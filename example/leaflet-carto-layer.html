<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>Example adding Carto Layer on Leaflet | Layer Manager</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
      integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
      crossorigin=""></script>
    <script src="https://unpkg.com/esri-leaflet@2.1.3/dist/esri-leaflet.js"
      integrity="sha512-pijLQd2FbV/7+Jwa86Mk3ACxnasfIMzJRrIlVQsuPKPCfUBCDMDUoLiBQRg7dAQY6D1rkmCcR8286hVTn/wlIg=="
      crossorigin=""></script>
    <script src="../dist/bundle.js"></script>

    <style type="text/css">
      *, html { margin:0; padding:0 }
      #map_canvas { position: absolute; width: 100%; height: 100vh; }
    </style>

    <script type="text/javascript">
      function initMap() {
        const mymap = L.map('map_canvas').setView([40, -3], 5);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);

        fetch('http://api.resourcewatch.org/v1/layer?ids=914882a7-179a-4b78-9814-5f03384ad294,5c8ec7a7-ce63-4841-b011-b0188fe0fc84')
          .then(response => response.json())
          .then((layerSpec) => {
            // Extracting layers from datasets
            // const layerSpec = [];
            // for (let i = 0; i < datasetSpec.data.length; i++) {
            //   const layers = datasetSpec.data[i].attributes.layer;
            //   for (let j = 0; j < layers.length; j++) {
            //     const element = layers[j];
            //     layerSpec.push(element);
            //   }
            // }

            // Initializing layer manager
            const { LayerManagerLeaflet } = layerManager;
            const lm = new LayerManagerLeaflet(mymap);

            console.log(layerSpec);
            // Adding layers
            lm.add(layerSpec);

            window.lm = lm;
          });
      }

      document.addEventListener('DOMContentLoaded', initMap);
    </script>
  </head>
  <body>
    <div id="map_canvas"></div>
  </body>
</html>

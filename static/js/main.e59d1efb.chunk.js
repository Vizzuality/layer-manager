(window.webpackJsonpsandbox=window.webpackJsonpsandbox||[]).push([[0],{227:function(e,t,n){e.exports=function(e,t,n,r,a,i,o,s){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var c="default"in t?t.default:t;n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,o=o&&o.hasOwnProperty("default")?o.default:o,s=s&&s.hasOwnProperty("default")?s.default:s;var u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},f=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},m=function(e,t,n,r){try{e(n(r))}catch(a){t(a)}},v=function(){function e(t){l(this,e),this._promise=new Promise(t),this._canceled=!1}return p(e,null,[{key:"all",value:function(t){return new e((function(e,n){Promise.all(t).then(e,n)}))}},{key:"race",value:function(t){return new e((function(e,n){Promise.race(t).then(e,n)}))}},{key:"reject",value:function(t){return new e((function(e,n){Promise.reject(t).then(e,n)}))}},{key:"resolve",value:function(t){return new e((function(e,n){Promise.resolve(t).then(e,n)}))}}]),p(e,[{key:"then",value:function(t,n){var r=this,a=new e((function(e,i){r._promise.then((function(n){r._canceled&&a.cancel(),t&&!r._canceled?m(e,i,t,n):e(n)}),(function(t){r._canceled&&a.cancel(),n&&!r._canceled?m(e,i,n,t):i(t)}))}));return a}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,t),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,e,{changedAttributes:{}})}return p(t,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(t){var n=this,r=d({},this),a=d({},t);this.set("changedAttributes",{}),Object.keys(a).forEach((function(t){e(r[t],a[t])||(n.changedAttributes[t]=a[t],n.set(t,a[t]))}))}}]),t}(),b={"Content-Type":"application/json"},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.get(e,d({headers:b},t))},x=function(e,t){return c.post(e,t,{headers:b})},O={carto:function(e,r,a,i){var o=e.interactivity,s=e.source.provider,c=JSON.stringify({version:"1.3.0",stat_tag:"API",layers:s.layers.map((function(e){return o&&o.length?d({},e,{options:d({},e.options,{interactivity:o})}):e}))}),u=d({stat_tag:"API",config:encodeURIComponent(c)},s.api_key&&{api_key:s.api_key}),l=Object.keys(u).map((function(e){return e+"="+u[e]})).join("&");(function(e,n,r,a){var i=a.layerRequest;i&&i.cancel("Operation canceled by the user.");var o=t.CancelToken.source();return a.set("layerRequest",o),("post"===e?x:w)(n,d({},r,{cancelToken:o.token})).then((function(e){return e.status>400?(console.error(e),!1):e.data}))})("get","https://"+s.account+".carto.com/api/v1/map?"+l,{},e).then((function(t){var i="vector"===e.type?"mvt":"png",o=t.cdn_url.templates.https.url.replace("{s}","a")+"/"+s.account+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}."+i;return a(d({},r,{source:d({},n(r.source,"provider"),{tiles:[o]})}))})).catch((function(e){return i(e)}))}},k=function(){function e(t,n,r){var a;l(this,e),this.map=t,this.providers=d({},O,r),this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new n(this.map,this.options),(a=this.plugin)&&(["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach((function(e){a[e]||console.error("The "+e+" function is required for layer manager plugins")})),["getLayerByProvider"].forEach((function(e){a[e]&&console.warn("The "+e+" function is deprecated for layer manager plugins")})))}return p(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},n=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var r=new g(d({},e,t)),a=r.id;return this.layers.find((function(e){return e.id===a}))||(this.layers.push(r),this.requestLayer(r,n)),this.layers}},{key:"update",value:function(e,t){var n=this.getLayerModel(e);if(n&&n.mapLayer){n.update(t);var a=t.opacity,i=t.visibility,o=t.zIndex,s=t.source,c=t.render,u=t.params,l=t.sqlParams,p=t.decodeParams;"undefined"!==typeof a&&this.plugin.setOpacity(n,a),"undefined"!==typeof i&&this.plugin.setVisibility(n,i),"undefined"!==typeof o&&this.plugin.setZIndex(n,o),r(s)||this.plugin.setSource(n),r(c)||this.plugin.setRender(n),r(u)||this.plugin.setParams(n),r(l)||this.plugin.setSqlParams(n),r(p)||this.plugin.setDecodeParams(n)}}},{key:"remove",value:function(e,t){var n=this.layers.slice(0);this.requestCancel(e);var r=this.getLayerModel(e);r&&this.plugin.remove(r),this.layers=n.filter((function(t){return t.id!==e})),t(r)}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"setOpacity",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setOpacity(n,t)}},{key:"setVisibility",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setVisibility(n,t)}},{key:"setZIndex",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setZIndex(n,t)}},{key:"requestLayer",value:function(e,t){var n=this,r=e.type,a=this.plugin.getLayerByType(r);return a?(this.requestCancel(e.id),this.promises[e.id]=a.call(this,e,this.providers).then((function(r){n.promises[e.id]._canceled||(e.set("mapLayer",r),n.plugin.add(e,n.layers),n.plugin.setZIndex(e,e.zIndex),n.plugin.setOpacity(e,e.opacity),n.plugin.setVisibility(e,e.visibility),n.plugin.setRender(e),t(e))})),this):(this.promises[e.id]=v.reject(new Error(r+" type is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}]),e}(),E=function(e){function t(e){l(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.map,a=e.plugin,i=e.providers;return n.layerManager=new k(r,a,i),n}return y(t,e),p(t,[{key:"componentWillUnmount",value:function(){this.layerManager.unmount()}},{key:"render",value:function(){var e=this,t=this.props.children;return t&&a.Children.count(t)?a.Children.map(t,(function(t,n){return t&&a.cloneElement(t,{layerManager:e.layerManager,zIndex:t.props.zIndex||1e3-n})})):null}}]),t}(a.PureComponent);E.propTypes={map:i.shape({}).isRequired,plugin:i.func.isRequired,providers:i.shape({}),children:i.oneOfType([i.arrayOf(i.node),i.node])},E.defaultProps={children:[],providers:{}};var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return Object.keys(t).forEach((function(e){(Array.isArray(t[e])||s(t[e]))&&(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{{"+e+"}}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{{"+e+"}}`","g"),JSON.stringify(t[e])).replace(new RegExp('"{'+e+'}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{"+e+"}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{"+e+"}`","g"),JSON.stringify(t[e]))),"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),n=n.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])})),n},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,r=void 0;return Object.keys(t).forEach((function(e){r=(r=""+o(Object.keys(t[e]).map((function(n){var r=t[e][n];return Array.isArray(r)&&r.length?n+" IN ("+r.map((function(e){return"number"!==typeof e?"'"+e+"'":e})).join(", ")+")":!Array.isArray(r)&&r?"number"!==typeof r?n+" = '"+r+"'":n+" = "+r:null}))).join(" AND "))&&e.startsWith("where")?"WHERE "+r:r&&e.startsWith("and")?"AND "+r:"",n=(n=n.replace(new RegExp("{{"+e+"}}","g"),r)).replace(new RegExp("{"+e+"}","g"),r)})),n},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e;return"string"===typeof r&&(r=_(r,t),r=L(r,n)),r},j=function(t){function n(){var e,t,r;l(this,n);for(var a=arguments.length,i=Array(a),o=0;o<a;o++)i[o]=arguments[o];return t=r=h(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(i))),r.add=function(){var e=r.props,t=e.layerManager,n=e.onAfterAdd,a=f(e,["layerManager","onAfterAdd"]),i=a.source,o=a.render,s=a.params,c=a.sqlParams,u=!1===i.parse?i:JSON.parse(P(JSON.stringify(i),s,c)),l=!1===o.parse?o:JSON.parse(P(JSON.stringify(o),s,c));t.add(d({},a,{source:u,render:l}),{},n)},r.update=function(e){var t=r.props,n=t.layerManager,a=t.id;n.update(a,e)},r.remove=function(){var e=r.props,t=e.layerManager,n=e.id,a=e.onAfterRemove;t.remove(n,a)},h(r,t)}return y(n,t),p(n,[{key:"componentDidMount",value:function(){this.add()}},{key:"componentDidUpdate",value:function(t){var n=t.source,a=t.render,i=t.params,o=t.sqlParams,s=t.decodeParams,c=t.opacity,u=t.visibility,l=t.zIndex,p=this.props,y=p.type,f=p.source,h=p.render,m=p.params,v=p.sqlParams,g=p.decodeParams,b=p.opacity,w=p.visibility,x=p.zIndex,O=!1===n.parse?n:JSON.parse(P(JSON.stringify(n),i,o)),k=!1===f.parse?f:JSON.parse(P(JSON.stringify(f),m,v)),E=!1===a.parse?a:JSON.parse(P(JSON.stringify(a),i,o)),_=!1===h.parse?h:JSON.parse(P(JSON.stringify(h),m,v));if(k&&!e(k,O)){var L=k.type,j=k.data,C=L||y;if("raster"===C||"vector"===C||"geojson"===C&&"string"===typeof j)return this.remove(),void this.add()}if(_&&!e(_,E)){var T=_.layers,S=void 0===T?[]:T,R=E.layers,z=void 0===R?[]:R;if(S.length!==z.length)return this.remove(),void this.add()}var M=d({},b!==c&&{opacity:b},w!==u&&{visibility:w},x!==l&&{zIndex:x},!e(k,E)&&{source:k},!e(_,E)&&{render:_},!e(g,s)&&{decodeParams:g});r(M)||this.update(M)}},{key:"componentWillUnmount",value:function(){this.remove()}},{key:"render",value:function(){return null}}]),n}(a.PureComponent);j.propTypes={id:i.oneOfType([i.string,i.number]).isRequired,type:i.oneOf(["raster","vector","geojson"]).isRequired,source:i.shape({parse:i.bool}).isRequired,render:function(e,t,n){return"vector"===e.type&&r(e[t])?new Error("The prop '"+t+"' is marked as required in '"+n+"', but its value is {}"):"object"!==u(e[t])?new Error("Invalid prop '"+t+"' of type '"+u(e[t])+"' supplied to '"+n+"', expected 'object'."):null},params:i.shape({}),sqlParams:i.shape({}),decodeParams:i.shape({}),opacity:i.number,visibility:i.bool,zIndex:i.number,onAfterAdd:i.func,onAfterRemove:i.func,layerManager:i.shape({add:i.func.isRequired,update:i.func.isRequired,remove:i.func.isRequired,map:i.shape({getSource:i.func})})},j.defaultProps={params:void 0,sqlParams:void 0,decodeParams:void 0,opacity:1,visibility:!0,zIndex:void 0,render:{},layerManager:null,onAfterAdd:function(){},onAfterRemove:function(){}};var C={};return C.LayerManager=E,C.Layer=j,C}(n(223),n(137),n(224),n(99),n(570),n(573),n(225),n(71))},233:function(e,t){},312:function(e,t,n){e.exports=n.p+"static/media/marker1.f388fa7a.svg"},313:function(e,t,n){e.exports=n.p+"static/media/marker2.c4f943ea.svg"},353:function(e,t,n){e.exports=n(605)},457:function(e,t,n){},458:function(e,t,n){},576:function(e,t){},603:function(e,t,n){},604:function(e,t,n){},605:function(e,t,n){"use strict";n.r(t);var r=n(6),a=n.n(r),i=n(222),o=n.n(i),s=n(314),c=n(74),u=n(30),l=n(147),p=n(299),d=n.n(p),y=n(118),f=n.n(y),h=n(67),m=n.n(h),v=function(e,t){var n=new Date(t),r=new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()),i=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate());return Math.floor((i-a)/864e5)},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e||{},n=t.startDate,r=t.endDate,a=t.minDate,i=t.maxDate;if(!n||!r||!a||!i)return null;var o=new Date(a),s=new Date(i),c=v(s,o),u=new Date(n),l=new Date(r),p=c-v(s,u),d=c-v(s,l),y=p||0,f=d||c;return{startDayIndex:y,endDayIndex:f,numberOfDays:c}},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.reduce((function(e,t){var n=t.key,r=t.default;return Object(u.a)({},e,Object(c.a)({},n,r))}),{}),r=Object(u.a)({},n,{},t),a=r.startDate,i=r.endDate,o=r.trimEndDate,s=r.maxAbsoluteDate,l=a,p=i>s?s:i,d=o>s?s:o;return Object(u.a)({},r,{},!!l&&{startYear:m()(l).year(),startMonth:m()(l).month(),startDay:m()(l).dayOfYear()},{},!!i&&{endYear:m()(p).year(),endMonth:m()(p).month(),endDay:m()(p).dayOfYear()},{},!!o&&{trimEndYear:m()(d).year(),trimEndMonth:m()(d).month(),trimEndDay:m()(d).dayOfYear()},{},g(r))},w=n(315),x=n(173),O=n(174),k=n(181),E=n(175),_=n(183),L=n(300),P=n.n(L),j=n(226),C=n.n(j),T=n(189),S=n(623),R=n(613),z=(n(456),n(457),{zoom:2,lat:0,lng:0}),M=function(e){function t(){var e,n;Object(x.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(k.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(a)))).events={},n.HOVER={},n.state={viewport:Object(u.a)({},z,{},n.props.viewport),flying:!1,loaded:!1},n.onLoad=function(){var e=n.props,t=e.bounds,r=e.onLoad;n.setState({loaded:!0}),!f()(t)&&t.bbox&&n.fitBounds(),r({map:n.map,mapContainer:n.mapContainer})},n.onViewportChange=function(e,t){var r=n.props.onViewportChange;n.setState({viewport:e}),r(e)},n.onResize=function(e){var t=n.props.onViewportChange,r=n.state.viewport,a=Object(u.a)({},r,{},e);n.setState({viewport:a}),t(a)},n.onMoveEnd=function(){var e=n.props.onViewportChange,t=n.state.viewport;if(n.map){var r=n.map.getBearing(),a=n.map.getPitch(),i=n.map.getZoom(),o=n.map.getCenter(),s=o.lng,c=o.lat,l=Object(u.a)({},t,{bearing:r,pitch:a,zoom:i,latitude:c,longitude:s});n.setState({viewport:l}),e(l)}},n.onHover=function(e){var t=n.props.onHover,r=e.features;if(r&&r.length){var a=r[0],i=a.id,o=a.source,s=a.sourceLayer;n.HOVER.id&&n.map.setFeatureState(Object(u.a)({},n.HOVER),{hover:!1}),i&&o&&(n.HOVER=Object(u.a)({id:i,source:o},s&&{sourceLayer:s}),n.map.setFeatureState(Object(u.a)({},n.HOVER),{hover:!0}))}t&&t(e)},n.onMouseLeave=function(e){var t=n.props.onMouseLeave;n.HOVER.id&&n.map.setFeatureState(Object(u.a)({},n.HOVER),{hover:!1}),n.HOVER={},t&&t(e)},n.fitBounds=function(){var e=n.state.viewport,t=n.props,r=t.bounds,a=t.onViewportChange,i=r.bbox,o=r.options,s=Object(u.a)({width:n.mapContainer.offsetWidth,height:n.mapContainer.offsetHeight},e),c=new S.a(s).fitBounds([[i[0],i[1]],[i[2],i[3]]],o),l=c.longitude,p=c.latitude,d=c.zoom,y=Object(u.a)({},n.state.viewport,{longitude:l,latitude:p,zoom:d,transitionDuration:2500,transitionInterruption:T.b.UPDATE});n.setState({flying:!0,viewport:y}),a(y),setTimeout((function(){n.setState({flying:!1})}),2500)},n}return Object(_.a)(t,e),Object(O.a)(t,[{key:"componentDidUpdate",value:function(e){var t=e.viewport,n=e.bounds,r=this.props,a=r.viewport,i=r.bounds,o=this.state.viewport;C()(a,t)||this.setState({viewport:Object(u.a)({},o,{},a)}),f()(i)||C()(i,n)||this.fitBounds()}},{key:"render",value:function(){var e=this,t=this.props,n=t.customClass,r=t.children,i=(t.getCursor,t.dragPan),o=t.dragRotate,s=t.scrollZoom,u=t.touchZoom,l=t.touchRotate,p=t.doubleClickZoom,d=Object(w.a)(t,["customClass","children","getCursor","dragPan","dragRotate","scrollZoom","touchZoom","touchRotate","doubleClickZoom"]),y=this.state,f=y.viewport,h=y.loaded,m=y.flying;return a.a.createElement("div",{ref:function(t){e.mapContainer=t},className:P()(Object(c.a)({"c-map":!0},n,!!n))},a.a.createElement(T.c,Object.assign({ref:function(t){e.map=t&&t.getMap()}},d,f,{width:"100%",height:"100%",dragPan:!m&&i,dragRotate:!m&&o,scrollZoom:!m&&s,touchZoom:!m&&u,touchRotate:!m&&l,doubleClickZoom:!m&&p,onViewportChange:this.onViewportChange,onResize:this.onResize,onLoad:this.onLoad,onHover:this.onHover,onMouseLeave:this.onMouseLeave,transitionInterpolator:new T.a,transitionEasing:R.a}),h&&!!this.map&&"function"===typeof r&&r(this.map)))}}]),t}(r.Component);M.defaultProps={children:null,customClass:null,viewport:z,bounds:{},dragPan:!0,dragRotate:!0,onViewportChange:function(){},onLoad:function(){},getCursor:function(e){var t=e.isHovering,n=e.isDragging;return t?"pointer":n?"grabbing":"grab"}};var A=M,D=(n(458),function(e){function t(){return Object(x.a)(this,t),Object(k.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.props.children;return a.a.createElement("div",{className:"c-sidebar"},a.a.createElement("div",{className:"sidebar--scroll"},e))}}]),t}(a.a.Component)),I=n(302),N=n.n(I),F=(n(464),n(465),n(227)),q=n(223),Z=n.n(q),V=n(137),J=n.n(V),H=n(224),U=n.n(H),B=n(99),Y=n.n(B),W=n(225),G=n.n(W),X=n(71),Q=n.n(X),$=n(622),K=n(310),ee=n(180),te=n(625),ne=n(621),re=n(77),ae=n.n(re),ie=n(121),oe=n(123),se=n(231),ce=n.n(se),ue=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},le=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),pe=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ye=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},he=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){a=!0,i=c}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},me=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},ve=function(e,t,n,r){try{e(n(r))}catch(a){t(a)}},ge=function(){function e(t){ue(this,e),this._promise=new Promise(t),this._canceled=!1}return le(e,null,[{key:"all",value:function(t){return new e((function(e,n){Promise.all(t).then(e,n)}))}},{key:"race",value:function(t){return new e((function(e,n){Promise.race(t).then(e,n)}))}},{key:"reject",value:function(t){return new e((function(e,n){Promise.reject(t).then(e,n)}))}},{key:"resolve",value:function(t){return new e((function(e,n){Promise.resolve(t).then(e,n)}))}}]),le(e,[{key:"then",value:function(t,n){var r=this,a=new e((function(e,i){r._promise.then((function(n){r._canceled&&a.cancel(),t&&!r._canceled?ve(e,i,t,n):e(n)}),(function(t){r._canceled&&a.cancel(),n&&!r._canceled?ve(e,i,n,t):i(t)}))}));return a}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ue(this,e),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,t,{changedAttributes:{}})}return le(e,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(e){var t=this,n=de({},this),r=de({},e);this.set("changedAttributes",{}),Object.keys(r).forEach((function(e){Z()(n[e],r[e])||(t.changedAttributes[e]=r[e],t.set(e,r[e]))}))}}]),e}(),we={"Content-Type":"application/json"},xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J.a.get(e,de({headers:we},t))},Oe=function(e,t){return J.a.post(e,t,{headers:we})},ke=function(e,t,n,r){var a=r.layerRequest;a&&a.cancel("Operation canceled by the user.");var i=V.CancelToken.source();return r.set("layerRequest",i),("post"===e?Oe:xe)(t,de({},n,{cancelToken:i.token})).then((function(e){return e.status>400?(console.error(e),!1):e.data}))},Ee={carto:function(e,t,n,r){var a=e.interactivity,i=e.source.provider,o=JSON.stringify({version:"1.3.0",stat_tag:"API",layers:i.layers.map((function(e){return a&&a.length?de({},e,{options:de({},e.options,{interactivity:a})}):e}))}),s=de({stat_tag:"API",config:encodeURIComponent(o)},i.api_key&&{api_key:i.api_key}),c=Object.keys(s).map((function(e){return e+"="+s[e]})).join("&"),u="https://"+i.account+".carto.com/api/v1/map?"+c;ke("get",u,{},e).then((function(r){var a="vector"===e.type?"mvt":"png",o=r.cdn_url.templates.https.url.replace("{s}","a")+"/"+i.account+"/api/v1/map/"+r.layergroupid+"/{z}/{x}/{y}."+a;return n(de({},t,{source:de({},U()(t.source,"provider"),{tiles:[o]})}))})).catch((function(e){return r(e)}))}};!function(){function e(t,n,r){ue(this,e),this.map=t,this.providers=de({},Ee,r),this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new n(this.map,this.options),function(e){if(e){["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach((function(t){e[t]||console.error("The "+t+" function is required for layer manager plugins")}));["getLayerByProvider"].forEach((function(t){e[t]&&console.warn("The "+t+" function is deprecated for layer manager plugins")}))}}(this.plugin)}le(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},n=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var r=new be(de({},e,t)),a=r.id;return this.layers.find((function(e){return e.id===a}))||(this.layers.push(r),this.requestLayer(r,n)),this.layers}},{key:"update",value:function(e,t){var n=this.getLayerModel(e);if(n&&n.mapLayer){n.update(t);var r=t.opacity,a=t.visibility,i=t.zIndex,o=t.source,s=t.render,c=t.params,u=t.sqlParams,l=t.decodeParams;"undefined"!==typeof r&&this.plugin.setOpacity(n,r),"undefined"!==typeof a&&this.plugin.setVisibility(n,a),"undefined"!==typeof i&&this.plugin.setZIndex(n,i),Y()(o)||this.plugin.setSource(n),Y()(s)||this.plugin.setRender(n),Y()(c)||this.plugin.setParams(n),Y()(u)||this.plugin.setSqlParams(n),Y()(l)||this.plugin.setDecodeParams(n)}}},{key:"remove",value:function(e,t){var n=this.layers.slice(0);this.requestCancel(e);var r=this.getLayerModel(e);r&&this.plugin.remove(r),this.layers=n.filter((function(t){return t.id!==e})),t(r)}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"setOpacity",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setOpacity(n,t)}},{key:"setVisibility",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setVisibility(n,t)}},{key:"setZIndex",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setZIndex(n,t)}},{key:"requestLayer",value:function(e,t){var n=this,r=e.type,a=this.plugin.getLayerByType(r);return a?(this.requestCancel(e.id),this.promises[e.id]=a.call(this,e,this.providers).then((function(r){n.promises[e.id]._canceled||(e.set("mapLayer",r),n.plugin.add(e,n.layers),n.plugin.setZIndex(e,e.zIndex),n.plugin.setOpacity(e,e.opacity),n.plugin.setVisibility(e,e.visibility),n.plugin.setRender(e),t(e))})),this):(this.promises[e.id]=ge.reject(new Error(r+" type is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}])}();var _e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return Object.keys(t).forEach((function(e){(Array.isArray(t[e])||Q()(t[e]))&&(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{{"+e+"}}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{{"+e+"}}`","g"),JSON.stringify(t[e])).replace(new RegExp('"{'+e+'}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{"+e+"}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{"+e+"}`","g"),JSON.stringify(t[e]))),"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),n=n.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])})),n},Le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,r=void 0;return Object.keys(t).forEach((function(e){r=(r=""+G()(Object.keys(t[e]).map((function(n){var r=t[e][n];return Array.isArray(r)&&r.length?n+" IN ("+r.map((function(e){return"number"!==typeof e?"'"+e+"'":e})).join(", ")+")":!Array.isArray(r)&&r?"number"!==typeof r?n+" = '"+r+"'":n+" = "+r:null}))).join(" AND "))&&e.startsWith("where")?"WHERE "+r:r&&e.startsWith("and")?"AND "+r:"",n=(n=n.replace(new RegExp("{{"+e+"}}","g"),r)).replace(new RegExp("{"+e+"}","g"),r)})),n},Pe=function(e,t){var n=t.id,r=t.params,a=t.sqlParams;if(e&&e.length){var i=JSON.parse(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e;return"string"===typeof r&&(r=_e(r,t),r=Le(r,n)),r}(JSON.stringify(e),r,a));return i&&i.map((function(e,r){var a=e.paint,i=void 0===a?{}:a,o=({symbol:["icon","text"],circle:["circle","circle-stroke"]}[e.type]||[e.type]).reduce((function(e,n){var r=i[n+"-opacity"],a=.99*t.opacity;return void 0!==r&&null!==r&&("number"===typeof r&&(a=r*t.opacity*.99),Array.isArray(r)&&(a=r.map((function(e){return"number"===typeof e?e*t.opacity*.99:e})))),de({},e,pe({},n+"-opacity",a))}),{}),s=e.paint&&Object.entries(e.paint).reduce((function(e,t){var n=he(t,2),r=n[0],a=n[1];return de({},e,!!a&&pe({},r,a))}),{});return de({id:n+"-"+e.type+"-"+r},e,{source:n},e.paint&&{paint:de({},s,o)})}))}return!1};function je(e){var t=e.map,n=e.gl,r=e.deck;if(t.__deck)return t.__deck;var a=r&&r.props._customRender,i={useDevicePixels:!0,_customRender:function(){t.triggerRepaint(),a&&a()},parameters:{depthMask:!0,depthTest:!0,blendFunc:[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],blendEquation:n.FUNC_ADD},userData:{isExternal:!1,mapboxLayers:new Set}};return r?(r.setProps(i),r.props.userData.isExternal=!0):(Object.assign(i,{gl:n,width:!1,height:!1,viewState:Ce(t)}),r=new $.a(i),t.on("move",(function(){return function(e,t){e.setProps({viewState:Ce(t)})}(r,t)})),t.on("remove",(function(){r.finalize(),t.__deck=null}))),r.props.userData.mapboxVersion=function(e){var t=0,n=0;if(e.version){var r=e.version.split(".").slice(0,2).map(Number),a=he(r,2);t=a[0],n=a[1]}return{major:t,minor:n}}(t),t.__deck=r,t.on("render",(function(){return function(e,t){var n=e.props.userData,r=n.mapboxLayers;if(n.isExternal){var a=Array.from(r,(function(e){return e.id})),i=Se(e,(function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=a[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){if(Re(i.value,e))return!1}}catch(s){n=!0,r=s}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return!0}));i.length>0&&e._drawLayers("mapbox-repaint",{viewports:[Te(e,t,!1)],layers:i,clearCanvas:!1})}e.props.userData.currentViewport=null}(r,t)})),r}function Ce(e){var t=e.getCenter();return{longitude:t.lng,latitude:t.lat,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}}function Te(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.props.userData.mapboxVersion;return new K.a(Object.assign({x:0,y:0,width:e.width,height:e.height},Ce(t),n?{nearZMultiplier:1===r.major&&r.minor>=3||r.major>=2?.02:1/(e.height||1)}:{nearZMultiplier:.1}))}function Se(e,t){return e.layerManager.getLayers().filter(t)}function Re(e,t){for(var n=t;n;){if(n.id===e)return!0;n=n.parent}return!1}function ze(e){if(!e.props.userData.isExternal){var t=[];e.props.userData.mapboxLayers.forEach((function(e){var n=new(0,e.props.type)(e.props);t.push(n)})),e.setProps({layers:t})}}var Me=function(){function e(t){if(ue(this,e),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}return le(e,[{key:"onAdd",value:function(e,t){var n,r;this.map=e,this.deck=je({map:e,gl:t,deck:this.props.deck}),n=this.deck,r=this,n.props.userData.mapboxLayers.add(r),ze(n)}},{key:"onRemove",value:function(){var e,t;e=this.deck,t=this,e.props.userData.mapboxLayers.delete(t),ze(e)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&ze(this.deck)}},{key:"render",value:function(){!function(e,t,n){var r=e.props.userData.currentViewport;r||(r=Te(e,t,!0),e.props.userData.currentViewport=r),e._drawLayers("mapbox-repaint",{viewports:[r],layers:Se(e,(function(e){return Re(n.id,e)})),clearCanvas:!1})}(this.deck,this.map,this)}}]),e}();function Ae(e,t,n){var r=e/Math.pow(2,n)*360-180,a=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}var De=function(){function e(t){var n=t.getTileData,r=t.x,a=t.y,i=t.z,o=t.onTileLoad,s=t.onTileError;ue(this,e),this.x=r,this.y=a,this.z=i,this.bbox=function(e,t,n){var r=Ae(e,t,n),a=he(r,2),i=a[0],o=a[1],s=Ae(e+1,t+1,n),c=he(s,2),u=c[0];return[i,c[1],u,o]}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=n,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileLoad=o,this.onTileError=s}return le(e,[{key:"_loadData",value:function(){var e=this,t=this.x,n=this.y,r=this.z,a=this.bbox;return this.getTileData?Promise.resolve(this.getTileData({x:t,y:n,z:r,bbox:a})).then((function(t){return e._data=t,e._isLoaded=!0,e.onTileLoad(e),t})).catch((function(t){e._isLoaded=!0,e.onTileError(t)})):null}},{key:"isOverlapped",value:function(e){var t=this.x,n=this.y,r=this.z,a=Math.pow(2,e.z-r);return Math.floor(e.x/a)===t&&Math.floor(e.y/a)===n}},{key:"data",get:function(){return this._data||this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),e}();function Ie(e){return e/256}function Ne(e,t){var n=e.x,r=e.y,a=e.z,i=Math.pow(2,a-t);return{x:Math.floor(n/i),y:Math.floor(r/i),z:t}}var Fe=function(){function e(t){var n=t.getTileData,r=t.maxSize,a=t.maxZoom,i=t.minZoom,o=t.onTileLoad,s=t.onTileError;ue(this,e),this._getTileData=n,this._maxSize=r,this.onTileError=s,this.onTileLoad=o,this._cache=new Map,this._tiles=[],Number.isFinite(a)&&(this._maxZoom=Math.floor(a)),Number.isFinite(i)&&(this._minZoom=Math.ceil(i))}return le(e,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(e){var t=this._cache,n=this._getTileData,r=this._maxSize,a=this._maxZoom,i=this._minZoom;this._markOldTiles();var o=function(e,t,n){var r=Math.floor(e.zoom)+1;if(n&&r<n)return[];var a=function(e){var t=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([0,e.height]),e.unproject([e.width,e.height])];return[t.reduce((function(e,t){return e<t[0]?e:t[0]}),180),t.reduce((function(e,t){return e<t[1]?e:t[1]}),90),t.reduce((function(e,t){return e>t[0]?e:t[0]}),-180),t.reduce((function(e,t){return e>t[1]?e:t[1]}),-90)]}(e=new e.constructor(de({},e,{zoom:r-1}))),i=Object(te.a)([a[0],a[3]],e.scale).map(Ie),o=he(i,2),s=o[0],c=o[1],u=Object(te.a)([a[2],a[1]],e.scale).map(Ie),l=he(u,2),p=l[0],d=l[1];s=Math.floor(s),p=Math.ceil(p),c=Math.floor(c),d=Math.ceil(d);for(var y=[],f=s;f<p;f++)for(var h=c;h<d;h++)t&&r>t?y.push(Ne({x:f,y:h,z:r},t)):y.push({x:f,y:h,z:r});return y}(e,a,i);if(o&&0!==o.length){t.forEach((function(e){o.some((function(t){return e.isOverlapped(t)}))&&(e.isVisible=!0)}));for(var s=!1,c=0;c<o.length;c++){var u=o[c],l=u.x,p=u.y,d=u.z,y=this._getTile(l,p,d);y||((y=new De({getTileData:n,x:l,y:p,z:d,onTileLoad:this.onTileLoad,onTileError:this.onTileError})).isVisible=!0,s=!0);var f=this._getTileId(l,p,d);t.set(f,y)}if(s){this._resizeCache(r||5*o.length),this._tiles=Array.from(this._cache.values()).sort((function(e,t){return e.z-t.z}))}}}},{key:"_resizeCache",value:function(e){var t=this._cache;if(t.size>e){var n=t[Symbol.iterator](),r=!0,a=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(t.size<=e)break;var u=c[0];c[1].isVisible||t.delete(u)}}catch(l){a=!0,i=l}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach((function(e){e.isVisible=!1}))}},{key:"_getTile",value:function(e,t,n){var r=this._getTileId(e,t,n);return this._cache.get(r)}},{key:"_getTileId",value:function(e,t,n){return n+"-"+e+"-"+t}},{key:"tiles",get:function(){return this._tiles}}]),e}(),qe={renderSubLayers:{type:"function",value:function(){return null}},getTileData:{type:"function",value:function(){return Promise.resolve(null)}},onViewportLoaded:{type:"function",optional:!0,value:null},onTileError:{type:"function",value:function(e){return console.error(e)}},maxZoom:null,minZoom:0,maxCacheSize:null},Ze=function(e){function t(){return ue(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ye(t,e),le(t,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,n=e.context,r=e.changeFlags,a=this.state.tileCache;if(!a||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData)){var i=t.getTileData,o=t.maxZoom,s=t.minZoom,c=t.maxCacheSize;a&&a.finalize(),a=new Fe({getTileData:i,maxSize:c,maxZoom:o,minZoom:s,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileCache:a})}else r.updateTriggersChanged&&this.state.tileCache.tiles.forEach((function(e){e.layer=null}));var u=n.viewport;if(r.viewportChanged&&"DEFAULT-INITIAL-VIEWPORT"!==u.id){var l=this.getLayerZoomLevel();a.update(u);var p=a.tiles.filter((function(e){return e.z===l}));this.setState({isLoaded:!1,tiles:p}),this._onTileLoad()}}},{key:"_onTileLoad",value:function(){var e=this.props.onViewportLoaded,t=this.state.tiles,n=t.every((function(e){return e.isLoaded}));this.state.isLoaded!==n&&(this.setState({isLoaded:n}),n&&e&&e(t.filter((function(e){return e._data})).map((function(e){return e._data}))))}},{key:"_onTileError",value:function(e){this.props.onTileError(e),this._onTileLoad()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.sourceLayer;return t.sourceLayer=n,t.tile=n.props.tile,t}},{key:"getLayerZoomLevel",value:function(){var e=Math.floor(this.context.viewport.zoom)+1,t=this.props,n=t.maxZoom,r=t.minZoom;return Number.isFinite(n)&&e>n?Math.floor(n):Number.isFinite(r)&&e<r?Math.ceil(r):e}},{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.visible,r=t.opacity,a=t.decodeParams,i=t.renderSubLayers,o=this.getLayerZoomLevel();return this.state.tiles.map((function(t){var s=n&&t.isVisible&&(!e.state.isLoaded||t.z===o);return t.layer?t.layer.props.visible!==s?t.layer=t.layer.clone({visible:s}):t.layer.props.opacity!==r?t.layer=t.layer.clone({opacity:r}):t.layer.props.decodeParams&&(t.layer=t.layer.clone({decodeParams:a})):t.layer=i(de({},e.props,{id:e.id+"-"+t.x+"-"+t.y+"-"+t.z,data:t.data,visible:s,opacity:r,tile:t,zoom:o})),t.layer}))}}]),t}(ne.a);Ze.layerName="TileLayer",Ze.defaultProps=qe;var Ve,Je=ie.d.fp64LowPart,He=(pe(Ve={},ae.a.TEXTURE_MIN_FILTER,ae.a.NEAREST),pe(Ve,ae.a.TEXTURE_MAG_FILTER,ae.a.NEAREST),pe(Ve,ae.a.TEXTURE_WRAP_S,ae.a.CLAMP_TO_EDGE),pe(Ve,ae.a.TEXTURE_WRAP_T,ae.a.CLAMP_TO_EDGE),Ve),Ue=function(e){function t(){return ue(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ye(t,e),le(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n\n  vTexCoord = texCoords;\n\n  picking_setPickingColor(vec3(0., 0., 1.));\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\n{decodeParams}\n\nuniform float opacity;\nuniform float zoom;\n\n\nvec4 decodeFunction(vec3 color, float alpha) {\n  {decodeFunction}\n  return vec4(color, alpha * opacity);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  // clear mask\n  if (bitmapColor == vec4(0., 0., 0., 1.)) {\n    discard;\n  }\n\n  // custom decode\n  gl_FragColor = decodeFunction(bitmapColor.rgb, bitmapColor.a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n".replace("{decodeParams}",Object.keys(this.props.decodeParams).map((function(e){return"uniform float "+e+";"})).join(" ")).replace("{decodeFunction}",this.props.decodeFunction||""),modules:["project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(12)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(12)}}),this.setState({numInstances:4})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;if(t.fp64!==n.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}t.image!==n.image&&this.loadTexture(t.image);var a=this.getAttributeManager();t.bounds!==n.bounds&&(this.setState({positions:this._getPositionsFromBounds(t.bounds)}),a.invalidate("positions"),a.invalidate("positions64xyLow"))}},{key:"finalizeState",value:function(){(function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_getPositionsFromBounds",value:function(e){var t=new Array(12);if(Number.isFinite(e[0]))t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[0],t[4]=e[3],t[5]=0,t[6]=e[2],t[7]=e[3],t[8]=0,t[9]=e[2],t[10]=e[1],t[11]=0;else for(var n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return t}},{key:"_getModel",value:function(e){return e?new ie.b(e,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new ie.a({drawMode:ae.a.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,r=n.bitmapTexture,a=n.model,i=this.props,o=i.desaturate,s=i.transparentColor,c=i.tintColor,u=i.zoom,l=i.decodeParams,p=i.opacity;r&&a&&a.setUniforms(Object.assign({},t,de({bitmapTexture:r,desaturate:o,transparentColor:s,tintColor:c,zoom:u},l,{opacity:p}))).draw()}},{key:"loadTexture",value:function(e){var t=this;if("string"===typeof e&&(e=Object(oe.b)(e)),e instanceof Promise)e.then((function(e){return t.loadTexture(e)}));else{var n=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof ie.c?this.setState({bitmapTexture:e}):(e instanceof Image||e instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new ie.c(n,{data:e,parameters:He,mipmaps:!1})})}}},{key:"calculatePositions",value:function(e){var t=e.value,n=this.state.positions;t.set(n)}},{key:"calculatePositions64xyLow",value:function(e){var t=this.use64bitPositions();(e.constant=!t,t)?e.value.set(this.state.positions.map(Je)):e.value=new Float32Array(4)}}]),t}(ee.a);Ue.layerName="DecodeLayer",Ue.defaultProps={image:null,bounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var Be=function(e,t){var n=e.source,r=void 0===n?{}:n,a=e.render,i=void 0===a?{}:a,o=e.decodeParams,s=e.id,c=e.opacity,u=e.decodeFunction,l={id:s+"-raster",type:"raster",source:s},p=r.provider,d=i.layers,y=void 0===d?[l]:d,f={};if(f=u?{id:s,type:"custom",layers:[{id:s+"-raster-decode-bg",type:"background",paint:{"background-color":"transparent"}}].concat(me(r.tiles.map((function(t){return new Me({id:s+"-raster-decode",type:Ze,getTileData:function(e){return function(e,t){var n=e.x,r=e.y,a=e.z,i=t.replace("{z}",a).replace("{x}",n).replace("{y}",r);return fetch(i).then((function(e){return e.blob()})).then((function(e){var t=(e||{}).type;if("application/xml"!==t&&"text/xml"!==t&&"text/html"!==t){var n=URL.createObjectURL(e),r=new Image;return r.src=n,r}return!1}))}(e,t)},renderSubLayers:function(e){var t=e.id,n=e.data,r=e.tile,a=e.visible,i=e.zoom,o=e.decodeParams,s=e.decodeFunction;return n&&n.src?new Ue({id:t,image:n.src,bounds:r.bbox,visible:a,zoom:i,decodeParams:o,decodeFunction:s,opacity:c}):null},minZoom:r.minzoom,maxZoom:r.maxzoom,opacity:e.opacity,decodeParams:o,decodeFunction:u})}))))}:{id:s,type:"raster",source:de({type:"raster",tileSize:256},r),layers:Pe(y.map((function(e){return de({},l,e)})),e)},p){var h=t[p.type];return new ge((function(t,n){h||n(new Error(p.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),h.call(void 0,e,f,t,n)}))}return new ge((function(e,t){f?e(f):t(new Error("error in layer config"))}))},Ye=function(e,t){var n=e.source,r=void 0===n?{}:n,a=e.render,i=void 0===a?{}:a,o=e.id,s=r.provider,c=i.layers,u=de({id:o,source:de({type:"vector"},r)},i,{layers:Pe(c,e)});if(s){var l=t[s.type];return new ge((function(t,n){l||n(new Error(s.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),l.call(void 0,e,u,t,n)}))}return new ge((function(e,t){u?e(u):t(new Error("error in layer config"))}))},We=function(e,t){var n=e.source,r=void 0===n?{}:n,a=e.render,i=void 0===a?{}:a,o=e.id,s=r.provider,c=i.layers,u=de({id:o,source:de({type:"geojson"},r)},i,{layers:Pe(c,e)});if(s){var l=t[s.type];return new ge((function(t,n){l||n(new Error(s.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),l.call(void 0,e,u,t,n)}))}return new ge((function(e,t){u?e(u):t(new Error('"type" specified in layer spec doesn`t exist'))}))},Ge=function(e){var t=e.source,n=void 0===t?{}:t,r=e.render,a=e.id,i=de({id:a,type:"raster",source:de({},n,{type:"video-tiled",tiles:["https://storage.googleapis.com/skydipper_materials/movie-tiles/EVI_TEST/{z}/{x}/{y}.mp4"],scheme:"xyz",tileSize:256,minzoom:1,maxzoom:4,playbackRate:.1})},r,{layers:[{id:a+"-raster",type:"raster",source:a}]});return new ge((function(e,t){i?e(i):t(new Error("error in layer config"))}))},Xe=function(){function e(t,n){var r=this;ue(this,e),this.type={raster:Be,vector:Ye,geojson:We,video:Ge},this.map=t,this.options=n,this.map.on("style.load",(function(){r.getLayers().forEach((function(e){return r.add(e)}))}))}return le(e,[{key:"add",value:function(e){var t=this,n=e.images,r=e.mapLayer,a=this.getLayers();Array.isArray(n)&&n.forEach((function(e){var n=e.id,r=e.src;if(!t.map.hasImage(n)){var a=new Image;a.src=r,a.onload=function(){t.map.addImage(n,a)}}})),this.map&&r&&r.source&&r.id&&!this.map.getSource(r.id)&&this.map.addSource(r.id,r.source),r&&r.layers&&r.layers.forEach((function(n){var r=n.metadata,i="top"===(void 0===r?{}:r).position?null:t.getNextLayerId(e);t.map&&!t.map.getLayer(n.id)&&t.map.addLayer(n,i),a.forEach((function(){t.setZIndex()}))}))}},{key:"remove",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.mapLayer;n&&n.layers&&this.map&&this.map.style&&n.layers.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),n&&this.map&&this.map.getSource(n.id)&&this.map.removeSource(n.id)}},{key:"getLayerByType",value:function(e){return this.type[e]}},{key:"getLayersOnMap",value:function(){return this.map.getStyle().layers}},{key:"getLayer",value:function(e){var t=e.mapLayer;return this.map?this.map.getSource(t.id):null}},{key:"getLayers",value:function(){var e=this.options.getLayers,t=e();return ce()(t,(function(e){return e.decodeFunction}))}},{key:"getNextLayerId",value:function(e){var t=e.zIndex,n=this.getLayers(),r=this.getLayersOnMap(),a=r&&r.length&&r.find((function(e){return e.id.includes("custom-layers")||e.id.includes("label")||e.id.includes("place")||e.id.includes("poi")})),i=ce()(n,(function(e){return e.zIndex})).find((function(e){return e.zIndex>t&&(!e.mapLayer||!e.mapLayer.layers||!e.mapLayer.layers[0]||!e.mapLayer.layers[0].metadata||!e.mapLayer.layers[0].metadata.position)}));if(!i||i&&!i.mapLayer)return a.id;var o=i.mapLayer.layers[0].id;return!!r.find((function(e){return o===e.id}))?o:a.id}},{key:"setZIndex",value:function(){var e=this,t=this.getLayers(),n=this.getLayersOnMap();n.forEach((function(n){var r=n.id,a=n.metadata,i=void 0===a?{}:a,o=t.find((function(e){return r.includes(e.id)}));if(o){var s="top"===i.position?null:e.getNextLayerId(o);e.map.moveLayer(r,s)}}));var r=t.filter((function(e){return!!e.decodeFunction}));return r&&this.map&&r.forEach((function(t){var r=t.mapLayer;if(r){var a=r.layers,i=a[0],o=a[1],s=n.find((function(e){return e.id===i.id})),c=e.map.getLayer(o.id);s&&c&&e.map.moveLayer(o.id,i.id)}})),!0}},{key:"setOpacity",value:function(e,t){var n=this,r={symbol:["icon","text"],circle:["circle","circle-stroke"]},a=e.render,i=e.mapLayer,o=e.decodeFunction,s=a.layers,c=void 0===s?[]:s;if(i.layers&&!o&&i.layers.forEach((function(t){var a=r[t.type]||[t.type],i=(c.find((function(e,n){return(e.id||t.source+"-"+e.type+"-"+n)===t.id}))||{}).paint,o=void 0===i?{}:i;a.forEach((function(r){var a=o[r+"-opacity"],i=.99*e.opacity;void 0!==a&&null!==a&&("number"===typeof a&&(i=a*e.opacity*.99),Array.isArray(a)&&(i=a.map((function(t){return"number"===typeof t?t*e.opacity*.99:t})))),n.map.setPaintProperty(t.id,r+"-opacity",i)}))})),o){var u=i.layers[1];u&&"function"===typeof u.setProps&&u.setProps({opacity:t})}}},{key:"setVisibility",value:function(e,t){var n=this,r=e.mapLayer;r&&r.layers&&this.map&&this.map.style&&r.layers.forEach((function(e){n.map.setLayoutProperty(e.id,"visibility",t?"visible":"none")}))}},{key:"setSource",value:function(e){var t=e.id,n=e.source,r=n.type,a=n.data;this.map&&"geojson"===r&&a&&"string"!==typeof a&&this.map.getSource(t).setData(a);return this}},{key:"setRender",value:function(e){var t=this,n=e.mapLayer,r=e.render.layers,a=void 0===r?[]:r;if(!n||!a.length)return this;try{n.layers.forEach((function(e,n){var r=e.id,i=a[n]||a[0]||{},o=i.paint,s=void 0===o?{}:o,c=i.layout,u=void 0===c?{}:c,l=i.filter,p=void 0===l?null:l;t.map.setFilter(r,p),Object.keys(s).forEach((function(e){t.map.setPaintProperty(r,e,s[e])})),Object.keys(u).forEach((function(e){t.map.setLayoutProperty(r,e,u[e])}))}))}catch(i){console.error(i)}return this}},{key:"setParams",value:function(){return this}},{key:"setSQLParams",value:function(){return this}},{key:"setDecodeParams",value:function(e){var t=e.mapLayer,n=e.decodeParams;if(!t)return this;var r=t.layers[1];return r&&"function"===typeof r.setProps?r.setProps({decodeParams:n}):console.error("Layer is not present. You defined decodeParams but maybe you didn't define a decodeFunction"),this}},{key:"unmount",value:function(){this.map=null}}]),e}(),Qe=n(88),$e=n(312),Ke=n.n($e),et=n(313),tt=n.n(et),nt=[{id:"gain",name:"Tree cover gain",config:{type:"raster",source:{type:"raster",tiles:["https://earthengine.google.org/static/hansen_2013/gain_alpha/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{type:"basic",items:[{name:"Tree cover gain",color:"#6D6DE5"}]}},{id:"loss",name:"Tree cover loss",config:{type:"raster",source:{type:"raster",tiles:["https://storage.googleapis.com/wri-public/Hansen_16/tiles/hansen_world/v1/tc30/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{enabled:!0},decodeConfig:[{default:"2001-01-01",key:"startDate",required:!0},{default:"2018-12-31",key:"endDate",required:!0}],timelineConfig:{step:1,speed:250,interval:"years",dateFormat:"YYYY",trimEndDate:"2018-12-31",maxDate:"2018-12-31",minDate:"2001-01-01",canPlay:!0,railStyle:{background:"#DDD"},trackStyle:[{background:"#dc6c9a"},{background:"#982d5f"}]},decodeFunction:"\n      // values for creating power scale, domain (input), and range (output)\n      float domainMin = 0.;\n      float domainMax = 255.;\n      float rangeMin = 0.;\n      float rangeMax = 255.;\n\n      float exponent = zoom < 13. ? 0.3 + (zoom - 3.) / 20. : 1.;\n      float intensity = color.r * 255.;\n\n      // get the min, max, and current values on the power scale\n      float minPow = pow(domainMin, exponent - domainMin);\n      float maxPow = pow(domainMax, exponent);\n      float currentPow = pow(intensity, exponent);\n\n      // get intensity value mapped to range\n      float scaleIntensity = ((currentPow - minPow) / (maxPow - minPow) * (rangeMax - rangeMin)) + rangeMin;\n      // a value between 0 and 255\n      alpha = zoom < 13. ? scaleIntensity / 255. : color.g;\n\n      float year = 2000.0 + (color.b * 255.);\n      // map to years\n      if (year >= startYear && year <= endYear && year >= 2001.) {\n        color.r = 220. / 255.;\n        color.g = (72. - zoom + 102. - 3. * scaleIntensity / zoom) / 255.;\n        color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n      } else {\n        alpha = 0.;\n      }\n    "},{id:"protected-areas",name:"Protected areas",config:{type:"vector",source:{type:"vector",promoteId:"cartodb_id",provider:{type:"carto",account:"wri-01",layers:[{options:{cartocss:"#wdpa_protected_areas {  polygon-opacity: 1.0; polygon-fill: #704489 }",cartocss_version:"2.3.0",sql:"SELECT * FROM wdpa_protected_areas"},type:"mapnik"}]}},render:{layers:[{type:"fill","source-layer":"layer0",featureState:{},paint:{"fill-color":["case",["boolean",["feature-state","hover"],!1],"#000","#5ca2d1"],"fill-color-transition":{duration:300,delay:0},"fill-opacity":1}},{type:"line","source-layer":"layer0",paint:{"line-color":"#000000","line-opacity":.1}}]}},paramsConfig:[],legendConfig:{type:"basic",items:[{name:"Protected areas",color:"#5ca2d1"}]},interactionConfig:{enabled:!0,type:"hover"}},{id:"mongabay-stories",name:"Mongabay stories",config:{type:"geojson",images:[{id:"lm-marker1",src:Ke.a},{id:"lm-marker2",src:tt.a}],source:{type:"geojson",promoteId:"cartodb_id",data:"https://wri-01.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20mongabay&format=geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:45},render:{metadata:{position:"top"},layers:[{id:"media-clusters",metadata:{position:"top"},type:"circle",filter:["has","point_count"],paint:{"circle-color":"#FFF","circle-stroke-width":2,"circle-stroke-color":["case",["boolean",["feature-state","hover"],!1],"#000","#5ca2d1"],"circle-radius":12}},{id:"media-cluster-count",metadata:{position:"top"},type:"symbol",filter:["has","point_count"],layout:{"text-allow-overlap":!0,"text-ignore-placement":!0,"text-field":"{point_count_abbreviated}","text-size":12}},{id:"media",metadata:{position:"top"},type:"symbol",filter:["!",["has","point_count"]],layout:{"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-image":"lm-marker1","icon-size":.05}}]}},paramsConfig:[],legendConfig:{type:"basic",items:[{name:"Mongabay stories",color:"#FFCC00"}]},interactionConfig:{enabled:!0,type:"hover"}}];n(603);var rt=function(){var e=Object(r.useState)(nt),t=Object(l.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(JSON.stringify(nt,null,2)),p=Object(l.a)(o,2),y=p[0],h=p[1],m=Object(r.useState)({}),v=Object(l.a)(m,2),g=v[0],w=v[1],x=Object(r.useState)([]),O=Object(l.a)(x,2),k=O[0],E=O[1],_=n.map((function(e){var t=e.id,n=e.paramsConfig,r=e.sqlConfig,a=e.decodeConfig,i=e.timelineConfig,o=g[t]||{},s=!!n&&b(n,o.params),c=!!r&&b(r,o.sqlParams),l=!!a&&b(a,Object(u.a)({},i,{},o.decodeParams)),p=!!i&&Object(u.a)({},i,{},b(n,o.params),{},b(a,o.decodeParams));return Object(u.a)({id:t,slug:t,dataset:t,layers:[Object(u.a)({active:!0},e,{},o,{params:s,sqlParams:c,decodeParams:l,timelineParams:p})]},o)})),L=function(e,t){w(Object(u.a)({},g,Object(c.a)({},e.id,Object(u.a)({},g[e.id],{visibility:t}))))},P=function(e,t){w(Object(u.a)({},g,Object(c.a)({},e.id,Object(u.a)({},g[e.id],{opacity:t}))))},j=function(e,t){var n=t.id,r=t.decodeConfig;w(Object(u.a)({},g,Object(c.a)({},n,Object(u.a)({},g[n],{},r&&{decodeParams:{startDate:e[0],endDate:e[1],trimEndDate:e[2]}},{},!r&&{params:{startDate:e[0],endDate:e[1]}}))))},C=function(e){f()(e.interactionConfig)||e.mapLayer.layers.forEach((function(e){var t=e.id;k.includes(t)||E((function(e){return[].concat(Object(s.a)(e),[t])}))}))},T=function(e){f()(e.interactionConfig)||e.mapLayer.layers.forEach((function(e){var t=e.id;k.includes(t)&&E((function(e){return e.filter((function(e){return e!==t}))}))}))};return a.a.createElement("div",{className:"c-app"},a.a.createElement(Qe.Icons,null),a.a.createElement("div",{className:"c-main"},a.a.createElement(D,null,a.a.createElement(N.a,{mode:"json",theme:"github",value:y,onChange:function(e){h(e);try{var t=JSON.parse(e);i(t)}catch(n){}},tabSize:2,width:"100%",height:"100%",wrapEnabled:!0,showPrintMargin:!1,editorProps:{$blockScrolling:!0},debounceChangePeriod:500})),a.a.createElement("div",{className:"c-map-container"},a.a.createElement(A,{mapboxApiAccessToken:"pk.eyJ1IjoibGF5ZXItbWFuYWdlciIsImEiOiJjazA2dTJnMG0zc3lwM251dGM0aXhiYTVxIn0.AaoErQTRezfQshqnEKIg8A",minZoom:2,mapOptions:{fadeDuration:0},interactiveLayerIds:k},(function(e){return a.a.createElement(F.LayerManager,{map:e,plugin:Xe,providers:{"carto-sql-points":function(e,t,n,r){var a=e.source.provider;ke("get",a.url,a.options,e).then((function(e){return n(Object(u.a)({},t,{source:Object(u.a)({},d()(t.source,"provider"),{data:{type:"FeatureCollection",features:e.rows.map((function(e){return{type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.lon,e.lat]}}}))}})}))})).catch((function(e){r(e)}))}}},n.map((function(e){var t=e.id,n=e.paramsConfig,r=e.sqlConfig,i=e.decodeConfig,o=e.timelineConfig,s=e.decodeFunction,c=g[t]||{},l=Object(u.a)({},e,{},e.config,{},c,{},!!n&&{params:b(n,Object(u.a)({},c.params))},{},!!r&&{sqlParams:b(r,Object(u.a)({},c.sqlParams))},{},!!i&&{decodeParams:b(i,Object(u.a)({},o,{},c.decodeParams)),decodeFunction:s});return a.a.createElement(F.Layer,Object.assign({key:e.id},l,{onAfterAdd:C,onAfterRemove:T}))})))})),a.a.createElement("div",{className:"c-legend"},a.a.createElement(Qe.Legend,{maxHeight:"65vh",collapsable:!1,sortable:!1,onChangeOrder:function(e){console.log("onChangeOrder",e)}},_.map((function(e,t){return a.a.createElement(Qe.LegendListItem,{index:t,key:e.slug,layerGroup:e,toolbar:a.a.createElement(Qe.LegendItemToolbar,null,a.a.createElement(Qe.LegendItemButtonOpacity,{trackStyle:{background:"#FFCC00"},handleStyle:{background:"#FFCC00"}}),a.a.createElement(Qe.LegendItemButtonVisibility,null)),onChangeVisibility:L,onChangeOpacity:P},a.a.createElement(Qe.LegendItemTypes,null),a.a.createElement(Qe.LegendItemTimeStep,{defaultStyles:{handleStyle:{backgroundColor:"white",borderRadius:"50%",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.29)",border:"0px",zIndex:2},railStyle:{backgroundColor:"#d6d6d9"},dotStyle:{visibility:"hidden",border:"0px"}},handleChange:j}))})))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(604);o.a.render(a.a.createElement(rt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[353,1,2]]]);
//# sourceMappingURL=main.e59d1efb.chunk.js.map
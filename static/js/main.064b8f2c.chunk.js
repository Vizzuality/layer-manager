(window.webpackJsonpsandbox=window.webpackJsonpsandbox||[]).push([[0],{188:function(e,t,n){e.exports=function(e,t,n,r,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a;var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},p=function(e,t,n,r){try{e(n(r))}catch(a){t(a)}},d=function(){function e(t){i(this,e),this._promise=new Promise(t),this._canceled=!1}return o(e,null,[{key:"all",value:function(t){return new e(function(e,n){Promise.all(t).then(e,n)})}},{key:"race",value:function(t){return new e(function(e,n){Promise.race(t).then(e,n)})}},{key:"reject",value:function(t){return new e(function(e,n){Promise.reject(t).then(e,n)})}},{key:"resolve",value:function(t){return new e(function(e,n){Promise.resolve(t).then(e,n)})}}]),o(e,[{key:"then",value:function(t,n){var r=this,a=new e(function(e,i){r._promise.then(function(n){r._canceled&&a.cancel(),t&&!r._canceled?p(e,i,t,n):e(n)},function(t){r._canceled&&a.cancel(),n&&!r._canceled?p(e,i,n,t):i(t)})});return a}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,e,{changedAttributes:{}})}return o(t,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(t){var n=this,r=s({},this),a=s({},t);this.set("changedAttributes",{}),Object.keys(a).forEach(function(t){e(r[t],a[t])||(n.changedAttributes[t]=a[t],n.set(t,a[t]))})}}]),t}(),y=function(){function e(t,n){var r;i(this,e),this.map=t,this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new n(this.map,this.options),(r=this.plugin)&&(["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach(function(e){r[e]||console.error("The "+e+" function is required for layer manager plugins")}),["getLayerByProvider"].forEach(function(e){r[e]&&console.warn("The "+e+" function is deprecated for layer manager plugins")}))}return o(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},n=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var r=new f(s({},e,t)),a=r.id;return this.layers.find(function(e){return e.id===a})?this.layers:(this.layers.push(r),this.requestLayer(r,n),this.layers)}},{key:"update",value:function(e,n){var r=this.getLayerModel(e);if(r&&r.mapLayer){r.update(n);var a=n.opacity,i=n.visibility,o=n.zIndex,s=n.source,c=n.render,u=n.params,l=n.sqlParams,p=n.decodeParams;"undefined"!==typeof a&&this.plugin.setOpacity(r,a),"undefined"!==typeof i&&this.plugin.setVisibility(r,i),"undefined"!==typeof o&&this.plugin.setZIndex(r,o),t(s)||this.plugin.setSource(r),t(c)||this.plugin.setRender(r),t(u)||this.plugin.setParams(r),t(l)||this.plugin.setSqlParams(r),t(p)||this.plugin.setDecodeParams(r)}}},{key:"remove",value:function(e){var t=this.layers.slice(0);this.requestCancel(e);var n=this.getLayerModel(e);n&&this.plugin.remove(n),this.layers=t.filter(function(t){return t.id!==e})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find(function(t){return t.id===e})}},{key:"setOpacity",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setOpacity(n,t)}},{key:"setVisibility",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setVisibility(n,t)}},{key:"setZIndex",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setZIndex(n,t)}},{key:"requestLayer",value:function(e,t){var n=this,r=e.type,a=e.provider,i=this.plugin.getLayerByType(r);return i?(this.requestCancel(e.id),this.promises[e.id]=i.call(this,e).then(function(r){n.promises[e.id]._canceled||(e.set("mapLayer",r),n.plugin.add(e,n.layers),n.plugin.setZIndex(e,e.zIndex),n.plugin.setOpacity(e,e.opacity),n.plugin.setVisibility(e,e.visibility),n.plugin.setRender(e),t(e))}),this):(this.promises[e.id]=d.reject(new Error(a+" provider is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}]),e}(),h=function(e){function t(e){i(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.map,a=e.plugin;return n.layerManager=new y(r,a),n}return c(t,e),o(t,[{key:"componentWillUnmount",value:function(){this.layerManager.unmount()}},{key:"render",value:function(){var e=this,t=this.props.children;return t&&n.Children.count(t)?n.Children.map(t,function(t,r){return t&&n.cloneElement(t,{layerManager:e.layerManager,zIndex:t.props.zIndex||1e3-r})}):null}}]),t}(n.PureComponent);h.propTypes={map:r.shape({}).isRequired,plugin:r.func.isRequired,children:r.oneOfType([r.arrayOf(r.node),r.node])},h.defaultProps={children:[]};var m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return Object.keys(t).forEach(function(e){"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),n=n.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])}),n},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,r=void 0;return Object.keys(t).forEach(function(e){r=(r=""+a(Object.keys(t[e]).map(function(n){var r=t[e][n];return Array.isArray(r)&&r.length?n+" IN ("+r.map(function(e){return"number"!==typeof e?"'"+e+"'":e}).join(", ")+")":!Array.isArray(r)&&r?"number"!==typeof r?n+" = '"+r+"'":n+" = "+r:null})).join(" AND "))&&e.startsWith("where")?"WHERE "+r:r&&e.startsWith("and")?"AND "+r:"",n=(n=n.replace(new RegExp("{{"+e+"}}","g"),r)).replace(new RegExp("{"+e+"}","g"),r)}),n},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e;return"string"===typeof r&&(r=m(r,t),r=v(r,n)),r},b=function(n){function r(){var e,t,n;i(this,r);for(var a=arguments.length,o=Array(a),c=0;c<a;c++)o[c]=arguments[c];return t=n=l(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(o))),n.add=function(){var e=n.props,t=e.layerManager,r=e.onAfterAdd,a=u(e,["layerManager","onAfterAdd"]),i=a.source,o=a.render,c=a.params,l=a.sqlParams,p=!1===i.parse?i:JSON.parse(g(JSON.stringify(i),c,l)),d=!1===o.parse?o:JSON.parse(g(JSON.stringify(o),c,l));t.add(s({},a,{source:p,render:d}),{},r)},n.update=function(e){var t=n.props,r=t.layerManager,a=t.id;r.update(a,e)},n.remove=function(){var e=n.props,t=e.layerManager,r=e.id;t.remove(r)},l(n,t)}return c(r,n),o(r,[{key:"componentDidMount",value:function(){this.add()}},{key:"componentDidUpdate",value:function(n){var r=n.source,a=n.render,i=n.params,o=n.sqlParams,c=n.decodeParams,u=n.opacity,l=n.visibility,p=n.zIndex,d=this.props,f=d.type,y=d.source,h=d.render,m=d.params,v=d.sqlParams,b=d.decodeParams,w=d.opacity,O=d.visibility,x=d.zIndex,k=!1===r.parse?r:JSON.parse(g(JSON.stringify(r),i,o)),P=!1===y.parse?y:JSON.parse(g(JSON.stringify(y),m,v)),_=!1===a.parse?a:JSON.parse(g(JSON.stringify(a),i,o)),L=!1===h.parse?h:JSON.parse(g(JSON.stringify(h),m,v));if(P&&!e(P,k)){var E=P.type,j=P.data,T=E||f;if("raster"===T||"vector"===T||"geojson"===T&&"string"===typeof j)return this.remove(),void this.add()}if(L&&!e(L,_)){var S=L.layers,C=void 0===S?[]:S,D=_.layers,z=void 0===D?[]:D;if(C.length!==z.length)return this.remove(),void this.add()}var M=s({},w!==u&&{opacity:w},O!==l&&{visibility:O},x!==p&&{zIndex:x},!e(P,_)&&{source:P},!e(L,_)&&{render:L},!e(b,c)&&{decodeParams:b});t(M)||this.update(M)}},{key:"componentWillUnmount",value:function(){this.remove()}},{key:"render",value:function(){return null}}]),r}(n.PureComponent);b.propTypes={id:r.oneOfType([r.string,r.number]).isRequired,source:r.shape({parse:r.oneOfType([r.bool,r.func])}),render:r.shape({parse:r.oneOfType([r.bool,r.func])}),params:r.shape({}),sqlParams:r.shape({}),decodeParams:r.shape({}),opacity:r.number,visibility:r.bool,zIndex:r.number,onAfterAdd:r.func,layerManager:r.shape({add:r.func.isRequired,update:r.func.isRequired,remove:r.func.isRequired,map:r.shape({getSource:r.func})})},b.defaultProps={params:void 0,sqlParams:void 0,decodeParams:void 0,opacity:1,visibility:!0,zIndex:void 0,source:{parse:!0},render:{},layerManager:null,onAfterAdd:function(){}};var w={};return w.LayerManager=h,w.Layer=b,w}(n(184),n(91),n(431),n(434),n(185))},194:function(e,t){},296:function(e,t,n){e.exports=n(496)},366:function(e,t,n){},367:function(e,t,n){},453:function(e,t){},494:function(e,t,n){},495:function(e,t,n){},496:function(e,t,n){"use strict";n.r(t);var r=n(6),a=n.n(r),i=n(183),o=n.n(i),s=n(3),c=n(20),u=n(64),l=n.n(u);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=function(e,t){var n=new Date(t),r=new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()),i=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate());return Math.floor((i-a)/864e5)},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e||{},n=t.startDate,r=t.endDate,a=t.minDate,i=t.maxDate;if(!n||!r||!a||!i)return null;var o=new Date(a),s=new Date(i),c=f(s,o),u=new Date(n),l=new Date(r),p=c-f(s,u),d=c-f(s,l),y=p||0,h=d||c;return{startDayIndex:y,endDayIndex:h,numberOfDays:c}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.reduce(function(e,t){var n=t.key,r=t.default;return d({},e,Object(s.a)({},n,r))},{}),r=d({},n,{},t),a=r.startDate,i=r.endDate,o=r.trimEndDate,c=r.maxAbsoluteDate,u=a,p=i>c?c:i,f=o>c?c:o;return d({},r,{},!!u&&{startYear:l()(u).year(),startMonth:l()(u).month(),startDay:l()(u).dayOfYear()},{},!!i&&{endYear:l()(p).year(),endMonth:l()(p).month(),endDay:l()(p).dayOfYear()},{},!!o&&{trimEndYear:l()(f).year(),trimEndMonth:l()(f).month(),trimEndDay:l()(f).dayOfYear()},{},y(r))},m=n(258),v=n(14),g=n(13),b=n(26),w=n(22),O=n(25),x=n(245),k=n.n(x),P=n(186),_=n.n(P),L=n(187),E=n.n(L),j=n(166),T=n(512),S=n(257);n(365),n(366);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z={zoom:2,lat:0,lng:0},M=function(e){function t(){var e,n;Object(v.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(b.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(a)))).events={},n.state={viewport:D({},z,{},n.props.viewport),flying:!1,loaded:!1},n.onLoad=function(){var e=n.props,t=e.bounds,r=e.onLoad;n.setState({loaded:!0}),!E()(t)&&t.bbox&&n.fitBounds(),r({map:n.map,mapContainer:n.mapContainer})},n.onViewportChange=function(e,t){var r=n.props.onViewportChange;n.setState({viewport:e}),r(e)},n.onResize=function(e){var t=n.props.onViewportChange,r=D({},n.state.viewport,{},e);n.setState({viewport:r}),t(r)},n.onMoveEnd=function(){var e=n.props.onViewportChange,t=n.state.viewport;if(n.map){var r=n.map.getBearing(),a=n.map.getPitch(),i=n.map.getZoom(),o=n.map.getCenter(),s=o.lng,c=D({},t,{bearing:r,pitch:a,zoom:i,latitude:o.lat,longitude:s});n.setState({viewport:c}),e(c)}},n.fitBounds=function(){var e=n.state.viewport,t=n.props,r=t.bounds,a=t.onViewportChange,i=r.bbox,o=r.options,s=D({width:n.mapContainer.offsetWidth,height:n.mapContainer.offsetHeight},e),c=new T.a(s).fitBounds([[i[0],i[1]],[i[2],i[3]]],o),u=c.longitude,l=c.latitude,p=c.zoom,d=D({},n.state.viewport,{longitude:u,latitude:l,zoom:p,transitionDuration:2500,transitionInterruption:j.b.UPDATE});n.setState({flying:!0,viewport:d}),a(d),setTimeout(function(){n.setState({flying:!1})},2500)},n}return Object(O.a)(t,e),Object(g.a)(t,[{key:"componentDidUpdate",value:function(e){var t=e.viewport,n=e.bounds,r=this.props,a=r.viewport,i=r.bounds,o=this.state.viewport;_()(a,t)||this.setState({viewport:D({},o,{},a)}),E()(i)||_()(i,n)||this.fitBounds()}},{key:"render",value:function(){var e=this,t=this.props,n=t.customClass,r=t.children,i=(t.getCursor,t.dragPan),o=t.dragRotate,c=t.scrollZoom,u=t.touchZoom,l=t.touchRotate,p=t.doubleClickZoom,d=Object(m.a)(t,["customClass","children","getCursor","dragPan","dragRotate","scrollZoom","touchZoom","touchRotate","doubleClickZoom"]),f=this.state,y=f.viewport,h=f.loaded,v=f.flying;return a.a.createElement("div",{ref:function(t){e.mapContainer=t},className:k()(Object(s.a)({"c-map":!0},n,!!n))},a.a.createElement(j.c,Object.assign({ref:function(t){e.map=t&&t.getMap()}},d,y,{width:"100%",height:"100%",dragPan:!v&&i,dragRotate:!v&&o,scrollZoom:!v&&c,touchZoom:!v&&u,touchRotate:!v&&l,doubleClickZoom:!v&&p,onViewportChange:this.onViewportChange,onResize:this.onResize,onLoad:this.onLoad,transitionInterpolator:new j.a,transitionEasing:S.a}),h&&!!this.map&&"function"===typeof r&&r(this.map)))}}]),t}(r.Component);M.defaultProps={children:null,customClass:null,viewport:z,bounds:{},dragPan:!0,dragRotate:!0,onViewportChange:function(){},onLoad:function(){},getCursor:function(e){var t=e.isHovering,n=e.isDragging;return t?"pointer":n?"grabbing":"grab"}};var I=M,R=(n(367),function(e){function t(){return Object(v.a)(this,t),Object(b.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props.children;return a.a.createElement("div",{className:"c-sidebar"},a.a.createElement("div",{className:"sidebar--scroll"},e))}}]),t}(a.a.Component)),A=n(247),N=n.n(A),F=(n(373),n(374),n(188)),q=n(184),Z=n.n(q),V=n(91),J=n.n(V),B=n(161),U=n.n(B),Y=n(185),W=n.n(Y),H=n(511),G=n(255),X=n(158),Q=n(513),$=n(510),K=n(72),ee=n.n(K),te=n(108),ne=n(109),re=n(192),ae=n.n(re),ie=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},oe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),se=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ue=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},le=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},pe=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){a=!0,i=c}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),de=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},fe=function(e,t,n,r){try{e(n(r))}catch(a){t(a)}},ye=function(){function e(t){ie(this,e),this._promise=new Promise(t),this._canceled=!1}return oe(e,null,[{key:"all",value:function(t){return new e(function(e,n){Promise.all(t).then(e,n)})}},{key:"race",value:function(t){return new e(function(e,n){Promise.race(t).then(e,n)})}},{key:"reject",value:function(t){return new e(function(e,n){Promise.reject(t).then(e,n)})}},{key:"resolve",value:function(t){return new e(function(e,n){Promise.resolve(t).then(e,n)})}}]),oe(e,[{key:"then",value:function(t,n){var r=this,a=new e(function(e,i){r._promise.then(function(n){r._canceled&&a.cancel(),t&&!r._canceled?fe(e,i,t,n):e(n)},function(t){r._canceled&&a.cancel(),n&&!r._canceled?fe(e,i,n,t):i(t)})});return a}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ie(this,e),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,t,{changedAttributes:{}})}return oe(e,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(e){var t=this,n=ce({},this),r=ce({},e);this.set("changedAttributes",{}),Object.keys(r).forEach(function(e){Z()(n[e],r[e])||(t.changedAttributes[e]=r[e],t.set(e,r[e]))})}}]),e}();!function(){function e(t,n){ie(this,e),this.map=t,this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new n(this.map,this.options),function(e){if(e){["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach(function(t){e[t]||console.error("The "+t+" function is required for layer manager plugins")});["getLayerByProvider"].forEach(function(t){e[t]&&console.warn("The "+t+" function is deprecated for layer manager plugins")})}}(this.plugin)}oe(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},n=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var r=new he(ce({},e,t)),a=r.id;return this.layers.find(function(e){return e.id===a})?this.layers:(this.layers.push(r),this.requestLayer(r,n),this.layers)}},{key:"update",value:function(e,t){var n=this.getLayerModel(e);if(n&&n.mapLayer){n.update(t);var r=t.opacity,a=t.visibility,i=t.zIndex,o=t.source,s=t.render,c=t.params,u=t.sqlParams,l=t.decodeParams;"undefined"!==typeof r&&this.plugin.setOpacity(n,r),"undefined"!==typeof a&&this.plugin.setVisibility(n,a),"undefined"!==typeof i&&this.plugin.setZIndex(n,i),J()(o)||this.plugin.setSource(n),J()(s)||this.plugin.setRender(n),J()(c)||this.plugin.setParams(n),J()(u)||this.plugin.setSqlParams(n),J()(l)||this.plugin.setDecodeParams(n)}}},{key:"remove",value:function(e){var t=this.layers.slice(0);this.requestCancel(e);var n=this.getLayerModel(e);n&&this.plugin.remove(n),this.layers=t.filter(function(t){return t.id!==e})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find(function(t){return t.id===e})}},{key:"setOpacity",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setOpacity(n,t)}},{key:"setVisibility",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setVisibility(n,t)}},{key:"setZIndex",value:function(e,t){var n=this.getLayerModel(e);this.plugin.setZIndex(n,t)}},{key:"requestLayer",value:function(e,t){var n=this,r=e.type,a=e.provider,i=this.plugin.getLayerByType(r);return i?(this.requestCancel(e.id),this.promises[e.id]=i.call(this,e).then(function(r){n.promises[e.id]._canceled||(e.set("mapLayer",r),n.plugin.add(e,n.layers),n.plugin.setZIndex(e,e.zIndex),n.plugin.setOpacity(e,e.opacity),n.plugin.setVisibility(e,e.visibility),n.plugin.setRender(e),t(e))}),this):(this.promises[e.id]=ye.reject(new Error(a+" provider is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}])}();var me={"Content-Type":"application/json"},ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return U.a.get(e,ce({headers:me},t))},ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return Object.keys(t).forEach(function(e){"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(n=n.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),n=n.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])}),n},be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,r=void 0;return Object.keys(t).forEach(function(e){r=(r=""+W()(Object.keys(t[e]).map(function(n){var r=t[e][n];return Array.isArray(r)&&r.length?n+" IN ("+r.map(function(e){return"number"!==typeof e?"'"+e+"'":e}).join(", ")+")":!Array.isArray(r)&&r?"number"!==typeof r?n+" = '"+r+"'":n+" = "+r:null})).join(" AND "))&&e.startsWith("where")?"WHERE "+r:r&&e.startsWith("and")?"AND "+r:"",n=(n=n.replace(new RegExp("{{"+e+"}}","g"),r)).replace(new RegExp("{"+e+"}","g"),r)}),n},we=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e;return"string"===typeof r&&(r=ge(r,t),r=be(r,n)),r},Oe=function(e){var t=e.source,n=e.params,r=e.sqlParams,a=e.interactivity,i=(!1===t.parse?t:JSON.parse(we(JSON.stringify(t),n,r))).provider,o=JSON.stringify({version:"1.3.0",stat_tag:"API",layers:i.options.layers.map(function(e){return a&&a.length?ce({},e,{options:ce({},e.options,{interactivity:a})}):e})}),s=ce({stat_tag:"API",config:encodeURIComponent(o)},i.options.api_key&&{api_key:i.options.api_key}),c=Object.keys(s).map(function(e){return e+"="+s[e]}).join("&"),u="https://"+i.options.account+".carto.com/api/v1/map?"+c,l=e.layerRequest;l&&l.cancel("Operation canceled by the user.");var p=B.CancelToken.source();return e.set("layerRequest",p),ve(u,{cancelToken:p.token}).then(function(e){return e.status>400?(console.error(e),!1):e.data})},xe=function(e,t){var n=t.id,r=t.params,a=t.sqlParams;if(e&&e.length){var i=JSON.parse(we(JSON.stringify(e),r,a));return i&&i.map(function(e,r){var a=e.paint,i=void 0===a?{}:a,o=({symbol:["icon","text"],circle:["circle","circle-stroke"]}[e.type]||[e.type]).reduce(function(e,n){var r=i[n+"-opacity"];return ce({},e,se({},n+"-opacity",(void 0!==r&&null!==r?r:1)*t.opacity*.99))},{}),s=e.paint&&Object.entries(e.paint).reduce(function(e,t){var n=pe(t,2),r=n[0],a=n[1];return ce({},e,!!a&&se({},r,a))},{});return ce({id:n+"-"+e.type+"-"+r},e,{source:n},e.paint&&{paint:ce({},s,o)})})}return!1};function ke(e){var t=e.map,n=e.gl,r=e.deck;if(t.__deck)return t.__deck;var a=r&&r.props._customRender,i={useDevicePixels:!0,_customRender:function(){t.triggerRepaint(),a&&a()},parameters:{depthMask:!0,depthTest:!0,blendFunc:[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],blendEquation:n.FUNC_ADD},userData:{isExternal:!1,mapboxLayers:new Set}};return r?(r.setProps(i),r.props.userData.isExternal=!0):(Object.assign(i,{gl:n,width:!1,height:!1,viewState:Pe(t)}),r=new H.a(i),t.on("move",function(){return function(e,t){e.setProps({viewState:Pe(t)})}(r,t)}),t.on("remove",function(){r.finalize(),t.__deck=null})),r.props.userData.mapboxVersion=function(e){var t=0,n=0;if(e.version){var r=e.version.split(".").slice(0,2).map(Number),a=pe(r,2);t=a[0],n=a[1]}return{major:t,minor:n}}(t),t.__deck=r,t.on("render",function(){return function(e,t){var n=e.props.userData,r=n.mapboxLayers;if(n.isExternal){var a=Array.from(r,function(e){return e.id}),i=Le(e,function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=a[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){if(Ee(i.value,e))return!1}}catch(s){n=!0,r=s}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return!0});i.length>0&&(console.log("afterRender"),e._drawLayers("mapbox-repaint",{viewports:[_e(e,t,!1)],layers:i,clearCanvas:!1}))}e.props.userData.currentViewport=null}(r,t)}),r}function Pe(e){var t=e.getCenter();return{longitude:t.lng,latitude:t.lat,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}}function _e(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.props.userData.mapboxVersion;return new G.a(Object.assign({x:0,y:0,width:e.width,height:e.height},Pe(t),n?{nearZMultiplier:1===r.major&&r.minor>=3||r.major>=2?.02:1/(e.height||1)}:{nearZMultiplier:.1}))}function Le(e,t){return e.layerManager.getLayers().filter(t)}function Ee(e,t){for(var n=t;n;){if(n.id===e)return!0;n=n.parent}return!1}function je(e){if(!e.props.userData.isExternal){var t=[];e.props.userData.mapboxLayers.forEach(function(e){var n=new(0,e.props.type)(e.props);t.push(n)}),e.setProps({layers:t})}}var Te=function(){function e(t){if(ie(this,e),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}return oe(e,[{key:"onAdd",value:function(e,t){var n,r;this.map=e,this.deck=ke({map:e,gl:t,deck:this.props.deck}),n=this.deck,r=this,n.props.userData.mapboxLayers.add(r),je(n)}},{key:"onRemove",value:function(){var e,t;e=this.deck,t=this,e.props.userData.mapboxLayers.delete(t),je(e)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&je(this.deck)}},{key:"render",value:function(){!function(e,t,n){var r=e.props.userData.currentViewport;r||(r=_e(e,t,!0),e.props.userData.currentViewport=r),e._drawLayers("mapbox-repaint",{viewports:[r],layers:Le(e,function(e){return Ee(n.id,e)}),clearCanvas:!1})}(this.deck,this.map,this)}}]),e}();function Se(e,t,n){var r=e/Math.pow(2,n)*360-180,a=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}var Ce=function(){function e(t){var n=t.getTileData,r=t.x,a=t.y,i=t.z,o=t.onTileLoad,s=t.onTileError;ie(this,e),this.x=r,this.y=a,this.z=i,this.bbox=function(e,t,n){var r=Se(e,t,n),a=pe(r,2),i=a[0],o=a[1],s=Se(e+1,t+1,n),c=pe(s,2),u=c[0];return[i,c[1],u,o]}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=n,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileLoad=o,this.onTileError=s}return oe(e,[{key:"_loadData",value:function(){var e=this,t=this.x,n=this.y,r=this.z,a=this.bbox;return this.getTileData?Promise.resolve(this.getTileData({x:t,y:n,z:r,bbox:a})).then(function(t){return e._data=t,e._isLoaded=!0,e.onTileLoad(e),t}).catch(function(t){e._isLoaded=!0,e.onTileError(t)}):null}},{key:"isOverlapped",value:function(e){var t=this.x,n=this.y,r=this.z,a=Math.pow(2,e.z-r);return Math.floor(e.x/a)===t&&Math.floor(e.y/a)===n}},{key:"data",get:function(){return this._data||this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),e}(),De=256;function ze(e){return e/De}function Me(e,t){var n=e.x,r=e.y,a=e.z,i=Math.pow(2,a-t);return{x:Math.floor(n/i),y:Math.floor(r/i),z:t}}var Ie=function(){function e(t){var n=t.getTileData,r=t.maxSize,a=t.maxZoom,i=t.minZoom,o=t.onTileLoad,s=t.onTileError;ie(this,e),this._getTileData=n,this._maxSize=r,this.onTileError=s,this.onTileLoad=o,this._cache=new Map,this._tiles=[],Number.isFinite(a)&&(this._maxZoom=Math.floor(a)),Number.isFinite(i)&&(this._minZoom=Math.ceil(i))}return oe(e,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(e){var t=this._cache,n=this._getTileData,r=this._maxSize,a=this._maxZoom,i=this._minZoom;this._markOldTiles();var o=function(e,t,n){var r=Math.floor(e.zoom)+1;if(n&&r<n)return[];var a=function(e){var t=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([0,e.height]),e.unproject([e.width,e.height])];return[t.reduce(function(e,t){return e<t[0]?e:t[0]},180),t.reduce(function(e,t){return e<t[1]?e:t[1]},90),t.reduce(function(e,t){return e>t[0]?e:t[0]},-180),t.reduce(function(e,t){return e>t[1]?e:t[1]},-90)]}(e=new e.constructor(ce({},e,{zoom:r-1}))),i=Object(Q.a)([a[0],a[3]],e.scale).map(ze),o=pe(i,2),s=o[0],c=o[1],u=Object(Q.a)([a[2],a[1]],e.scale).map(ze),l=pe(u,2),p=l[0],d=l[1];s=Math.floor(s),p=Math.ceil(p),c=Math.floor(c),d=Math.ceil(d);for(var f=[],y=s;y<p;y++)for(var h=c;h<d;h++)t&&r>t?f.push(Me({x:y,y:h,z:r},t)):f.push({x:y,y:h,z:r});return f}(e,a,i);if(o&&0!==o.length){t.forEach(function(e){o.some(function(t){return e.isOverlapped(t)})&&(e.isVisible=!0)});for(var s=!1,c=0;c<o.length;c++){var u=o[c],l=u.x,p=u.y,d=u.z,f=this._getTile(l,p,d);f||((f=new Ce({getTileData:n,x:l,y:p,z:d,onTileLoad:this.onTileLoad,onTileError:this.onTileError})).isVisible=!0,s=!0);var y=this._getTileId(l,p,d);t.set(y,f)}if(s){this._resizeCache(r||5*o.length),this._tiles=Array.from(this._cache.values()).sort(function(e,t){return e.z-t.z})}}}},{key:"_resizeCache",value:function(e){var t=this._cache;if(t.size>e){var n=t[Symbol.iterator](),r=!0,a=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(t.size<=e)break;var u=c[0];c[1].isVisible||t.delete(u)}}catch(l){a=!0,i=l}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(e){e.isVisible=!1})}},{key:"_getTile",value:function(e,t,n){var r=this._getTileId(e,t,n);return this._cache.get(r)}},{key:"_getTileId",value:function(e,t,n){return n+"-"+e+"-"+t}},{key:"tiles",get:function(){return this._tiles}}]),e}(),Re={renderSubLayers:{type:"function",value:function(){return null}},getTileData:{type:"function",value:function(){return Promise.resolve(null)}},onViewportLoaded:{type:"function",optional:!0,value:null},onTileError:{type:"function",value:function(e){return console.error(e)}},maxZoom:null,minZoom:0,maxCacheSize:null},Ae=function(e){function t(){return ie(this,t),le(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ue(t,e),oe(t,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,n=e.context,r=e.changeFlags,a=this.state.tileCache;if(!a||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData)){var i=t.getTileData,o=t.maxZoom,s=t.minZoom,c=t.maxCacheSize;a&&a.finalize(),a=new Ie({getTileData:i,maxSize:c,maxZoom:o,minZoom:s,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileCache:a})}else r.updateTriggersChanged&&this.state.tileCache.tiles.forEach(function(e){e.layer=null});var u=n.viewport;if(r.viewportChanged&&"DEFAULT-INITIAL-VIEWPORT"!==u.id){var l=this.getLayerZoomLevel();a.update(u);var p=a.tiles.filter(function(e){return e.z===l});this.setState({isLoaded:!1,tiles:p}),this._onTileLoad()}}},{key:"_onTileLoad",value:function(){var e=this.props.onViewportLoaded,t=this.state.tiles,n=t.every(function(e){return e.isLoaded});this.state.isLoaded!==n&&(this.setState({isLoaded:n}),n&&e&&e(t.filter(function(e){return e._data}).map(function(e){return e._data})))}},{key:"_onTileError",value:function(e){this.props.onTileError(e),this._onTileLoad()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.sourceLayer;return t.sourceLayer=n,t.tile=n.props.tile,t}},{key:"getLayerZoomLevel",value:function(){var e=Math.floor(this.context.viewport.zoom)+1,t=this.props,n=t.maxZoom,r=t.minZoom;return Number.isFinite(n)&&e>n?Math.floor(n):Number.isFinite(r)&&e<r?Math.ceil(r):e}},{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.visible,r=t.opacity,a=t.decodeParams,i=t.renderSubLayers,o=this.getLayerZoomLevel();return this.state.tiles.map(function(t){var s=n&&t.isVisible&&(!e.state.isLoaded||t.z===o);return t.layer?t.layer.props.visible!==s?t.layer=t.layer.clone({visible:s}):t.layer.props.opacity!==r?t.layer=t.layer.clone({opacity:r}):t.layer.props.decodeParams&&(t.layer=t.layer.clone({decodeParams:a})):t.layer=i(ce({},e.props,{id:e.id+"-"+t.x+"-"+t.y+"-"+t.z,data:t.data,visible:s,opacity:r,tile:t,zoom:o})),t.layer})}}]),t}($.a);Ae.layerName="TileLayer",Ae.defaultProps=Re;var Ne,Fe=te.d.fp64LowPart,qe=(se(Ne={},ee.a.TEXTURE_MIN_FILTER,ee.a.NEAREST),se(Ne,ee.a.TEXTURE_MAG_FILTER,ee.a.NEAREST),se(Ne,ee.a.TEXTURE_WRAP_S,ee.a.CLAMP_TO_EDGE),se(Ne,ee.a.TEXTURE_WRAP_T,ee.a.CLAMP_TO_EDGE),Ne),Ze=function(e){function t(){return ie(this,t),le(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ue(t,e),oe(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n\n  vTexCoord = texCoords;\n\n  picking_setPickingColor(vec3(0., 0., 1.));\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\n{decodeParams}\n\nuniform float opacity;\nuniform float zoom;\n\n\nvec4 decodeFunction(vec3 color, float alpha) {\n  {decodeFunction}\n  return vec4(color, alpha * opacity);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  // clear mask\n  if (bitmapColor == vec4(0., 0., 0., 1.)) {\n    discard;\n  }\n\n  // custom decode\n  gl_FragColor = decodeFunction(bitmapColor.rgb, bitmapColor.a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n".replace("{decodeParams}",Object.keys(this.props.decodeParams).map(function(e){return"uniform float "+e+";"}).join(" ")).replace("{decodeFunction}",this.props.decodeFunction||""),modules:["project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(12)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(12)}}),this.setState({numInstances:4})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;if(t.fp64!==n.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}t.image!==n.image&&this.loadTexture(t.image);var a=this.getAttributeManager();t.bounds!==n.bounds&&(this.setState({positions:this._getPositionsFromBounds(t.bounds)}),a.invalidate("positions"),a.invalidate("positions64xyLow"))}},{key:"finalizeState",value:function(){(function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_getPositionsFromBounds",value:function(e){var t=new Array(12);if(Number.isFinite(e[0]))t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[0],t[4]=e[3],t[5]=0,t[6]=e[2],t[7]=e[3],t[8]=0,t[9]=e[2],t[10]=e[1],t[11]=0;else for(var n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return t}},{key:"_getModel",value:function(e){return e?new te.b(e,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new te.a({drawMode:ee.a.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,r=n.bitmapTexture,a=n.model,i=this.props,o=i.desaturate,s=i.transparentColor,c=i.tintColor,u=i.zoom,l=i.decodeParams,p=i.opacity;r&&a&&a.setUniforms(Object.assign({},t,ce({bitmapTexture:r,desaturate:o,transparentColor:s,tintColor:c,zoom:u},l,{opacity:p}))).draw()}},{key:"loadTexture",value:function(e){var t=this;if("string"===typeof e&&(e=Object(ne.b)(e)),e instanceof Promise)e.then(function(e){return t.loadTexture(e)});else{var n=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof te.c?this.setState({bitmapTexture:e}):(e instanceof Image||e instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new te.c(n,{data:e,parameters:qe,mipmaps:!1})})}}},{key:"calculatePositions",value:function(e){var t=e.value,n=this.state.positions;t.set(n)}},{key:"calculatePositions64xyLow",value:function(e){var t=this.use64bitPositions();(e.constant=!t,t)?e.value.set(this.state.positions.map(Fe)):e.value=new Float32Array(4)}}]),t}(X.a);Ze.layerName="DecodeLayer",Ze.defaultProps={image:null,bounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var Ve=function(e){var t=e.source,n=void 0===t?{}:t,r=e.render,a=void 0===r?{}:r,i=e.decodeParams,o=e.id,s=e.opacity,c=e.decodeFunction,u={id:o+"-raster",type:"raster",source:o},l=n.provider,p=a.layers,d=void 0===p?[u]:p,f={};return f=c?{id:o,type:"custom",layers:[{id:o+"-raster-decode-bg",type:"background",paint:{"background-color":"transparent"}}].concat(de(n.tiles.map(function(t){return new Te({id:o+"-raster-decode",type:Ae,getTileData:function(e){return function(e,t){var n=e.x,r=e.y,a=e.z,i=t.replace("{z}",a).replace("{x}",n).replace("{y}",r);return fetch(i).then(function(e){return e.blob()}).then(function(e){var t=(e||{}).type;if("application/xml"!==t&&"text/xml"!==t&&"text/html"!==t){var n=URL.createObjectURL(e),r=new Image;return r.src=n,r}return!1})}(e,t)},renderSubLayers:function(e){var t=e.id,n=e.data,r=e.tile,a=e.visible,i=e.zoom,o=e.decodeParams,c=e.decodeFunction;return n&&n.src?new Ze({id:t,image:n.src,bounds:r.bbox,visible:a,zoom:i,decodeParams:o,decodeFunction:c,opacity:s}):null},minZoom:n.minzoom,maxZoom:n.maxzoom,opacity:e.opacity,decodeParams:i,decodeFunction:c})})))}:{id:o,type:"raster",source:ce({type:"raster",tileSize:256},n),layers:xe(d.map(function(e){return ce({},u,e)}),e)},!l||"cartodb"!==l.type&&"carto"!==l.type?new ye(function(e,t){f?e(f):t(new Error("error in layer config"))}):new ye(function(t,n){Oe(e).then(function(e){var n=e.cdn_url.templates.https.url.replace("{s}","a")+"/"+l.options.account+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";return t(ce({},f,{source:{type:"raster",tileSize:256,tiles:[n]}}))}).catch(function(e){return n(e)})})},Je=function(e){var t=e.source,n=void 0===t?{}:t,r=e.render,a=void 0===r?{}:r,i=e.id,o=n.provider,s=a.layers,c=ce({id:i,source:ce({type:"vector"},n)},a,{layers:xe(s,e)});return!o||"cartodb"!==o.type&&"carto"!==o.type?new ye(function(e,t){c?e(c):t(new Error("error in layer config"))}):new ye(function(t,n){Oe(e).then(function(e){var n=e.cdn_url.templates.https.url.replace("{s}","a")+"/"+o.options.account+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.mvt";return t(ce({},c,{source:{type:"vector",tiles:[n]}}))}).catch(function(e){return n(e)})})},Be=function(e){var t=e.source,n=void 0===t?{}:t,r=e.render,a=void 0===r?{}:r,i=e.id,o=a.layers,s=ce({id:i,source:ce({type:"geojson"},n)},a,{layers:xe(o,e)});return n.parse&&"function"===typeof n.parse?new ye(function(t,r){(function(e){var t=e.source,n=e.params,r=e.sqlParams,a=e.layerRequest,i=((!1===t.parse||"function"===typeof t.parse?t:JSON.parse(we(JSON.stringify(t),n,r)))||{}).data;a&&a.cancel("Operation canceled by the user.");var o=B.CancelToken.source();return e.set("layerRequest",o),ve(i,{cancelToken:o.token}).then(function(e){return e.status>400?(console.error(e),!1):e.data})})(e).then(function(e){var r=n.parse(e),a=ce({},s,{source:ce({type:"geojson"},n,{data:r})});t(a)}).catch(function(e){return r(e)})}):new ye(function(e,t){s?e(s):t(new Error('"type" specified in layer spec doesn`t exist'))})},Ue=function(e){var t=e.source,n=void 0===t?{}:t,r=e.render,a=void 0===r?{}:r,i=e.params,o=e.sqlParams,s=e.id,c=!1===n.parse?n:JSON.parse(we(JSON.stringify(n),i,o)),u=!1===a.parse?n:JSON.parse(we(JSON.stringify(a),i,o)),l=ce({id:s,type:"raster",source:ce({},c,{type:"video-tiled",tiles:["https://storage.googleapis.com/skydipper_materials/movie-tiles/EVI_TEST/{z}/{x}/{y}.mp4"],scheme:"xyz",tileSize:256,minzoom:1,maxzoom:4,playbackRate:.1})},u,{layers:[{id:s+"-raster",type:"raster",source:s}]});return new ye(function(e,t){l?e(l):t(new Error("error in layer config"))})},Ye=function(){function e(t,n){var r=this;ie(this,e),this.type={raster:Ve,vector:Je,geojson:Be,video:Ue},this.map=t,this.options=n,this.map.on("style.load",function(){r.getLayers().forEach(function(e){return r.add(e)})})}return oe(e,[{key:"add",value:function(e){var t=this,n=e.mapLayer,r=this.getLayers();this.map&&n&&n.source&&n.id&&!this.map.getSource(n.id)&&this.map.addSource(n.id,n.source),n&&n.layers&&n.layers.forEach(function(n){var a=n.metadata,i="top"===(void 0===a?{}:a).position?null:t.getNextLayerId(e);t.map.getLayer(n.id)||t.map.addLayer(n,i),r.forEach(function(){t.setZIndex()})})}},{key:"remove",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.mapLayer;n&&n.layers&&this.map&&this.map.style&&n.layers.forEach(function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)}),n&&this.map&&this.map.getSource(n.id)&&this.map.removeSource(n.id)}},{key:"getLayerByType",value:function(e){return this.type[e]}},{key:"getLayersOnMap",value:function(){return this.map.getStyle().layers}},{key:"getLayer",value:function(e){var t=e.mapLayer;return this.map?this.map.getSource(t.id):null}},{key:"getLayers",value:function(){var e=this.options.getLayers,t=e();return ae()(t,function(e){return e.decodeFunction})}},{key:"getNextLayerId",value:function(e){var t=e.zIndex,n=this.getLayers(),r=this.getLayersOnMap(),a=r&&r.length&&r.find(function(e){return e.id.includes("custom-layers")||e.id.includes("label")||e.id.includes("place")||e.id.includes("poi")}),i=ae()(n,function(e){return e.zIndex}).find(function(e){return e.zIndex>t&&(!e.mapLayer||!e.mapLayer.layers||!e.mapLayer.layers[0]||!e.mapLayer.layers[0].metadata||!e.mapLayer.layers[0].metadata.position)});if(!i||i&&!i.mapLayer)return a.id;var o=i.mapLayer.layers[0].id;return!!r.find(function(e){return o===e.id})?o:a.id}},{key:"setZIndex",value:function(){var e=this,t=this.getLayers(),n=this.getLayersOnMap();n.forEach(function(n){var r=n.id,a=n.metadata,i=void 0===a?{}:a,o=t.find(function(e){return r.includes(e.id)});if(o){var s="top"===i.position?null:e.getNextLayerId(o);e.map.moveLayer(r,s)}});var r=t.filter(function(e){return!!e.decodeFunction});return r&&this.map&&r.forEach(function(t){var r=t.mapLayer;if(r){var a=r.layers,i=a[0],o=a[1],s=n.find(function(e){return e.id===i.id}),c=e.map.getLayer(o.id);s&&c&&e.map.moveLayer(o.id,i.id)}}),!0}},{key:"setOpacity",value:function(e,t){var n=this,r={symbol:["icon","text"],circle:["circle","circle-stroke"]},a=e.render,i=e.mapLayer,o=e.decodeFunction,s=a.layers,c=void 0===s?[]:s;if(i.layers&&!o&&i.layers.forEach(function(e){var a=r[e.type]||[e.type],i=(c.find(function(t,n){return(t.id||e.source+"-"+t.type+"-"+n)===e.id})||{}).paint,o=void 0===i?{}:i;a.forEach(function(r){var a=o[r+"-opacity"],i=void 0!==a?a:1;n.map.setPaintProperty(e.id,r+"-opacity",i*t*.99)})}),o){var u=i.layers[1];u&&"function"===typeof u.setProps&&u.setProps({opacity:t})}}},{key:"setVisibility",value:function(e,t){var n=this,r=e.mapLayer;r&&r.layers&&this.map&&this.map.style&&r.layers.forEach(function(e){n.map.setLayoutProperty(e.id,"visibility",t?"visible":"none")})}},{key:"setSource",value:function(e){var t=e.id,n=e.source,r=n.type,a=n.data;this.map&&"geojson"===r&&"string"!==typeof a&&this.map.getSource(t).setData(a);return this}},{key:"setRender",value:function(e){var t=this,n=e.mapLayer,r=e.render.layers,a=void 0===r?[]:r;if(!n||!a.length)return this;try{n.layers.forEach(function(e,n){var r=e.id,i=a[n]||a[0]||{},o=i.paint,s=void 0===o?{}:o,c=i.layout,u=void 0===c?{}:c,l=i.filter,p=void 0===l?null:l;t.map.setFilter(r,p),Object.keys(s).forEach(function(e){t.map.setPaintProperty(r,e,s[e])}),Object.keys(u).forEach(function(e){t.map.setLayoutProperty(r,e,u[e])})})}catch(i){console.error(i)}return this}},{key:"setParams",value:function(){return this}},{key:"setSQLParams",value:function(){return this}},{key:"setDecodeParams",value:function(e){var t=e.mapLayer,n=e.decodeParams;if(!t)return this;var r=t.layers[1];return r&&"function"===typeof r.setProps?r.setProps({decodeParams:n}):console.error("Layer is not present. You defined decodeParams but maybe you didn't define a decodeFunction"),this}},{key:"unmount",value:function(){this.map=null}}]),e}(),We=n(84),He=[{id:"gain",name:"Tree cover gain",config:{type:"raster",source:{type:"raster",tiles:["https://earthengine.google.org/static/hansen_2013/gain_alpha/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{type:"basic",items:[{name:"Tree cover gain",color:"#6D6DE5"}]}},{id:"loss",name:"Tree cover loss",config:{type:"raster",source:{type:"raster",tiles:["https://storage.googleapis.com/wri-public/Hansen_16/tiles/hansen_world/v1/tc30/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{enabled:!0},decodeConfig:[{default:"2001-01-01",key:"startDate",required:!0},{default:"2018-12-31",key:"endDate",required:!0}],timelineConfig:{step:1,speed:250,interval:"years",dateFormat:"YYYY",trimEndDate:"2018-12-31",maxDate:"2018-12-31",minDate:"2001-01-01",canPlay:!0,railStyle:{background:"#DDD"},trackStyle:[{background:"#dc6c9a"},{background:"#982d5f"}]},decodeFunction:"\n      // values for creating power scale, domain (input), and range (output)\n      float domainMin = 0.;\n      float domainMax = 255.;\n      float rangeMin = 0.;\n      float rangeMax = 255.;\n\n      float exponent = zoom < 13. ? 0.3 + (zoom - 3.) / 20. : 1.;\n      float intensity = color.r * 255.;\n\n      // get the min, max, and current values on the power scale\n      float minPow = pow(domainMin, exponent - domainMin);\n      float maxPow = pow(domainMax, exponent);\n      float currentPow = pow(intensity, exponent);\n\n      // get intensity value mapped to range\n      float scaleIntensity = ((currentPow - minPow) / (maxPow - minPow) * (rangeMax - rangeMin)) + rangeMin;\n      // a value between 0 and 255\n      alpha = zoom < 13. ? scaleIntensity / 255. : color.g;\n\n      float year = 2000.0 + (color.b * 255.);\n      // map to years\n      if (year >= startYear && year <= endYear && year >= 2001.) {\n        color.r = 220. / 255.;\n        color.g = (72. - zoom + 102. - 3. * scaleIntensity / zoom) / 255.;\n        color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n      } else {\n        alpha = 0.;\n      }\n    "},{id:"protected-areas",name:"Protected areas",config:{type:"vector",source:{type:"vector",provider:{type:"carto",options:{account:"wri-01",layers:[{options:{cartocss:"#wdpa_protected_areas {  polygon-opacity: 1.0; polygon-fill: #704489 }",cartocss_version:"2.3.0",sql:"SELECT * FROM wdpa_protected_areas"},type:"mapnik"}]}}},render:{layers:[{type:"fill","source-layer":"layer0",paint:{"fill-color":"#5ca2d1","fill-opacity":1}},{type:"line","source-layer":"layer0",paint:{"line-color":"#000000","line-opacity":.1}}]}},paramsConfig:[],legendConfig:{type:"basic",items:[{name:"Protected areas",color:"#5ca2d1"}]}}];n(494);function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(n,!0).forEach(function(t){Object(s.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Qe=function(){var e=Object(r.useState)(He),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(JSON.stringify(He,null,2)),u=Object(c.a)(o,2),l=u[0],p=u[1],d=Object(r.useState)({}),f=Object(c.a)(d,2),y=f[0],m=f[1],v=n.map(function(e){var t=e.id,n=e.paramsConfig,r=e.sqlConfig,a=e.decodeConfig,i=e.timelineConfig,o=y[t]||{},s=!!n&&h(n,o.params),c=!!r&&h(r,o.sqlParams),u=!!a&&h(a,Xe({},i,{},o.decodeParams)),l=!!i&&Xe({},i,{},h(n,o.params),{},h(a,o.decodeParams));return Xe({id:t,slug:t,dataset:t,layers:[Xe({active:!0},e,{},o,{params:s,sqlParams:c,decodeParams:u,timelineParams:l})]},o)}),g=function(e,t){m(Xe({},y,Object(s.a)({},e.id,Xe({},y[e.id],{visibility:t}))))},b=function(e,t){m(Xe({},y,Object(s.a)({},e.id,Xe({},y[e.id],{opacity:t}))))},w=function(e,t){var n=t.id,r=t.decodeConfig;m(Xe({},y,Object(s.a)({},n,Xe({},y[n],{},r&&{decodeParams:{startDate:e[0],endDate:e[1],trimEndDate:e[2]}},{},!r&&{params:{startDate:e[0],endDate:e[1]}}))))};return a.a.createElement("div",{className:"c-app"},a.a.createElement(We.Icons,null),a.a.createElement("div",{className:"c-main"},a.a.createElement(R,null,a.a.createElement(N.a,{mode:"json",theme:"github",value:l,onChange:function(e){p(e);try{var t=JSON.parse(e);i(t)}catch(n){}},tabSize:2,width:"100%",height:"100%",wrapEnabled:!0,showPrintMargin:!1,editorProps:{$blockScrolling:!0},debounceChangePeriod:500})),a.a.createElement("div",{className:"c-map-container"},a.a.createElement(I,{mapboxApiAccessToken:"pk.eyJ1IjoibGF5ZXItbWFuYWdlciIsImEiOiJjazA2dTJnMG0zc3lwM251dGM0aXhiYTVxIn0.AaoErQTRezfQshqnEKIg8A",mapStyle:"mapbox://styles/layer-manager/ck07vfinn01xm1co324q5vcdl",minZoom:2},function(e){return a.a.createElement(F.LayerManager,{map:e,plugin:Ye},n.map(function(e){var t=e.id,n=e.paramsConfig,r=e.sqlConfig,i=e.decodeConfig,o=e.timelineConfig,s=e.decodeFunction,c=y[t]||{},u=Xe({},e,{},e.config,{},c,{},!!n&&{params:h(n,Xe({},c.params))},{},!!r&&{sqlParams:h(r,Xe({},c.sqlParams))},{},!!i&&{decodeParams:h(i,Xe({},o,{},c.decodeParams)),decodeFunction:s});return a.a.createElement(F.Layer,Object.assign({key:e.id},u))}))}),a.a.createElement("div",{className:"c-legend"},a.a.createElement(We.Legend,{maxHeight:"65vh",collapsable:!1,sortable:!1,onChangeOrder:function(e){console.log("onChangeOrder",e)}},v.map(function(e,t){return a.a.createElement(We.LegendListItem,{index:t,key:e.slug,layerGroup:e,toolbar:a.a.createElement(We.LegendItemToolbar,null,a.a.createElement(We.LegendItemButtonOpacity,{trackStyle:{background:"#FFCC00"},handleStyle:{background:"#FFCC00"}}),a.a.createElement(We.LegendItemButtonVisibility,null)),onChangeVisibility:g,onChangeOpacity:b},a.a.createElement(We.LegendItemTypes,null),a.a.createElement(We.LegendItemTimeStep,{defaultStyles:{handleStyle:{backgroundColor:"white",borderRadius:"50%",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.29)",border:"0px",zIndex:2},railStyle:{backgroundColor:"#d6d6d9"},dotStyle:{visibility:"hidden",border:"0px"}},handleChange:w}))}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(495);o.a.render(a.a.createElement(Qe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[296,1,2]]]);
//# sourceMappingURL=main.064b8f2c.chunk.js.map
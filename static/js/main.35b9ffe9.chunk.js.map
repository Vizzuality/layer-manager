{"version":3,"sources":["../../dist/components/index.js","images/marker1.svg","images/marker2.svg","utils.js","components/map/index.js","components/sidebar/index.js","components/sidebar/component.js","../../dist/layer-manager.esm.js","layers.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","isEqual","axios","omit","isEmpty","react","PropTypes","compact","isObject","hasOwnProperty","axios__default","_typeof","Symbol","iterator","obj","constructor","prototype","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","_extends","assign","arguments","source","call","inherits","subClass","superClass","create","value","setPrototypeOf","__proto__","objectWithoutProperties","keys","indexOf","possibleConstructorReturn","self","ReferenceError","handleCallback","resolve","reject","callback","r","e","CancelablePromise","executor","this","_promise","Promise","_canceled","iterable","y","n","all","then","race","success","error","_this","p","cancel","undefined","errorCallback","catch","LayerModel","layerSpec","opacity","visibility","render","changedAttributes","prevData","nextData","set","forEach","k","headers","get$1","url","options","get","post","body","DEFAULT_PROVIDERS","carto","layerModel","layer","interactivity","provider","layerTpl","JSON","stringify","version","stat_tag","layers","map","l","apiParams","config","encodeURIComponent","api_key","apiParamsString","join","type","layerRequest","layerRequestSource","CancelToken","cancelToken","token","res","status","console","data","fetch","account","response","ext","tileUrl","cdn_url","templates","https","replace","layergroupid","tiles","err","LayerManager","Plugin","Providers","plugin","providers","promises","getLayers","bind","property","warn","layerOptions","zIndex","onAfterAdd","id","find","push","requestLayer","changedProps","getLayerModel","mapLayer","update","params","sqlParams","decodeParams","setOpacity","setVisibility","setZIndex","setSource","setRender","setParams","setSqlParams","setDecodeParams","onAfterRemove","slice","requestCancel","remove","filter","method","getLayerByType","add","Error","layerModelId","unmount","LayerManager$1","_PureComponent","LayerManager$$1","getPrototypeOf","layerManager","_this2","children","Children","count","child","cloneElement","PureComponent","propTypes","shape","isRequired","func","oneOfType","arrayOf","node","defaultProps","substitution","originalStr","str","Array","isArray","RegExp","concatenation","sql","v","startsWith","Layer","_ref","_temp","_len","args","_key","apply","concat","_this$props","sourceParsed","parse","renderParsed","_this$props2","_this$props3","prevProps","prevSource","prevRender","prevParams","prevSqlParams","prevDecodeParams","prevOpacity","prevVisibility","prevZIndex","_props","prevSourceParsed","prevRenderParsed","sourceType","t","_renderParsed$layers","_prevRenderParsed$lay","prevLayers","string","number","oneOf","bool","propName","componentName","getSource","Components","factory","dateDiffInDays","startDate","endDate","a","Date","b","utc1","UTC","getFullYear","getMonth","getDate","utc2","Math","floor","getDayRange","minDate","maxDate","minDateTime","maxDateTime","numberOfDays","startDateTime","endDateTime","activeStartDay","activeEndDay","startDayIndex","endDayIndex","getParams","defaultParams","reduce","acc","default","newParams","trimEndDate","maxAbsoluteDate","start","end","trim","startYear","moment","year","startMonth","month","startDay","dayOfYear","endYear","endMonth","endDay","trimEndYear","trimEndMonth","trimEndDay","DEFAULT_VIEWPORT","zoom","lat","lng","Map","events","HOVER","state","viewport","flying","loaded","onLoad","bounds","setState","bbox","fitBounds","mapContainer","onViewportChange","onResize","newViewport","onMoveEnd","bearing","getBearing","pitch","getPitch","getZoom","getCenter","latitude","longitude","onHover","features","sourceLayer","setFeatureState","hover","onMouseLeave","viewportOptions","width","offsetWidth","height","offsetHeight","transitionDuration","transitionInterruption","TRANSITION_EVENTS","UPDATE","setTimeout","prevViewport","prevBounds","stateViewport","customClass","dragPan","getCursor","dragRotate","scrollZoom","touchZoom","touchRotate","doubleClickZoom","mapboxProps","ref","className","classnames","getMap","transitionInterpolator","FlyToInterpolator","transitionEasing","easeCubic","Component","isHovering","isDragging","SidebarComponent","React","arr","_arr","_n","_d","_e","_s","_i","next","done","sliceIterator","arr2","from","fetch$1","checkPluginProperties","getVectorStyleLayers","vectorLayers","vectorLayersParsed","vectorLayer","_vectorLayer$paint","paint","opacityPaintStyles","symbol","circle","name","currentProperty","paintOpacity","j","filteredPaintProperties","entries","_ref2","getDeckInstance","gl","deck","__deck","customRender","_customRender","deckProps","useDevicePixels","triggerRepaint","parameters","depthMask","depthTest","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","blendEquation","FUNC_ADD","userData","isExternal","mapboxLayers","Set","setProps","viewState","getViewState","on","onMapMove","finalize","mapboxVersion","major","minor","_map$version$split$sl","split","Number","_map$version$split$sl2","getMapboxVersion","_deck$props$userData","mapboxLayerIds","deckLayer","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","shouldDrawLayer","return","_drawLayers","viewports","getViewport","clearCanvas","currentViewport","afterRender","_map$getCenter","useMapboxProjection","x","repeat","nearZMultiplier","layerFilter","layerInstance","parent","updateLayers","LayerType","MapboxLayer","renderingMode","delete","drawLayer","tile2latLng","z","pow","PI","atan","exp","Tile","getTileData","onTileLoad","onTileError","_tile2latLng","_tile2latLng2","west","north","_tile2latLng3","_tile2latLng4","east","tile2boundingBox","isVisible","_data","_isLoaded","_loader","_loadData","buffers","tile","m","PI_4","DEGREES_TO_RADIANS","lngLatToWorld","scale","isFinite","s","TILE_SIZE","phi2","log","tan","pixelsToTileIndex","getAdjustedTileIndex","_ref3","adjustedZ","TileCache","maxSize","maxZoom","minZoom","_getTileData","_maxSize","_cache","_tiles","_maxZoom","_minZoom","ceil","clear","_markOldTiles","tileIndices","corners","unproject","minLng","minLat","maxLng","maxLat","getBoundingBox","_lngLatToWorld$map","_lngLatToWorld$map2","minX","minY","_lngLatToWorld$map3","_lngLatToWorld$map4","maxX","maxY","indices","getTileIndices","cachedTile","some","isOverlapped","changed","tileIndex","_getTile","tileId","_getTileId","_resizeCache","values","sort","t1","t2","size","renderSubLayers","onViewportLoaded","optional","maxCacheSize","TileLayer","_CompositeLayer","isLoaded","changeFlags","somethingChanged","context","tileCache","updateTriggersChanged","_onTileLoad","_onTileError","viewportChanged","getLayerZoomLevel","currTiles","allCurrTilesLoaded","every","info","_props2","visible","clone","layerName","_DEFAULT_TEXTURE_PARA","fp64LowPart","DEFAULT_TEXTURE_PARAMETERS","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","_Layer","DecodeLayer","vs","fs","decodeFunction","modules","getAttributeManager","positions","calculatePositions","Float32Array","positions64xyLow","calculatePositions64xyLow","numInstances","oldProps","fp64","model","_getModel","invalidateAll","image","loadTexture","attributeManager","_getPositionsFromBounds","invalidate","object","receiver","Function","desc","getOwnPropertyDescriptor","getter","bitmapTexture","getShaders","shaderCache","geometry","drawMode","TRIANGLE_FAN","vertexCount","attributes","texCoords","isInstanced","uniforms","_state","desaturate","transparentColor","tintColor","setUniforms","draw","Image","HTMLCanvasElement","mipmaps","attribute","isFP64","use64bitPositions","constant","compare","min","max","RasterLayer","_layerModel$source","_layerModel$render","DEFAULT_RASTER_OPTIONS","_render$layers","mapSource","blob","src","URL","createObjectURL","subLayerId","decodeParamsSub","decodeFunctionSub","minzoom","maxzoom","tileSize","VectorLayer","GeoJsonLayer","VideoLayer","scheme","playbackRate","PluginMapboxGL","raster","vector","geojson","video","images","allLayers","hasImage","img","onload","addImage","addSource","_l$metadata","metadata","nextLayerId","position","getNextLayerId","getLayer","addLayer","_this3","style","removeLayer","removeSource","getStyle","layersOnMap","getLayersOnMap","customLayer","includes","nextLayer","_this4","_l$metadata2","ly","moveLayer","decodeLayers","parentLayer","childLayer","parentLayerOnMap","childLayerOnMap","layerId","propertyName","desiredValue","_layerModel$render$la","test","_ref2$paint","index","currentValue","element","_this5","PAINT_STYLE_NAMES","propertyValue","computePaintPropertyValue","setPaintProperty","_this6","setLayoutProperty","setData","_this7","renderLayers","rl","_rl$paint","_rl$layout","layout","_rl$filter","setFilter","legendConfig","items","color","enabled","decodeConfig","required","timelineConfig","step","speed","interval","dateFormat","canPlay","railStyle","background","trackStyle","promoteId","cartocss","cartocss_version","featureState","duration","delay","paramsConfig","interactionConfig","MARKER1","sdf","MARKER2","cluster","clusterMaxZoom","clusterRadius","App","useState","DEFAULT_LAYERS","setLayers","layersJson","setLayersJson","layersSettings","setLayersSettings","layersInteractiveIds","setLayersInteractiveIds","layerGroups","sqlConfig","lSettings","timelineParams","slug","dataset","active","onChangeVisibility","onChangeOpacity","onChangeLayerDate","dates","prevLayersInteractiveIds","mode","theme","onChange","json","newLayers","tabSize","wrapEnabled","showPrintMargin","editorProps","$blockScrolling","debounceChangePeriod","mapboxApiAccessToken","process","mapOptions","fadeDuration","interactiveLayerIds","PluginMapboxGl","rows","properties","coordinates","lon","maxHeight","collapsable","sortable","onChangeOrder","ids","layerGroup","toolbar","handleStyle","defaultStyles","backgroundColor","borderRadius","boxShadow","border","dotStyle","handleChange","Boolean","window","location","hostname","match","ReactDOM","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.35b9ffe9.chunk.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash/isEqual'), require('axios'), require('lodash/omit'), require('lodash/isEmpty'), require('react'), require('prop-types'), require('lodash/compact'), require('lodash/isObject')) : typeof define === 'function' && define.amd ? define(['lodash/isEqual', 'axios', 'lodash/omit', 'lodash/isEmpty', 'react', 'prop-types', 'lodash/compact', 'lodash/isObject'], factory) : global.LayerManager = factory(global.isEqual, global.axios, global.omit, global.isEmpty, global.React, global.PropTypes, global.compact, global.isObject);\n})(this, function (isEqual, axios, omit, isEmpty, react, PropTypes, compact, isObject) {\n  'use strict';\n\n  isEqual = isEqual && isEqual.hasOwnProperty('default') ? isEqual['default'] : isEqual;\n  var axios__default = 'default' in axios ? axios['default'] : axios;\n  omit = omit && omit.hasOwnProperty('default') ? omit['default'] : omit;\n  isEmpty = isEmpty && isEmpty.hasOwnProperty('default') ? isEmpty['default'] : isEmpty;\n  PropTypes = PropTypes && PropTypes.hasOwnProperty('default') ? PropTypes['default'] : PropTypes;\n  compact = compact && compact.hasOwnProperty('default') ? compact['default'] : compact;\n  isObject = isObject && isObject.hasOwnProperty('default') ? isObject['default'] : isObject;\n\n  var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  };\n\n  var classCallCheck = function classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  var inherits = function inherits(subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  var objectWithoutProperties = function objectWithoutProperties(obj, keys) {\n    var target = {};\n\n    for (var i in obj) {\n      if (keys.indexOf(i) >= 0) continue;\n      if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n      target[i] = obj[i];\n    }\n\n    return target;\n  };\n\n  var possibleConstructorReturn = function possibleConstructorReturn(self, call) {\n    if (!self) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n  };\n\n  var handleCallback = function handleCallback(resolve, reject, callback, r) {\n    try {\n      resolve(callback(r));\n    } catch (e) {\n      reject(e);\n    }\n  };\n\n  var CancelablePromise = function () {\n    createClass(CancelablePromise, null, [{\n      key: \"all\",\n      value: function all(iterable) {\n        return new CancelablePromise(function (y, n) {\n          Promise.all(iterable).then(y, n);\n        });\n      }\n    }, {\n      key: \"race\",\n      value: function race(iterable) {\n        return new CancelablePromise(function (y, n) {\n          Promise.race(iterable).then(y, n);\n        });\n      }\n    }, {\n      key: \"reject\",\n      value: function reject(value) {\n        return new CancelablePromise(function (y, n) {\n          Promise.reject(value).then(y, n);\n        });\n      }\n    }, {\n      key: \"resolve\",\n      value: function resolve(value) {\n        return new CancelablePromise(function (y, n) {\n          Promise.resolve(value).then(y, n);\n        });\n      }\n    }]);\n\n    function CancelablePromise(executor) {\n      classCallCheck(this, CancelablePromise);\n      this._promise = new Promise(executor);\n      this._canceled = false;\n    }\n\n    createClass(CancelablePromise, [{\n      key: \"then\",\n      value: function then(success, error) {\n        var _this = this;\n\n        var p = new CancelablePromise(function (resolve, reject) {\n          _this._promise.then(function (r) {\n            if (_this._canceled) {\n              p.cancel();\n            }\n\n            if (success && !_this._canceled) {\n              handleCallback(resolve, reject, success, r);\n            } else {\n              resolve(r);\n            }\n          }, function (r) {\n            if (_this._canceled) {\n              p.cancel();\n            }\n\n            if (error && !_this._canceled) {\n              handleCallback(resolve, reject, error, r);\n            } else {\n              reject(r);\n            }\n          });\n        });\n        return p;\n      }\n    }, {\n      key: \"catch\",\n      value: function _catch(error) {\n        return this.then(undefined, error);\n      }\n    }, {\n      key: \"cancel\",\n      value: function cancel(errorCallback) {\n        this._canceled = true;\n\n        if (errorCallback) {\n          this._promise.catch(errorCallback);\n        }\n\n        return this;\n      }\n    }]);\n    return CancelablePromise;\n  }();\n\n  var LayerModel = function () {\n    function LayerModel() {\n      var layerSpec = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      classCallCheck(this, LayerModel);\n      this.opacity = 1;\n      this.visibility = true;\n      this.source = {};\n      this.render = {};\n      Object.assign(this, layerSpec, {\n        changedAttributes: {}\n      });\n    }\n\n    createClass(LayerModel, [{\n      key: 'get',\n      value: function get$$1(key) {\n        return this[key];\n      }\n    }, {\n      key: 'set',\n      value: function set$$1(key, value) {\n        this[key] = value;\n        return this;\n      }\n    }, {\n      key: 'update',\n      value: function update(layerSpec) {\n        var _this = this;\n\n        var prevData = _extends({}, this);\n\n        var nextData = _extends({}, layerSpec); // reseting changedAttributes for every update\n\n\n        this.set('changedAttributes', {});\n        Object.keys(nextData).forEach(function (k) {\n          if (!isEqual(prevData[k], nextData[k])) {\n            _this.changedAttributes[k] = nextData[k];\n\n            _this.set(k, nextData[k]);\n          }\n        });\n      }\n    }]);\n    return LayerModel;\n  }();\n\n  var headers = {\n    'Content-Type': 'application/json'\n  };\n\n  var get$1 = function get$$1(url) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return axios__default.get(url, _extends({\n      headers: headers\n    }, options));\n  };\n\n  var post = function post(url, body) {\n    return axios__default.post(url, body, {\n      headers: headers\n    });\n  };\n\n  var fetch = function fetch(type, url, options, layerModel) {\n    var layerRequest = layerModel.layerRequest;\n\n    if (layerRequest) {\n      layerRequest.cancel('Operation canceled by the user.');\n    }\n\n    var layerRequestSource = axios.CancelToken.source();\n    layerModel.set('layerRequest', layerRequestSource);\n    var method = type === 'post' ? post : get$1;\n    var newLayerRequest = method(url, _extends({}, options, {\n      cancelToken: layerRequestSource.token\n    })).then(function (res) {\n      if (res.status > 400) {\n        console.error(res);\n        return false;\n      }\n\n      return res.data;\n    });\n    return newLayerRequest;\n  };\n\n  var DEFAULT_PROVIDERS = {\n    carto: function carto(layerModel, layer, resolve, reject) {\n      var interactivity = layerModel.interactivity,\n          source = layerModel.source;\n      var provider = source.provider;\n      var layerTpl = JSON.stringify({\n        version: '1.3.0',\n        stat_tag: 'API',\n        layers: provider.layers.map(function (l) {\n          if (!!interactivity && interactivity.length) {\n            return _extends({}, l, {\n              options: _extends({}, l.options, {\n                interactivity: interactivity\n              })\n            });\n          }\n\n          return l;\n        })\n      }); // https://carto.com/developers/auth-api/guides/how-to-send-API-Keys/\n\n      var apiParams = _extends({\n        stat_tag: 'API',\n        config: encodeURIComponent(layerTpl)\n      }, provider.api_key && {\n        api_key: provider.api_key\n      });\n\n      var apiParamsString = Object.keys(apiParams).map(function (k) {\n        return k + '=' + apiParams[k];\n      }).join('&');\n      var url = 'https://' + provider.account + '.carto.com/api/v1/map?' + apiParamsString;\n      fetch('get', url, {}, layerModel).then(function (response) {\n        var ext = layerModel.type === 'vector' ? 'mvt' : 'png';\n        var tileUrl = response.cdn_url.templates.https.url.replace('{s}', 'a') + '/' + provider.account + '/api/v1/map/' + response.layergroupid + '/{z}/{x}/{y}.' + ext;\n        return resolve(_extends({}, layer, {\n          source: _extends({}, omit(layer.source, 'provider'), {\n            tiles: [tileUrl]\n          })\n        }));\n      }).catch(function (err) {\n        return reject(err);\n      });\n    }\n  };\n\n  function checkPluginProperties(plugin) {\n    if (plugin) {\n      var requiredProperties = ['add', 'remove', 'setVisibility', 'setOpacity', 'setZIndex', 'setSource', 'setRender', 'setParams', 'setSQLParams', 'setDecodeParams', 'getLayerByType'];\n      requiredProperties.forEach(function (property) {\n        if (!plugin[property]) {\n          console.error('The ' + property + ' function is required for layer manager plugins');\n        }\n      });\n      var deprecatedProperties = ['getLayerByProvider'];\n      deprecatedProperties.forEach(function (property) {\n        if (plugin[property]) {\n          console.warn('The ' + property + ' function is deprecated for layer manager plugins');\n        }\n      });\n    }\n  }\n\n  var LayerManager = function () {\n    function LayerManager(map, Plugin, Providers) {\n      classCallCheck(this, LayerManager);\n      this.map = map;\n      this.providers = _extends({}, DEFAULT_PROVIDERS, Providers);\n      this.layers = [];\n      this.promises = {};\n      this.options = {\n        getLayers: this.getLayers.bind(this)\n      };\n      this.plugin = new Plugin(this.map, this.options);\n      checkPluginProperties(this.plugin);\n    }\n    /**\n     * Add layers\n     * @param {Array} layers\n     * @param {Object} layerOptions\n     */\n\n\n    createClass(LayerManager, [{\n      key: 'add',\n      value: function add(layer) {\n        var layerOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n          opacity: 1,\n          visibility: true,\n          zIndex: 0,\n          interactivity: null\n        };\n        var onAfterAdd = arguments[2];\n\n        if (typeof layer === 'undefined') {\n          console.error('layer is required');\n          return this;\n        }\n\n        var layerModel = new LayerModel(_extends({}, layer, layerOptions));\n        var id = layerModel.id;\n\n        if (this.layers.find(function (l) {\n          return l.id === id;\n        })) {\n          return this.layers;\n        }\n\n        this.layers.push(layerModel);\n        this.requestLayer(layerModel, onAfterAdd);\n        return this.layers;\n      }\n      /**\n       * Updating a specific layer\n       * @param  {Object} layerModel\n       */\n\n    }, {\n      key: 'update',\n      value: function update(id, changedProps) {\n        var layerModel = this.getLayerModel(id);\n        if (!layerModel || !layerModel.mapLayer) return;\n        layerModel.update(changedProps);\n        var opacity = changedProps.opacity,\n            visibility = changedProps.visibility,\n            zIndex = changedProps.zIndex,\n            source = changedProps.source,\n            render = changedProps.render,\n            params = changedProps.params,\n            sqlParams = changedProps.sqlParams,\n            decodeParams = changedProps.decodeParams;\n\n        if (typeof opacity !== 'undefined') {\n          this.plugin.setOpacity(layerModel, opacity);\n        }\n\n        if (typeof visibility !== 'undefined') {\n          this.plugin.setVisibility(layerModel, visibility);\n        }\n\n        if (typeof zIndex !== 'undefined') {\n          this.plugin.setZIndex(layerModel, zIndex);\n        }\n\n        if (!isEmpty(source)) {\n          this.plugin.setSource(layerModel);\n        }\n\n        if (!isEmpty(render)) {\n          this.plugin.setRender(layerModel);\n        }\n\n        if (!isEmpty(params)) {\n          this.plugin.setParams(layerModel);\n        }\n\n        if (!isEmpty(sqlParams)) {\n          this.plugin.setSqlParams(layerModel);\n        }\n\n        if (!isEmpty(decodeParams)) {\n          this.plugin.setDecodeParams(layerModel);\n        }\n      }\n      /**\n       * Remove a layer giving a Layer ID\n       * @param {String} id\n       */\n\n    }, {\n      key: 'remove',\n      value: function remove(id, onAfterRemove) {\n        var layers = this.layers.slice(0);\n        this.requestCancel(id);\n        var layerModel = this.getLayerModel(id);\n\n        if (layerModel) {\n          this.plugin.remove(layerModel);\n        }\n\n        this.layers = layers.filter(function (l) {\n          return l.id !== id;\n        });\n        onAfterRemove(layerModel);\n      }\n    }, {\n      key: 'getLayers',\n      value: function getLayers() {\n        return this.layers;\n      }\n    }, {\n      key: 'getLayerModel',\n      value: function getLayerModel(id) {\n        return this.layers.find(function (l) {\n          return l.id === id;\n        });\n      }\n      /**\n       * A namespace to set opacity on selected layer\n       * @param {String} id\n       * @param {Number} opacity\n       */\n\n    }, {\n      key: 'setOpacity',\n      value: function setOpacity(id, opacity) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setOpacity(layerModel, opacity);\n      }\n      /**\n       * A namespace to hide or show a selected layer\n       * @param {String} id\n       * @param {Boolean} visibility\n       */\n\n    }, {\n      key: 'setVisibility',\n      value: function setVisibility(id, visibility) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setVisibility(layerModel, visibility);\n      }\n      /**\n       * A namespace to set z-index on selected layer\n       * @param {String} id\n       * @param {Number} zIndex\n       */\n\n    }, {\n      key: 'setZIndex',\n      value: function setZIndex(id, zIndex) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setZIndex(layerModel, zIndex);\n      }\n    }, {\n      key: 'requestLayer',\n      value: function requestLayer(layerModel, onAfterAdd) {\n        var _this = this;\n\n        var type = layerModel.type;\n        var method = this.plugin.getLayerByType(type);\n\n        if (!method) {\n          this.promises[layerModel.id] = CancelablePromise.reject(new Error(type + ' type is not yet supported.'));\n          return false;\n        } // Cancel previous/existing request\n\n\n        this.requestCancel(layerModel.id); // every request method returns a promise that we store in the array\n        // to control when all layers are fetched.\n\n        this.promises[layerModel.id] = method.call(this, layerModel, this.providers).then(function (layer) {\n          var canceled = _this.promises[layerModel.id]._canceled;\n\n          if (!canceled) {\n            layerModel.set('mapLayer', layer);\n\n            _this.plugin.add(layerModel, _this.layers);\n\n            _this.plugin.setZIndex(layerModel, layerModel.zIndex);\n\n            _this.plugin.setOpacity(layerModel, layerModel.opacity);\n\n            _this.plugin.setVisibility(layerModel, layerModel.visibility);\n\n            _this.plugin.setRender(layerModel);\n\n            onAfterAdd(layerModel);\n          }\n        });\n        return this;\n      }\n    }, {\n      key: 'requestCancel',\n      value: function requestCancel(layerModelId) {\n        // Cancel previous/existing request\n        if (this.promises[layerModelId] && this.promises[layerModelId].cancel) {\n          this.promises[layerModelId].cancel();\n        }\n      }\n    }, {\n      key: 'unmount',\n      value: function unmount() {\n        this.map = null;\n        this.plugin.unmount();\n      }\n    }]);\n    return LayerManager;\n  }();\n\n  var LayerManager$1 = function (_PureComponent) {\n    inherits(LayerManager$$1, _PureComponent);\n\n    function LayerManager$$1(props) {\n      classCallCheck(this, LayerManager$$1);\n\n      var _this = possibleConstructorReturn(this, (LayerManager$$1.__proto__ || Object.getPrototypeOf(LayerManager$$1)).call(this, props));\n\n      var map = props.map,\n          plugin = props.plugin,\n          providers = props.providers;\n      _this.layerManager = new LayerManager(map, plugin, providers);\n      return _this;\n    }\n\n    createClass(LayerManager$$1, [{\n      key: 'componentWillUnmount',\n      value: function componentWillUnmount() {\n        this.layerManager.unmount();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        var _this2 = this;\n\n        var children = this.props.children;\n\n        if (children && react.Children.count(children)) {\n          return react.Children.map(children, function (child, i) {\n            return child && react.cloneElement(child, {\n              layerManager: _this2.layerManager,\n              zIndex: child.props.zIndex || 1000 - i\n            });\n          });\n        }\n\n        return null;\n      }\n    }]);\n    return LayerManager$$1;\n  }(react.PureComponent);\n\n  LayerManager$1.propTypes = {\n    map: PropTypes.shape({}).isRequired,\n    plugin: PropTypes.func.isRequired,\n    providers: PropTypes.shape({}),\n    children: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.node), PropTypes.node])\n  };\n  LayerManager$1.defaultProps = {\n    children: [],\n    providers: {}\n  };\n  /**\n   * Params should have this format => { key:'xxx', key2:'xxx' }\n   * Keys to search should be in this format {{key}}\n   * @param {String} originalStr\n   * @param {Object} params\n   */\n\n  var substitution = function substitution(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var str = originalStr;\n    Object.keys(params).forEach(function (key) {\n      if (Array.isArray(params[key]) || isObject(params[key])) {\n        str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), JSON.stringify(params[key])).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), JSON.stringify(params[key])).replace(new RegExp('`{{' + key + '}}`', 'g'), JSON.stringify(params[key])).replace(new RegExp('\"{' + key + '}\"', 'g'), JSON.stringify(params[key])).replace(new RegExp('\\'{' + key + '}\\'', 'g'), JSON.stringify(params[key])).replace(new RegExp('`{' + key + '}`', 'g'), JSON.stringify(params[key]));\n      }\n\n      if (typeof params[key] === 'number' || typeof params[key] === 'boolean') {\n        str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), params[key]).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), params[key]).replace(new RegExp('`{{' + key + '}}`', 'g'), params[key]).replace(new RegExp('\"{' + key + '}\"', 'g'), params[key]).replace(new RegExp('\\'{' + key + '}\\'', 'g'), params[key]).replace(new RegExp('`{' + key + '}`', 'g'), params[key]);\n      }\n\n      str = str.replace(new RegExp('{{' + key + '}}', 'g'), params[key]).replace(new RegExp('{' + key + '}', 'g'), params[key]);\n    });\n    return str;\n  };\n  /**\n   * Params should have this format => { where1: { { key:'xxx', key2:'xxx' } }},\n   * Keys to search should be in this format {{key}}\n   * @param {String} originalStr\n   * @param {Object} params\n   */\n\n\n  var concatenation = function concatenation(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var str = originalStr;\n    var sql = void 0;\n    Object.keys(params).forEach(function (key) {\n      sql = '' + compact(Object.keys(params[key]).map(function (k) {\n        var value = params[key][k];\n\n        if (Array.isArray(value) && !!value.length) {\n          var mappedValue = value.map(function (v) {\n            return typeof v !== 'number' ? '\\'' + v + '\\'' : v;\n          });\n          return k + ' IN (' + mappedValue.join(', ') + ')';\n        }\n\n        if (!Array.isArray(value) && value) {\n          return typeof value !== 'number' ? k + ' = \\'' + value + '\\'' : k + ' = ' + value;\n        }\n\n        return null;\n      })).join(' AND ');\n      if (sql && key.startsWith('where')) sql = 'WHERE ' + sql;else if (sql && key.startsWith('and')) sql = 'AND ' + sql;else sql = '';\n      str = str.replace(new RegExp('{{' + key + '}}', 'g'), sql);\n      str = str.replace(new RegExp('{' + key + '}', 'g'), sql);\n    });\n    return str;\n  };\n  /**\n   * Replace function\n   * @param {String} string\n   * @param {Object} params\n   * @param {Object} sqlParams\n   */\n\n\n  var replace = function replace(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var sqlParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var str = originalStr;\n\n    if (typeof str === 'string') {\n      str = substitution(str, params);\n      str = concatenation(str, sqlParams);\n    }\n\n    return str;\n  };\n\n  var Layer = function (_PureComponent) {\n    inherits(Layer, _PureComponent);\n\n    function Layer() {\n      var _ref;\n\n      var _temp, _this, _ret;\n\n      classCallCheck(this, Layer);\n\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return _ret = (_temp = (_this = possibleConstructorReturn(this, (_ref = Layer.__proto__ || Object.getPrototypeOf(Layer)).call.apply(_ref, [this].concat(args))), _this), _this.add = function () {\n        var _this$props = _this.props,\n            layerManager = _this$props.layerManager,\n            onAfterAdd = _this$props.onAfterAdd,\n            props = objectWithoutProperties(_this$props, ['layerManager', 'onAfterAdd']);\n        var source = props.source,\n            render = props.render,\n            params = props.params,\n            sqlParams = props.sqlParams;\n        var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams));\n        var renderParsed = render.parse === false ? render : JSON.parse(replace(JSON.stringify(render), params, sqlParams));\n        layerManager.add(_extends({}, props, {\n          source: sourceParsed,\n          render: renderParsed\n        }), {}, onAfterAdd);\n      }, _this.update = function (changedProps) {\n        var _this$props2 = _this.props,\n            layerManager = _this$props2.layerManager,\n            id = _this$props2.id;\n        layerManager.update(id, changedProps);\n      }, _this.remove = function () {\n        var _this$props3 = _this.props,\n            layerManager = _this$props3.layerManager,\n            id = _this$props3.id,\n            onAfterRemove = _this$props3.onAfterRemove;\n        layerManager.remove(id, onAfterRemove);\n      }, _temp), possibleConstructorReturn(_this, _ret);\n    }\n\n    createClass(Layer, [{\n      key: 'componentDidMount',\n      value: function componentDidMount() {\n        this.add();\n      }\n    }, {\n      key: 'componentDidUpdate',\n      value: function componentDidUpdate(prevProps) {\n        var prevSource = prevProps.source,\n            prevRender = prevProps.render,\n            prevParams = prevProps.params,\n            prevSqlParams = prevProps.sqlParams,\n            prevDecodeParams = prevProps.decodeParams,\n            prevOpacity = prevProps.opacity,\n            prevVisibility = prevProps.visibility,\n            prevZIndex = prevProps.zIndex;\n        var _props = this.props,\n            type = _props.type,\n            source = _props.source,\n            render = _props.render,\n            params = _props.params,\n            sqlParams = _props.sqlParams,\n            decodeParams = _props.decodeParams,\n            opacity = _props.opacity,\n            visibility = _props.visibility,\n            zIndex = _props.zIndex; // Check that source has changed\n\n        var prevSourceParsed = prevSource.parse === false ? prevSource : JSON.parse(replace(JSON.stringify(prevSource), prevParams, prevSqlParams));\n        var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams)); // Check that render has changed\n\n        var prevRenderParsed = prevRender.parse === false ? prevRender : JSON.parse(replace(JSON.stringify(prevRender), prevParams, prevSqlParams));\n        var renderParsed = render.parse === false ? render : JSON.parse(replace(JSON.stringify(render), params, sqlParams)); // TODO: don't add and remove if provider is geojson\n\n        if (sourceParsed && !isEqual(sourceParsed, prevSourceParsed)) {\n          var sourceType = sourceParsed.type,\n              data = sourceParsed.data;\n          var t = sourceType || type;\n\n          if (t === 'raster' || t === 'vector' || t === 'geojson' && typeof data === 'string') {\n            this.remove();\n            this.add(); // prevent updating layer\n\n            return;\n          }\n        }\n\n        if (renderParsed && !isEqual(renderParsed, prevRenderParsed)) {\n          var _renderParsed$layers = renderParsed.layers,\n              layers = _renderParsed$layers === undefined ? [] : _renderParsed$layers;\n          var _prevRenderParsed$lay = prevRenderParsed.layers,\n              prevLayers = _prevRenderParsed$lay === undefined ? [] : _prevRenderParsed$lay;\n\n          if (layers.length !== prevLayers.length) {\n            this.remove();\n            this.add(); // prevent updating layer\n\n            return;\n          }\n        }\n\n        var changedProps = _extends({}, opacity !== prevOpacity && {\n          opacity: opacity\n        }, visibility !== prevVisibility && {\n          visibility: visibility\n        }, zIndex !== prevZIndex && {\n          zIndex: zIndex\n        }, !isEqual(sourceParsed, prevRenderParsed) && {\n          source: sourceParsed\n        }, !isEqual(renderParsed, prevRenderParsed) && {\n          render: renderParsed\n        }, !isEqual(decodeParams, prevDecodeParams) && {\n          decodeParams: decodeParams\n        });\n\n        if (!isEmpty(changedProps)) {\n          this.update(changedProps);\n        }\n      }\n    }, {\n      key: 'componentWillUnmount',\n      value: function componentWillUnmount() {\n        this.remove();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        return null;\n      }\n    }]);\n    return Layer;\n  }(react.PureComponent);\n\n  Layer.propTypes = {\n    id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n    type: PropTypes.oneOf(['raster', 'vector', 'geojson']).isRequired,\n    source: PropTypes.shape({\n      parse: PropTypes.bool\n    }).isRequired,\n    render: function render(props, propName, componentName) {\n      var type = props.type;\n\n      if (type === 'vector' && isEmpty(props[propName])) {\n        return new Error('The prop \\'' + propName + '\\' is marked as required in \\'' + componentName + '\\', but its value is {}');\n      }\n\n      if (_typeof(props[propName]) !== 'object') {\n        return new Error('Invalid prop \\'' + propName + '\\' of type \\'' + _typeof(props[propName]) + '\\' supplied to \\'' + componentName + '\\', expected \\'object\\'.');\n      }\n\n      return null;\n    },\n    params: PropTypes.shape({}),\n    sqlParams: PropTypes.shape({}),\n    decodeParams: PropTypes.shape({}),\n    opacity: PropTypes.number,\n    visibility: PropTypes.bool,\n    zIndex: PropTypes.number,\n    onAfterAdd: PropTypes.func,\n    onAfterRemove: PropTypes.func,\n    layerManager: PropTypes.shape({\n      add: PropTypes.func.isRequired,\n      update: PropTypes.func.isRequired,\n      remove: PropTypes.func.isRequired,\n      map: PropTypes.shape({\n        getSource: PropTypes.func\n      })\n    })\n  };\n  Layer.defaultProps = {\n    params: undefined,\n    sqlParams: undefined,\n    decodeParams: undefined,\n    opacity: 1,\n    visibility: true,\n    zIndex: undefined,\n    render: {},\n    layerManager: null,\n    onAfterAdd: function onAfterAdd() {},\n    onAfterRemove: function onAfterRemove() {}\n  }; // This file exists as an entry point for bundling our umd builds.\n\n  var Components = {};\n  Components.LayerManager = LayerManager$1;\n  Components.Layer = Layer;\n  return Components;\n});","module.exports = __webpack_public_path__ + \"static/media/marker1.ff16441f.svg\";","module.exports = __webpack_public_path__ + \"static/media/marker2.c4f943ea.svg\";","import moment from 'moment';\n\nconst MS_PER_DAY = 1000 * 60 * 60 * 24;\n\n// a and b are javascript Date objects\nexport const dateDiffInDays = (startDate, endDate) => {\n  const a = new Date(endDate);\n  const b = new Date(startDate);\n  // Discard the time and time-zone information.\n  const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());\n  const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());\n\n  return Math.floor((utc2 - utc1) / MS_PER_DAY);\n};\n\nexport const getDayRange = (params = {}) => {\n  const { startDate, endDate, minDate, maxDate } = params || {};\n\n  if (!startDate || !endDate || !minDate || !maxDate) return null;\n\n  const minDateTime = new Date(minDate);\n  const maxDateTime = new Date(maxDate);\n  const numberOfDays = dateDiffInDays(maxDateTime, minDateTime);\n\n  // timeline or hover effect active range\n  const startDateTime = new Date(startDate);\n  const endDateTime = new Date(endDate);\n  const activeStartDay = numberOfDays - dateDiffInDays(maxDateTime, startDateTime);\n  const activeEndDay = numberOfDays - dateDiffInDays(maxDateTime, endDateTime);\n\n  // get start and end day\n  const startDayIndex = activeStartDay || 0;\n  const endDayIndex = activeEndDay || numberOfDays;\n\n  return {\n    startDayIndex,\n    endDayIndex,\n    numberOfDays\n  };\n};\n\nexport const getParams = (config = [], params = {}) => {\n  const defaultParams = config.reduce((acc, v) => {\n    const key = v.key;\n    const value = v.default;\n\n    return {\n      ...acc,\n      [key]: value\n    };\n  }, {});\n\n  const newParams = {\n    ...defaultParams,\n    ...params\n  };\n\n  const { startDate, endDate, trimEndDate, maxAbsoluteDate } = newParams;\n\n  const start = startDate;\n  const end = endDate > maxAbsoluteDate ? maxAbsoluteDate : endDate;\n  const trim = trimEndDate > maxAbsoluteDate ? maxAbsoluteDate : trimEndDate;\n\n  return {\n    ...newParams,\n    ...(!!start && {\n      startYear: moment(start).year(),\n      startMonth: moment(start).month(),\n      startDay: moment(start).dayOfYear()\n    }),\n    ...(!!endDate && {\n      endYear: moment(end).year(),\n      endMonth: moment(end).month(),\n      endDay: moment(end).dayOfYear()\n    }),\n    ...(!!trimEndDate && {\n      trimEndYear: moment(trim).year(),\n      trimEndMonth: moment(trim).month(),\n      trimEndDay: moment(trim).dayOfYear()\n    }),\n    ...getDayRange(newParams)\n  };\n};\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\n\nimport isEqual from 'lodash/isEqual';\nimport isEmpty from 'lodash/isEmpty';\n\nimport ReactMapGL, { FlyToInterpolator, TRANSITION_EVENTS } from 'react-map-gl';\nimport { fitBounds } from '@math.gl/web-mercator';\n\nimport { easeCubic } from 'd3-ease';\n\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport './styles.scss';\n\nconst DEFAULT_VIEWPORT = {\n  zoom: 2,\n  lat: 0,\n  lng: 0\n};\n\nclass Map extends Component {\n  events = {};\n\n  HOVER = {};\n\n  static propTypes = {\n    /** A function that returns the map instance */\n    children: PropTypes.func,\n\n    /** Custom css class for styling */\n    customClass: PropTypes.string,\n\n    /** An object that defines the viewport\n     * @see https://uber.github.io/react-map-gl/#/Documentation/api-reference/interactive-map?section=initialization\n     */\n    viewport: PropTypes.shape({}),\n\n    /** An object that defines the bounds */\n    bounds: PropTypes.shape({\n      bbox: PropTypes.array,\n      options: PropTypes.shape({})\n    }),\n\n    /** A boolean that allows panning */\n    dragPan: PropTypes.bool,\n\n    /** A boolean that allows rotating */\n    dragRotate: PropTypes.bool,\n\n    /** A boolean that allows zooming */\n    scrollZoom: PropTypes.bool,\n\n    /** A boolean that allows zooming */\n    touchZoom: PropTypes.bool,\n\n    /** A boolean that allows touch rotating */\n    touchRotate: PropTypes.bool,\n\n    /** A boolean that allows double click zooming */\n    doubleClickZoom: PropTypes.bool,\n\n    /** A function that exposes when the map is loaded. It returns and object with the `this.map` and `this.mapContainer` reference. */\n    onLoad: PropTypes.func,\n\n    /** A function that exposes the viewport */\n    onViewportChange: PropTypes.func,\n\n    /** A function that exposes hovering features. */\n    onHover: PropTypes.func,\n\n    /** A function that exposes mouseleave from features. */\n    onMouseLeave: PropTypes.func,\n\n    /** A function that exposes the viewport */\n    getCursor: PropTypes.func\n  };\n\n  static defaultProps = {\n    children: null,\n    customClass: null,\n    viewport: DEFAULT_VIEWPORT,\n    bounds: {},\n    dragPan: true,\n    dragRotate: true,\n\n    onViewportChange: () => {},\n    onLoad: () => {},\n    getCursor: ({ isHovering, isDragging }) => {\n      if (isHovering) return 'pointer';\n      if (isDragging) return 'grabbing';\n      return 'grab';\n    }\n  };\n\n  state = {\n    viewport: {\n      ...DEFAULT_VIEWPORT,\n      ...this.props.viewport // eslint-disable-line\n    },\n    flying: false,\n    loaded: false\n  };\n\n  componentDidUpdate(prevProps) {\n    const { viewport: prevViewport, bounds: prevBounds } = prevProps;\n    const { viewport, bounds } = this.props;\n    const { viewport: stateViewport } = this.state;\n\n    if (!isEqual(viewport, prevViewport)) {\n      this.setState({\n        // eslint-disable-line\n        viewport: {\n          ...stateViewport,\n          ...viewport\n        }\n      });\n    }\n\n    if (!isEmpty(bounds) && !isEqual(bounds, prevBounds)) {\n      this.fitBounds();\n    }\n  }\n\n  onLoad = () => {\n    const { bounds, onLoad } = this.props;\n    this.setState({ loaded: true });\n\n    if (!isEmpty(bounds) && !!bounds.bbox) {\n      this.fitBounds();\n    }\n\n    onLoad({\n      map: this.map,\n      mapContainer: this.mapContainer\n    });\n  };\n\n  onViewportChange = (v, i) => {\n    const { onViewportChange } = this.props;\n\n    this.setState({ viewport: v });\n    onViewportChange(v);\n  };\n\n  onResize = v => {\n    const { onViewportChange } = this.props;\n    const { viewport } = this.state;\n    const newViewport = {\n      ...viewport,\n      ...v\n    };\n\n    this.setState({ viewport: newViewport });\n    onViewportChange(newViewport);\n  };\n\n  onMoveEnd = () => {\n    const { onViewportChange } = this.props;\n    const { viewport } = this.state;\n\n    if (this.map) {\n      const bearing = this.map.getBearing();\n      const pitch = this.map.getPitch();\n      const zoom = this.map.getZoom();\n      const { lng, lat } = this.map.getCenter();\n\n      const newViewport = {\n        ...viewport,\n        bearing,\n        pitch,\n        zoom,\n        latitude: lat,\n        longitude: lng\n      };\n\n      // Publish new viewport and save it into the state\n      this.setState({ viewport: newViewport });\n      onViewportChange(newViewport);\n    }\n  };\n\n  onHover = e => {\n    const { onHover } = this.props;\n    const { features } = e;\n    if (features && features.length) {\n      const { id, source, sourceLayer } = features[0];\n\n      if (this.HOVER.id) {\n        this.map.setFeatureState(\n          {\n            ...this.HOVER\n          },\n          { hover: false }\n        );\n      }\n\n      if (id && source) {\n        this.HOVER = {\n          id,\n          source,\n          ...(sourceLayer && { sourceLayer })\n        };\n\n        this.map.setFeatureState(\n          {\n            ...this.HOVER\n          },\n          { hover: true }\n        );\n      }\n    }\n\n    !!onHover && onHover(e);\n  };\n\n  onMouseLeave = e => {\n    const { onMouseLeave } = this.props;\n    if (this.HOVER.id) {\n      this.map.setFeatureState(\n        {\n          ...this.HOVER\n        },\n        { hover: false }\n      );\n    }\n\n    this.HOVER = {};\n\n    !!onMouseLeave && onMouseLeave(e);\n  };\n\n  fitBounds = () => {\n    const { bounds, onViewportChange } = this.props;\n    const { bbox, options, viewportOptions } = bounds;\n\n    const { longitude, latitude, zoom } = fitBounds({\n      width: this.mapContainer.offsetWidth,\n      height: this.mapContainer.offsetHeight,\n      bounds: [\n        [bbox[0], bbox[1]],\n        [bbox[2], bbox[3]]\n      ],\n      ...options\n    });\n\n    const newViewport = {\n      ...this.state.viewport,\n      longitude,\n      latitude,\n      zoom,\n      transitionDuration: 2500,\n      transitionInterruption: TRANSITION_EVENTS.UPDATE,\n      ...viewportOptions\n    };\n\n    this.setState({\n      flying: true,\n      viewport: newViewport\n    });\n    onViewportChange(newViewport);\n\n    setTimeout(() => {\n      this.setState({ flying: false });\n    }, 2500);\n  };\n\n  render() {\n    const {\n      customClass,\n      children,\n      getCursor,\n      dragPan,\n      dragRotate,\n      scrollZoom,\n      touchZoom,\n      touchRotate,\n      doubleClickZoom,\n      ...mapboxProps\n    } = this.props;\n    const { viewport, loaded, flying } = this.state;\n\n    return (\n      <div\n        ref={r => {\n          this.mapContainer = r;\n        }}\n        className={classnames({\n          'c-map': true,\n          [customClass]: !!customClass\n        })}\n      >\n        <ReactMapGL\n          ref={map => {\n            this.map = map && map.getMap();\n          }}\n          // CUSTOM PROPS FROM REACT MAPBOX API\n          {...mapboxProps}\n          // VIEWPORT\n          {...viewport}\n          width=\"100%\"\n          height=\"100%\"\n          // INTERACTIVE\n          dragPan={!flying && dragPan}\n          dragRotate={!flying && dragRotate}\n          scrollZoom={!flying && scrollZoom}\n          touchZoom={!flying && touchZoom}\n          touchRotate={!flying && touchRotate}\n          doubleClickZoom={!flying && doubleClickZoom}\n          // DEFAULT FUNC IMPLEMENTATIONS\n          onViewportChange={this.onViewportChange}\n          onResize={this.onResize}\n          onLoad={this.onLoad}\n          // getCursor={getCursor}\n\n          onHover={this.onHover}\n          onMouseLeave={this.onMouseLeave}\n          transitionInterpolator={new FlyToInterpolator()}\n          transitionEasing={easeCubic}\n        >\n          {loaded && !!this.map && typeof children === 'function' && children(this.map)}\n        </ReactMapGL>\n      </div>\n    );\n  }\n}\n\nexport default Map;\n","import SidebarComponent from './component';\n\nexport default SidebarComponent;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './styles.scss';\n\nclass SidebarComponent extends React.Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired\n  };\n\n  render() {\n    const { children } = this.props;\n\n    return (\n      <div className=\"c-sidebar\">\n        <div className=\"sidebar--scroll\">{children}</div>\n      </div>\n    );\n  }\n}\n\nexport default SidebarComponent;\n","import isEqual from 'lodash/isEqual';\nimport axios, { CancelToken } from 'axios';\nimport omit from 'lodash/omit';\nimport isEmpty from 'lodash/isEmpty';\nimport compact from 'lodash/compact';\nimport isObject from 'lodash/isObject';\nimport { Deck, WebMercatorViewport, Layer } from '@deck.gl/core';\nimport { CompositeLayer } from 'deck.gl';\nimport GL from '@luma.gl/constants';\nimport { Model, Geometry, Texture2D, fp64 } from 'luma.gl';\nimport { loadImage } from '@loaders.gl/images';\nimport sortBy from 'lodash/sortBy';\n\nvar classCallCheck = function classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar defineProperty = function defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar possibleConstructorReturn = function possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar toConsumableArray = function toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n};\n\nvar handleCallback = function handleCallback(resolve, reject, callback, r) {\n  try {\n    resolve(callback(r));\n  } catch (e) {\n    reject(e);\n  }\n};\n\nvar CancelablePromise = function () {\n  createClass(CancelablePromise, null, [{\n    key: \"all\",\n    value: function all(iterable) {\n      return new CancelablePromise(function (y, n) {\n        Promise.all(iterable).then(y, n);\n      });\n    }\n  }, {\n    key: \"race\",\n    value: function race(iterable) {\n      return new CancelablePromise(function (y, n) {\n        Promise.race(iterable).then(y, n);\n      });\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(value) {\n      return new CancelablePromise(function (y, n) {\n        Promise.reject(value).then(y, n);\n      });\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(value) {\n      return new CancelablePromise(function (y, n) {\n        Promise.resolve(value).then(y, n);\n      });\n    }\n  }]);\n\n  function CancelablePromise(executor) {\n    classCallCheck(this, CancelablePromise);\n    this._promise = new Promise(executor);\n    this._canceled = false;\n  }\n\n  createClass(CancelablePromise, [{\n    key: \"then\",\n    value: function then(success, error) {\n      var _this = this;\n\n      var p = new CancelablePromise(function (resolve, reject) {\n        _this._promise.then(function (r) {\n          if (_this._canceled) {\n            p.cancel();\n          }\n\n          if (success && !_this._canceled) {\n            handleCallback(resolve, reject, success, r);\n          } else {\n            resolve(r);\n          }\n        }, function (r) {\n          if (_this._canceled) {\n            p.cancel();\n          }\n\n          if (error && !_this._canceled) {\n            handleCallback(resolve, reject, error, r);\n          } else {\n            reject(r);\n          }\n        });\n      });\n      return p;\n    }\n  }, {\n    key: \"catch\",\n    value: function _catch(error) {\n      return this.then(undefined, error);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(errorCallback) {\n      this._canceled = true;\n\n      if (errorCallback) {\n        this._promise.catch(errorCallback);\n      }\n\n      return this;\n    }\n  }]);\n  return CancelablePromise;\n}();\n\nvar LayerModel = function () {\n  function LayerModel() {\n    var layerSpec = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    classCallCheck(this, LayerModel);\n    this.opacity = 1;\n    this.visibility = true;\n    this.source = {};\n    this.render = {};\n    Object.assign(this, layerSpec, {\n      changedAttributes: {}\n    });\n  }\n\n  createClass(LayerModel, [{\n    key: 'get',\n    value: function get$$1(key) {\n      return this[key];\n    }\n  }, {\n    key: 'set',\n    value: function set$$1(key, value) {\n      this[key] = value;\n      return this;\n    }\n  }, {\n    key: 'update',\n    value: function update(layerSpec) {\n      var _this = this;\n\n      var prevData = _extends({}, this);\n\n      var nextData = _extends({}, layerSpec); // reseting changedAttributes for every update\n\n\n      this.set('changedAttributes', {});\n      Object.keys(nextData).forEach(function (k) {\n        if (!isEqual(prevData[k], nextData[k])) {\n          _this.changedAttributes[k] = nextData[k];\n\n          _this.set(k, nextData[k]);\n        }\n      });\n    }\n  }]);\n  return LayerModel;\n}();\n\nvar headers = {\n  'Content-Type': 'application/json'\n};\n\nvar get$1 = function get$$1(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return axios.get(url, _extends({\n    headers: headers\n  }, options));\n};\n\nvar post = function post(url, body) {\n  return axios.post(url, body, {\n    headers: headers\n  });\n};\n\nvar fetch$1 = function fetch(type, url, options, layerModel) {\n  var layerRequest = layerModel.layerRequest;\n\n  if (layerRequest) {\n    layerRequest.cancel('Operation canceled by the user.');\n  }\n\n  var layerRequestSource = CancelToken.source();\n  layerModel.set('layerRequest', layerRequestSource);\n  var method = type === 'post' ? post : get$1;\n  var newLayerRequest = method(url, _extends({}, options, {\n    cancelToken: layerRequestSource.token\n  })).then(function (res) {\n    if (res.status > 400) {\n      console.error(res);\n      return false;\n    }\n\n    return res.data;\n  });\n  return newLayerRequest;\n};\n\nvar DEFAULT_PROVIDERS = {\n  carto: function carto(layerModel, layer, resolve, reject) {\n    var interactivity = layerModel.interactivity,\n        source = layerModel.source;\n    var provider = source.provider;\n    var layerTpl = JSON.stringify({\n      version: '1.3.0',\n      stat_tag: 'API',\n      layers: provider.layers.map(function (l) {\n        if (!!interactivity && interactivity.length) {\n          return _extends({}, l, {\n            options: _extends({}, l.options, {\n              interactivity: interactivity\n            })\n          });\n        }\n\n        return l;\n      })\n    }); // https://carto.com/developers/auth-api/guides/how-to-send-API-Keys/\n\n    var apiParams = _extends({\n      stat_tag: 'API',\n      config: encodeURIComponent(layerTpl)\n    }, provider.api_key && {\n      api_key: provider.api_key\n    });\n\n    var apiParamsString = Object.keys(apiParams).map(function (k) {\n      return k + '=' + apiParams[k];\n    }).join('&');\n    var url = 'https://' + provider.account + '.carto.com/api/v1/map?' + apiParamsString;\n    fetch$1('get', url, {}, layerModel).then(function (response) {\n      var ext = layerModel.type === 'vector' ? 'mvt' : 'png';\n      var tileUrl = response.cdn_url.templates.https.url.replace('{s}', 'a') + '/' + provider.account + '/api/v1/map/' + response.layergroupid + '/{z}/{x}/{y}.' + ext;\n      return resolve(_extends({}, layer, {\n        source: _extends({}, omit(layer.source, 'provider'), {\n          tiles: [tileUrl]\n        })\n      }));\n    }).catch(function (err) {\n      return reject(err);\n    });\n  }\n};\n\nfunction checkPluginProperties(plugin) {\n  if (plugin) {\n    var requiredProperties = ['add', 'remove', 'setVisibility', 'setOpacity', 'setZIndex', 'setSource', 'setRender', 'setParams', 'setSQLParams', 'setDecodeParams', 'getLayerByType'];\n    requiredProperties.forEach(function (property) {\n      if (!plugin[property]) {\n        console.error('The ' + property + ' function is required for layer manager plugins');\n      }\n    });\n    var deprecatedProperties = ['getLayerByProvider'];\n    deprecatedProperties.forEach(function (property) {\n      if (plugin[property]) {\n        console.warn('The ' + property + ' function is deprecated for layer manager plugins');\n      }\n    });\n  }\n}\n\nvar LayerManager = function () {\n  function LayerManager(map, Plugin, Providers) {\n    classCallCheck(this, LayerManager);\n    this.map = map;\n    this.providers = _extends({}, DEFAULT_PROVIDERS, Providers);\n    this.layers = [];\n    this.promises = {};\n    this.options = {\n      getLayers: this.getLayers.bind(this)\n    };\n    this.plugin = new Plugin(this.map, this.options);\n    checkPluginProperties(this.plugin);\n  }\n  /**\n   * Add layers\n   * @param {Array} layers\n   * @param {Object} layerOptions\n   */\n\n\n  createClass(LayerManager, [{\n    key: 'add',\n    value: function add(layer) {\n      var layerOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        opacity: 1,\n        visibility: true,\n        zIndex: 0,\n        interactivity: null\n      };\n      var onAfterAdd = arguments[2];\n\n      if (typeof layer === 'undefined') {\n        console.error('layer is required');\n        return this;\n      }\n\n      var layerModel = new LayerModel(_extends({}, layer, layerOptions));\n      var id = layerModel.id;\n\n      if (this.layers.find(function (l) {\n        return l.id === id;\n      })) {\n        return this.layers;\n      }\n\n      this.layers.push(layerModel);\n      this.requestLayer(layerModel, onAfterAdd);\n      return this.layers;\n    }\n    /**\n     * Updating a specific layer\n     * @param  {Object} layerModel\n     */\n\n  }, {\n    key: 'update',\n    value: function update(id, changedProps) {\n      var layerModel = this.getLayerModel(id);\n      if (!layerModel || !layerModel.mapLayer) return;\n      layerModel.update(changedProps);\n      var opacity = changedProps.opacity,\n          visibility = changedProps.visibility,\n          zIndex = changedProps.zIndex,\n          source = changedProps.source,\n          render = changedProps.render,\n          params = changedProps.params,\n          sqlParams = changedProps.sqlParams,\n          decodeParams = changedProps.decodeParams;\n\n      if (typeof opacity !== 'undefined') {\n        this.plugin.setOpacity(layerModel, opacity);\n      }\n\n      if (typeof visibility !== 'undefined') {\n        this.plugin.setVisibility(layerModel, visibility);\n      }\n\n      if (typeof zIndex !== 'undefined') {\n        this.plugin.setZIndex(layerModel, zIndex);\n      }\n\n      if (!isEmpty(source)) {\n        this.plugin.setSource(layerModel);\n      }\n\n      if (!isEmpty(render)) {\n        this.plugin.setRender(layerModel);\n      }\n\n      if (!isEmpty(params)) {\n        this.plugin.setParams(layerModel);\n      }\n\n      if (!isEmpty(sqlParams)) {\n        this.plugin.setSqlParams(layerModel);\n      }\n\n      if (!isEmpty(decodeParams)) {\n        this.plugin.setDecodeParams(layerModel);\n      }\n    }\n    /**\n     * Remove a layer giving a Layer ID\n     * @param {String} id\n     */\n\n  }, {\n    key: 'remove',\n    value: function remove(id, onAfterRemove) {\n      var layers = this.layers.slice(0);\n      this.requestCancel(id);\n      var layerModel = this.getLayerModel(id);\n\n      if (layerModel) {\n        this.plugin.remove(layerModel);\n      }\n\n      this.layers = layers.filter(function (l) {\n        return l.id !== id;\n      });\n      onAfterRemove(layerModel);\n    }\n  }, {\n    key: 'getLayers',\n    value: function getLayers() {\n      return this.layers;\n    }\n  }, {\n    key: 'getLayerModel',\n    value: function getLayerModel(id) {\n      return this.layers.find(function (l) {\n        return l.id === id;\n      });\n    }\n    /**\n     * A namespace to set opacity on selected layer\n     * @param {String} id\n     * @param {Number} opacity\n     */\n\n  }, {\n    key: 'setOpacity',\n    value: function setOpacity(id, opacity) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setOpacity(layerModel, opacity);\n    }\n    /**\n     * A namespace to hide or show a selected layer\n     * @param {String} id\n     * @param {Boolean} visibility\n     */\n\n  }, {\n    key: 'setVisibility',\n    value: function setVisibility(id, visibility) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setVisibility(layerModel, visibility);\n    }\n    /**\n     * A namespace to set z-index on selected layer\n     * @param {String} id\n     * @param {Number} zIndex\n     */\n\n  }, {\n    key: 'setZIndex',\n    value: function setZIndex(id, zIndex) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setZIndex(layerModel, zIndex);\n    }\n  }, {\n    key: 'requestLayer',\n    value: function requestLayer(layerModel, onAfterAdd) {\n      var _this = this;\n\n      var type = layerModel.type;\n      var method = this.plugin.getLayerByType(type);\n\n      if (!method) {\n        this.promises[layerModel.id] = CancelablePromise.reject(new Error(type + ' type is not yet supported.'));\n        return false;\n      } // Cancel previous/existing request\n\n\n      this.requestCancel(layerModel.id); // every request method returns a promise that we store in the array\n      // to control when all layers are fetched.\n\n      this.promises[layerModel.id] = method.call(this, layerModel, this.providers).then(function (layer) {\n        var canceled = _this.promises[layerModel.id]._canceled;\n\n        if (!canceled) {\n          layerModel.set('mapLayer', layer);\n\n          _this.plugin.add(layerModel, _this.layers);\n\n          _this.plugin.setZIndex(layerModel, layerModel.zIndex);\n\n          _this.plugin.setOpacity(layerModel, layerModel.opacity);\n\n          _this.plugin.setVisibility(layerModel, layerModel.visibility);\n\n          _this.plugin.setRender(layerModel);\n\n          onAfterAdd(layerModel);\n        }\n      });\n      return this;\n    }\n  }, {\n    key: 'requestCancel',\n    value: function requestCancel(layerModelId) {\n      // Cancel previous/existing request\n      if (this.promises[layerModelId] && this.promises[layerModelId].cancel) {\n        this.promises[layerModelId].cancel();\n      }\n    }\n  }, {\n    key: 'unmount',\n    value: function unmount() {\n      this.map = null;\n      this.plugin.unmount();\n    }\n  }]);\n  return LayerManager;\n}();\n/**\n * Params should have this format => { key:'xxx', key2:'xxx' }\n * Keys to search should be in this format {{key}}\n * @param {String} originalStr\n * @param {Object} params\n */\n\n\nvar substitution = function substitution(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var str = originalStr;\n  Object.keys(params).forEach(function (key) {\n    if (Array.isArray(params[key]) || isObject(params[key])) {\n      str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), JSON.stringify(params[key])).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), JSON.stringify(params[key])).replace(new RegExp('`{{' + key + '}}`', 'g'), JSON.stringify(params[key])).replace(new RegExp('\"{' + key + '}\"', 'g'), JSON.stringify(params[key])).replace(new RegExp('\\'{' + key + '}\\'', 'g'), JSON.stringify(params[key])).replace(new RegExp('`{' + key + '}`', 'g'), JSON.stringify(params[key]));\n    }\n\n    if (typeof params[key] === 'number' || typeof params[key] === 'boolean') {\n      str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), params[key]).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), params[key]).replace(new RegExp('`{{' + key + '}}`', 'g'), params[key]).replace(new RegExp('\"{' + key + '}\"', 'g'), params[key]).replace(new RegExp('\\'{' + key + '}\\'', 'g'), params[key]).replace(new RegExp('`{' + key + '}`', 'g'), params[key]);\n    }\n\n    str = str.replace(new RegExp('{{' + key + '}}', 'g'), params[key]).replace(new RegExp('{' + key + '}', 'g'), params[key]);\n  });\n  return str;\n};\n/**\n * Params should have this format => { where1: { { key:'xxx', key2:'xxx' } }},\n * Keys to search should be in this format {{key}}\n * @param {String} originalStr\n * @param {Object} params\n */\n\n\nvar concatenation = function concatenation(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var str = originalStr;\n  var sql = void 0;\n  Object.keys(params).forEach(function (key) {\n    sql = '' + compact(Object.keys(params[key]).map(function (k) {\n      var value = params[key][k];\n\n      if (Array.isArray(value) && !!value.length) {\n        var mappedValue = value.map(function (v) {\n          return typeof v !== 'number' ? '\\'' + v + '\\'' : v;\n        });\n        return k + ' IN (' + mappedValue.join(', ') + ')';\n      }\n\n      if (!Array.isArray(value) && value) {\n        return typeof value !== 'number' ? k + ' = \\'' + value + '\\'' : k + ' = ' + value;\n      }\n\n      return null;\n    })).join(' AND ');\n    if (sql && key.startsWith('where')) sql = 'WHERE ' + sql;else if (sql && key.startsWith('and')) sql = 'AND ' + sql;else sql = '';\n    str = str.replace(new RegExp('{{' + key + '}}', 'g'), sql);\n    str = str.replace(new RegExp('{' + key + '}', 'g'), sql);\n  });\n  return str;\n};\n/**\n * Replace function\n * @param {String} string\n * @param {Object} params\n * @param {Object} sqlParams\n */\n\n\nvar replace = function replace(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var sqlParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var str = originalStr;\n\n  if (typeof str === 'string') {\n    str = substitution(str, params);\n    str = concatenation(str, sqlParams);\n  }\n\n  return str;\n};\n/**\n * Parsed vector style layers that follow the mapbox style layer spec\n * and returns mountable layers with ids and opacity applied\n * @param {Array} vectorLayers\n * @param {Object} layerModel\n */\n\n\nvar getVectorStyleLayers = function getVectorStyleLayers(vectorLayers, layerModel) {\n  var id = layerModel.id,\n      params = layerModel.params,\n      sqlParams = layerModel.sqlParams;\n\n  if (vectorLayers && vectorLayers.length) {\n    var vectorLayersParsed = JSON.parse(replace(JSON.stringify(vectorLayers), params, sqlParams));\n    return vectorLayersParsed && vectorLayersParsed.map(function (vectorLayer, i) {\n      var PAINT_STYLE_NAMES = {\n        symbol: ['icon', 'text'],\n        circle: ['circle', 'circle-stroke']\n      }; // Select the paint property from the original layer\n\n      var _vectorLayer$paint = vectorLayer.paint,\n          paint = _vectorLayer$paint === undefined ? {} : _vectorLayer$paint; // Select the style to change depending on the type of layer\n\n      var opacityPaintNames = PAINT_STYLE_NAMES[vectorLayer.type] || [vectorLayer.type];\n      var opacityPaintStyles = opacityPaintNames.reduce(function (obj, name) {\n        var currentProperty = paint[name + '-opacity'];\n        var paintOpacity = 0.99 * layerModel.opacity;\n\n        if (currentProperty !== undefined && currentProperty !== null) {\n          if (typeof currentProperty === 'number') {\n            paintOpacity = currentProperty * layerModel.opacity * 0.99;\n          }\n\n          if (Array.isArray(currentProperty)) {\n            paintOpacity = currentProperty.map(function (j) {\n              if (typeof j === 'number') {\n                return j * layerModel.opacity * 0.99;\n              }\n\n              return j;\n            });\n          }\n        }\n\n        return _extends({}, obj, defineProperty({}, name + '-opacity', paintOpacity));\n      }, {}); // if paint properties are null are passed it breaks interaction\n      // on mapbox. We need to remove these\n\n      var filteredPaintProperties = vectorLayer.paint && Object.entries(vectorLayer.paint).reduce(function (obj, _ref) {\n        var _ref2 = slicedToArray(_ref, 2),\n            key = _ref2[0],\n            value = _ref2[1];\n\n        return _extends({}, obj, !!value && defineProperty({}, key, value));\n      }, {});\n      return _extends({\n        // id: This will avoid having issues with any layer, but you should specify an id when you create it.\n        // If you don't set an id in the definition, and you set a fill-opacity, it won't work\n        id: id + '-' + vectorLayer.type + '-' + i\n      }, vectorLayer, {\n        source: id\n      }, vectorLayer.paint && {\n        paint: _extends({}, filteredPaintProperties, opacityPaintStyles)\n      });\n    });\n  }\n\n  return false;\n};\n/* eslint-disable no-restricted-syntax */\n\n\nfunction getDeckInstance(_ref) {\n  var map = _ref.map,\n      gl = _ref.gl,\n      deck = _ref.deck; // Only create one deck instance per context\n\n  if (map.__deck) {\n    return map.__deck;\n  }\n\n  var customRender = deck && deck.props._customRender;\n  var deckProps = {\n    useDevicePixels: true,\n    _customRender: function _customRender() {\n      map.triggerRepaint();\n\n      if (customRender) {\n        // customRender may be subscribed by DeckGL React component to update child props\n        // make sure it is still called\n        customRender();\n      }\n    },\n    // TODO: import these defaults from a single source of truth\n    parameters: {\n      depthMask: true,\n      depthTest: true,\n      blendFunc: [gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA],\n      blendEquation: gl.FUNC_ADD\n    },\n    userData: {\n      isExternal: false,\n      mapboxLayers: new Set()\n    }\n  };\n\n  if (deck) {\n    deck.setProps(deckProps);\n    deck.props.userData.isExternal = true;\n  } else {\n    // Using external gl context - do not set css size\n    Object.assign(deckProps, {\n      gl: gl,\n      width: false,\n      height: false,\n      viewState: getViewState(map)\n    });\n    deck = new Deck(deckProps); // If deck is externally provided (React use case), we use deck's viewState to\n    // drive the map.\n    // Otherwise (pure JS use case), we use the map's viewState to drive deck.\n\n    map.on('move', function () {\n      return onMapMove(deck, map);\n    });\n    map.on('remove', function () {\n      deck.finalize();\n      map.__deck = null;\n    });\n  }\n\n  deck.props.userData.mapboxVersion = getMapboxVersion(map);\n  map.__deck = deck;\n  map.on('render', function () {\n    if (deck.layerManager) afterRender(deck, map);\n  });\n  return deck;\n}\n\nfunction addLayer(deck, layer) {\n  deck.props.userData.mapboxLayers.add(layer);\n  updateLayers(deck);\n}\n\nfunction removeLayer(deck, layer) {\n  deck.props.userData.mapboxLayers.delete(layer);\n  updateLayers(deck);\n}\n\nfunction updateLayer(deck) {\n  updateLayers(deck);\n}\n\nfunction drawLayer(deck, map, layer) {\n  var currentViewport = deck.props.userData.currentViewport;\n\n  if (!currentViewport) {\n    // This is the first layer drawn in this render cycle.\n    // Generate viewport from the current map state.\n    currentViewport = getViewport(deck, map, true);\n    deck.props.userData.currentViewport = currentViewport;\n  }\n\n  if (!deck.layerManager) {\n    return;\n  }\n\n  deck._drawLayers('mapbox-repaint', {\n    viewports: [currentViewport],\n    // TODO - accept layerFilter in drawLayers' renderOptions\n    layers: getLayers(deck, function (deckLayer) {\n      return shouldDrawLayer(layer.id, deckLayer);\n    }),\n    clearCanvas: false\n  });\n}\n\nfunction getViewState(map) {\n  var _map$getCenter = map.getCenter(),\n      lng = _map$getCenter.lng,\n      lat = _map$getCenter.lat;\n\n  return {\n    longitude: lng,\n    latitude: lat,\n    zoom: map.getZoom(),\n    bearing: map.getBearing(),\n    pitch: map.getPitch()\n  };\n}\n\nfunction getMapboxVersion(map) {\n  // parse mapbox version string\n  var major = 0;\n  var minor = 0;\n\n  if (map.version) {\n    var _map$version$split$sl = map.version.split('.').slice(0, 2).map(Number);\n\n    var _map$version$split$sl2 = slicedToArray(_map$version$split$sl, 2);\n\n    major = _map$version$split$sl2[0];\n    minor = _map$version$split$sl2[1];\n  }\n\n  return {\n    major: major,\n    minor: minor\n  };\n}\n\nfunction getViewport(deck, map) {\n  var useMapboxProjection = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var mapboxVersion = deck.props.userData.mapboxVersion;\n  return new WebMercatorViewport(Object.assign({\n    x: 0,\n    y: 0,\n    width: deck.width,\n    height: deck.height,\n    repeat: true\n  }, getViewState(map), useMapboxProjection ? {\n    // match mapbox's projection matrix\n    // A change of near plane was made in 1.3.0\n    // https://github.com/mapbox/mapbox-gl-js/pull/8502\n    nearZMultiplier: mapboxVersion.major === 1 && mapboxVersion.minor >= 3 || mapboxVersion.major >= 2 ? 0.02 : 1 / (deck.height || 1)\n  } : {\n    // use deck.gl's own default\n    nearZMultiplier: 0.1\n  }));\n}\n\nfunction afterRender(deck, map) {\n  var _deck$props$userData = deck.props.userData,\n      mapboxLayers = _deck$props$userData.mapboxLayers,\n      isExternal = _deck$props$userData.isExternal;\n\n  if (isExternal) {\n    // Draw non-Mapbox layers\n    var mapboxLayerIds = Array.from(mapboxLayers, function (layer) {\n      return layer.id;\n    });\n    var layers = getLayers(deck, function (deckLayer) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = mapboxLayerIds[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var id = _step.value;\n\n          if (shouldDrawLayer(id, deckLayer)) {\n            return false;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return true;\n    });\n\n    if (layers.length > 0) {\n      deck._drawLayers('mapbox-repaint', {\n        viewports: [getViewport(deck, map, false)],\n        layers: layers,\n        clearCanvas: false\n      });\n    }\n  } // End of render cycle, clear generated viewport\n\n\n  deck.props.userData.currentViewport = null;\n}\n\nfunction onMapMove(deck, map) {\n  deck.setProps({\n    viewState: getViewState(map)\n  }); // Camera changed, will trigger a map repaint right after this\n  // Clear any change flag triggered by setting viewState so that deck does not request\n  // a second repaint\n  // deck.needsRedraw({ clearRedrawFlags: true });\n}\n\nfunction getLayers(deck, layerFilter) {\n  var layers = deck.layerManager.getLayers();\n  return layers.filter(layerFilter);\n}\n\nfunction shouldDrawLayer(id, layer) {\n  var layerInstance = layer;\n\n  while (layerInstance) {\n    if (layerInstance.id === id) {\n      return true;\n    }\n\n    layerInstance = layerInstance.parent;\n  }\n\n  return false;\n}\n\nfunction updateLayers(deck) {\n  if (deck.props.userData.isExternal) {\n    return;\n  }\n\n  var layers = [];\n  deck.props.userData.mapboxLayers.forEach(function (deckLayer) {\n    var LayerType = deckLayer.props.type;\n    var layer = new LayerType(deckLayer.props);\n    layers.push(layer);\n  });\n  deck.setProps({\n    layers: layers\n  });\n}\n\nvar MapboxLayer = function () {\n  /* eslint-disable no-this-before-super */\n  function MapboxLayer(props) {\n    classCallCheck(this, MapboxLayer);\n\n    if (!props.id) {\n      throw new Error('Layer must have an unique id');\n    }\n\n    this.id = props.id;\n    this.type = 'custom';\n    this.renderingMode = props.renderingMode || '3d';\n    this.map = null;\n    this.deck = null;\n    this.props = props;\n  }\n  /* Mapbox custom layer methods */\n\n\n  createClass(MapboxLayer, [{\n    key: 'onAdd',\n    value: function onAdd(map, gl) {\n      this.map = map;\n      this.deck = getDeckInstance({\n        map: map,\n        gl: gl,\n        deck: this.props.deck\n      });\n      addLayer(this.deck, this);\n    }\n  }, {\n    key: 'onRemove',\n    value: function onRemove() {\n      removeLayer(this.deck, this);\n    }\n  }, {\n    key: 'setProps',\n    value: function setProps(props) {\n      // id cannot be changed\n      Object.assign(this.props, props, {\n        id: this.id\n      }); // safe guard in case setProps is called before onAdd\n\n      if (this.deck) {\n        updateLayer(this.deck, this);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      drawLayer(this.deck, this.map, this);\n    }\n  }]);\n  return MapboxLayer;\n}(); // https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Lon..2Flat._to_tile_numbers_2\n\n\nfunction tile2latLng(x, y, z) {\n  var lng = x / Math.pow(2, z) * 360 - 180;\n  var n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\n  var lat = 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  return [lng, lat];\n}\n\nfunction tile2boundingBox(x, y, z) {\n  var _tile2latLng = tile2latLng(x, y, z),\n      _tile2latLng2 = slicedToArray(_tile2latLng, 2),\n      west = _tile2latLng2[0],\n      north = _tile2latLng2[1];\n\n  var _tile2latLng3 = tile2latLng(x + 1, y + 1, z),\n      _tile2latLng4 = slicedToArray(_tile2latLng3, 2),\n      east = _tile2latLng4[0],\n      south = _tile2latLng4[1];\n\n  return [west, south, east, north];\n}\n\nvar Tile = function () {\n  function Tile(_ref) {\n    var getTileData = _ref.getTileData,\n        x = _ref.x,\n        y = _ref.y,\n        z = _ref.z,\n        onTileLoad = _ref.onTileLoad,\n        onTileError = _ref.onTileError;\n    classCallCheck(this, Tile);\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.bbox = tile2boundingBox(this.x, this.y, this.z);\n    this.isVisible = true;\n    this.getTileData = getTileData;\n    this._data = null;\n    this._isLoaded = false;\n    this._loader = this._loadData();\n    this.onTileLoad = onTileLoad;\n    this.onTileError = onTileError;\n  }\n\n  createClass(Tile, [{\n    key: \"_loadData\",\n    value: function _loadData() {\n      var _this = this;\n\n      var x = this.x,\n          y = this.y,\n          z = this.z,\n          bbox = this.bbox;\n\n      if (!this.getTileData) {\n        return null;\n      }\n\n      return Promise.resolve(this.getTileData({\n        x: x,\n        y: y,\n        z: z,\n        bbox: bbox\n      })).then(function (buffers) {\n        _this._data = buffers;\n        _this._isLoaded = true;\n\n        _this.onTileLoad(_this);\n\n        return buffers;\n      }).catch(function (err) {\n        _this._isLoaded = true;\n\n        _this.onTileError(err);\n      });\n    }\n  }, {\n    key: \"isOverlapped\",\n    value: function isOverlapped(tile) {\n      var x = this.x,\n          y = this.y,\n          z = this.z;\n      var m = Math.pow(2, tile.z - z);\n      return Math.floor(tile.x / m) === x && Math.floor(tile.y / m) === y;\n    }\n  }, {\n    key: \"data\",\n    get: function get$$1() {\n      return this._data || this._loader;\n    }\n  }, {\n    key: \"isLoaded\",\n    get: function get$$1() {\n      return this._isLoaded;\n    }\n  }]);\n  return Tile;\n}();\n\nvar TILE_SIZE = 256;\nvar PI = Math.PI;\nvar PI_4 = PI / 4;\nvar DEGREES_TO_RADIANS = PI / 180;\n\nfunction lngLatToWorld(_ref, scale) {\n  var _ref2 = slicedToArray(_ref, 2),\n      lng = _ref2[0],\n      lat = _ref2[1];\n\n  if (!Number.isFinite(lng) || !Number.isFinite(scale) || !(Number.isFinite(lat) && lat >= -90 && lat <= 90)) {\n    return console.error('lngLatToWorld: lng, lat or scale are not correct values');\n  }\n\n  var s = TILE_SIZE * 2 * scale;\n  var lambda2 = lng * DEGREES_TO_RADIANS;\n  var phi2 = lat * DEGREES_TO_RADIANS;\n  var x = s * (lambda2 + PI) / (2 * PI);\n  var y = s * (PI - Math.log(Math.tan(PI_4 + phi2 * 0.5))) / (2 * PI);\n  return [x, y];\n}\n\nfunction getBoundingBox(viewport) {\n  var corners = [viewport.unproject([0, 0]), viewport.unproject([viewport.width, 0]), viewport.unproject([0, viewport.height]), viewport.unproject([viewport.width, viewport.height])];\n  return [corners.reduce(function (minLng, p) {\n    return minLng < p[0] ? minLng : p[0];\n  }, 180), corners.reduce(function (minLat, p) {\n    return minLat < p[1] ? minLat : p[1];\n  }, 90), corners.reduce(function (maxLng, p) {\n    return maxLng > p[0] ? maxLng : p[0];\n  }, -180), corners.reduce(function (maxLat, p) {\n    return maxLat > p[1] ? maxLat : p[1];\n  }, -90)];\n}\n\nfunction pixelsToTileIndex(a) {\n  return a / TILE_SIZE;\n}\n/**\n * Calculates and returns a new tile index {x, y, z}, with z being the given adjustedZ.\n */\n\n\nfunction getAdjustedTileIndex(_ref3, adjustedZ) {\n  var x = _ref3.x,\n      y = _ref3.y,\n      z = _ref3.z;\n  var m = Math.pow(2, z - adjustedZ);\n  return {\n    x: Math.floor(x / m),\n    y: Math.floor(y / m),\n    z: adjustedZ\n  };\n}\n/**\n * Returns all tile indices in the current viewport. If the current zoom level is smaller\n * than minZoom, return an empty array. If the current zoom level is greater than maxZoom,\n * return tiles that are on maxZoom.\n */\n\n\nfunction getTileIndices(viewport, maxZoom, minZoom) {\n  var z = Math.floor(viewport.zoom) + 1;\n\n  if (minZoom && z < minZoom) {\n    return [];\n  } // eslint-disable-next-line no-param-reassign\n\n\n  viewport = new viewport.constructor(_extends({}, viewport, {\n    zoom: z - 1\n  }));\n  var bbox = getBoundingBox(viewport);\n\n  var _lngLatToWorld$map = lngLatToWorld([bbox[0], bbox[3]], viewport.scale).map(pixelsToTileIndex),\n      _lngLatToWorld$map2 = slicedToArray(_lngLatToWorld$map, 2),\n      minX = _lngLatToWorld$map2[0],\n      minY = _lngLatToWorld$map2[1];\n\n  var _lngLatToWorld$map3 = lngLatToWorld([bbox[2], bbox[1]], viewport.scale).map(pixelsToTileIndex),\n      _lngLatToWorld$map4 = slicedToArray(_lngLatToWorld$map3, 2),\n      maxX = _lngLatToWorld$map4[0],\n      maxY = _lngLatToWorld$map4[1];\n\n  minX = Math.floor(minX);\n  maxX = Math.ceil(maxX);\n  minY = Math.floor(minY);\n  maxY = Math.ceil(maxY);\n  var indices = [];\n\n  for (var x = minX; x < maxX; x++) {\n    for (var y = minY; y < maxY; y++) {\n      if (maxZoom && z > maxZoom) {\n        indices.push(getAdjustedTileIndex({\n          x: x,\n          y: y,\n          z: z\n        }, maxZoom));\n      } else {\n        indices.push({\n          x: x,\n          y: y,\n          z: z\n        });\n      }\n    }\n  }\n\n  return indices;\n}\n/* eslint-disable class-methods-use-this */\n\n/**\n * Manages loading and purging of tiles data. This class caches recently visited tiles\n * and only create new tiles if they are present.\n */\n\n\nvar TileCache = function () {\n  /**\n   * Takes in a function that returns tile data, a cache size, and a max and a min zoom level.\n   * Cache size defaults to 5 * number of tiles in the current viewport\n   */\n  function TileCache(_ref) {\n    var getTileData = _ref.getTileData,\n        maxSize = _ref.maxSize,\n        maxZoom = _ref.maxZoom,\n        minZoom = _ref.minZoom,\n        onTileLoad = _ref.onTileLoad,\n        onTileError = _ref.onTileError;\n    classCallCheck(this, TileCache); // TODO: Instead of hardcode size, we should calculate how much memory left\n\n    this._getTileData = getTileData;\n    this._maxSize = maxSize;\n    this.onTileError = onTileError;\n    this.onTileLoad = onTileLoad; // Maps tile id in string {z}-{x}-{y} to a Tile object\n\n    this._cache = new Map();\n    this._tiles = [];\n\n    if (Number.isFinite(maxZoom)) {\n      this._maxZoom = Math.floor(maxZoom);\n    }\n\n    if (Number.isFinite(minZoom)) {\n      this._minZoom = Math.ceil(minZoom);\n    }\n  }\n\n  createClass(TileCache, [{\n    key: 'finalize',\n\n    /**\n     * Clear the current cache\n     */\n    value: function finalize() {\n      this._cache.clear();\n    }\n    /**\n     * Update the cache with the given viewport and triggers callback onUpdate.\n     * @param {*} viewport\n     * @param {*} onUpdate\n     */\n\n  }, {\n    key: 'update',\n    value: function update(viewport) {\n      var _cache = this._cache,\n          _getTileData = this._getTileData,\n          _maxSize = this._maxSize,\n          _maxZoom = this._maxZoom,\n          _minZoom = this._minZoom;\n\n      this._markOldTiles();\n\n      var tileIndices = getTileIndices(viewport, _maxZoom, _minZoom);\n\n      if (!tileIndices || tileIndices.length === 0) {\n        return;\n      }\n\n      _cache.forEach(function (cachedTile) {\n        if (tileIndices.some(function (tile) {\n          return cachedTile.isOverlapped(tile);\n        })) {\n          cachedTile.isVisible = true; // eslint-disable-line\n        }\n      });\n\n      var changed = false;\n\n      for (var i = 0; i < tileIndices.length; i++) {\n        var tileIndex = tileIndices[i];\n        var x = tileIndex.x,\n            y = tileIndex.y,\n            z = tileIndex.z;\n\n        var tile = this._getTile(x, y, z);\n\n        if (!tile) {\n          tile = new Tile({\n            getTileData: _getTileData,\n            x: x,\n            y: y,\n            z: z,\n            onTileLoad: this.onTileLoad,\n            onTileError: this.onTileError\n          });\n          tile.isVisible = true;\n          changed = true;\n        }\n\n        var tileId = this._getTileId(x, y, z);\n\n        _cache.set(tileId, tile);\n      }\n\n      if (changed) {\n        // cache size is either the user defined maxSize or 5 * number of current tiles in the viewport.\n        var commonZoomRange = 5;\n\n        this._resizeCache(_maxSize || commonZoomRange * tileIndices.length);\n\n        this._tiles = Array.from(this._cache.values()) // sort by zoom level so parents tiles don't show up when children tiles are rendered\n        .sort(function (t1, t2) {\n          return t1.z - t2.z;\n        });\n      }\n    }\n    /**\n     * Clear tiles that are not visible when the cache is full\n     */\n\n  }, {\n    key: '_resizeCache',\n    value: function _resizeCache(maxSize) {\n      var _cache = this._cache;\n\n      if (_cache.size > maxSize) {\n        var iterator = _cache[Symbol.iterator](); // eslint-disable-next-line no-restricted-syntax\n\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = iterator[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var cachedTile = _step.value;\n\n            if (_cache.size <= maxSize) {\n              break;\n            }\n\n            var tileId = cachedTile[0];\n            var tile = cachedTile[1];\n\n            if (!tile.isVisible) {\n              _cache.delete(tileId);\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: '_markOldTiles',\n    value: function _markOldTiles() {\n      this._cache.forEach(function (cachedTile) {\n        // eslint-disable-next-line no-param-reassign\n        cachedTile.isVisible = false;\n      });\n    }\n  }, {\n    key: '_getTile',\n    value: function _getTile(x, y, z) {\n      var tileId = this._getTileId(x, y, z);\n\n      return this._cache.get(tileId);\n    }\n  }, {\n    key: '_getTileId',\n    value: function _getTileId(x, y, z) {\n      return z + '-' + x + '-' + y;\n    }\n  }, {\n    key: 'tiles',\n    get: function get$$1() {\n      return this._tiles;\n    }\n  }]);\n  return TileCache;\n}();\n/* eslint-disable no-param-reassign,no-restricted-properties,class-methods-use-this,no-underscore-dangle */\n\n\nvar defaultProps = {\n  renderSubLayers: {\n    type: 'function',\n    value: function value() {\n      return null;\n    }\n  },\n  getTileData: {\n    type: 'function',\n    value: function value() {\n      return Promise.resolve(null);\n    }\n  },\n  // TODO - change to onViewportLoad to align with Tile3DLayer\n  onViewportLoaded: {\n    type: 'function',\n    optional: true,\n    value: null\n  },\n  // eslint-disable-next-line\n  onTileError: {\n    type: 'function',\n    value: function value(err) {\n      return console.error(err);\n    }\n  },\n  maxZoom: null,\n  minZoom: 0,\n  maxCacheSize: null\n};\n\nvar TileLayer = function (_CompositeLayer) {\n  inherits(TileLayer, _CompositeLayer);\n\n  function TileLayer() {\n    classCallCheck(this, TileLayer);\n    return possibleConstructorReturn(this, (TileLayer.__proto__ || Object.getPrototypeOf(TileLayer)).apply(this, arguments));\n  }\n\n  createClass(TileLayer, [{\n    key: 'initializeState',\n    value: function initializeState() {\n      this.state = {\n        tiles: [],\n        isLoaded: false\n      };\n    }\n  }, {\n    key: 'shouldUpdateState',\n    value: function shouldUpdateState(_ref) {\n      var changeFlags = _ref.changeFlags;\n      return changeFlags.somethingChanged;\n    }\n  }, {\n    key: 'updateState',\n    value: function updateState(_ref2) {\n      var props = _ref2.props,\n          context = _ref2.context,\n          changeFlags = _ref2.changeFlags;\n      var tileCache = this.state.tileCache;\n\n      if (!tileCache || changeFlags.updateTriggersChanged && (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getTileData)) {\n        var getTileData = props.getTileData,\n            maxZoom = props.maxZoom,\n            minZoom = props.minZoom,\n            maxCacheSize = props.maxCacheSize;\n\n        if (tileCache) {\n          tileCache.finalize();\n        }\n\n        tileCache = new TileCache({\n          getTileData: getTileData,\n          maxSize: maxCacheSize,\n          maxZoom: maxZoom,\n          minZoom: minZoom,\n          onTileLoad: this._onTileLoad.bind(this),\n          onTileError: this._onTileError.bind(this)\n        });\n        this.setState({\n          tileCache: tileCache\n        });\n      } else if (changeFlags.updateTriggersChanged) {\n        // if any updateTriggersChanged (other than getTileData), delete the layer\n        this.state.tileCache.tiles.forEach(function (tile) {\n          tile.layer = null;\n        });\n      }\n\n      var viewport = context.viewport;\n\n      if (changeFlags.viewportChanged && viewport.id !== 'DEFAULT-INITIAL-VIEWPORT') {\n        var z = this.getLayerZoomLevel();\n        tileCache.update(viewport); // The tiles that should be displayed at this zoom level\n\n        var currTiles = tileCache.tiles.filter(function (tile) {\n          return tile.z === z;\n        });\n        this.setState({\n          isLoaded: false,\n          tiles: currTiles\n        });\n\n        this._onTileLoad();\n      }\n    }\n  }, {\n    key: '_onTileLoad',\n    value: function _onTileLoad() {\n      var onViewportLoaded = this.props.onViewportLoaded;\n      var currTiles = this.state.tiles;\n      var allCurrTilesLoaded = currTiles.every(function (tile) {\n        return tile.isLoaded;\n      });\n\n      if (this.state.isLoaded !== allCurrTilesLoaded) {\n        this.setState({\n          isLoaded: allCurrTilesLoaded\n        });\n\n        if (allCurrTilesLoaded && onViewportLoaded) {\n          onViewportLoaded(currTiles.filter(function (tile) {\n            return tile._data;\n          }).map(function (tile) {\n            return tile._data;\n          }));\n        }\n      }\n    }\n  }, {\n    key: '_onTileError',\n    value: function _onTileError(error) {\n      this.props.onTileError(error); // errorred tiles should not block rendering, are considered \"loaded\" with empty data\n\n      this._onTileLoad();\n    }\n  }, {\n    key: 'getPickingInfo',\n    value: function getPickingInfo(_ref3) {\n      var info = _ref3.info,\n          sourceLayer = _ref3.sourceLayer;\n      info.sourceLayer = sourceLayer;\n      info.tile = sourceLayer.props.tile;\n      return info;\n    }\n  }, {\n    key: 'getLayerZoomLevel',\n    value: function getLayerZoomLevel() {\n      var z = Math.floor(this.context.viewport.zoom) + 1;\n      var _props = this.props,\n          maxZoom = _props.maxZoom,\n          minZoom = _props.minZoom;\n\n      if (Number.isFinite(maxZoom) && z > maxZoom) {\n        return Math.floor(maxZoom);\n      }\n\n      if (Number.isFinite(minZoom) && z < minZoom) {\n        return Math.ceil(minZoom);\n      }\n\n      return z;\n    }\n  }, {\n    key: 'renderLayers',\n    value: function renderLayers() {\n      var _this2 = this;\n\n      var _props2 = this.props,\n          visible = _props2.visible,\n          opacity = _props2.opacity,\n          decodeParams = _props2.decodeParams,\n          renderSubLayers = _props2.renderSubLayers;\n      var z = this.getLayerZoomLevel();\n      return this.state.tiles.map(function (tile) {\n        // For a tile to be visible:\n        // - parent layer must be visible\n        // - tile must be visible in the current viewport\n        // - if all tiles are loaded, only display the tiles from the current z level\n        var isVisible = visible && tile.isVisible && (!_this2.state.isLoaded || tile.z === z); // cache the rendered layer in the tile\n\n        if (!tile.layer) {\n          // I have an error when I try this condition. I think is related to return the same tile.layer\n          // https://github.com/uber/deck.gl/blob/c616dbfbcbdc9d8533b88ba8a142c5527764bbd8/modules/core/src/lib/layer-manager.js#L67-L70\n          tile.layer = renderSubLayers(_extends({}, _this2.props, {\n            id: _this2.id + '-' + tile.x + '-' + tile.y + '-' + tile.z,\n            data: tile.data,\n            visible: isVisible,\n            opacity: opacity,\n            tile: tile,\n            zoom: z\n          }));\n        } else if (tile.layer.props.visible !== isVisible) {\n          tile.layer = tile.layer.clone({\n            visible: isVisible\n          });\n        } else if (tile.layer.props.opacity !== opacity) {\n          tile.layer = tile.layer.clone({\n            opacity: opacity\n          });\n        } else if (tile.layer.props.decodeParams) {\n          tile.layer = tile.layer.clone({\n            decodeParams: decodeParams\n          });\n        }\n\n        return tile.layer;\n      });\n    }\n  }]);\n  return TileLayer;\n}(CompositeLayer);\n\nTileLayer.layerName = 'TileLayer';\nTileLayer.defaultProps = defaultProps;\nvar decodeVX = \"\\n#define SHADER_NAME bitmap-layer-vertex-shader\\n\\nattribute vec2 texCoords;\\nattribute vec3 positions;\\nattribute vec2 positions64xyLow;\\n\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\\n\\n  vTexCoord = texCoords;\\n\\n  picking_setPickingColor(vec3(0., 0., 1.));\\n}\\n\";\nvar decodeFR = \"\\n#define SHADER_NAME bitmap-layer-fragment-shader\\n\\n#ifdef GL_ES\\nprecision highp float;\\n#endif\\n\\nuniform sampler2D bitmapTexture;\\n\\nvarying vec2 vTexCoord;\\n\\n{decodeParams}\\n\\nuniform float opacity;\\nuniform float zoom;\\n\\n\\nvec4 decodeFunction(vec3 color, float alpha) {\\n  {decodeFunction}\\n  return vec4(color, alpha * opacity);\\n}\\n\\nvoid main(void) {\\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\\n\\n  // clear mask\\n  if (bitmapColor == vec4(0., 0., 0., 1.)) {\\n    discard;\\n  }\\n\\n  // custom decode\\n  gl_FragColor = decodeFunction(bitmapColor.rgb, bitmapColor.a);\\n\\n  // use highlight color if this fragment belongs to the selected object.\\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\\n\\n  // use picking color if rendering to picking FBO.\\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\\n}\\n\";\n\nvar _DEFAULT_TEXTURE_PARA;\n\nvar fp64LowPart = fp64.fp64LowPart;\nvar DEFAULT_TEXTURE_PARAMETERS = (_DEFAULT_TEXTURE_PARA = {}, defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_MIN_FILTER, GL.NEAREST), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_MAG_FILTER, GL.NEAREST), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_WRAP_S, GL.CLAMP_TO_EDGE), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_WRAP_T, GL.CLAMP_TO_EDGE), _DEFAULT_TEXTURE_PARA);\nvar defaultProps$1 = {\n  image: null,\n  bounds: {\n    type: 'array',\n    value: [1, 0, 0, 1],\n    compare: true\n  },\n  fp64: false,\n  desaturate: {\n    type: 'number',\n    min: 0,\n    max: 1,\n    value: 0\n  },\n  // More context: because of the blending mode we're using for ground imagery,\n  // alpha is not effective when blending the bitmap layers with the base map.\n  // Instead we need to manually dim/blend rgb values with a background color.\n  transparentColor: {\n    type: 'color',\n    value: [0, 0, 0, 0]\n  },\n  tintColor: {\n    type: 'color',\n    value: [255, 255, 255]\n  }\n};\n/*\n * @class\n * @param {object} props\n * @param {number} props.transparentColor - color to interpret transparency to\n * @param {number} props.tintColor - color bias\n */\n\nvar DecodeLayer = function (_Layer) {\n  inherits(DecodeLayer, _Layer);\n\n  function DecodeLayer() {\n    classCallCheck(this, DecodeLayer);\n    return possibleConstructorReturn(this, (DecodeLayer.__proto__ || Object.getPrototypeOf(DecodeLayer)).apply(this, arguments));\n  }\n\n  createClass(DecodeLayer, [{\n    key: 'getShaders',\n    value: function getShaders() {\n      var projectModule = 'project32';\n      var fs = decodeFR.replace('{decodeParams}', Object.keys(this.props.decodeParams).map(function (p) {\n        return 'uniform float ' + p + ';';\n      }).join(' ')).replace('{decodeFunction}', this.props.decodeFunction || '');\n      return {\n        vs: decodeVX,\n        fs: fs,\n        modules: [projectModule, 'picking']\n      };\n    }\n  }, {\n    key: 'initializeState',\n    value: function initializeState() {\n      var attributeManager = this.getAttributeManager();\n      attributeManager.add({\n        positions: {\n          size: 3,\n          update: this.calculatePositions,\n          value: new Float32Array(12)\n        },\n        positions64xyLow: {\n          size: 3,\n          update: this.calculatePositions64xyLow,\n          value: new Float32Array(12)\n        }\n      });\n      this.setState({\n        numInstances: 4\n      }); // 4 corners\n    }\n  }, {\n    key: 'updateState',\n    value: function updateState(_ref) {\n      var props = _ref.props,\n          oldProps = _ref.oldProps; // setup model first\n\n      if (props.fp64 !== oldProps.fp64) {\n        var gl = this.context.gl;\n\n        if (this.state.model) {\n          this.state.model.delete();\n        }\n\n        this.setState({\n          model: this._getModel(gl)\n        });\n        this.getAttributeManager().invalidateAll();\n      }\n\n      if (props.image !== oldProps.image) {\n        this.loadTexture(props.image);\n      }\n\n      var attributeManager = this.getAttributeManager();\n\n      if (props.bounds !== oldProps.bounds) {\n        this.setState({\n          positions: this._getPositionsFromBounds(props.bounds)\n        });\n        attributeManager.invalidate('positions');\n        attributeManager.invalidate('positions64xyLow');\n      }\n    }\n  }, {\n    key: 'finalizeState',\n    value: function finalizeState() {\n      get(DecodeLayer.prototype.__proto__ || Object.getPrototypeOf(DecodeLayer.prototype), 'finalizeState', this).call(this);\n\n      if (this.state.bitmapTexture) {\n        this.state.bitmapTexture.delete();\n      }\n    }\n  }, {\n    key: '_getPositionsFromBounds',\n    value: function _getPositionsFromBounds(bounds) {\n      var positions = new Array(12); // bounds as [minX, minY, maxX, maxY]\n\n      if (Number.isFinite(bounds[0])) {\n        /*\n          (minX0, maxY3) ---- (maxX2, maxY3)\n                 |                  |\n                 |                  |\n                 |                  |\n          (minX0, minY1) ---- (maxX2, minY1)\n        */\n        positions[0] = bounds[0];\n        positions[1] = bounds[1];\n        positions[2] = 0;\n        positions[3] = bounds[0];\n        positions[4] = bounds[3];\n        positions[5] = 0;\n        positions[6] = bounds[2];\n        positions[7] = bounds[3];\n        positions[8] = 0;\n        positions[9] = bounds[2];\n        positions[10] = bounds[1];\n        positions[11] = 0;\n      } else {\n        // [[minX, minY], [minX, maxY], [maxX, maxY], [maxX, minY]]\n        for (var i = 0; i < bounds.length; i++) {\n          positions[i * 3 + 0] = bounds[i][0];\n          positions[i * 3 + 1] = bounds[i][1];\n          positions[i * 3 + 2] = bounds[i][2] || 0;\n        }\n      }\n\n      return positions;\n    }\n  }, {\n    key: '_getModel',\n    value: function _getModel(gl) {\n      if (!gl) {\n        return null;\n      }\n      /*\n        0,1 --- 1,1\n         |       |\n        0,0 --- 1,0\n      */\n\n\n      return new Model(gl, Object.assign({}, this.getShaders(), {\n        id: this.props.id,\n        shaderCache: this.context.shaderCache,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLE_FAN,\n          vertexCount: 4,\n          attributes: {\n            texCoords: new Float32Array([0, 0, 0, 1, 1, 1, 1, 0])\n          }\n        }),\n        isInstanced: false\n      }));\n    }\n  }, {\n    key: 'draw',\n    value: function draw(_ref2) {\n      var uniforms = _ref2.uniforms;\n      var _state = this.state,\n          bitmapTexture = _state.bitmapTexture,\n          model = _state.model;\n      var _props = this.props,\n          desaturate = _props.desaturate,\n          transparentColor = _props.transparentColor,\n          tintColor = _props.tintColor,\n          zoom = _props.zoom,\n          decodeParams = _props.decodeParams,\n          opacity = _props.opacity; // // TODO fix zFighting\n      // Render the image\n\n      if (bitmapTexture && model) {\n        model.setUniforms(Object.assign({}, uniforms, _extends({\n          bitmapTexture: bitmapTexture,\n          desaturate: desaturate,\n          transparentColor: transparentColor,\n          tintColor: tintColor,\n          zoom: zoom\n        }, decodeParams, {\n          opacity: opacity\n        }))).draw();\n      }\n    }\n  }, {\n    key: 'loadTexture',\n    value: function loadTexture(image) {\n      var _this2 = this;\n\n      if (typeof image === 'string') {\n        image = loadImage(image);\n      }\n\n      if (image instanceof Promise) {\n        image.then(function (data) {\n          return _this2.loadTexture(data);\n        });\n        return;\n      }\n\n      var gl = this.context.gl;\n\n      if (this.state.bitmapTexture) {\n        this.state.bitmapTexture.delete();\n      }\n\n      if (image instanceof Texture2D) {\n        this.setState({\n          bitmapTexture: image\n        });\n      } else if ( // browser object\n      image instanceof Image || image instanceof HTMLCanvasElement) {\n        this.setState({\n          bitmapTexture: new Texture2D(gl, {\n            data: image,\n            parameters: DEFAULT_TEXTURE_PARAMETERS,\n            mipmaps: false\n          })\n        });\n      }\n    }\n  }, {\n    key: 'calculatePositions',\n    value: function calculatePositions(_ref3) {\n      var value = _ref3.value;\n      var positions = this.state.positions;\n      value.set(positions);\n    }\n  }, {\n    key: 'calculatePositions64xyLow',\n    value: function calculatePositions64xyLow(attribute) {\n      var isFP64 = this.use64bitPositions();\n      attribute.constant = !isFP64;\n\n      if (!isFP64) {\n        attribute.value = new Float32Array(4);\n        return;\n      }\n\n      var value = attribute.value;\n      value.set(this.state.positions.map(fp64LowPart));\n    }\n  }]);\n  return DecodeLayer;\n}(Layer);\n\nDecodeLayer.layerName = 'DecodeLayer';\nDecodeLayer.defaultProps = defaultProps$1;\nvar _this = undefined;\n\nvar _getTileData = function _getTileData(_ref, url) {\n  var x = _ref.x,\n      y = _ref.y,\n      z = _ref.z;\n  var mapSource = url.replace('{z}', z).replace('{x}', x).replace('{y}', y);\n  return fetch(mapSource).then(function (response) {\n    return response.blob();\n  }).then(function (response) {\n    var _ref2 = response || {},\n        type = _ref2.type;\n\n    if (type !== 'application/xml' && type !== 'text/xml' && type !== 'text/html') {\n      var src = URL.createObjectURL(response);\n      var image = new Image();\n      image.src = src;\n      return image;\n    }\n\n    return false;\n  });\n};\n\nvar RasterLayer = function RasterLayer(layerModel, providers) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      decodeParams = layerModel.decodeParams,\n      id = layerModel.id,\n      opacity = layerModel.opacity,\n      decodeFunction = layerModel.decodeFunction;\n  var DEFAULT_RASTER_OPTIONS = {\n    id: id + '-raster',\n    type: 'raster',\n    source: id\n  };\n  var provider = source.provider;\n  var _render$layers = render.layers,\n      layers = _render$layers === undefined ? [DEFAULT_RASTER_OPTIONS] : _render$layers;\n  var layer = {}; // if decoded layer use custom deck layer\n\n  if (decodeFunction) {\n    layer = {\n      id: id,\n      type: 'custom',\n      layers: [{\n        id: id + '-raster-decode-bg',\n        type: 'background',\n        paint: {\n          'background-color': 'transparent'\n        }\n      }].concat(toConsumableArray(source.tiles.map(function (t) {\n        return new MapboxLayer({\n          id: id + '-raster-decode',\n          type: TileLayer,\n          getTileData: function getTileData(e) {\n            return _getTileData(e, t);\n          },\n          renderSubLayers: function renderSubLayers(_ref3) {\n            var subLayerId = _ref3.id,\n                data = _ref3.data,\n                tile = _ref3.tile,\n                visible = _ref3.visible,\n                zoom = _ref3.zoom,\n                decodeParamsSub = _ref3.decodeParams,\n                decodeFunctionSub = _ref3.decodeFunction;\n\n            if (data && data.src) {\n              return new DecodeLayer({\n                id: subLayerId,\n                image: data.src,\n                bounds: tile.bbox,\n                visible: visible,\n                zoom: zoom,\n                decodeParams: decodeParamsSub,\n                decodeFunction: decodeFunctionSub,\n                opacity: opacity\n              });\n            }\n\n            return null;\n          },\n          minZoom: source.minzoom,\n          maxZoom: source.maxzoom,\n          opacity: layerModel.opacity,\n          decodeParams: decodeParams,\n          decodeFunction: decodeFunction\n        });\n      })))\n    };\n  } else {\n    layer = {\n      id: id,\n      type: 'raster',\n      source: _extends({\n        type: 'raster',\n        tileSize: 256\n      }, source),\n      layers: getVectorStyleLayers(layers.map(function (l) {\n        return _extends({}, DEFAULT_RASTER_OPTIONS, l);\n      }), layerModel)\n    };\n  }\n\n  if (provider) {\n    var method = providers[provider.type];\n    return new CancelablePromise(function (resolve, reject) {\n      if (!method) {\n        reject(new Error(provider.type + ' provider is not supported. Try to add it to the providers method when you initialize layer-manager'));\n      }\n\n      method.call(_this, layerModel, layer, resolve, reject);\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n\nvar _this$1 = undefined;\n\nvar VectorLayer = function VectorLayer(layerModel, providers) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      id = layerModel.id;\n  var provider = source.provider;\n  var layers = render.layers;\n\n  var layer = _extends({\n    id: id,\n    source: _extends({\n      type: 'vector'\n    }, source)\n  }, render, {\n    layers: getVectorStyleLayers(layers, layerModel)\n  });\n\n  if (provider) {\n    var method = providers[provider.type];\n    return new CancelablePromise(function (resolve, reject) {\n      if (!method) {\n        reject(new Error(provider.type + ' provider is not supported. Try to add it to the providers method when you initialize layer-manager'));\n      }\n\n      method.call(_this$1, layerModel, layer, resolve, reject);\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n\nvar _this$2 = undefined;\n\nvar GeoJsonLayer = function GeoJsonLayer(layerModel, providers) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      id = layerModel.id;\n  var provider = source.provider;\n  var layers = render.layers;\n\n  var layer = _extends({\n    id: id,\n    source: _extends({\n      type: 'geojson'\n    }, source)\n  }, render, {\n    layers: getVectorStyleLayers(layers, layerModel)\n  });\n\n  if (provider) {\n    var method = providers[provider.type];\n    return new CancelablePromise(function (resolve, reject) {\n      if (!method) {\n        reject(new Error(provider.type + ' provider is not supported. Try to add it to the providers method when you initialize layer-manager'));\n      }\n\n      method.call(_this$2, layerModel, layer, resolve, reject);\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('\"type\" specified in layer spec doesn`t exist'));\n    }\n  });\n};\n\nvar VideoLayer = function VideoLayer(layerModel) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      render = layerModel.render,\n      id = layerModel.id;\n\n  var layer = _extends({\n    id: id,\n    type: 'raster',\n    source: _extends({}, source, {\n      type: 'video-tiled',\n      // tiles: [ \"https://storage.googleapis.com/skydipper_materials/movie-tiles/MODIS/{z}/{x}/{y}.mp4\" ],\n      tiles: ['https://storage.googleapis.com/skydipper_materials/movie-tiles/EVI_TEST/{z}/{x}/{y}.mp4'],\n      scheme: 'xyz',\n      tileSize: 256,\n      minzoom: 1,\n      maxzoom: 4,\n      playbackRate: 0.1 // geometryFilter: 'https://storage.googleapis.com/deltares-video-map/mapbox-test/test1/geometry-filter.geojson'\n\n    })\n  }, render, {\n    layers: [{\n      id: id + '-raster',\n      type: 'raster',\n      source: id\n    }]\n  });\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n/* eslint-disable no-underscore-dangle */\n\n\nvar PluginMapboxGL = function () {\n  function PluginMapboxGL(map, options) {\n    var _this = this;\n\n    classCallCheck(this, PluginMapboxGL);\n    this.type = {\n      raster: RasterLayer,\n      vector: VectorLayer,\n      geojson: GeoJsonLayer,\n      video: VideoLayer\n    };\n    this.map = map;\n    this.options = options; // You can change mapStyles and all the layers will be repositioned\n\n    this.map.on('style.load', function () {\n      var layers = _this.getLayers();\n\n      layers.forEach(function (layer) {\n        return _this.add(layer);\n      });\n    });\n  }\n\n  createClass(PluginMapboxGL, [{\n    key: 'add',\n\n    /**\n     * Add a layer\n     * @param {Object} layerModel\n     */\n    value: function add(layerModel) {\n      var _this2 = this;\n\n      var images = layerModel.images,\n          mapLayer = layerModel.mapLayer;\n      var allLayers = this.getLayers();\n\n      if (Array.isArray(images)) {\n        images.forEach(function (_ref) {\n          var id = _ref.id,\n              src = _ref.src,\n              options = _ref.options;\n\n          if (!_this2.map.hasImage(id)) {\n            var img = new Image();\n            img.src = src;\n\n            img.onload = function () {\n              _this2.map.addImage(id, img, options);\n            };\n          }\n        });\n      } // add source if it has one\n\n\n      if (this.map && mapLayer && mapLayer.source && mapLayer.id && !this.map.getSource(mapLayer.id)) {\n        this.map.addSource(mapLayer.id, mapLayer.source);\n      } // add layers\n\n\n      if (mapLayer && mapLayer.layers) {\n        mapLayer.layers.forEach(function (l) {\n          var _l$metadata = l.metadata,\n              metadata = _l$metadata === undefined ? {} : _l$metadata;\n          var nextLayerId = metadata.position === 'top' ? null : _this2.getNextLayerId(layerModel);\n\n          if (_this2.map && !_this2.map.getLayer(l.id)) {\n            _this2.map.addLayer(l, nextLayerId);\n          }\n\n          allLayers.forEach(function () {\n            _this2.setZIndex();\n          });\n        });\n      }\n    }\n    /**\n     * Remove a layer\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'remove',\n    value: function remove() {\n      var _this3 = this;\n\n      var layerModel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var mapLayer = layerModel.mapLayer;\n\n      if (mapLayer && mapLayer.layers && this.map && this.map.style) {\n        mapLayer.layers.forEach(function (l) {\n          if (_this3.map.getLayer(l.id)) {\n            _this3.map.removeLayer(l.id);\n          }\n        });\n      }\n\n      if (mapLayer && !!this.map && this.map.getSource(mapLayer.id)) {\n        this.map.removeSource(mapLayer.id);\n      }\n    }\n    /**\n     * Get method by type\n     * @param {String} type\n     */\n\n  }, {\n    key: 'getLayerByType',\n    value: function getLayerByType(type) {\n      return this.type[type];\n    }\n    /**\n     * Get all mapbox layers\n     */\n\n  }, {\n    key: 'getLayersOnMap',\n    value: function getLayersOnMap() {\n      return this.map.getStyle().layers;\n    }\n  }, {\n    key: 'getLayer',\n    value: function getLayer(layerModel) {\n      var mapLayer = layerModel.mapLayer;\n\n      if (this.map) {\n        return this.map.getSource(mapLayer.id);\n      }\n\n      return null;\n    }\n    /**\n     * Get all layers passed to layer manager\n     */\n\n  }, {\n    key: 'getLayers',\n    value: function getLayers() {\n      var getLayers = this.options.getLayers;\n      var layers = getLayers();\n      return sortBy(layers, function (l) {\n        return l.decodeFunction;\n      });\n    }\n    /**\n     * Get the layer above the given z-index\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'getNextLayerId',\n    value: function getNextLayerId(layerModel) {\n      var zIndex = layerModel.zIndex;\n      var allLayers = this.getLayers();\n      var layersOnMap = this.getLayersOnMap(); // find the top layer for placing data layers below\n\n      var customLayer = layersOnMap && layersOnMap.length && layersOnMap.find(function (l) {\n        return l.id.includes('custom-layers') || l.id.includes('label') || l.id.includes('place') || l.id.includes('poi');\n      }); // make sure layers are sorted by zIndex\n\n      var sortedLayers = sortBy(allLayers, function (l) {\n        return l.zIndex;\n      }); // get the layer with zIndex greater than current layer from all layers\n\n      var nextLayer = sortedLayers.find(function (l) {\n        return l.zIndex > zIndex && (!l.mapLayer || !l.mapLayer.layers || !l.mapLayer.layers[0] || !l.mapLayer.layers[0].metadata || !l.mapLayer.layers[0].metadata.position);\n      }); // if no layer above it then use the custom layer\n\n      if (!nextLayer || !!nextLayer && !nextLayer.mapLayer) {\n        return customLayer.id;\n      } // get the first layer of the next layer's array\n\n\n      var nextLayerMapLayers = nextLayer.mapLayer.layers;\n      var nextLayerMapLayer = nextLayerMapLayers[0]; // Filter layers with custom metadata position\n\n      var id = nextLayerMapLayer.id; // if it has a layer above it, check if that layer has been added to the map and get its id\n\n      var isNextLayerOnMap = !!layersOnMap.find(function (l) {\n        return id === l.id;\n      }); // if next layer is on map return the id, else return the custom layer to add below\n\n      return isNextLayerOnMap ? id : customLayer.id;\n    }\n    /**\n     * A namespace to set z-index\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'setZIndex',\n    value: function setZIndex() {\n      var _this4 = this;\n\n      var allLayers = this.getLayers();\n      var layersOnMap = this.getLayersOnMap(); // set zIndex for all layers currently on map\n\n      layersOnMap.forEach(function (l) {\n        var id = l.id,\n            _l$metadata2 = l.metadata,\n            metadata = _l$metadata2 === undefined ? {} : _l$metadata2;\n        var layerModel = allLayers.find(function (ly) {\n          return id.includes(ly.id);\n        });\n\n        if (layerModel) {\n          var nextLayerId = metadata.position === 'top' ? null : _this4.getNextLayerId(layerModel);\n\n          _this4.map.moveLayer(id, nextLayerId);\n        }\n      }); // set for all decode layers that don't exist inside mapStyle()\n\n      var decodeLayers = allLayers.filter(function (l) {\n        return !!l.decodeFunction;\n      });\n\n      if (decodeLayers && this.map) {\n        decodeLayers.forEach(function (layerModel) {\n          var mapLayer = layerModel.mapLayer;\n\n          if (mapLayer) {\n            var layers = mapLayer.layers;\n            var parentLayer = layers[0];\n            var childLayer = layers[1];\n            var parentLayerOnMap = layersOnMap.find(function (ly) {\n              return ly.id === parentLayer.id;\n            });\n\n            var childLayerOnMap = _this4.map.getLayer(childLayer.id);\n\n            if (parentLayerOnMap && childLayerOnMap) {\n              _this4.map.moveLayer(childLayer.id, parentLayer.id);\n            }\n          }\n        });\n      }\n\n      return true;\n    }\n    /**\n     * Given a desired value to give to a paint property of a layer, this function will return the\n     * correct value to set, by taking into account other factors such as the opacity of the layer\n     * @param {object} layerModel LayerModel instance\n     * @param {string} layerId ID of the layer that contains the property\n     * @param {string} propertyName Name of the property to set\n     * @param {any} desiredValue Value to give the property\n     */\n    // eslint-disable-next-line class-methods-use-this\n\n  }, {\n    key: 'computePaintPropertyValue',\n    value: function computePaintPropertyValue(layerModel, layerId, propertyName, desiredValue) {\n      var opacity = layerModel.opacity,\n          _layerModel$render$la = layerModel.render.layers,\n          layers = _layerModel$render$la === undefined ? [] : _layerModel$render$la,\n          mapLayer = layerModel.mapLayer;\n      var isOpacityProperty = /-opacity$/.test(propertyName); // The opacity of the layer isn't relevant for this property\n\n      if (!isOpacityProperty) {\n        return desiredValue;\n      }\n\n      var _ref2 = layers.find(function (layer, index) {\n        if (layer.id === undefined || layer.id === null) {\n          return mapLayer.id + '-' + layer.type + '-' + index === layerId;\n        }\n\n        return layer.id === layerId;\n      }) || {},\n          _ref2$paint = _ref2.paint,\n          paint = _ref2$paint === undefined ? {} : _ref2$paint;\n\n      var currentValue = paint[propertyName];\n      var res = 0.99 * opacity;\n\n      if (currentValue !== undefined && currentValue !== null) {\n        if (typeof currentValue === 'number') {\n          res = currentValue * opacity * 0.99;\n        } else if (Array.isArray(currentValue)) {\n          res = currentValue.map(function (element) {\n            return typeof element === 'number' ? element * opacity * 0.99 : element;\n          });\n        }\n      }\n\n      return res;\n    }\n    /**\n     * A namespace to set opacity\n     * @param {Object} layerModel\n     * @param {Number} opacity\n     */\n\n  }, {\n    key: 'setOpacity',\n    value: function setOpacity(layerModel, opacity) {\n      var _this5 = this;\n\n      var PAINT_STYLE_NAMES = {\n        symbol: ['icon', 'text'],\n        circle: ['circle', 'circle-stroke']\n      };\n      var mapLayer = layerModel.mapLayer,\n          decodeFunction = layerModel.decodeFunction;\n\n      if (mapLayer.layers && !decodeFunction) {\n        mapLayer.layers.forEach(function (l) {\n          // Select the style to change depending on the type of layer\n          var paintStyleNames = PAINT_STYLE_NAMES[l.type] || [l.type]; // Loop each style name and check if there is an opacity in the original layer\n\n          paintStyleNames.forEach(function (name) {\n            var propertyName = name + '-opacity';\n\n            var propertyValue = _this5.computePaintPropertyValue(layerModel, l.id, propertyName, opacity);\n\n            _this5.map.setPaintProperty(l.id, propertyName, propertyValue);\n          });\n        });\n      }\n\n      if (decodeFunction) {\n        var layer = mapLayer.layers[1];\n\n        if (layer && typeof layer.setProps === 'function') {\n          layer.setProps({\n            opacity: opacity\n          });\n        }\n      }\n    }\n    /**\n     * A namespace to hide or show a selected layer\n     * @param {Object} layerModel\n     * @param {Boolean} visibility\n     */\n\n  }, {\n    key: 'setVisibility',\n    value: function setVisibility(layerModel, visibility) {\n      var _this6 = this;\n\n      var mapLayer = layerModel.mapLayer;\n\n      if (mapLayer && mapLayer.layers && this.map && this.map.style) {\n        mapLayer.layers.forEach(function (l) {\n          _this6.map.setLayoutProperty(l.id, 'visibility', visibility ? 'visible' : 'none');\n        });\n      }\n    }\n  }, {\n    key: 'setSource',\n    value: function setSource(layerModel) {\n      var id = layerModel.id,\n          source = layerModel.source;\n      var type = source.type,\n          data = source.data;\n\n      if (this.map && type === 'geojson' && !!data && typeof data !== 'string') {\n        var src = this.map.getSource(id);\n        src.setData(data);\n      }\n\n      return this;\n    }\n  }, {\n    key: 'setRender',\n    value: function setRender(layerModel) {\n      var _this7 = this;\n\n      var mapLayer = layerModel.mapLayer,\n          render = layerModel.render;\n      var _render$layers = render.layers,\n          renderLayers = _render$layers === undefined ? [] : _render$layers;\n\n      if (!mapLayer || !renderLayers.length) {\n        return this;\n      }\n\n      try {\n        mapLayer.layers.forEach(function (layer, i) {\n          var id = layer.id;\n          var rl = renderLayers[i] || renderLayers[0] || {}; // take the style for each layer or use the first one for all of them\n\n          var _rl$paint = rl.paint,\n              paint = _rl$paint === undefined ? {} : _rl$paint,\n              _rl$layout = rl.layout,\n              layout = _rl$layout === undefined ? {} : _rl$layout,\n              _rl$filter = rl.filter,\n              filter = _rl$filter === undefined ? null : _rl$filter;\n\n          _this7.map.setFilter(id, filter);\n\n          Object.keys(paint).forEach(function (p) {\n            _this7.map.setPaintProperty(id, p, _this7.computePaintPropertyValue(layerModel, id, p, paint[p]));\n          });\n          Object.keys(layout).forEach(function (l) {\n            _this7.map.setLayoutProperty(id, l, layout[l]);\n          });\n        });\n      } catch (error) {\n        console.error(error);\n      } // NOT COMPATIBLE WITH REACT MAP GL\n      // if (true) {\n      //   document.querySelector('.overlays').style = 'pointer-events: none;'\n      //   mapLayer.layers.forEach((layer) => {\n      //     const { id, source, 'source-layer': sourceLayer } = layer;\n      //     // When the user moves their mouse over the state-fill layer, we'll update the\n      //     // feature state for the feature under the mouse.\n      //     this.map.off('mousemove', id);\n      //     this.map.on('mousemove', id, (e) => {\n      //       const { hoverId } = layerModel;\n      //       if (e.features.length > 0) {\n      //         layerModel.set('hoverId', e.features[0].id);\n      //         if (hoverId) {\n      //           this.map.setFeatureState({\n      //             source,\n      //             ...sourceLayer && { sourceLayer },\n      //             id: hoverId\n      //           }, { hover: false });\n      //         }\n      //         this.map.setFeatureState({\n      //           source,\n      //           ...sourceLayer && { sourceLayer },\n      //           id: e.features[0].id\n      //         }, { hover: true });\n      //       }\n      //     });\n      //     // When the mouse leaves the state-fill layer, update the feature state of the\n      //     // previously hovered feature.\n      //     this.map.off('mouseleave', id);\n      //     this.map.on('mouseleave', id, () => {\n      //       const { hoverId } = layerModel;\n      //       if (hoverId) {\n      //         this.map.setFeatureState({\n      //           source,\n      //           ...layer['source-layer'] && { 'sourceLayer': layer['source-layer'] },\n      //           id: hoverId\n      //         }, { hover: false });\n      //       }\n      //       layerModel.set('hoverId', null);\n      //     });\n      //   })\n      // }\n\n\n      return this;\n    }\n  }, {\n    key: 'setParams',\n    value: function setParams() {\n      return this;\n    }\n  }, {\n    key: 'setSQLParams',\n    value: function setSQLParams() {\n      return this;\n    }\n  }, {\n    key: 'setDecodeParams',\n    value: function setDecodeParams(layerModel) {\n      var mapLayer = layerModel.mapLayer,\n          decodeParams = layerModel.decodeParams;\n\n      if (!mapLayer) {\n        return this;\n      }\n\n      var layer = mapLayer.layers[1];\n\n      if (layer && typeof layer.setProps === 'function') {\n        layer.setProps({\n          decodeParams: decodeParams\n        });\n      } else {\n        console.error(\"Layer is not present. You defined decodeParams but maybe you didn't define a decodeFunction\");\n      }\n\n      return this;\n    }\n  }, {\n    key: 'unmount',\n    value: function unmount() {\n      this.map = null;\n    }\n  }]);\n  return PluginMapboxGL;\n}();\n\nexport default LayerManager;\nexport { PluginMapboxGL as PluginMapboxGl, replace, substitution, concatenation, fetch$1 as fetch };","import MARKER1 from 'images/marker1.svg';\nimport MARKER2 from 'images/marker2.svg';\n\nexport default [\n  // RASTER LAYER\n  {\n    id: 'gain',\n    name: 'Tree cover gain',\n    config: {\n      type: 'raster',\n      source: {\n        type: 'raster',\n        tiles: ['https://earthengine.google.org/static/hansen_2013/gain_alpha/{z}/{x}/{y}.png'],\n        minzoom: 3,\n        maxzoom: 12\n      }\n    },\n    legendConfig: {\n      type: 'basic',\n      items: [{ name: 'Tree cover gain', color: '#6D6DE5' }]\n    }\n  },\n\n  // DECODED RASTER LAYER\n  {\n    id: 'loss',\n    name: 'Tree cover loss',\n    config: {\n      type: 'raster',\n      source: {\n        type: 'raster',\n        tiles: [\n          'https://storage.googleapis.com/wri-public/Hansen_16/tiles/hansen_world/v1/tc30/{z}/{x}/{y}.png'\n        ],\n        minzoom: 3,\n        maxzoom: 12\n      }\n    },\n    legendConfig: {\n      enabled: true\n    },\n    decodeConfig: [\n      {\n        default: '2001-01-01',\n        key: 'startDate',\n        required: true\n      },\n      {\n        default: '2018-12-31',\n        key: 'endDate',\n        required: true\n      }\n    ],\n    timelineConfig: {\n      step: 1,\n      speed: 250,\n      interval: 'years',\n      dateFormat: 'YYYY',\n      trimEndDate: '2018-12-31',\n      maxDate: '2018-12-31',\n      minDate: '2001-01-01',\n      canPlay: true,\n      railStyle: {\n        background: '#DDD'\n      },\n      trackStyle: [\n        {\n          background: '#dc6c9a'\n        },\n        {\n          background: '#982d5f'\n        }\n      ]\n    },\n    decodeFunction: `\n      // values for creating power scale, domain (input), and range (output)\n      float domainMin = 0.;\n      float domainMax = 255.;\n      float rangeMin = 0.;\n      float rangeMax = 255.;\n\n      float exponent = zoom < 13. ? 0.3 + (zoom - 3.) / 20. : 1.;\n      float intensity = color.r * 255.;\n\n      // get the min, max, and current values on the power scale\n      float minPow = pow(domainMin, exponent - domainMin);\n      float maxPow = pow(domainMax, exponent);\n      float currentPow = pow(intensity, exponent);\n\n      // get intensity value mapped to range\n      float scaleIntensity = ((currentPow - minPow) / (maxPow - minPow) * (rangeMax - rangeMin)) + rangeMin;\n      // a value between 0 and 255\n      alpha = zoom < 13. ? scaleIntensity / 255. : color.g;\n\n      float year = 2000.0 + (color.b * 255.);\n      // map to years\n      if (year >= startYear && year <= endYear && year >= 2001.) {\n        color.r = 220. / 255.;\n        color.g = (72. - zoom + 102. - 3. * scaleIntensity / zoom) / 255.;\n        color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n      } else {\n        alpha = 0.;\n      }\n    `\n  },\n\n  // VECTOR - PROVIDER CARTO\n  {\n    id: 'protected-areas',\n    name: 'Protected areas',\n    config: {\n      type: 'vector',\n      source: {\n        type: 'vector',\n        promoteId: 'cartodb_id',\n        provider: {\n          type: 'carto',\n          account: 'wri-01',\n          layers: [\n            {\n              options: {\n                cartocss: '#wdpa_protected_areas {  polygon-opacity: 1.0; polygon-fill: #704489 }',\n                cartocss_version: '2.3.0',\n                sql: 'SELECT * FROM wdpa_protected_areas'\n              },\n              type: 'mapnik'\n            }\n          ]\n        }\n      },\n      render: {\n        layers: [\n          {\n            type: 'fill',\n            'source-layer': 'layer0',\n            featureState: {},\n            paint: {\n              'fill-color': [\n                'case',\n                ['boolean', ['feature-state', 'hover'], false],\n                '#000',\n                '#5ca2d1'\n              ],\n              'fill-color-transition': {\n                duration: 300,\n                delay: 0\n              },\n              'fill-opacity': 1\n            }\n          },\n          {\n            type: 'line',\n            'source-layer': 'layer0',\n            paint: {\n              'line-color': '#000000',\n              'line-opacity': 0.1\n            }\n          }\n        ]\n      }\n    },\n    paramsConfig: [],\n    legendConfig: {\n      type: 'basic',\n      items: [{ name: 'Protected areas', color: '#5ca2d1' }]\n    },\n    interactionConfig: {\n      enabled: true,\n      type: 'hover'\n    }\n  },\n\n  // CUSTOM PROVIDER\n  {\n    id: 'mongabay-stories',\n    name: 'Mongabay stories',\n    config: {\n      type: 'geojson',\n      images: [\n        { id: 'lm-marker1', src: MARKER1, options: { sdf: true }},\n        { id: 'lm-marker2', src: MARKER2, options: { sdf: true }}\n      ],\n      source: {\n        type: 'geojson',\n        promoteId: 'cartodb_id',\n        data: 'https://wri-01.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20mongabay&format=geojson',\n        cluster: true,\n        clusterMaxZoom: 14,\n        clusterRadius: 45\n      },\n      render: {\n        metadata: {\n          position: 'top'\n        },\n        layers: [\n          {\n            id: 'media-clusters',\n            metadata: {\n              position: 'top'\n            },\n            type: 'circle',\n            filter: ['has', 'point_count'],\n            paint: {\n              'circle-color': '#FFF',\n              'circle-stroke-width': 2,\n              'circle-stroke-color': [\n                'case',\n                ['boolean', ['feature-state', 'hover'], false],\n                '#000',\n                '#5ca2d1'\n              ],\n              'circle-radius': 12\n            }\n          },\n          {\n            id: 'media-cluster-count',\n            metadata: {\n              position: 'top'\n            },\n            type: 'symbol',\n            filter: ['has', 'point_count'],\n            layout: {\n              'text-allow-overlap': true,\n              'text-ignore-placement': true,\n              'text-field': '{point_count_abbreviated}',\n              'text-size': 12\n            }\n          },\n          {\n            id: 'media',\n            metadata: {\n              position: 'top'\n            },\n            type: 'symbol',\n            filter: ['!', ['has', 'point_count']],\n            paint: {\n              'icon-color': '#F00'\n            },\n            layout: {\n              'icon-ignore-placement': true,\n              'icon-allow-overlap': true,\n              'icon-image': 'lm-marker1'\n            }\n          }\n        ]\n      }\n    },\n    paramsConfig: [],\n    legendConfig: {\n      type: 'basic',\n      items: [{ name: 'Mongabay stories', color: '#FFCC00' }]\n    },\n    interactionConfig: {\n      enabled: true,\n      type: 'hover'\n    }\n  }\n];\n","import React, { useState } from 'react';\n\nimport omit from 'lodash/omit';\nimport isEmpty from 'lodash/isEmpty';\n\nimport { getParams } from './utils';\n\n// Components\nimport Map from 'components/map';\nimport Sidebar from 'components/sidebar';\nimport AceEditor from 'react-ace';\nimport 'ace-builds/src-noconflict/mode-json';\nimport 'ace-builds/src-noconflict/theme-github';\n\n// Layer manager\nimport { LayerManager, Layer } from 'layer-manager/dist/components';\nimport { PluginMapboxGl, fetch } from 'layer-manager';\n\n// Legend\nimport {\n  Icons,\n  Legend,\n  LegendListItem,\n  LegendItemTypes,\n  LegendItemTimeStep,\n  LegendItemToolbar,\n  LegendItemButtonOpacity,\n  LegendItemButtonVisibility\n} from 'vizzuality-components';\n\n// DATA\nimport DEFAULT_LAYERS from './layers';\n\nimport './App.scss';\n\nfunction App() {\n  const [layers, setLayers] = useState(DEFAULT_LAYERS);\n  const [layersJson, setLayersJson] = useState(JSON.stringify(DEFAULT_LAYERS, null, 2));\n  const [layersSettings, setLayersSettings] = useState({});\n  const [layersInteractiveIds, setLayersInteractiveIds] = useState([]);\n\n  // LEGEND\n  const layerGroups = layers.map(l => {\n    const { id, paramsConfig, sqlConfig, decodeConfig, timelineConfig } = l;\n    const lSettings = layersSettings[id] || {};\n\n    const params = !!paramsConfig && getParams(paramsConfig, lSettings.params);\n    const sqlParams = !!sqlConfig && getParams(sqlConfig, lSettings.sqlParams);\n    const decodeParams =\n      !!decodeConfig && getParams(decodeConfig, { ...timelineConfig, ...lSettings.decodeParams });\n    const timelineParams = !!timelineConfig && {\n      ...timelineConfig,\n      ...getParams(paramsConfig, lSettings.params),\n      ...getParams(decodeConfig, lSettings.decodeParams)\n    };\n\n    return {\n      id,\n      slug: id,\n      dataset: id,\n      layers: [\n        {\n          active: true,\n          ...l,\n          ...lSettings,\n          params,\n          sqlParams,\n          decodeParams,\n          timelineParams\n        }\n      ],\n      ...lSettings\n    };\n  });\n\n  const onChangeJson = json => {\n    setLayersJson(json);\n\n    try {\n      const newLayers = JSON.parse(json);\n      setLayers(newLayers);\n    } catch (e) {\n      // do nothing\n    }\n  };\n\n  const onChangeOrder = ids => {\n    console.log('onChangeOrder', ids);\n  };\n\n  const onChangeVisibility = (l, visibility) => {\n    setLayersSettings({\n      ...layersSettings,\n      [l.id]: {\n        ...layersSettings[l.id],\n        visibility\n      }\n    });\n  };\n\n  const onChangeOpacity = (l, opacity) => {\n    setLayersSettings({\n      ...layersSettings,\n      [l.id]: {\n        ...layersSettings[l.id],\n        opacity\n      }\n    });\n  };\n\n  const onChangeLayerDate = (dates, layer) => {\n    const { id, decodeConfig } = layer;\n\n    setLayersSettings({\n      ...layersSettings,\n      [id]: {\n        ...layersSettings[id],\n        ...(decodeConfig && {\n          decodeParams: {\n            startDate: dates[0],\n            endDate: dates[1],\n            trimEndDate: dates[2]\n          }\n        }),\n        ...(!decodeConfig && {\n          params: {\n            startDate: dates[0],\n            endDate: dates[1]\n          }\n        })\n      }\n    });\n  };\n\n  const onAfterAdd = layerModel => {\n    if (!isEmpty(layerModel.interactionConfig)) {\n      layerModel.mapLayer.layers.forEach(l => {\n        const { id } = l;\n\n        if (!layersInteractiveIds.includes(id)) {\n          setLayersInteractiveIds(prevLayersInteractiveIds => [...prevLayersInteractiveIds, id]);\n        }\n      });\n    }\n  };\n\n  const onAfterRemove = layerModel => {\n    if (!isEmpty(layerModel.interactionConfig)) {\n      layerModel.mapLayer.layers.forEach(l => {\n        const { id } = l;\n\n        if (layersInteractiveIds.includes(id)) {\n          setLayersInteractiveIds(prevLayersInteractiveIds => {\n            const arr = prevLayersInteractiveIds.filter(e => e !== id);\n\n            return arr;\n          });\n        }\n      });\n    }\n  };\n\n  return (\n    <div className=\"c-app\">\n      <Icons />\n\n      <div className=\"c-main\">\n        <Sidebar>\n          <AceEditor\n            mode=\"json\"\n            theme=\"github\"\n            value={layersJson}\n            onChange={onChangeJson}\n            tabSize={2}\n            width=\"100%\"\n            height=\"100%\"\n            wrapEnabled\n            showPrintMargin={false}\n            editorProps={{ $blockScrolling: true }}\n            debounceChangePeriod={500}\n          />\n        </Sidebar>\n\n        <div className=\"c-map-container\">\n          <Map\n            mapboxApiAccessToken={process.env.REACT_APP_MAPBOX_TOKEN}\n            // mapStyle=\"mapbox://styles/layer-manager/ck07vfinn01xm1co324q5vcdl\"\n            minZoom={2}\n            mapOptions={{\n              fadeDuration: 0\n            }}\n            interactiveLayerIds={layersInteractiveIds}\n          >\n            {map => (\n              <LayerManager\n                map={map}\n                plugin={PluginMapboxGl}\n                providers={{\n                  'carto-sql-points': (layerModel, layer, resolve, reject) => {\n                    const { source } = layerModel;\n                    const { provider } = source;\n\n                    fetch('get', provider.url, provider.options, layerModel)\n                      .then(response => {\n                        return resolve({\n                          ...layer,\n                          source: {\n                            ...omit(layer.source, 'provider'),\n                            data: {\n                              type: 'FeatureCollection',\n                              features: response.rows.map(r => ({\n                                type: 'Feature',\n                                properties: r,\n                                geometry: {\n                                  type: 'Point',\n                                  coordinates: [r.lon, r.lat]\n                                }\n                              }))\n                            }\n                          }\n                        });\n                      })\n                      .catch(e => {\n                        reject(e);\n                      });\n                  }\n                }}\n              >\n                {layers.map(layer => {\n                  const {\n                    id,\n                    paramsConfig,\n                    sqlConfig,\n                    decodeConfig,\n                    timelineConfig,\n                    decodeFunction\n                  } = layer;\n\n                  const lSettings = layersSettings[id] || {};\n\n                  const l = {\n                    ...layer,\n                    ...layer.config,\n                    ...lSettings,\n                    ...(!!paramsConfig && {\n                      params: getParams(paramsConfig, { ...lSettings.params })\n                    }),\n\n                    ...(!!sqlConfig && {\n                      sqlParams: getParams(sqlConfig, { ...lSettings.sqlParams })\n                    }),\n\n                    ...(!!decodeConfig && {\n                      decodeParams: getParams(decodeConfig, {\n                        ...timelineConfig,\n                        ...lSettings.decodeParams\n                      }),\n                      decodeFunction\n                    })\n                  };\n\n                  return (\n                    <Layer\n                      key={layer.id}\n                      {...l}\n                      onAfterAdd={onAfterAdd}\n                      onAfterRemove={onAfterRemove}\n                    />\n                  );\n                })}\n              </LayerManager>\n            )}\n          </Map>\n\n          <div className=\"c-legend\">\n            <Legend\n              maxHeight={'65vh'}\n              collapsable={false}\n              sortable={false}\n              onChangeOrder={onChangeOrder}\n            >\n              {layerGroups.map((layerGroup, i) => {\n                return (\n                  <LegendListItem\n                    index={i}\n                    key={layerGroup.slug}\n                    layerGroup={layerGroup}\n                    toolbar={\n                      <LegendItemToolbar>\n                        <LegendItemButtonOpacity\n                          trackStyle={{\n                            background: '#FFCC00'\n                          }}\n                          handleStyle={{\n                            background: '#FFCC00'\n                          }}\n                        />\n                        <LegendItemButtonVisibility />\n                      </LegendItemToolbar>\n                    }\n                    onChangeVisibility={onChangeVisibility}\n                    onChangeOpacity={onChangeOpacity}\n                  >\n                    <LegendItemTypes />\n\n                    <LegendItemTimeStep\n                      defaultStyles={{\n                        handleStyle: {\n                          backgroundColor: 'white',\n                          borderRadius: '50%',\n                          boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.29)',\n                          border: '0px',\n                          zIndex: 2\n                        },\n                        railStyle: { backgroundColor: '#d6d6d9' },\n                        dotStyle: { visibility: 'hidden', border: '0px' }\n                      }}\n                      handleChange={onChangeLayerDate}\n                    />\n                  </LegendListItem>\n                );\n              })}\n            </Legend>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport './styles/index.scss';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}
(window.webpackJsonpsandbox=window.webpackJsonpsandbox||[]).push([[0],{205:function(e,t,r){e.exports=function(e,t,r,n,i,a,o){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var s="default"in t?t.default:t;r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o;var c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},d=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},f=function(e,t,r,n){try{e(r(n))}catch(i){t(i)}},h=function(){function e(t){c(this,e),this._promise=new Promise(t),this._canceled=!1}return u(e,null,[{key:"all",value:function(t){return new e(function(e,r){Promise.all(t).then(e,r)})}},{key:"race",value:function(t){return new e(function(e,r){Promise.race(t).then(e,r)})}},{key:"reject",value:function(t){return new e(function(e,r){Promise.reject(t).then(e,r)})}},{key:"resolve",value:function(t){return new e(function(e,r){Promise.resolve(t).then(e,r)})}}]),u(e,[{key:"then",value:function(t,r){var n=this,i=new e(function(e,a){n._promise.then(function(r){n._canceled&&i.cancel(),t&&!n._canceled?f(e,a,t,r):e(r)},function(t){n._canceled&&i.cancel(),r&&!n._canceled?f(e,a,r,t):a(t)})});return i}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,t),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,e,{changedAttributes:{}})}return u(t,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(t){var r=this,n=l({},this),i=l({},t);this.set("changedAttributes",{}),Object.keys(i).forEach(function(t){e(n[t],i[t])||(r.changedAttributes[t]=i[t],r.set(t,i[t]))})}}]),t}(),g={"Content-Type":"application/json"},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.get(e,l({headers:g},t))},b=function(e,t){return s.post(e,t,{headers:g})},w={carto:function(e,r,n,i){var a=e.interactivity,o=e.source.provider,s=JSON.stringify({version:"1.3.0",stat_tag:"API",layers:o.layers.map(function(e){return a&&a.length?l({},e,{options:l({},e.options,{interactivity:a})}):e})}),c=l({stat_tag:"API",config:encodeURIComponent(s)},o.api_key&&{api_key:o.api_key}),u=Object.keys(c).map(function(e){return e+"="+c[e]}).join("&");(function(e,r,n,i){var a=i.layerRequest;a&&a.cancel("Operation canceled by the user.");var o=t.CancelToken.source();return i.set("layerRequest",o),("post"===e?b:v)(r,l({},n,{cancelToken:o.token})).then(function(e){return e.status>400?(console.error(e),!1):e.data})})("get","https://"+o.account+".carto.com/api/v1/map?"+u,{},e).then(function(t){var i="vector"===e.type?"mvt":"png",a=t.cdn_url.templates.https.url.replace("{s}","a")+"/"+o.account+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}."+i;return n(l({},r,{source:l({},r.source,{tiles:[a]})}))}).catch(function(e){return i(e)})}},O=function(){function e(t,r,n){var i;c(this,e),this.map=t,this.providers=l({},w,n),this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new r(this.map,this.options),(i=this.plugin)&&(["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach(function(e){i[e]||console.error("The "+e+" function is required for layer manager plugins")}),["getLayerByProvider"].forEach(function(e){i[e]&&console.warn("The "+e+" function is deprecated for layer manager plugins")}))}return u(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},r=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var n=new m(l({},e,t)),i=n.id;return this.layers.find(function(e){return e.id===i})?this.layers:(this.layers.push(n),this.requestLayer(n,r),this.layers)}},{key:"update",value:function(e,t){var n=this.getLayerModel(e);if(n&&n.mapLayer){n.update(t);var i=t.opacity,a=t.visibility,o=t.zIndex,s=t.source,c=t.render,u=t.params,l=t.sqlParams,p=t.decodeParams;"undefined"!==typeof i&&this.plugin.setOpacity(n,i),"undefined"!==typeof a&&this.plugin.setVisibility(n,a),"undefined"!==typeof o&&this.plugin.setZIndex(n,o),r(s)||this.plugin.setSource(n),r(c)||this.plugin.setRender(n),r(u)||this.plugin.setParams(n),r(l)||this.plugin.setSqlParams(n),r(p)||this.plugin.setDecodeParams(n)}}},{key:"remove",value:function(e){var t=this.layers.slice(0);this.requestCancel(e);var r=this.getLayerModel(e);r&&this.plugin.remove(r),this.layers=t.filter(function(t){return t.id!==e})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find(function(t){return t.id===e})}},{key:"setOpacity",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setOpacity(r,t)}},{key:"setVisibility",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setVisibility(r,t)}},{key:"setZIndex",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setZIndex(r,t)}},{key:"requestLayer",value:function(e,t){var r=this,n=e.type,i=this.plugin.getLayerByType(n);return i?(this.requestCancel(e.id),this.promises[e.id]=i.call(this,e,this.providers).then(function(n){r.promises[e.id]._canceled||(e.set("mapLayer",n),r.plugin.add(e,r.layers),r.plugin.setZIndex(e,e.zIndex),r.plugin.setOpacity(e,e.opacity),r.plugin.setVisibility(e,e.visibility),r.plugin.setRender(e),t(e))}),this):(this.promises[e.id]=h.reject(new Error(n+" type is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}]),e}(),x=function(e){function t(e){c(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=e.map,i=e.plugin,a=e.providers;return r.layerManager=new O(n,i,a),r}return p(t,e),u(t,[{key:"componentWillUnmount",value:function(){this.layerManager.unmount()}},{key:"render",value:function(){var e=this,t=this.props.children;return t&&n.Children.count(t)?n.Children.map(t,function(t,r){return t&&n.cloneElement(t,{layerManager:e.layerManager,zIndex:t.props.zIndex||1e3-r})}):null}}]),t}(n.PureComponent);x.propTypes={map:i.shape({}).isRequired,plugin:i.func.isRequired,providers:i.shape({}),children:i.oneOfType([i.arrayOf(i.node),i.node])},x.defaultProps={children:[],providers:{}};var k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return Object.keys(t).forEach(function(e){(Array.isArray(t[e])||o(t[e]))&&(r=r.replace(new RegExp('"{{'+e+'}}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{{"+e+"}}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{{"+e+"}}`","g"),JSON.stringify(t[e])).replace(new RegExp('"{'+e+'}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{"+e+"}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{"+e+"}`","g"),JSON.stringify(t[e]))),"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(r=r.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),r=r.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])}),r},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e,n=void 0;return Object.keys(t).forEach(function(e){n=(n=""+a(Object.keys(t[e]).map(function(r){var n=t[e][r];return Array.isArray(n)&&n.length?r+" IN ("+n.map(function(e){return"number"!==typeof e?"'"+e+"'":e}).join(", ")+")":!Array.isArray(n)&&n?"number"!==typeof n?r+" = '"+n+"'":r+" = "+n:null})).join(" AND "))&&e.startsWith("where")?"WHERE "+n:n&&e.startsWith("and")?"AND "+n:"",r=(r=r.replace(new RegExp("{{"+e+"}}","g"),n)).replace(new RegExp("{"+e+"}","g"),n)}),r},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e;return"string"===typeof n&&(n=k(n,t),n=P(n,r)),n},_=function(t){function n(){var e,t,r;c(this,n);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=r=y(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(a))),r.add=function(){var e=r.props,t=e.layerManager,n=e.onAfterAdd,i=d(e,["layerManager","onAfterAdd"]),a=i.source,o=i.render,s=i.params,c=i.sqlParams,u=!1===a.parse?a:JSON.parse(E(JSON.stringify(a),s,c)),p=!1===o.parse?o:JSON.parse(E(JSON.stringify(o),s,c));t.add(l({},i,{source:u,render:p}),{},n)},r.update=function(e){var t=r.props,n=t.layerManager,i=t.id;n.update(i,e)},r.remove=function(){var e=r.props,t=e.layerManager,n=e.id;t.remove(n)},y(r,t)}return p(n,t),u(n,[{key:"componentDidMount",value:function(){this.add()}},{key:"componentDidUpdate",value:function(t){var n=t.source,i=t.render,a=t.params,o=t.sqlParams,s=t.decodeParams,c=t.opacity,u=t.visibility,p=t.zIndex,d=this.props,y=d.type,f=d.source,h=d.render,m=d.params,g=d.sqlParams,v=d.decodeParams,b=d.opacity,w=d.visibility,O=d.zIndex,x=!1===n.parse?n:JSON.parse(E(JSON.stringify(n),a,o)),k=!1===f.parse?f:JSON.parse(E(JSON.stringify(f),m,g)),P=!1===i.parse?i:JSON.parse(E(JSON.stringify(i),a,o)),_=!1===h.parse?h:JSON.parse(E(JSON.stringify(h),m,g));if(k&&!e(k,x)){var L=k.type,j=k.data,C=L||y;if("raster"===C||"vector"===C||"geojson"===C&&"string"===typeof j)return this.remove(),void this.add()}if(_&&!e(_,P)){var T=_.layers,S=void 0===T?[]:T,D=P.layers,z=void 0===D?[]:D;if(S.length!==z.length)return this.remove(),void this.add()}var M=l({},b!==c&&{opacity:b},w!==u&&{visibility:w},O!==p&&{zIndex:O},!e(k,P)&&{source:k},!e(_,P)&&{render:_},!e(v,s)&&{decodeParams:v});r(M)||this.update(M)}},{key:"componentWillUnmount",value:function(){this.remove()}},{key:"render",value:function(){return null}}]),n}(n.PureComponent);_.propTypes={id:i.oneOfType([i.string,i.number]).isRequired,source:i.shape({parse:i.oneOfType([i.bool,i.func])}),render:i.shape({parse:i.oneOfType([i.bool,i.func])}),params:i.shape({}),sqlParams:i.shape({}),decodeParams:i.shape({}),opacity:i.number,visibility:i.bool,zIndex:i.number,onAfterAdd:i.func,layerManager:i.shape({add:i.func.isRequired,update:i.func.isRequired,remove:i.func.isRequired,map:i.shape({getSource:i.func})})},_.defaultProps={params:void 0,sqlParams:void 0,decodeParams:void 0,opacity:1,visibility:!0,zIndex:void 0,source:{parse:!0},render:{},layerManager:null,onAfterAdd:function(){}};var L={};return L.LayerManager=x,L.Layer=_,L}(r(201),r(130),r(95),r(507),r(510),r(202),r(93))},211:function(e,t){},322:function(e,t,r){e.exports=r(556)},426:function(e,t,r){},427:function(e,t,r){},513:function(e,t){},554:function(e,t,r){},555:function(e,t,r){},556:function(e,t,r){"use strict";r.r(t);var n=r(6),i=r.n(n),a=r(200),o=r.n(a),s=r(3),c=r(20),u=r(270),l=r.n(u),p=r(65),d=r.n(p);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(r,!0).forEach(function(t){Object(s.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(e,t){var r=new Date(t),n=new Date(e),i=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate()),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate());return Math.floor((a-i)/864e5)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e||{},r=t.startDate,n=t.endDate,i=t.minDate,a=t.maxDate;if(!r||!n||!i||!a)return null;var o=new Date(i),s=new Date(a),c=h(s,o),u=new Date(r),l=new Date(n),p=c-h(s,u),d=c-h(s,l),y=p||0,f=d||c;return{startDayIndex:y,endDayIndex:f,numberOfDays:c}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.reduce(function(e,t){var r=t.key,n=t.default;return f({},e,Object(s.a)({},r,n))},{}),n=f({},r,{},t),i=n.startDate,a=n.endDate,o=n.trimEndDate,c=n.maxAbsoluteDate,u=i,l=a>c?c:a,p=o>c?c:o;return f({},n,{},!!u&&{startYear:d()(u).year(),startMonth:d()(u).month(),startDay:d()(u).dayOfYear()},{},!!a&&{endYear:d()(l).year(),endMonth:d()(l).month(),endDay:d()(l).dayOfYear()},{},!!o&&{trimEndYear:d()(p).year(),trimEndMonth:d()(p).month(),trimEndDay:d()(p).dayOfYear()},{},m(n))},v=r(284),b=r(14),w=r(13),O=r(25),x=r(22),k=r(26),P=r(271),E=r.n(P),_=r(203),L=r.n(_),j=r(204),C=r.n(j),T=r(172),S=r(572),D=r(283);r(425),r(426);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(r,!0).forEach(function(t){Object(s.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var R={zoom:2,lat:0,lng:0},I=function(e){function t(){var e,r;Object(b.a)(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(r=Object(O.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).events={},r.state={viewport:M({},R,{},r.props.viewport),flying:!1,loaded:!1},r.onLoad=function(){var e=r.props,t=e.bounds,n=e.onLoad;r.setState({loaded:!0}),!C()(t)&&t.bbox&&r.fitBounds(),n({map:r.map,mapContainer:r.mapContainer})},r.onViewportChange=function(e,t){var n=r.props.onViewportChange;r.setState({viewport:e}),n(e)},r.onResize=function(e){var t=r.props.onViewportChange,n=M({},r.state.viewport,{},e);r.setState({viewport:n}),t(n)},r.onMoveEnd=function(){var e=r.props.onViewportChange,t=r.state.viewport;if(r.map){var n=r.map.getBearing(),i=r.map.getPitch(),a=r.map.getZoom(),o=r.map.getCenter(),s=o.lng,c=M({},t,{bearing:n,pitch:i,zoom:a,latitude:o.lat,longitude:s});r.setState({viewport:c}),e(c)}},r.fitBounds=function(){var e=r.state.viewport,t=r.props,n=t.bounds,i=t.onViewportChange,a=n.bbox,o=n.options,s=M({width:r.mapContainer.offsetWidth,height:r.mapContainer.offsetHeight},e),c=new S.a(s).fitBounds([[a[0],a[1]],[a[2],a[3]]],o),u=c.longitude,l=c.latitude,p=c.zoom,d=M({},r.state.viewport,{longitude:u,latitude:l,zoom:p,transitionDuration:2500,transitionInterruption:T.b.UPDATE});r.setState({flying:!0,viewport:d}),i(d),setTimeout(function(){r.setState({flying:!1})},2500)},r}return Object(k.a)(t,e),Object(w.a)(t,[{key:"componentDidUpdate",value:function(e){var t=e.viewport,r=e.bounds,n=this.props,i=n.viewport,a=n.bounds,o=this.state.viewport;L()(i,t)||this.setState({viewport:M({},o,{},i)}),C()(a)||L()(a,r)||this.fitBounds()}},{key:"render",value:function(){var e=this,t=this.props,r=t.customClass,n=t.children,a=(t.getCursor,t.dragPan),o=t.dragRotate,c=t.scrollZoom,u=t.touchZoom,l=t.touchRotate,p=t.doubleClickZoom,d=Object(v.a)(t,["customClass","children","getCursor","dragPan","dragRotate","scrollZoom","touchZoom","touchRotate","doubleClickZoom"]),y=this.state,f=y.viewport,h=y.loaded,m=y.flying;return i.a.createElement("div",{ref:function(t){e.mapContainer=t},className:E()(Object(s.a)({"c-map":!0},r,!!r))},i.a.createElement(T.c,Object.assign({ref:function(t){e.map=t&&t.getMap()}},d,f,{width:"100%",height:"100%",dragPan:!m&&a,dragRotate:!m&&o,scrollZoom:!m&&c,touchZoom:!m&&u,touchRotate:!m&&l,doubleClickZoom:!m&&p,onViewportChange:this.onViewportChange,onResize:this.onResize,onLoad:this.onLoad,transitionInterpolator:new T.a,transitionEasing:D.a}),h&&!!this.map&&"function"===typeof n&&n(this.map)))}}]),t}(n.Component);I.defaultProps={children:null,customClass:null,viewport:R,bounds:{},dragPan:!0,dragRotate:!0,onViewportChange:function(){},onLoad:function(){},getCursor:function(e){var t=e.isHovering,r=e.isDragging;return t?"pointer":r?"grabbing":"grab"}};var A=I,N=(r(427),function(e){function t(){return Object(b.a)(this,t),Object(O.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(k.a)(t,e),Object(w.a)(t,[{key:"render",value:function(){var e=this.props.children;return i.a.createElement("div",{className:"c-sidebar"},i.a.createElement("div",{className:"sidebar--scroll"},e))}}]),t}(i.a.Component)),F=r(273),q=r.n(F),Z=(r(433),r(434),r(205)),V=r(201),J=r.n(V),U=r(130),B=r.n(U),Y=r(95),W=r.n(Y),H=r(202),G=r.n(H),X=r(93),Q=r.n(X),$=r(571),K=r(281),ee=r(165),te=r(573),re=r(570),ne=r(73),ie=r.n(ne),ae=r(113),oe=r(114),se=r(209),ce=r.n(se),ue=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},le=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),pe=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ye=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},he=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(c){i=!0,a=c}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),me=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},ge=function(e,t,r,n){try{e(r(n))}catch(i){t(i)}},ve=function(){function e(t){ue(this,e),this._promise=new Promise(t),this._canceled=!1}return le(e,null,[{key:"all",value:function(t){return new e(function(e,r){Promise.all(t).then(e,r)})}},{key:"race",value:function(t){return new e(function(e,r){Promise.race(t).then(e,r)})}},{key:"reject",value:function(t){return new e(function(e,r){Promise.reject(t).then(e,r)})}},{key:"resolve",value:function(t){return new e(function(e,r){Promise.resolve(t).then(e,r)})}}]),le(e,[{key:"then",value:function(t,r){var n=this,i=new e(function(e,a){n._promise.then(function(r){n._canceled&&i.cancel(),t&&!n._canceled?ge(e,a,t,r):e(r)},function(t){n._canceled&&i.cancel(),r&&!n._canceled?ge(e,a,r,t):a(t)})});return i}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"cancel",value:function(e){return this._canceled=!0,e&&this._promise.catch(e),this}}]),e}(),be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ue(this,e),this.opacity=1,this.visibility=!0,this.source={},this.render={},Object.assign(this,t,{changedAttributes:{}})}return le(e,[{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t){return this[e]=t,this}},{key:"update",value:function(e){var t=this,r=de({},this),n=de({},e);this.set("changedAttributes",{}),Object.keys(n).forEach(function(e){J()(r[e],n[e])||(t.changedAttributes[e]=n[e],t.set(e,n[e]))})}}]),e}(),we={"Content-Type":"application/json"},Oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B.a.get(e,de({headers:we},t))},xe=function(e,t){return B.a.post(e,t,{headers:we})},ke=function(e,t,r,n){var i=n.layerRequest;i&&i.cancel("Operation canceled by the user.");var a=U.CancelToken.source();return n.set("layerRequest",a),("post"===e?xe:Oe)(t,de({},r,{cancelToken:a.token})).then(function(e){return e.status>400?(console.error(e),!1):e.data})},Pe={carto:function(e,t,r,n){var i=e.interactivity,a=e.source.provider,o=JSON.stringify({version:"1.3.0",stat_tag:"API",layers:a.layers.map(function(e){return i&&i.length?de({},e,{options:de({},e.options,{interactivity:i})}):e})}),s=de({stat_tag:"API",config:encodeURIComponent(o)},a.api_key&&{api_key:a.api_key}),c=Object.keys(s).map(function(e){return e+"="+s[e]}).join("&"),u="https://"+a.account+".carto.com/api/v1/map?"+c;ke("get",u,{},e).then(function(n){var i="vector"===e.type?"mvt":"png",o=n.cdn_url.templates.https.url.replace("{s}","a")+"/"+a.account+"/api/v1/map/"+n.layergroupid+"/{z}/{x}/{y}."+i;return r(de({},t,{source:de({},t.source,{tiles:[o]})}))}).catch(function(e){return n(e)})}};!function(){function e(t,r,n){ue(this,e),this.map=t,this.providers=de({},Pe,n),this.layers=[],this.promises={},this.options={getLayers:this.getLayers.bind(this)},this.plugin=new r(this.map,this.options),function(e){if(e){["add","remove","setVisibility","setOpacity","setZIndex","setSource","setRender","setParams","setSQLParams","setDecodeParams","getLayerByType"].forEach(function(t){e[t]||console.error("The "+t+" function is required for layer manager plugins")});["getLayerByProvider"].forEach(function(t){e[t]&&console.warn("The "+t+" function is deprecated for layer manager plugins")})}}(this.plugin)}le(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{opacity:1,visibility:!0,zIndex:0,interactivity:null},r=arguments[2];if("undefined"===typeof e)return console.error("layer is required"),this;var n=new be(de({},e,t)),i=n.id;return this.layers.find(function(e){return e.id===i})?this.layers:(this.layers.push(n),this.requestLayer(n,r),this.layers)}},{key:"update",value:function(e,t){var r=this.getLayerModel(e);if(r&&r.mapLayer){r.update(t);var n=t.opacity,i=t.visibility,a=t.zIndex,o=t.source,s=t.render,c=t.params,u=t.sqlParams,l=t.decodeParams;"undefined"!==typeof n&&this.plugin.setOpacity(r,n),"undefined"!==typeof i&&this.plugin.setVisibility(r,i),"undefined"!==typeof a&&this.plugin.setZIndex(r,a),W()(o)||this.plugin.setSource(r),W()(s)||this.plugin.setRender(r),W()(c)||this.plugin.setParams(r),W()(u)||this.plugin.setSqlParams(r),W()(l)||this.plugin.setDecodeParams(r)}}},{key:"remove",value:function(e){var t=this.layers.slice(0);this.requestCancel(e);var r=this.getLayerModel(e);r&&this.plugin.remove(r),this.layers=t.filter(function(t){return t.id!==e})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayerModel",value:function(e){return this.layers.find(function(t){return t.id===e})}},{key:"setOpacity",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setOpacity(r,t)}},{key:"setVisibility",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setVisibility(r,t)}},{key:"setZIndex",value:function(e,t){var r=this.getLayerModel(e);this.plugin.setZIndex(r,t)}},{key:"requestLayer",value:function(e,t){var r=this,n=e.type,i=this.plugin.getLayerByType(n);return i?(this.requestCancel(e.id),this.promises[e.id]=i.call(this,e,this.providers).then(function(n){r.promises[e.id]._canceled||(e.set("mapLayer",n),r.plugin.add(e,r.layers),r.plugin.setZIndex(e,e.zIndex),r.plugin.setOpacity(e,e.opacity),r.plugin.setVisibility(e,e.visibility),r.plugin.setRender(e),t(e))}),this):(this.promises[e.id]=ve.reject(new Error(n+" type is not yet supported.")),!1)}},{key:"requestCancel",value:function(e){this.promises[e]&&this.promises[e].cancel&&this.promises[e].cancel()}},{key:"unmount",value:function(){this.map=null,this.plugin.unmount()}}])}();var Ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return Object.keys(t).forEach(function(e){(Array.isArray(t[e])||Q()(t[e]))&&(r=r.replace(new RegExp('"{{'+e+'}}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{{"+e+"}}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{{"+e+"}}`","g"),JSON.stringify(t[e])).replace(new RegExp('"{'+e+'}"',"g"),JSON.stringify(t[e])).replace(new RegExp("'{"+e+"}'","g"),JSON.stringify(t[e])).replace(new RegExp("`{"+e+"}`","g"),JSON.stringify(t[e]))),"number"!==typeof t[e]&&"boolean"!==typeof t[e]||(r=r.replace(new RegExp('"{{'+e+'}}"',"g"),t[e]).replace(new RegExp("'{{"+e+"}}'","g"),t[e]).replace(new RegExp("`{{"+e+"}}`","g"),t[e]).replace(new RegExp('"{'+e+'}"',"g"),t[e]).replace(new RegExp("'{"+e+"}'","g"),t[e]).replace(new RegExp("`{"+e+"}`","g"),t[e])),r=r.replace(new RegExp("{{"+e+"}}","g"),t[e]).replace(new RegExp("{"+e+"}","g"),t[e])}),r},_e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e,n=void 0;return Object.keys(t).forEach(function(e){n=(n=""+G()(Object.keys(t[e]).map(function(r){var n=t[e][r];return Array.isArray(n)&&n.length?r+" IN ("+n.map(function(e){return"number"!==typeof e?"'"+e+"'":e}).join(", ")+")":!Array.isArray(n)&&n?"number"!==typeof n?r+" = '"+n+"'":r+" = "+n:null})).join(" AND "))&&e.startsWith("where")?"WHERE "+n:n&&e.startsWith("and")?"AND "+n:"",r=(r=r.replace(new RegExp("{{"+e+"}}","g"),n)).replace(new RegExp("{"+e+"}","g"),n)}),r},Le=function(e,t){var r=t.id,n=t.params,i=t.sqlParams;if(e&&e.length){var a=JSON.parse(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e;return"string"===typeof n&&(n=Ee(n,t),n=_e(n,r)),n}(JSON.stringify(e),n,i));return a&&a.map(function(e,n){var i=e.paint,a=void 0===i?{}:i,o=({symbol:["icon","text"],circle:["circle","circle-stroke"]}[e.type]||[e.type]).reduce(function(e,r){var n=a[r+"-opacity"];return de({},e,pe({},r+"-opacity",(void 0!==n&&null!==n?n:1)*t.opacity*.99))},{}),s=e.paint&&Object.entries(e.paint).reduce(function(e,t){var r=he(t,2),n=r[0],i=r[1];return de({},e,!!i&&pe({},n,i))},{});return de({id:r+"-"+e.type+"-"+n},e,{source:r},e.paint&&{paint:de({},s,o)})})}return!1};function je(e){var t=e.map,r=e.gl,n=e.deck;if(t.__deck)return t.__deck;var i=n&&n.props._customRender,a={useDevicePixels:!0,_customRender:function(){t.triggerRepaint(),i&&i()},parameters:{depthMask:!0,depthTest:!0,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],blendEquation:r.FUNC_ADD},userData:{isExternal:!1,mapboxLayers:new Set}};return n?(n.setProps(a),n.props.userData.isExternal=!0):(Object.assign(a,{gl:r,width:!1,height:!1,viewState:Ce(t)}),n=new $.a(a),t.on("move",function(){return function(e,t){e.setProps({viewState:Ce(t)})}(n,t)}),t.on("remove",function(){n.finalize(),t.__deck=null})),n.props.userData.mapboxVersion=function(e){var t=0,r=0;if(e.version){var n=e.version.split(".").slice(0,2).map(Number),i=he(n,2);t=i[0],r=i[1]}return{major:t,minor:r}}(t),t.__deck=n,t.on("render",function(){return function(e,t){var r=e.props.userData,n=r.mapboxLayers;if(r.isExternal){var i=Array.from(n,function(e){return e.id}),a=Se(e,function(e){var t=!0,r=!1,n=void 0;try{for(var a,o=i[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){if(De(a.value,e))return!1}}catch(s){r=!0,n=s}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}return!0});a.length>0&&(console.log("afterRender"),e._drawLayers("mapbox-repaint",{viewports:[Te(e,t,!1)],layers:a,clearCanvas:!1}))}e.props.userData.currentViewport=null}(n,t)}),n}function Ce(e){var t=e.getCenter();return{longitude:t.lng,latitude:t.lat,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}}function Te(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.props.userData.mapboxVersion;return new K.a(Object.assign({x:0,y:0,width:e.width,height:e.height},Ce(t),r?{nearZMultiplier:1===n.major&&n.minor>=3||n.major>=2?.02:1/(e.height||1)}:{nearZMultiplier:.1}))}function Se(e,t){return e.layerManager.getLayers().filter(t)}function De(e,t){for(var r=t;r;){if(r.id===e)return!0;r=r.parent}return!1}function ze(e){if(!e.props.userData.isExternal){var t=[];e.props.userData.mapboxLayers.forEach(function(e){var r=new(0,e.props.type)(e.props);t.push(r)}),e.setProps({layers:t})}}var Me=function(){function e(t){if(ue(this,e),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}return le(e,[{key:"onAdd",value:function(e,t){var r,n;this.map=e,this.deck=je({map:e,gl:t,deck:this.props.deck}),r=this.deck,n=this,r.props.userData.mapboxLayers.add(n),ze(r)}},{key:"onRemove",value:function(){var e,t;e=this.deck,t=this,e.props.userData.mapboxLayers.delete(t),ze(e)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&ze(this.deck)}},{key:"render",value:function(){!function(e,t,r){var n=e.props.userData.currentViewport;n||(n=Te(e,t,!0),e.props.userData.currentViewport=n),e._drawLayers("mapbox-repaint",{viewports:[n],layers:Se(e,function(e){return De(r.id,e)}),clearCanvas:!1})}(this.deck,this.map,this)}}]),e}();function Re(e,t,r){var n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r);return[n,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Ie=function(){function e(t){var r=t.getTileData,n=t.x,i=t.y,a=t.z,o=t.onTileLoad,s=t.onTileError;ue(this,e),this.x=n,this.y=i,this.z=a,this.bbox=function(e,t,r){var n=Re(e,t,r),i=he(n,2),a=i[0],o=i[1],s=Re(e+1,t+1,r),c=he(s,2),u=c[0];return[a,c[1],u,o]}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=r,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileLoad=o,this.onTileError=s}return le(e,[{key:"_loadData",value:function(){var e=this,t=this.x,r=this.y,n=this.z,i=this.bbox;return this.getTileData?Promise.resolve(this.getTileData({x:t,y:r,z:n,bbox:i})).then(function(t){return e._data=t,e._isLoaded=!0,e.onTileLoad(e),t}).catch(function(t){e._isLoaded=!0,e.onTileError(t)}):null}},{key:"isOverlapped",value:function(e){var t=this.x,r=this.y,n=this.z,i=Math.pow(2,e.z-n);return Math.floor(e.x/i)===t&&Math.floor(e.y/i)===r}},{key:"data",get:function(){return this._data||this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),e}(),Ae=256;function Ne(e){return e/Ae}function Fe(e,t){var r=e.x,n=e.y,i=e.z,a=Math.pow(2,i-t);return{x:Math.floor(r/a),y:Math.floor(n/a),z:t}}var qe=function(){function e(t){var r=t.getTileData,n=t.maxSize,i=t.maxZoom,a=t.minZoom,o=t.onTileLoad,s=t.onTileError;ue(this,e),this._getTileData=r,this._maxSize=n,this.onTileError=s,this.onTileLoad=o,this._cache=new Map,this._tiles=[],Number.isFinite(i)&&(this._maxZoom=Math.floor(i)),Number.isFinite(a)&&(this._minZoom=Math.ceil(a))}return le(e,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(e){var t=this._cache,r=this._getTileData,n=this._maxSize,i=this._maxZoom,a=this._minZoom;this._markOldTiles();var o=function(e,t,r){var n=Math.floor(e.zoom)+1;if(r&&n<r)return[];var i=function(e){var t=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([0,e.height]),e.unproject([e.width,e.height])];return[t.reduce(function(e,t){return e<t[0]?e:t[0]},180),t.reduce(function(e,t){return e<t[1]?e:t[1]},90),t.reduce(function(e,t){return e>t[0]?e:t[0]},-180),t.reduce(function(e,t){return e>t[1]?e:t[1]},-90)]}(e=new e.constructor(de({},e,{zoom:n-1}))),a=Object(te.a)([i[0],i[3]],e.scale).map(Ne),o=he(a,2),s=o[0],c=o[1],u=Object(te.a)([i[2],i[1]],e.scale).map(Ne),l=he(u,2),p=l[0],d=l[1];s=Math.floor(s),p=Math.ceil(p),c=Math.floor(c),d=Math.ceil(d);for(var y=[],f=s;f<p;f++)for(var h=c;h<d;h++)t&&n>t?y.push(Fe({x:f,y:h,z:n},t)):y.push({x:f,y:h,z:n});return y}(e,i,a);if(o&&0!==o.length){t.forEach(function(e){o.some(function(t){return e.isOverlapped(t)})&&(e.isVisible=!0)});for(var s=!1,c=0;c<o.length;c++){var u=o[c],l=u.x,p=u.y,d=u.z,y=this._getTile(l,p,d);y||((y=new Ie({getTileData:r,x:l,y:p,z:d,onTileLoad:this.onTileLoad,onTileError:this.onTileError})).isVisible=!0,s=!0);var f=this._getTileId(l,p,d);t.set(f,y)}if(s){this._resizeCache(n||5*o.length),this._tiles=Array.from(this._cache.values()).sort(function(e,t){return e.z-t.z})}}}},{key:"_resizeCache",value:function(e){var t=this._cache;if(t.size>e){var r=t[Symbol.iterator](),n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;if(t.size<=e)break;var u=c[0];c[1].isVisible||t.delete(u)}}catch(l){i=!0,a=l}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(e){e.isVisible=!1})}},{key:"_getTile",value:function(e,t,r){var n=this._getTileId(e,t,r);return this._cache.get(n)}},{key:"_getTileId",value:function(e,t,r){return r+"-"+e+"-"+t}},{key:"tiles",get:function(){return this._tiles}}]),e}(),Ze={renderSubLayers:{type:"function",value:function(){return null}},getTileData:{type:"function",value:function(){return Promise.resolve(null)}},onViewportLoaded:{type:"function",optional:!0,value:null},onTileError:{type:"function",value:function(e){return console.error(e)}},maxZoom:null,minZoom:0,maxCacheSize:null},Ve=function(e){function t(){return ue(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ye(t,e),le(t,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,r=e.context,n=e.changeFlags,i=this.state.tileCache;if(!i||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getTileData)){var a=t.getTileData,o=t.maxZoom,s=t.minZoom,c=t.maxCacheSize;i&&i.finalize(),i=new qe({getTileData:a,maxSize:c,maxZoom:o,minZoom:s,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileCache:i})}else n.updateTriggersChanged&&this.state.tileCache.tiles.forEach(function(e){e.layer=null});var u=r.viewport;if(n.viewportChanged&&"DEFAULT-INITIAL-VIEWPORT"!==u.id){var l=this.getLayerZoomLevel();i.update(u);var p=i.tiles.filter(function(e){return e.z===l});this.setState({isLoaded:!1,tiles:p}),this._onTileLoad()}}},{key:"_onTileLoad",value:function(){var e=this.props.onViewportLoaded,t=this.state.tiles,r=t.every(function(e){return e.isLoaded});this.state.isLoaded!==r&&(this.setState({isLoaded:r}),r&&e&&e(t.filter(function(e){return e._data}).map(function(e){return e._data})))}},{key:"_onTileError",value:function(e){this.props.onTileError(e),this._onTileLoad()}},{key:"getPickingInfo",value:function(e){var t=e.info,r=e.sourceLayer;return t.sourceLayer=r,t.tile=r.props.tile,t}},{key:"getLayerZoomLevel",value:function(){var e=Math.floor(this.context.viewport.zoom)+1,t=this.props,r=t.maxZoom,n=t.minZoom;return Number.isFinite(r)&&e>r?Math.floor(r):Number.isFinite(n)&&e<n?Math.ceil(n):e}},{key:"renderLayers",value:function(){var e=this,t=this.props,r=t.visible,n=t.opacity,i=t.decodeParams,a=t.renderSubLayers,o=this.getLayerZoomLevel();return this.state.tiles.map(function(t){var s=r&&t.isVisible&&(!e.state.isLoaded||t.z===o);return t.layer?t.layer.props.visible!==s?t.layer=t.layer.clone({visible:s}):t.layer.props.opacity!==n?t.layer=t.layer.clone({opacity:n}):t.layer.props.decodeParams&&(t.layer=t.layer.clone({decodeParams:i})):t.layer=a(de({},e.props,{id:e.id+"-"+t.x+"-"+t.y+"-"+t.z,data:t.data,visible:s,opacity:n,tile:t,zoom:o})),t.layer})}}]),t}(re.a);Ve.layerName="TileLayer",Ve.defaultProps=Ze;var Je,Ue=ae.d.fp64LowPart,Be=(pe(Je={},ie.a.TEXTURE_MIN_FILTER,ie.a.NEAREST),pe(Je,ie.a.TEXTURE_MAG_FILTER,ie.a.NEAREST),pe(Je,ie.a.TEXTURE_WRAP_S,ie.a.CLAMP_TO_EDGE),pe(Je,ie.a.TEXTURE_WRAP_T,ie.a.CLAMP_TO_EDGE),Je),Ye=function(e){function t(){return ue(this,t),fe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ye(t,e),le(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n\n  vTexCoord = texCoords;\n\n  picking_setPickingColor(vec3(0., 0., 1.));\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\n{decodeParams}\n\nuniform float opacity;\nuniform float zoom;\n\n\nvec4 decodeFunction(vec3 color, float alpha) {\n  {decodeFunction}\n  return vec4(color, alpha * opacity);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  // clear mask\n  if (bitmapColor == vec4(0., 0., 0., 1.)) {\n    discard;\n  }\n\n  // custom decode\n  gl_FragColor = decodeFunction(bitmapColor.rgb, bitmapColor.a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n".replace("{decodeParams}",Object.keys(this.props.decodeParams).map(function(e){return"uniform float "+e+";"}).join(" ")).replace("{decodeFunction}",this.props.decodeFunction||""),modules:["project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(12)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(12)}}),this.setState({numInstances:4})}},{key:"updateState",value:function(e){var t=e.props,r=e.oldProps;if(t.fp64!==r.fp64){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}t.image!==r.image&&this.loadTexture(t.image);var i=this.getAttributeManager();t.bounds!==r.bounds&&(this.setState({positions:this._getPositionsFromBounds(t.bounds)}),i.invalidate("positions"),i.invalidate("positions64xyLow"))}},{key:"finalizeState",value:function(){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_getPositionsFromBounds",value:function(e){var t=new Array(12);if(Number.isFinite(e[0]))t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[0],t[4]=e[3],t[5]=0,t[6]=e[2],t[7]=e[3],t[8]=0,t[9]=e[2],t[10]=e[1],t[11]=0;else for(var r=0;r<e.length;r++)t[3*r+0]=e[r][0],t[3*r+1]=e[r][1],t[3*r+2]=e[r][2]||0;return t}},{key:"_getModel",value:function(e){return e?new ae.b(e,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new ae.a({drawMode:ie.a.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,r=this.state,n=r.bitmapTexture,i=r.model,a=this.props,o=a.desaturate,s=a.transparentColor,c=a.tintColor,u=a.zoom,l=a.decodeParams,p=a.opacity;n&&i&&i.setUniforms(Object.assign({},t,de({bitmapTexture:n,desaturate:o,transparentColor:s,tintColor:c,zoom:u},l,{opacity:p}))).draw()}},{key:"loadTexture",value:function(e){var t=this;if("string"===typeof e&&(e=Object(oe.b)(e)),e instanceof Promise)e.then(function(e){return t.loadTexture(e)});else{var r=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof ae.c?this.setState({bitmapTexture:e}):(e instanceof Image||e instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new ae.c(r,{data:e,parameters:Be,mipmaps:!1})})}}},{key:"calculatePositions",value:function(e){var t=e.value,r=this.state.positions;t.set(r)}},{key:"calculatePositions64xyLow",value:function(e){var t=this.use64bitPositions();(e.constant=!t,t)?e.value.set(this.state.positions.map(Ue)):e.value=new Float32Array(4)}}]),t}(ee.a);Ye.layerName="DecodeLayer",Ye.defaultProps={image:null,bounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var We=function(e,t){var r=e.source,n=void 0===r?{}:r,i=e.render,a=void 0===i?{}:i,o=e.decodeParams,s=e.id,c=e.opacity,u=e.decodeFunction,l={id:s+"-raster",type:"raster",source:s},p=n.provider,d=a.layers,y=void 0===d?[l]:d,f={};if(f=u?{id:s,type:"custom",layers:[{id:s+"-raster-decode-bg",type:"background",paint:{"background-color":"transparent"}}].concat(me(n.tiles.map(function(t){return new Me({id:s+"-raster-decode",type:Ve,getTileData:function(e){return function(e,t){var r=e.x,n=e.y,i=e.z,a=t.replace("{z}",i).replace("{x}",r).replace("{y}",n);return fetch(a).then(function(e){return e.blob()}).then(function(e){var t=(e||{}).type;if("application/xml"!==t&&"text/xml"!==t&&"text/html"!==t){var r=URL.createObjectURL(e),n=new Image;return n.src=r,n}return!1})}(e,t)},renderSubLayers:function(e){var t=e.id,r=e.data,n=e.tile,i=e.visible,a=e.zoom,o=e.decodeParams,s=e.decodeFunction;return r&&r.src?new Ye({id:t,image:r.src,bounds:n.bbox,visible:i,zoom:a,decodeParams:o,decodeFunction:s,opacity:c}):null},minZoom:n.minzoom,maxZoom:n.maxzoom,opacity:e.opacity,decodeParams:o,decodeFunction:u})})))}:{id:s,type:"raster",source:de({type:"raster",tileSize:256},n),layers:Le(y.map(function(e){return de({},l,e)}),e)},p){var h=t[p.type];return new ve(function(t,r){h||r(new Error(p.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),h.call(void 0,e,f,t,r)})}return new ve(function(e,t){f?e(f):t(new Error("error in layer config"))})},He=function(e,t){var r=e.source,n=void 0===r?{}:r,i=e.render,a=void 0===i?{}:i,o=e.id,s=n.provider,c=a.layers,u=de({id:o,source:de({type:"vector"},n)},a,{layers:Le(c,e)});if(s){var l=t[s.type];return new ve(function(t,r){l||r(new Error(s.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),l.call(void 0,e,u,t,r)})}return new ve(function(e,t){u?e(u):t(new Error("error in layer config"))})},Ge=function(e,t){var r=e.source,n=void 0===r?{}:r,i=e.render,a=void 0===i?{}:i,o=e.id,s=n.provider,c=a.layers,u=de({id:o,source:de({type:"geojson"},n)},a,{layers:Le(c,e)});if(s){var l=t[s.type];return new ve(function(t,r){l||r(new Error(s.type+" provider is not supported. Try to add it to the providers method when you initialize layer-manager")),l.call(void 0,e,u,t,r)})}return new ve(function(e,t){u?e(u):t(new Error('"type" specified in layer spec doesn`t exist'))})},Xe=function(e){var t=e.source,r=void 0===t?{}:t,n=e.render,i=e.id,a=de({id:i,type:"raster",source:de({},r,{type:"video-tiled",tiles:["https://storage.googleapis.com/skydipper_materials/movie-tiles/EVI_TEST/{z}/{x}/{y}.mp4"],scheme:"xyz",tileSize:256,minzoom:1,maxzoom:4,playbackRate:.1})},n,{layers:[{id:i+"-raster",type:"raster",source:i}]});return new ve(function(e,t){a?e(a):t(new Error("error in layer config"))})},Qe=function(){function e(t,r){var n=this;ue(this,e),this.type={raster:We,vector:He,geojson:Ge,video:Xe},this.map=t,this.options=r,this.map.on("style.load",function(){n.getLayers().forEach(function(e){return n.add(e)})})}return le(e,[{key:"add",value:function(e){var t=this,r=e.mapLayer,n=this.getLayers();this.map&&r&&r.source&&r.id&&!this.map.getSource(r.id)&&this.map.addSource(r.id,r.source),r&&r.layers&&r.layers.forEach(function(r){var i=r.metadata,a="top"===(void 0===i?{}:i).position?null:t.getNextLayerId(e);t.map&&!t.map.getLayer(r.id)&&t.map.addLayer(r,a),n.forEach(function(){t.setZIndex()})})}},{key:"remove",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.mapLayer;r&&r.layers&&this.map&&this.map.style&&r.layers.forEach(function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)}),r&&this.map&&this.map.getSource(r.id)&&this.map.removeSource(r.id)}},{key:"getLayerByType",value:function(e){return this.type[e]}},{key:"getLayersOnMap",value:function(){return this.map.getStyle().layers}},{key:"getLayer",value:function(e){var t=e.mapLayer;return this.map?this.map.getSource(t.id):null}},{key:"getLayers",value:function(){var e=this.options.getLayers,t=e();return ce()(t,function(e){return e.decodeFunction})}},{key:"getNextLayerId",value:function(e){var t=e.zIndex,r=this.getLayers(),n=this.getLayersOnMap(),i=n&&n.length&&n.find(function(e){return e.id.includes("custom-layers")||e.id.includes("label")||e.id.includes("place")||e.id.includes("poi")}),a=ce()(r,function(e){return e.zIndex}).find(function(e){return e.zIndex>t&&(!e.mapLayer||!e.mapLayer.layers||!e.mapLayer.layers[0]||!e.mapLayer.layers[0].metadata||!e.mapLayer.layers[0].metadata.position)});if(!a||a&&!a.mapLayer)return i.id;var o=a.mapLayer.layers[0].id;return!!n.find(function(e){return o===e.id})?o:i.id}},{key:"setZIndex",value:function(){var e=this,t=this.getLayers(),r=this.getLayersOnMap();r.forEach(function(r){var n=r.id,i=r.metadata,a=void 0===i?{}:i,o=t.find(function(e){return n.includes(e.id)});if(o){var s="top"===a.position?null:e.getNextLayerId(o);e.map.moveLayer(n,s)}});var n=t.filter(function(e){return!!e.decodeFunction});return n&&this.map&&n.forEach(function(t){var n=t.mapLayer;if(n){var i=n.layers,a=i[0],o=i[1],s=r.find(function(e){return e.id===a.id}),c=e.map.getLayer(o.id);s&&c&&e.map.moveLayer(o.id,a.id)}}),!0}},{key:"setOpacity",value:function(e,t){var r=this,n={symbol:["icon","text"],circle:["circle","circle-stroke"]},i=e.render,a=e.mapLayer,o=e.decodeFunction,s=i.layers,c=void 0===s?[]:s;if(a.layers&&!o&&a.layers.forEach(function(e){var i=n[e.type]||[e.type],a=(c.find(function(t,r){return(t.id||e.source+"-"+t.type+"-"+r)===e.id})||{}).paint,o=void 0===a?{}:a;i.forEach(function(n){var i=o[n+"-opacity"],a=void 0!==i?i:1;r.map.setPaintProperty(e.id,n+"-opacity",a*t*.99)})}),o){var u=a.layers[1];u&&"function"===typeof u.setProps&&u.setProps({opacity:t})}}},{key:"setVisibility",value:function(e,t){var r=this,n=e.mapLayer;n&&n.layers&&this.map&&this.map.style&&n.layers.forEach(function(e){r.map.setLayoutProperty(e.id,"visibility",t?"visible":"none")})}},{key:"setSource",value:function(e){var t=e.id,r=e.source,n=r.type,i=r.data;this.map&&"geojson"===n&&i&&"string"!==typeof i&&this.map.getSource(t).setData(i);return this}},{key:"setRender",value:function(e){var t=this,r=e.mapLayer,n=e.render.layers,i=void 0===n?[]:n;if(!r||!i.length)return this;try{r.layers.forEach(function(e,r){var n=e.id,a=i[r]||i[0]||{},o=a.paint,s=void 0===o?{}:o,c=a.layout,u=void 0===c?{}:c,l=a.filter,p=void 0===l?null:l;t.map.setFilter(n,p),Object.keys(s).forEach(function(e){t.map.setPaintProperty(n,e,s[e])}),Object.keys(u).forEach(function(e){t.map.setLayoutProperty(n,e,u[e])})})}catch(a){console.error(a)}return this}},{key:"setParams",value:function(){return this}},{key:"setSQLParams",value:function(){return this}},{key:"setDecodeParams",value:function(e){var t=e.mapLayer,r=e.decodeParams;if(!t)return this;var n=t.layers[1];return n&&"function"===typeof n.setProps?n.setProps({decodeParams:r}):console.error("Layer is not present. You defined decodeParams but maybe you didn't define a decodeFunction"),this}},{key:"unmount",value:function(){this.map=null}}]),e}(),$e=r(85),Ke=[{id:"gain",name:"Tree cover gain",config:{type:"raster",source:{type:"raster",tiles:["https://earthengine.google.org/static/hansen_2013/gain_alpha/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{type:"basic",items:[{name:"Tree cover gain",color:"#6D6DE5"}]}},{id:"loss",name:"Tree cover loss",config:{type:"raster",source:{type:"raster",tiles:["https://storage.googleapis.com/wri-public/Hansen_16/tiles/hansen_world/v1/tc30/{z}/{x}/{y}.png"],minzoom:3,maxzoom:12}},legendConfig:{enabled:!0},decodeConfig:[{default:"2001-01-01",key:"startDate",required:!0},{default:"2018-12-31",key:"endDate",required:!0}],timelineConfig:{step:1,speed:250,interval:"years",dateFormat:"YYYY",trimEndDate:"2018-12-31",maxDate:"2018-12-31",minDate:"2001-01-01",canPlay:!0,railStyle:{background:"#DDD"},trackStyle:[{background:"#dc6c9a"},{background:"#982d5f"}]},decodeFunction:"\n      // values for creating power scale, domain (input), and range (output)\n      float domainMin = 0.;\n      float domainMax = 255.;\n      float rangeMin = 0.;\n      float rangeMax = 255.;\n\n      float exponent = zoom < 13. ? 0.3 + (zoom - 3.) / 20. : 1.;\n      float intensity = color.r * 255.;\n\n      // get the min, max, and current values on the power scale\n      float minPow = pow(domainMin, exponent - domainMin);\n      float maxPow = pow(domainMax, exponent);\n      float currentPow = pow(intensity, exponent);\n\n      // get intensity value mapped to range\n      float scaleIntensity = ((currentPow - minPow) / (maxPow - minPow) * (rangeMax - rangeMin)) + rangeMin;\n      // a value between 0 and 255\n      alpha = zoom < 13. ? scaleIntensity / 255. : color.g;\n\n      float year = 2000.0 + (color.b * 255.);\n      // map to years\n      if (year >= startYear && year <= endYear && year >= 2001.) {\n        color.r = 220. / 255.;\n        color.g = (72. - zoom + 102. - 3. * scaleIntensity / zoom) / 255.;\n        color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n      } else {\n        alpha = 0.;\n      }\n    "},{id:"protected-areas",name:"Protected areas",config:{type:"vector",source:{type:"vector",provider:{type:"carto",account:"wri-01",layers:[{options:{cartocss:"#wdpa_protected_areas {  polygon-opacity: 1.0; polygon-fill: #704489 }",cartocss_version:"2.3.0",sql:"SELECT * FROM wdpa_protected_areas"},type:"mapnik"}]}},render:{layers:[{type:"fill","source-layer":"layer0",paint:{"fill-color":"#5ca2d1","fill-opacity":1}},{type:"line","source-layer":"layer0",paint:{"line-color":"#000000","line-opacity":.1}}]}},paramsConfig:[],legendConfig:{type:"basic",items:[{name:"Protected areas",color:"#5ca2d1"}]}},{id:"mongabay-stories",name:"Mongabay stories",config:{type:"geojson",source:{type:"geojson",data:"https://wri-01.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20mongabay&format=geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:45},render:{metadata:{position:"top"},layers:[{id:"media-clusters",metadata:{position:"top"},type:"circle",filter:["has","point_count"],paint:{"circle-color":"#FFF","circle-stroke-width":2,"circle-stroke-color":"#CCC","circle-radius":12}},{id:"media-cluster-count",metadata:{position:"top"},type:"symbol",filter:["has","point_count"],layout:{"text-allow-overlap":!0,"text-ignore-placement":!0,"text-field":"{point_count_abbreviated}","text-size":12}},{id:"media",metadata:{position:"top"},type:"circle",filter:["!",["has","point_count"]],paint:{"circle-color":"#FFCC00","circle-stroke-width":1,"circle-stroke-color":"#333","circle-radius":5}}]}},paramsConfig:[],legendConfig:{type:"basic",items:[{name:"Mongabay stories",color:"#FFCC00"}]}}];r(554);function et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?et(r,!0).forEach(function(t){Object(s.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):et(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var rt=function(){var e=Object(n.useState)(Ke),t=Object(c.a)(e,2),r=t[0],a=t[1],o=Object(n.useState)(JSON.stringify(Ke,null,2)),u=Object(c.a)(o,2),p=u[0],d=u[1],y=Object(n.useState)({}),f=Object(c.a)(y,2),h=f[0],m=f[1],v=r.map(function(e){var t=e.id,r=e.paramsConfig,n=e.sqlConfig,i=e.decodeConfig,a=e.timelineConfig,o=h[t]||{},s=!!r&&g(r,o.params),c=!!n&&g(n,o.sqlParams),u=!!i&&g(i,tt({},a,{},o.decodeParams)),l=!!a&&tt({},a,{},g(r,o.params),{},g(i,o.decodeParams));return tt({id:t,slug:t,dataset:t,layers:[tt({active:!0},e,{},o,{params:s,sqlParams:c,decodeParams:u,timelineParams:l})]},o)}),b=function(e,t){m(tt({},h,Object(s.a)({},e.id,tt({},h[e.id],{visibility:t}))))},w=function(e,t){m(tt({},h,Object(s.a)({},e.id,tt({},h[e.id],{opacity:t}))))},O=function(e,t){var r=t.id,n=t.decodeConfig;m(tt({},h,Object(s.a)({},r,tt({},h[r],{},n&&{decodeParams:{startDate:e[0],endDate:e[1],trimEndDate:e[2]}},{},!n&&{params:{startDate:e[0],endDate:e[1]}}))))};return i.a.createElement("div",{className:"c-app"},i.a.createElement($e.Icons,null),i.a.createElement("div",{className:"c-main"},i.a.createElement(N,null,i.a.createElement(q.a,{mode:"json",theme:"github",value:p,onChange:function(e){d(e);try{var t=JSON.parse(e);a(t)}catch(r){}},tabSize:2,width:"100%",height:"100%",wrapEnabled:!0,showPrintMargin:!1,editorProps:{$blockScrolling:!0},debounceChangePeriod:500})),i.a.createElement("div",{className:"c-map-container"},i.a.createElement(A,{mapboxApiAccessToken:"pk.eyJ1IjoibGF5ZXItbWFuYWdlciIsImEiOiJjazA2dTJnMG0zc3lwM251dGM0aXhiYTVxIn0.AaoErQTRezfQshqnEKIg8A",minZoom:2,mapOptions:{fadeDuration:0}},function(e){return i.a.createElement(Z.LayerManager,{map:e,plugin:Qe,providers:{"carto-sql-points":function(e,t,r,n){var i=e.source.provider;ke("get",i.url,i.options,e).then(function(e){return r(tt({},t,{source:tt({},l()(t.source,"provider"),{data:{type:"FeatureCollection",features:e.rows.map(function(e){return{type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.lon,e.lat]}}})}})}))}).catch(function(e){n(e)})}}},r.map(function(e){var t=e.id,r=e.paramsConfig,n=e.sqlConfig,a=e.decodeConfig,o=e.timelineConfig,s=e.decodeFunction,c=h[t]||{},u=tt({},e,{},e.config,{},c,{},!!r&&{params:g(r,tt({},c.params))},{},!!n&&{sqlParams:g(n,tt({},c.sqlParams))},{},!!a&&{decodeParams:g(a,tt({},o,{},c.decodeParams)),decodeFunction:s});return i.a.createElement(Z.Layer,Object.assign({key:e.id},u))}))}),i.a.createElement("div",{className:"c-legend"},i.a.createElement($e.Legend,{maxHeight:"65vh",collapsable:!1,sortable:!1,onChangeOrder:function(e){console.log("onChangeOrder",e)}},v.map(function(e,t){return i.a.createElement($e.LegendListItem,{index:t,key:e.slug,layerGroup:e,toolbar:i.a.createElement($e.LegendItemToolbar,null,i.a.createElement($e.LegendItemButtonOpacity,{trackStyle:{background:"#FFCC00"},handleStyle:{background:"#FFCC00"}}),i.a.createElement($e.LegendItemButtonVisibility,null)),onChangeVisibility:b,onChangeOpacity:w},i.a.createElement($e.LegendItemTypes,null),i.a.createElement($e.LegendItemTimeStep,{defaultStyles:{handleStyle:{backgroundColor:"white",borderRadius:"50%",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.29)",border:"0px",zIndex:2},railStyle:{backgroundColor:"#d6d6d9"},dotStyle:{visibility:"hidden",border:"0px"}},handleChange:O}))}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(555);o.a.render(i.a.createElement(rt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[322,1,2]]]);
//# sourceMappingURL=main.536fd243.chunk.js.map
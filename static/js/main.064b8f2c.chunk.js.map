{"version":3,"sources":["../../dist/components/index.js","utils.js","components/map/index.js","components/sidebar/index.js","components/sidebar/component.js","../../dist/layer-manager.esm.js","layers.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","isEqual","isEmpty","react","PropTypes","compact","hasOwnProperty","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_extends","assign","arguments","source","call","inherits","subClass","superClass","create","constructor","value","setPrototypeOf","__proto__","objectWithoutProperties","obj","keys","indexOf","possibleConstructorReturn","self","ReferenceError","handleCallback","resolve","reject","callback","r","e","CancelablePromise","executor","this","_promise","Promise","_canceled","iterable","y","n","all","then","race","success","error","_this","p","cancel","undefined","errorCallback","catch","LayerModel","layerSpec","opacity","visibility","render","changedAttributes","prevData","nextData","set","forEach","k","LayerManager","map","Plugin","plugin","layers","promises","options","getLayers","bind","property","console","warn","layer","layerOptions","zIndex","interactivity","onAfterAdd","layerModel","id","find","l","push","requestLayer","changedProps","getLayerModel","mapLayer","update","params","sqlParams","decodeParams","setOpacity","setVisibility","setZIndex","setSource","setRender","setParams","setSqlParams","setDecodeParams","slice","requestCancel","remove","filter","type","provider","method","getLayerByType","add","Error","layerModelId","unmount","LayerManager$1","_PureComponent","LayerManager$$1","getPrototypeOf","layerManager","_this2","children","Children","count","child","cloneElement","PureComponent","propTypes","shape","isRequired","func","oneOfType","arrayOf","node","defaultProps","substitution","originalStr","str","replace","RegExp","concatenation","sql","Array","isArray","v","join","startsWith","Layer","_ref","_temp","_len","args","_key","apply","concat","_this$props","sourceParsed","parse","JSON","stringify","renderParsed","_this$props2","_this$props3","prevProps","prevSource","prevRender","prevParams","prevSqlParams","prevDecodeParams","prevOpacity","prevVisibility","prevZIndex","_props","prevSourceParsed","prevRenderParsed","sourceType","data","t","_renderParsed$layers","_prevRenderParsed$lay","prevLayers","string","number","bool","getSource","Components","factory","dateDiffInDays","startDate","endDate","a","Date","b","utc1","UTC","getFullYear","getMonth","getDate","utc2","Math","floor","getDayRange","minDate","maxDate","minDateTime","maxDateTime","numberOfDays","startDateTime","endDateTime","activeStartDay","activeEndDay","startDayIndex","endDayIndex","getParams","config","defaultParams","reduce","acc","default","newParams","trimEndDate","maxAbsoluteDate","start","end","trim","startYear","moment","year","startMonth","month","startDay","dayOfYear","endYear","endMonth","endDay","trimEndYear","trimEndMonth","trimEndDay","DEFAULT_VIEWPORT","zoom","lat","lng","Map","events","state","viewport","flying","loaded","onLoad","bounds","setState","bbox","fitBounds","mapContainer","onViewportChange","onResize","newViewport","onMoveEnd","bearing","getBearing","pitch","getPitch","getZoom","getCenter","latitude","longitude","width","offsetWidth","height","offsetHeight","WebMercatorViewport","transitionDuration","transitionInterruption","TRANSITION_EVENTS","UPDATE","setTimeout","prevViewport","prevBounds","stateViewport","customClass","dragPan","getCursor","dragRotate","scrollZoom","touchZoom","touchRotate","doubleClickZoom","mapboxProps","ref","className","classnames","getMap","transitionInterpolator","FlyToInterpolator","transitionEasing","easeCubic","Component","isHovering","isDragging","SidebarComponent","React","arr","Symbol","iterator","_arr","_n","_d","_e","_s","_i","next","done","err","sliceIterator","toConsumableArray","arr2","from","checkPluginProperties","headers","get$1","url","get","layerTpl","version","stat_tag","apiParams","encodeURIComponent","api_key","apiParamsString","account","layerRequest","layerRequestSource","cancelToken","token","res","status","getVectorStyleLayers","vectorLayers","vectorLayersParsed","vectorLayer","_vectorLayer$paint","paint","opacityPaintStyles","symbol","circle","name","currentProperty","filteredPaintProperties","entries","_ref2","getDeckInstance","gl","deck","__deck","customRender","_customRender","deckProps","useDevicePixels","triggerRepaint","parameters","depthMask","depthTest","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","blendEquation","FUNC_ADD","userData","isExternal","mapboxLayers","Set","setProps","viewState","getViewState","on","onMapMove","finalize","mapboxVersion","major","minor","_map$version$split$sl","split","Number","_map$version$split$sl2","getMapboxVersion","_deck$props$userData","mapboxLayerIds","deckLayer","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","shouldDrawLayer","return","log","_drawLayers","viewports","getViewport","clearCanvas","currentViewport","afterRender","_map$getCenter","useMapboxProjection","x","nearZMultiplier","layerFilter","layerInstance","parent","updateLayers","LayerType","MapboxLayer","renderingMode","delete","drawLayer","tile2latLng","z","pow","PI","atan","exp","Tile","getTileData","onTileLoad","onTileError","_tile2latLng","_tile2latLng2","west","north","_tile2latLng3","_tile2latLng4","east","tile2boundingBox","isVisible","_data","_isLoaded","_loader","_loadData","buffers","tile","m","TILE_SIZE","pixelsToTileIndex","getAdjustedTileIndex","adjustedZ","TileCache","maxSize","maxZoom","minZoom","_getTileData","_maxSize","_cache","_tiles","isFinite","_maxZoom","_minZoom","ceil","clear","_markOldTiles","tileIndices","corners","unproject","minLng","minLat","maxLng","maxLat","getBoundingBox","_lngLatToWorld$map","scale","_lngLatToWorld$map2","minX","minY","_lngLatToWorld$map3","_lngLatToWorld$map4","maxX","maxY","indices","getTileIndices","cachedTile","some","isOverlapped","changed","tileIndex","_getTile","tileId","_getTileId","_resizeCache","values","sort","t1","t2","size","renderSubLayers","onViewportLoaded","optional","maxCacheSize","TileLayer","_CompositeLayer","tiles","isLoaded","changeFlags","somethingChanged","context","tileCache","updateTriggersChanged","_onTileLoad","_onTileError","viewportChanged","getLayerZoomLevel","currTiles","allCurrTilesLoaded","every","_ref3","info","sourceLayer","_props2","visible","clone","layerName","_DEFAULT_TEXTURE_PARA","fp64LowPart","DEFAULT_TEXTURE_PARAMETERS","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","_Layer","DecodeLayer","vs","fs","decodeFunction","modules","getAttributeManager","positions","calculatePositions","Float32Array","positions64xyLow","calculatePositions64xyLow","numInstances","oldProps","fp64","model","_getModel","invalidateAll","image","loadTexture","attributeManager","_getPositionsFromBounds","invalidate","object","receiver","Function","desc","getOwnPropertyDescriptor","getter","bitmapTexture","getShaders","shaderCache","geometry","drawMode","TRIANGLE_FAN","vertexCount","attributes","texCoords","isInstanced","uniforms","_state","desaturate","transparentColor","tintColor","setUniforms","draw","Image","HTMLCanvasElement","mipmaps","attribute","isFP64","use64bitPositions","constant","compare","min","max","RasterLayer","_layerModel$source","_layerModel$render","DEFAULT_RASTER_OPTIONS","_render$layers","mapSource","fetch","response","blob","src","URL","createObjectURL","subLayerId","decodeParamsSub","decodeFunctionSub","minzoom","maxzoom","tileSize","tileUrl","cdn_url","templates","https","layergroupid","VectorLayer","GeoJsonLayer","layerWithData","VideoLayer","scheme","playbackRate","PluginMapboxGL","raster","vector","geojson","video","allLayers","addSource","_l$metadata","metadata","nextLayerId","position","getNextLayerId","getLayer","addLayer","_this3","style","removeLayer","removeSource","getStyle","layersOnMap","getLayersOnMap","customLayer","includes","nextLayer","_this4","_l$metadata2","ly","moveLayer","decodeLayers","parentLayer","childLayer","parentLayerOnMap","childLayerOnMap","_this5","PAINT_STYLE_NAMES","paintStyleNames","_ref$paint","paintOpacity","setPaintProperty","_this6","setLayoutProperty","setData","_this7","_render$layers2","renderLayers","rl","_rl$paint","_rl$layout","layout","_rl$filter","setFilter","legendConfig","items","color","enabled","decodeConfig","required","timelineConfig","step","speed","interval","dateFormat","canPlay","railStyle","background","trackStyle","cartocss","cartocss_version","paramsConfig","App","useState","DEFAULT_LAYERS","setLayers","layersJson","setLayersJson","layersSettings","setLayersSettings","layerGroups","sqlConfig","lSettings","timelineParams","slug","dataset","active","onChangeVisibility","onChangeOpacity","onChangeLayerDate","dates","mode","theme","onChange","json","newLayers","tabSize","wrapEnabled","showPrintMargin","editorProps","$blockScrolling","debounceChangePeriod","mapboxApiAccessToken","process","mapStyle","PluginMapboxGl","maxHeight","collapsable","sortable","onChangeOrder","ids","layerGroup","index","toolbar","handleStyle","defaultStyles","backgroundColor","borderRadius","boxShadow","border","dotStyle","handleChange","Boolean","window","location","hostname","match","ReactDOM","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"2FACiEA,EAAOC,QAC/D,SAAUC,EAASC,EAASC,EAAOC,EAAWC,GACrD,aAEAJ,EAAUA,GAAWA,EAAQK,eAAe,WAAaL,EAAiB,QAAIA,EAC9EC,EAAUA,GAAWA,EAAQI,eAAe,WAAaJ,EAAiB,QAAIA,EAC9EE,EAAYA,GAAaA,EAAUE,eAAe,WAAaF,EAAmB,QAAIA,EACtFC,EAAUA,GAAWA,EAAQC,eAAe,WAAaD,EAAiB,QAAIA,EAE9E,IAAIE,EAAiB,SAAwBC,EAAUC,GACrD,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,sCAIpBC,EAAc,WAChB,SAASC,EAAiBC,EAAQC,GAChC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CACrC,IAAIE,EAAaH,EAAMC,GACvBE,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAIlD,OAAO,SAAUR,EAAae,EAAYC,GAGxC,OAFID,GAAYZ,EAAiBH,EAAYiB,UAAWF,GACpDC,GAAab,EAAiBH,EAAagB,GACxChB,GAdO,GAkBdkB,EAAWN,OAAOO,QAAU,SAAUf,GACxC,IAAK,IAAIE,EAAI,EAAGA,EAAIc,UAAUb,OAAQD,IAAK,CACzC,IAAIe,EAASD,UAAUd,GAEvB,IAAK,IAAIQ,KAAOO,EACVT,OAAOK,UAAUpB,eAAeyB,KAAKD,EAAQP,KAC/CV,EAAOU,GAAOO,EAAOP,IAK3B,OAAOV,GAGLmB,EAAW,SAAkBC,EAAUC,GACzC,GAA0B,oBAAfA,GAA4C,OAAfA,EACtC,MAAM,IAAIxB,UAAU,kEAAoEwB,GAG1FD,EAASP,UAAYL,OAAOc,OAAOD,GAAcA,EAAWR,UAAW,CACrEU,YAAa,CACXC,MAAOJ,EACPf,YAAY,EACZE,UAAU,EACVD,cAAc,KAGde,IAAYb,OAAOiB,eAAiBjB,OAAOiB,eAAeL,EAAUC,GAAcD,EAASM,UAAYL,IAGzGM,EAA0B,SAAiCC,EAAKC,GAClE,IAAI7B,EAAS,GAEb,IAAK,IAAIE,KAAK0B,EACRC,EAAKC,QAAQ5B,IAAM,GAClBM,OAAOK,UAAUpB,eAAeyB,KAAKU,EAAK1B,KAC/CF,EAAOE,GAAK0B,EAAI1B,IAGlB,OAAOF,GAGL+B,EAA4B,SAAmCC,EAAMd,GACvE,IAAKc,EACH,MAAM,IAAIC,eAAe,6DAG3B,OAAOf,GAAyB,kBAATA,GAAqC,oBAATA,EAA8Bc,EAAPd,GAGxEgB,EAAiB,SAAwBC,EAASC,EAAQC,EAAUC,GACtE,IACEH,EAAQE,EAASC,IACjB,MAAOC,GACPH,EAAOG,KAIPC,EAAoB,WA+BtB,SAASA,EAAkBC,GACzB/C,EAAegD,KAAMF,GACrBE,KAAKC,SAAW,IAAIC,QAAQH,GAC5BC,KAAKG,WAAY,EAkDnB,OAnFA/C,EAAY0C,EAAmB,KAAM,CAAC,CACpC9B,IAAK,MACLc,MAAO,SAAasB,GAClB,OAAO,IAAIN,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQK,IAAIH,GAAUI,KAAKH,EAAGC,OAGjC,CACDtC,IAAK,OACLc,MAAO,SAAcsB,GACnB,OAAO,IAAIN,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQO,KAAKL,GAAUI,KAAKH,EAAGC,OAGlC,CACDtC,IAAK,SACLc,MAAO,SAAgBA,GACrB,OAAO,IAAIgB,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQR,OAAOZ,GAAO0B,KAAKH,EAAGC,OAGjC,CACDtC,IAAK,UACLc,MAAO,SAAiBA,GACtB,OAAO,IAAIgB,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQT,QAAQX,GAAO0B,KAAKH,EAAGC,SAWrClD,EAAY0C,EAAmB,CAAC,CAC9B9B,IAAK,OACLc,MAAO,SAAc4B,EAASC,GAC5B,IAAIC,EAAQZ,KAERa,EAAI,IAAIf,EAAkB,SAAUL,EAASC,GAC/CkB,EAAMX,SAASO,KAAK,SAAUZ,GACxBgB,EAAMT,WACRU,EAAEC,SAGAJ,IAAYE,EAAMT,UACpBX,EAAeC,EAASC,EAAQgB,EAASd,GAEzCH,EAAQG,IAET,SAAUA,GACPgB,EAAMT,WACRU,EAAEC,SAGAH,IAAUC,EAAMT,UAClBX,EAAeC,EAASC,EAAQiB,EAAOf,GAEvCF,EAAOE,OAIb,OAAOiB,IAER,CACD7C,IAAK,QACLc,MAAO,SAAgB6B,GACrB,OAAOX,KAAKQ,UAAKO,EAAWJ,KAE7B,CACD3C,IAAK,SACLc,MAAO,SAAgBkC,GAOrB,OANAhB,KAAKG,WAAY,EAEba,GACFhB,KAAKC,SAASgB,MAAMD,GAGfhB,SAGJF,EApFe,GAuFpBoB,EAAa,WACf,SAASA,IACP,IAAIC,EAAY7C,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GACpFtB,EAAegD,KAAMkB,GACrBlB,KAAKoB,QAAU,EACfpB,KAAKqB,YAAa,EAClBrB,KAAKzB,OAAS,GACdyB,KAAKsB,OAAS,GACdxD,OAAOO,OAAO2B,KAAMmB,EAAW,CAC7BI,kBAAmB,KAmCvB,OA/BAnE,EAAY8D,EAAY,CAAC,CACvBlD,IAAK,MACLc,MAAO,SAAgBd,GACrB,OAAOgC,KAAKhC,KAEb,CACDA,IAAK,MACLc,MAAO,SAAgBd,EAAKc,GAE1B,OADAkB,KAAKhC,GAAOc,EACLkB,OAER,CACDhC,IAAK,SACLc,MAAO,SAAgBqC,GACrB,IAAIP,EAAQZ,KAERwB,EAAWpD,EAAS,GAAI4B,MAExByB,EAAWrD,EAAS,GAAI+C,GAG5BnB,KAAK0B,IAAI,oBAAqB,IAC9B5D,OAAOqB,KAAKsC,GAAUE,QAAQ,SAAUC,GACjClF,EAAQ8E,EAASI,GAAIH,EAASG,MACjChB,EAAMW,kBAAkBK,GAAKH,EAASG,GAEtChB,EAAMc,IAAIE,EAAGH,EAASG,WAKvBV,EA5CQ,GAgEbW,EAAe,WACjB,SAASA,EAAaC,EAAKC,GAlB7B,IAA+BC,EAmB3BhF,EAAegD,KAAM6B,GACrB7B,KAAK8B,IAAMA,EACX9B,KAAKiC,OAAS,GACdjC,KAAKkC,SAAW,GAChBlC,KAAKmC,QAAU,CACbC,UAAWpC,KAAKoC,UAAUC,KAAKrC,OAEjCA,KAAKgC,OAAS,IAAID,EAAO/B,KAAK8B,IAAK9B,KAAKmC,UA1BbH,EA2BLhC,KAAKgC,UAzBF,CAAC,MAAO,SAAU,gBAAiB,aAAc,YAAa,YAAa,YAAa,YAAa,eAAgB,kBAAmB,kBAC9IL,QAAQ,SAAUW,GAC9BN,EAAOM,IACVC,QAAQ5B,MAAM,OAAS2B,EAAW,qDAGX,CAAC,sBACPX,QAAQ,SAAUW,GACjCN,EAAOM,IACTC,QAAQC,KAAK,OAASF,EAAW,wDAoOvC,OA3MAlF,EAAYyE,EAAc,CAAC,CACzB7D,IAAK,MACLc,MAAO,SAAa2D,GAClB,IAAIC,EAAepE,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,CACrF8C,QAAS,EACTC,YAAY,EACZsB,OAAQ,EACRC,cAAe,MAEbC,EAAavE,UAAU,GAE3B,GAAqB,qBAAVmE,EAET,OADAF,QAAQ5B,MAAM,qBACPX,KAGT,IAAI8C,EAAa,IAAI5B,EAAW9C,EAAS,GAAIqE,EAAOC,IAChDK,EAAKD,EAAWC,GAEpB,OAAI/C,KAAKiC,OAAOe,KAAK,SAAUC,GAC7B,OAAOA,EAAEF,KAAOA,IAET/C,KAAKiC,QAGdjC,KAAKiC,OAAOiB,KAAKJ,GACjB9C,KAAKmD,aAAaL,EAAYD,GACvB7C,KAAKiC,UAOb,CACDjE,IAAK,SACLc,MAAO,SAAgBiE,EAAIK,GACzB,IAAIN,EAAa9C,KAAKqD,cAAcN,GACpC,GAAKD,GAAeA,EAAWQ,SAA/B,CACAR,EAAWS,OAAOH,GAClB,IAAIhC,EAAUgC,EAAahC,QACvBC,EAAa+B,EAAa/B,WAC1BsB,EAASS,EAAaT,OACtBpE,EAAS6E,EAAa7E,OACtB+C,EAAS8B,EAAa9B,OACtBkC,EAASJ,EAAaI,OACtBC,EAAYL,EAAaK,UACzBC,EAAeN,EAAaM,aAET,qBAAZtC,GACTpB,KAAKgC,OAAO2B,WAAWb,EAAY1B,GAGX,qBAAfC,GACTrB,KAAKgC,OAAO4B,cAAcd,EAAYzB,GAGlB,qBAAXsB,GACT3C,KAAKgC,OAAO6B,UAAUf,EAAYH,GAG/BhG,EAAQ4B,IACXyB,KAAKgC,OAAO8B,UAAUhB,GAGnBnG,EAAQ2E,IACXtB,KAAKgC,OAAO+B,UAAUjB,GAGnBnG,EAAQ6G,IACXxD,KAAKgC,OAAOgC,UAAUlB,GAGnBnG,EAAQ8G,IACXzD,KAAKgC,OAAOiC,aAAanB,GAGtBnG,EAAQ+G,IACX1D,KAAKgC,OAAOkC,gBAAgBpB,MAQ/B,CACD9E,IAAK,SACLc,MAAO,SAAgBiE,GACrB,IAAId,EAASjC,KAAKiC,OAAOkC,MAAM,GAC/BnE,KAAKoE,cAAcrB,GACnB,IAAID,EAAa9C,KAAKqD,cAAcN,GAEhCD,GACF9C,KAAKgC,OAAOqC,OAAOvB,GAGrB9C,KAAKiC,OAASA,EAAOqC,OAAO,SAAUrB,GACpC,OAAOA,EAAEF,KAAOA,MAGnB,CACD/E,IAAK,YACLc,MAAO,WACL,OAAOkB,KAAKiC,SAEb,CACDjE,IAAK,gBACLc,MAAO,SAAuBiE,GAC5B,OAAO/C,KAAKiC,OAAOe,KAAK,SAAUC,GAChC,OAAOA,EAAEF,KAAOA,MASnB,CACD/E,IAAK,aACLc,MAAO,SAAoBiE,EAAI3B,GAC7B,IAAI0B,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO2B,WAAWb,EAAY1B,KAQpC,CACDpD,IAAK,gBACLc,MAAO,SAAuBiE,EAAI1B,GAChC,IAAIyB,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO4B,cAAcd,EAAYzB,KAQvC,CACDrD,IAAK,YACLc,MAAO,SAAmBiE,EAAIJ,GAC5B,IAAIG,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO6B,UAAUf,EAAYH,KAEnC,CACD3E,IAAK,eACLc,MAAO,SAAsBgE,EAAYD,GACvC,IAAIjC,EAAQZ,KAERuE,EAAOzB,EAAWyB,KAClBC,EAAW1B,EAAW0B,SACtBC,EAASzE,KAAKgC,OAAO0C,eAAeH,GAExC,OAAKE,GAMLzE,KAAKoE,cAActB,EAAWC,IAG9B/C,KAAKkC,SAASY,EAAWC,IAAM0B,EAAOjG,KAAKwB,KAAM8C,GAAYtC,KAAK,SAAUiC,GAC3D7B,EAAMsB,SAASY,EAAWC,IAAI5C,YAG3C2C,EAAWpB,IAAI,WAAYe,GAE3B7B,EAAMoB,OAAO2C,IAAI7B,EAAYlC,EAAMqB,QAEnCrB,EAAMoB,OAAO6B,UAAUf,EAAYA,EAAWH,QAE9C/B,EAAMoB,OAAO2B,WAAWb,EAAYA,EAAW1B,SAE/CR,EAAMoB,OAAO4B,cAAcd,EAAYA,EAAWzB,YAElDT,EAAMoB,OAAO+B,UAAUjB,GAEvBD,EAAWC,MAGR9C,OA3BLA,KAAKkC,SAASY,EAAWC,IAAMjD,EAAkBJ,OAAO,IAAIkF,MAAMJ,EAAW,qCACtE,KA4BV,CACDxG,IAAK,gBACLc,MAAO,SAAuB+F,GAExB7E,KAAKkC,SAAS2C,IAAiB7E,KAAKkC,SAAS2C,GAAc/D,QAC7Dd,KAAKkC,SAAS2C,GAAc/D,WAG/B,CACD9C,IAAK,UACLc,MAAO,WACLkB,KAAK8B,IAAM,KACX9B,KAAKgC,OAAO8C,cAGTjD,EA9NU,GAiOfkD,EAAiB,SAAUC,GAG7B,SAASC,EAAgB1H,GACvBP,EAAegD,KAAMiF,GAErB,IAAIrE,EAAQvB,EAA0BW,MAAOiF,EAAgBjG,WAAalB,OAAOoH,eAAeD,IAAkBzG,KAAKwB,KAAMzC,IAEzHuE,EAAMvE,EAAMuE,IACZE,EAASzE,EAAMyE,OAEnB,OADApB,EAAMuE,aAAe,IAAItD,EAAaC,EAAKE,GACpCpB,EA2BT,OArCAnC,EAASwG,EAAiBD,GAa1B5H,EAAY6H,EAAiB,CAAC,CAC5BjH,IAAK,uBACLc,MAAO,WACLkB,KAAKmF,aAAaL,YAEnB,CACD9G,IAAK,SACLc,MAAO,WACL,IAAIsG,EAASpF,KAETqF,EAAWrF,KAAKzC,MAAM8H,SAE1B,OAAIA,GAAYzI,EAAM0I,SAASC,MAAMF,GAC5BzI,EAAM0I,SAASxD,IAAIuD,EAAU,SAAUG,EAAOhI,GACnD,OAAOgI,GAAS5I,EAAM6I,aAAaD,EAAO,CACxCL,aAAcC,EAAOD,aACrBxC,OAAQ6C,EAAMjI,MAAMoF,QAAU,IAAOnF,MAKpC,SAGJyH,EAtCY,CAuCnBrI,EAAM8I,eAERX,EAAeY,UAAY,CACzB7D,IAAKjF,EAAU+I,MAAM,IAAIC,WACzB7D,OAAQnF,EAAUiJ,KAAKD,WACvBR,SAAUxI,EAAUkJ,UAAU,CAAClJ,EAAUmJ,QAAQnJ,EAAUoJ,MAAOpJ,EAAUoJ,QAE9ElB,EAAemB,aAAe,CAC5Bb,SAAU,IASZ,IAAIc,EAAe,SAAsBC,GACvC,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7E+H,EAAMD,EAQV,OAPAtI,OAAOqB,KAAKqE,GAAQ7B,QAAQ,SAAU3D,GACT,kBAAhBwF,EAAOxF,IAA4C,mBAAhBwF,EAAOxF,KACnDqI,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,MAAQvI,EAAM,MAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,MAASvI,EAAM,MAAQ,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,MAAQvI,EAAM,MAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAQvI,EAAM,KAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,KAGtWqI,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,IAAMvI,EAAM,IAAK,KAAMwF,EAAOxF,MAE/GqI,GAULG,EAAgB,SAAuBJ,GACzC,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7E+H,EAAMD,EACNK,OAAM,EAsBV,OArBA3I,OAAOqB,KAAKqE,GAAQ7B,QAAQ,SAAU3D,GAiBAyI,GAhBpCA,EAAM,GAAK3J,EAAQgB,OAAOqB,KAAKqE,EAAOxF,IAAM8D,IAAI,SAAUF,GACxD,IAAI9C,EAAQ0E,EAAOxF,GAAK4D,GAExB,OAAI8E,MAAMC,QAAQ7H,IAAYA,EAAMrB,OAI3BmE,EAAI,QAHO9C,EAAMgD,IAAI,SAAU8E,GACpC,MAAoB,kBAANA,EAAiB,IAAOA,EAAI,IAAOA,IAElBC,KAAK,MAAQ,KAG3CH,MAAMC,QAAQ7H,IAAUA,EACH,kBAAVA,EAAqB8C,EAAI,OAAU9C,EAAQ,IAAO8C,EAAI,MAAQ9C,EAGvE,QACL+H,KAAK,WACE7I,EAAI8I,WAAW,SAAgB,SAAWL,EAAaA,GAAOzI,EAAI8I,WAAW,OAAc,OAASL,EAAe,GAE9HJ,GADAA,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMyI,IAC5CH,QAAQ,IAAIC,OAAO,IAAMvI,EAAM,IAAK,KAAMyI,KAE/CJ,GAULC,EAAU,SAAiBF,GAC7B,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7EmF,EAAYnF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAChF+H,EAAMD,EAOV,MALmB,kBAARC,IACTA,EAAMF,EAAaE,EAAK7C,GACxB6C,EAAMG,EAAcH,EAAK5C,IAGpB4C,GAGLU,EAAQ,SAAU/B,GAGpB,SAAS+B,IACP,IAAIC,EAEAC,EAAOrG,EAEX5D,EAAegD,KAAM+G,GAErB,IAAK,IAAIG,EAAO5I,UAAUb,OAAQ0J,EAAOT,MAAMQ,GAAOE,EAAO,EAAGA,EAAOF,EAAME,IAC3ED,EAAKC,GAAQ9I,UAAU8I,GAGzB,OAAeH,EAASrG,EAAQvB,EAA0BW,MAAOgH,EAAOD,EAAM/H,WAAalB,OAAOoH,eAAe6B,IAAQvI,KAAK6I,MAAML,EAAM,CAAChH,MAAMsH,OAAOH,KAAiBvG,EAAM+D,IAAM,WACnL,IAAI4C,EAAc3G,EAAMrD,MACpB4H,EAAeoC,EAAYpC,aAC3BtC,EAAa0E,EAAY1E,WACzBtF,EAAQ0B,EAAwBsI,EAAa,CAAC,eAAgB,eAC9DhJ,EAAShB,EAAMgB,OACf+C,EAAS/D,EAAM+D,OACfkC,EAASjG,EAAMiG,OACfC,EAAYlG,EAAMkG,UAClB+D,GAAgC,IAAjBjJ,EAAOkJ,MAAkBlJ,EAASmJ,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUpJ,GAASiF,EAAQC,IACpGmE,GAAgC,IAAjBtG,EAAOmG,MAAkBnG,EAASoG,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUrG,GAASkC,EAAQC,IACxG0B,EAAaR,IAAIvG,EAAS,GAAIb,EAAO,CACnCgB,OAAQiJ,EACRlG,OAAQsG,IACN,GAAI/E,IACPjC,EAAM2C,OAAS,SAAUH,GAC1B,IAAIyE,EAAejH,EAAMrD,MACrB4H,EAAe0C,EAAa1C,aAC5BpC,EAAK8E,EAAa9E,GACtBoC,EAAa5B,OAAOR,EAAIK,IACvBxC,EAAMyD,OAAS,WAChB,IAAIyD,EAAelH,EAAMrD,MACrB4H,EAAe2C,EAAa3C,aAC5BpC,EAAK+E,EAAa/E,GACtBoC,EAAad,OAAOtB,IACX1D,EAA0BuB,EAAlCqG,GA4FL,OAlIAxI,EAASsI,EAAO/B,GAyChB5H,EAAY2J,EAAO,CAAC,CAClB/I,IAAK,oBACLc,MAAO,WACLkB,KAAK2E,QAEN,CACD3G,IAAK,qBACLc,MAAO,SAA4BiJ,GACjC,IAAIC,EAAaD,EAAUxJ,OACvB0J,EAAaF,EAAUzG,OACvB4G,EAAaH,EAAUvE,OACvB2E,EAAgBJ,EAAUtE,UAC1B2E,EAAmBL,EAAUrE,aAC7B2E,EAAcN,EAAU3G,QACxBkH,EAAiBP,EAAU1G,WAC3BkH,EAAaR,EAAUpF,OACvB6F,EAASxI,KAAKzC,MACdgH,EAAOiE,EAAOjE,KACdhG,EAASiK,EAAOjK,OAChB+C,EAASkH,EAAOlH,OAChBkC,EAASgF,EAAOhF,OAChBC,EAAY+E,EAAO/E,UACnBC,EAAe8E,EAAO9E,aACtBtC,EAAUoH,EAAOpH,QACjBC,EAAamH,EAAOnH,WACpBsB,EAAS6F,EAAO7F,OAEhB8F,GAAwC,IAArBT,EAAWP,MAAkBO,EAAaN,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUK,GAAaE,EAAYC,IACxHX,GAAgC,IAAjBjJ,EAAOkJ,MAAkBlJ,EAASmJ,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUpJ,GAASiF,EAAQC,IAEpGiF,GAAwC,IAArBT,EAAWR,MAAkBQ,EAAaP,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUM,GAAaC,EAAYC,IACxHP,GAAgC,IAAjBtG,EAAOmG,MAAkBnG,EAASoG,KAAKD,MAAMnB,EAAQoB,KAAKC,UAAUrG,GAASkC,EAAQC,IAExG,GAAI+D,IAAiB9K,EAAQ8K,EAAciB,GAAmB,CAC5D,IAAIE,EAAanB,EAAajD,KAC1BqE,EAAOpB,EAAaoB,KACpBC,EAAIF,GAAcpE,EAEtB,GAAU,WAANsE,GAAwB,WAANA,GAAwB,YAANA,GAAmC,kBAATD,EAIhE,OAHA5I,KAAKqE,cACLrE,KAAK2E,MAMT,GAAIiD,IAAiBlL,EAAQkL,EAAcc,GAAmB,CAC5D,IAAII,EAAuBlB,EAAa3F,OACpCA,OAAkClB,IAAzB+H,EAAqC,GAAKA,EACnDC,EAAwBL,EAAiBzG,OACzC+G,OAAuCjI,IAA1BgI,EAAsC,GAAKA,EAE5D,GAAI9G,EAAOxE,SAAWuL,EAAWvL,OAI/B,OAHAuC,KAAKqE,cACLrE,KAAK2E,MAMT,IAAIvB,EAAehF,EAAS,GAAIgD,IAAYiH,GAAe,CACzDjH,QAASA,GACRC,IAAeiH,GAAkB,CAClCjH,WAAYA,GACXsB,IAAW4F,GAAc,CAC1B5F,OAAQA,IACNjG,EAAQ8K,EAAckB,IAAqB,CAC7CnK,OAAQiJ,IACN9K,EAAQkL,EAAcc,IAAqB,CAC7CpH,OAAQsG,IACNlL,EAAQgH,EAAc0E,IAAqB,CAC7C1E,aAAcA,IAGX/G,EAAQyG,IACXpD,KAAKuD,OAAOH,KAGf,CACDpF,IAAK,uBACLc,MAAO,WACLkB,KAAKqE,WAEN,CACDrG,IAAK,SACLc,MAAO,WACL,OAAO,SAGJiI,EAnIG,CAoIVnK,EAAM8I,eAERqB,EAAMpB,UAAY,CAChB5C,GAAIlG,EAAUkJ,UAAU,CAAClJ,EAAUoM,OAAQpM,EAAUqM,SAASrD,WAC9DtH,OAAQ1B,EAAU+I,MAAM,CACtB6B,MAAO5K,EAAUkJ,UAAU,CAAClJ,EAAUsM,KAAMtM,EAAUiJ,SAExDxE,OAAQzE,EAAU+I,MAAM,CACtB6B,MAAO5K,EAAUkJ,UAAU,CAAClJ,EAAUsM,KAAMtM,EAAUiJ,SAExDtC,OAAQ3G,EAAU+I,MAAM,IACxBnC,UAAW5G,EAAU+I,MAAM,IAC3BlC,aAAc7G,EAAU+I,MAAM,IAC9BxE,QAASvE,EAAUqM,OACnB7H,WAAYxE,EAAUsM,KACtBxG,OAAQ9F,EAAUqM,OAClBrG,WAAYhG,EAAUiJ,KACtBX,aAActI,EAAU+I,MAAM,CAC5BjB,IAAK9H,EAAUiJ,KAAKD,WACpBtC,OAAQ1G,EAAUiJ,KAAKD,WACvBxB,OAAQxH,EAAUiJ,KAAKD,WACvB/D,IAAKjF,EAAU+I,MAAM,CACnBwD,UAAWvM,EAAUiJ,UAI3BiB,EAAMb,aAAe,CACnB1C,YAAQzC,EACR0C,eAAW1C,EACX2C,kBAAc3C,EACdK,QAAS,EACTC,YAAY,EACZsB,YAAQ5B,EACRxC,OAAQ,CACNkJ,OAAO,GAETnG,OAAQ,GACR6D,aAAc,KACdtC,WAAY,cAGd,IAAIwG,EAAa,GAGjB,OAFAA,EAAWxH,aAAekD,EAC1BsE,EAAWtC,MAAQA,EACZsC,EA/vByEC,CAAQ,EAAQ,KAAmB,EAAQ,IAAmB,EAAQ,KAAU,EAAQ,KAAe,EAAQ,O,u0BCCjM,IAGaC,EAAiB,SAACC,EAAWC,GACxC,IAAMC,EAAI,IAAIC,KAAKF,GACbG,EAAI,IAAID,KAAKH,GAEbK,EAAOF,KAAKG,IAAIJ,EAAEK,cAAeL,EAAEM,WAAYN,EAAEO,WACjDC,EAAOP,KAAKG,IAAIF,EAAEG,cAAeH,EAAEI,WAAYJ,EAAEK,WAEvD,OAAOE,KAAKC,OAAOF,EAAOL,GAVT,QAaNQ,EAAc,WAAkB,IAAjB7G,EAAgB,uDAAP,GAAO,EACOA,GAAU,GAAnDgG,EADkC,EAClCA,UAAWC,EADuB,EACvBA,QAASa,EADc,EACdA,QAASC,EADK,EACLA,QAErC,IAAKf,IAAcC,IAAYa,IAAYC,EAAS,OAAO,KAE3D,IAAMC,EAAc,IAAIb,KAAKW,GACvBG,EAAc,IAAId,KAAKY,GACvBG,EAAenB,EAAekB,EAAaD,GAG3CG,EAAgB,IAAIhB,KAAKH,GACzBoB,EAAc,IAAIjB,KAAKF,GACvBoB,EAAiBH,EAAenB,EAAekB,EAAaE,GAC5DG,EAAeJ,EAAenB,EAAekB,EAAaG,GAG1DG,EAAgBF,GAAkB,EAClCG,EAAcF,GAAgBJ,EAEpC,MAAO,CACLK,gBACAC,cACAN,iBAISO,EAAY,WAA+B,IAA9BC,EAA6B,uDAApB,GAAI1H,EAAgB,uDAAP,GACxC2H,EAAgBD,EAAOE,OAAO,SAACC,EAAKzE,GACxC,IAAM5I,EAAM4I,EAAE5I,IACRc,EAAQ8H,EAAE0E,QAEhB,OAAO,EAAP,GACKD,EADL,eAEGrN,EAAMc,KAER,IAEGyM,EAAS,KACVJ,EADU,GAEV3H,GAGGgG,EAAqD+B,EAArD/B,UAAWC,EAA0C8B,EAA1C9B,QAAS+B,EAAiCD,EAAjCC,YAAaC,EAAoBF,EAApBE,gBAEnCC,EAAQlC,EACRmC,EAAMlC,EAAUgC,EAAkBA,EAAkBhC,EACpDmC,EAAOJ,EAAcC,EAAkBA,EAAkBD,EAE/D,OAAO,EAAP,GACKD,EADL,KAEQG,GAAS,CACbG,UAAWC,IAAOJ,GAAOK,OACzBC,WAAYF,IAAOJ,GAAOO,QAC1BC,SAAUJ,IAAOJ,GAAOS,aAL5B,KAOQ1C,GAAW,CACf2C,QAASN,IAAOH,GAAKI,OACrBM,SAAUP,IAAOH,GAAKM,QACtBK,OAAQR,IAAOH,GAAKQ,aAVxB,KAYQX,GAAe,CACnBe,YAAaT,IAAOF,GAAMG,OAC1BS,aAAcV,IAAOF,GAAMK,QAC3BQ,WAAYX,IAAOF,GAAMO,aAf7B,GAiBK9B,EAAYkB,K,msBCjEnB,IAAMmB,EAAmB,CACvBC,KAAM,EACNC,IAAK,EACLC,IAAK,GAGDC,E,2MACJC,OAAS,G,EAmETC,MAAQ,CACNC,SAAS,KACJP,EADG,GAEH,EAAKnP,MAAM0P,UAEhBC,QAAQ,EACRC,QAAQ,G,EAsBVC,OAAS,WAAO,IAAD,EACc,EAAK7P,MAAxB8P,EADK,EACLA,OAAQD,EADH,EACGA,OAChB,EAAKE,SAAS,CAAEH,QAAQ,KAEnBxQ,IAAQ0Q,IAAaA,EAAOE,MAC/B,EAAKC,YAGPJ,EAAO,CACLtL,IAAK,EAAKA,IACV2L,aAAc,EAAKA,gB,EAIvBC,iBAAmB,SAAC9G,EAAGpJ,GAAO,IACpBkQ,EAAqB,EAAKnQ,MAA1BmQ,iBAER,EAAKJ,SAAS,CAAEL,SAAUrG,IAC1B8G,EAAiB9G,I,EAGnB+G,SAAW,SAAC/G,GAAO,IACT8G,EAAqB,EAAKnQ,MAA1BmQ,iBAEFE,EAAW,KADI,EAAKZ,MAAlBC,SACS,GAEZrG,GAGL,EAAK0G,SAAS,CAAEL,SAAUW,IAC1BF,EAAiBE,I,EAGnBC,UAAY,WAAO,IACTH,EAAqB,EAAKnQ,MAA1BmQ,iBACAT,EAAa,EAAKD,MAAlBC,SAER,GAAI,EAAKnL,IAAK,CACZ,IAAMgM,EAAU,EAAKhM,IAAIiM,aACnBC,EAAQ,EAAKlM,IAAImM,WACjBtB,EAAO,EAAK7K,IAAIoM,UAHV,EAIS,EAAKpM,IAAIqM,YAAtBtB,EAJI,EAIJA,IAEFe,EAAW,KACZX,EADY,CAEfa,UACAE,QACArB,OACAyB,SAXU,EAICxB,IAQXyB,UAAWxB,IAIb,EAAKS,SAAS,CAAEL,SAAUW,IAC1BF,EAAiBE,K,EAIrBJ,UAAY,WAAO,IACTP,EAAa,EAAKD,MAAlBC,SADQ,EAEqB,EAAK1P,MAAlC8P,EAFQ,EAERA,OAAQK,EAFA,EAEAA,iBACRH,EAAkBF,EAAlBE,KAAMpL,EAAYkL,EAAZlL,QAERyE,EAAC,GACL0H,MAAO,EAAKb,aAAac,YACzBC,OAAQ,EAAKf,aAAagB,cACvBxB,GARW,EAWsB,IAAIyB,IAAoB9H,GAAG4G,UAC/D,CAAC,CAACD,EAAK,GAAIA,EAAK,IAAK,CAACA,EAAK,GAAIA,EAAK,KACpCpL,GAFMkM,EAXQ,EAWRA,UAAWD,EAXH,EAWGA,SAAUzB,EAXb,EAWaA,KAKvBiB,EAAW,KACZ,EAAKZ,MAAMC,SADC,CAEfoB,YACAD,WACAzB,OACAgC,mBAAoB,KACpBC,uBAAwBC,IAAkBC,SAG5C,EAAKxB,SAAS,CACZJ,QAAQ,EACRD,SAAUW,IAEZF,EAAiBE,GAEjBmB,WAAW,WACT,EAAKzB,SAAS,CAAEJ,QAAQ,KACvB,O,kFA9GcnF,GAAY,IACXiH,EAAqCjH,EAA/CkF,SAAgCgC,EAAelH,EAAvBsF,OADJ,EAECrN,KAAKzC,MAA1B0P,EAFoB,EAEpBA,SAAUI,EAFU,EAEVA,OACA6B,EAAkBlP,KAAKgN,MAAjCC,SAEHvQ,IAAQuQ,EAAU+B,IACrBhP,KAAKsN,SAAS,CACZL,SAAS,KACJiC,EADG,GAEHjC,KAKJtQ,IAAQ0Q,IAAY3Q,IAAQ2Q,EAAQ4B,IACvCjP,KAAKwN,c,+BAkGC,IAAD,SACgIxN,KAAKzC,MAApI4R,EADD,EACCA,YAAa9J,EADd,EACcA,SAAqB+J,GADnC,EACwBC,UADxB,EACmCD,SAASE,EAD5C,EAC4CA,WAAYC,EADxD,EACwDA,WAAYC,EADpE,EACoEA,UAAWC,EAD/E,EAC+EA,YAAaC,EAD5F,EAC4FA,gBAAoBC,EADhH,wIAE8B3P,KAAKgN,MAAlCC,EAFD,EAECA,SAAUE,EAFX,EAEWA,OAAQD,EAFnB,EAEmBA,OAE1B,OACE,yBACE0C,IAAK,SAAAhQ,GAAO,EAAK6N,aAAe7N,GAChCiQ,UAAWC,IAAW,aACpB,SAAS,GACRX,IAAgBA,KAGnB,kBAAC,IAAD,eACES,IAAK,SAAA9N,GAAS,EAAKA,IAAMA,GAAOA,EAAIiO,WAGhCJ,EAGA1C,EAPN,CAQEqB,MAAM,OACNE,OAAO,OAGPY,SAAUlC,GAAUkC,EACpBE,YAAapC,GAAUoC,EACvBC,YAAarC,GAAUqC,EACvBC,WAAYtC,GAAUsC,EACtBC,aAAcvC,GAAUuC,EACxBC,iBAAkBxC,GAAUwC,EAG5BhC,iBAAkB1N,KAAK0N,iBACvBC,SAAU3N,KAAK2N,SACfP,OAAQpN,KAAKoN,OAGb4C,uBAAwB,IAAIC,IAC5BC,iBAAkBC,MAEjBhD,KAAYnN,KAAK8B,KAA2B,oBAAbuD,GAA2BA,EAASrF,KAAK8B,W,GAtOjEsO,aAAZtD,EAmDG5G,aAAe,CACpBb,SAAU,KACV8J,YAAa,KACblC,SAAUP,EACVW,OAAQ,GACR+B,SAAS,EACTE,YAAY,EAEZ5B,iBAAkB,aAClBN,OAAQ,aACRiC,UAAW,YAAiC,IAA9BgB,EAA6B,EAA7BA,WAAYC,EAAiB,EAAjBA,WACxB,OAAID,EAAmB,UACnBC,EAAmB,WAChB,SA6KExD,QChQAyD,G,wLCQH,IACAlL,EAAarF,KAAKzC,MAAlB8H,SAER,OACE,yBAAKwK,UAAU,aACb,yBAAKA,UAAU,mBAAmBxK,Q,GAVXmL,IAAMJ,Y,0NCOjC,GAAiB,SAAwBnT,EAAUC,GACrD,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,sCAIpB,GAAc,WAChB,SAASE,EAAiBC,EAAQC,GAChC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CACrC,IAAIE,EAAaH,EAAMC,GACvBE,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAIlD,OAAO,SAAUR,EAAae,EAAYC,GAGxC,OAFID,GAAYZ,EAAiBH,EAAYiB,UAAWF,GACpDC,GAAab,EAAiBH,EAAagB,GACxChB,GAdO,GAkBd,GAAiB,SAAwBgC,EAAKlB,EAAKc,GAYrD,OAXId,KAAOkB,EACTpB,OAAOC,eAAemB,EAAKlB,EAAK,CAC9Bc,MAAOA,EACPnB,YAAY,EACZC,cAAc,EACdC,UAAU,IAGZqB,EAAIlB,GAAOc,EAGNI,GAGLd,GAAWN,OAAOO,QAAU,SAAUf,GACxC,IAAK,IAAIE,EAAI,EAAGA,EAAIc,UAAUb,OAAQD,IAAK,CACzC,IAAIe,EAASD,UAAUd,GAEvB,IAAK,IAAIQ,KAAOO,EACVT,OAAOK,UAAUpB,eAAeyB,KAAKD,EAAQP,KAC/CV,EAAOU,GAAOO,EAAOP,IAK3B,OAAOV,GA4BL,GAAW,SAAkBoB,EAAUC,GACzC,GAA0B,oBAAfA,GAA4C,OAAfA,EACtC,MAAM,IAAIxB,UAAU,kEAAoEwB,GAG1FD,EAASP,UAAYL,OAAOc,OAAOD,GAAcA,EAAWR,UAAW,CACrEU,YAAa,CACXC,MAAOJ,EACPf,YAAY,EACZE,UAAU,EACVD,cAAc,KAGde,IAAYb,OAAOiB,eAAiBjB,OAAOiB,eAAeL,EAAUC,GAAcD,EAASM,UAAYL,IAGzG,GAA4B,SAAmCW,EAAMd,GACvE,IAAKc,EACH,MAAM,IAAIC,eAAe,6DAG3B,OAAOf,GAAyB,kBAATA,GAAqC,oBAATA,EAA8Bc,EAAPd,GAGxE,GAAgB,WA2BlB,OAAO,SAAUiS,EAAKjT,GACpB,GAAIkJ,MAAMC,QAAQ8J,GAChB,OAAOA,EACF,GAAIC,OAAOC,YAAY7S,OAAO2S,GACnC,OA9BJ,SAAuBA,EAAKjT,GAC1B,IAAIoT,EAAO,GACPC,GAAK,EACLC,GAAK,EACLC,OAAKhQ,EAET,IACE,IAAK,IAAiCiQ,EAA7BC,EAAKR,EAAIC,OAAOC,cAAmBE,GAAMG,EAAKC,EAAGC,QAAQC,QAChEP,EAAK1N,KAAK8N,EAAGlS,QAETtB,GAAKoT,EAAKnT,SAAWD,GAH8CqT,GAAK,IAK9E,MAAOO,GACPN,GAAK,EACLC,EAAKK,EACL,QACA,KACOP,GAAMI,EAAW,QAAGA,EAAW,SACpC,QACA,GAAIH,EAAI,MAAMC,GAIlB,OAAOH,EAOES,CAAcZ,EAAKjT,GAE1B,MAAM,IAAIL,UAAU,yDAjCN,GAsChBmU,GAAoB,SAA2Bb,GACjD,GAAI/J,MAAMC,QAAQ8J,GAAM,CACtB,IAAK,IAAIjT,EAAI,EAAG+T,EAAO7K,MAAM+J,EAAIhT,QAASD,EAAIiT,EAAIhT,OAAQD,IACxD+T,EAAK/T,GAAKiT,EAAIjT,GAGhB,OAAO+T,EAEP,OAAO7K,MAAM8K,KAAKf,IAIlBjR,GAAiB,SAAwBC,EAASC,EAAQC,EAAUC,GACtE,IACEH,EAAQE,EAASC,IACjB,MAAOC,GACPH,EAAOG,KAIPC,GAAoB,WA+BtB,SAASA,EAAkBC,GACzB,GAAeC,KAAMF,GACrBE,KAAKC,SAAW,IAAIC,QAAQH,GAC5BC,KAAKG,WAAY,EAkDnB,OAnFA,GAAYL,EAAmB,KAAM,CAAC,CACpC9B,IAAK,MACLc,MAAO,SAAasB,GAClB,OAAO,IAAIN,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQK,IAAIH,GAAUI,KAAKH,EAAGC,OAGjC,CACDtC,IAAK,OACLc,MAAO,SAAcsB,GACnB,OAAO,IAAIN,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQO,KAAKL,GAAUI,KAAKH,EAAGC,OAGlC,CACDtC,IAAK,SACLc,MAAO,SAAgBA,GACrB,OAAO,IAAIgB,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQR,OAAOZ,GAAO0B,KAAKH,EAAGC,OAGjC,CACDtC,IAAK,UACLc,MAAO,SAAiBA,GACtB,OAAO,IAAIgB,EAAkB,SAAUO,EAAGC,GACxCJ,QAAQT,QAAQX,GAAO0B,KAAKH,EAAGC,SAWrC,GAAYR,EAAmB,CAAC,CAC9B9B,IAAK,OACLc,MAAO,SAAc4B,EAASC,GAC5B,IAAIC,EAAQZ,KAERa,EAAI,IAAIf,EAAkB,SAAUL,EAASC,GAC/CkB,EAAMX,SAASO,KAAK,SAAUZ,GACxBgB,EAAMT,WACRU,EAAEC,SAGAJ,IAAYE,EAAMT,UACpBX,GAAeC,EAASC,EAAQgB,EAASd,GAEzCH,EAAQG,IAET,SAAUA,GACPgB,EAAMT,WACRU,EAAEC,SAGAH,IAAUC,EAAMT,UAClBX,GAAeC,EAASC,EAAQiB,EAAOf,GAEvCF,EAAOE,OAIb,OAAOiB,IAER,CACD7C,IAAK,QACLc,MAAO,SAAgB6B,GACrB,OAAOX,KAAKQ,UAAKO,EAAWJ,KAE7B,CACD3C,IAAK,SACLc,MAAO,SAAgBkC,GAOrB,OANAhB,KAAKG,WAAY,EAEba,GACFhB,KAAKC,SAASgB,MAAMD,GAGfhB,SAGJF,EApFe,GAuFpB,GAAa,WACf,SAASoB,IACP,IAAIC,EAAY7C,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GACpF,GAAe0B,KAAMkB,GACrBlB,KAAKoB,QAAU,EACfpB,KAAKqB,YAAa,EAClBrB,KAAKzB,OAAS,GACdyB,KAAKsB,OAAS,GACdxD,OAAOO,OAAO2B,KAAMmB,EAAW,CAC7BI,kBAAmB,KAmCvB,OA/BA,GAAYL,EAAY,CAAC,CACvBlD,IAAK,MACLc,MAAO,SAAgBd,GACrB,OAAOgC,KAAKhC,KAEb,CACDA,IAAK,MACLc,MAAO,SAAgBd,EAAKc,GAE1B,OADAkB,KAAKhC,GAAOc,EACLkB,OAER,CACDhC,IAAK,SACLc,MAAO,SAAgBqC,GACrB,IAAIP,EAAQZ,KAERwB,EAAWpD,GAAS,GAAI4B,MAExByB,EAAWrD,GAAS,GAAI+C,GAG5BnB,KAAK0B,IAAI,oBAAqB,IAC9B5D,OAAOqB,KAAKsC,GAAUE,QAAQ,SAAUC,GACjC,IAAQJ,EAASI,GAAIH,EAASG,MACjChB,EAAMW,kBAAkBK,GAAKH,EAASG,GAEtChB,EAAMc,IAAIE,EAAGH,EAASG,WAKvBV,EA5CQ,IAgEE,WACjB,SAASW,EAAaC,EAAKC,GACzB,GAAe/B,KAAM6B,GACrB7B,KAAK8B,IAAMA,EACX9B,KAAKiC,OAAS,GACdjC,KAAKkC,SAAW,GAChBlC,KAAKmC,QAAU,CACbC,UAAWpC,KAAKoC,UAAUC,KAAKrC,OAEjCA,KAAKgC,OAAS,IAAID,EAAO/B,KAAK8B,IAAK9B,KAAKmC,SA1B5C,SAA+BH,GAC7B,GAAIA,EAAQ,CACe,CAAC,MAAO,SAAU,gBAAiB,aAAc,YAAa,YAAa,YAAa,YAAa,eAAgB,kBAAmB,kBAC9IL,QAAQ,SAAUW,GAC9BN,EAAOM,IACVC,QAAQ5B,MAAM,OAAS2B,EAAW,qDAGX,CAAC,sBACPX,QAAQ,SAAUW,GACjCN,EAAOM,IACTC,QAAQC,KAAK,OAASF,EAAW,wDAgBrCmP,CAAsBzR,KAAKgC,QAS7B,GAAYH,EAAc,CAAC,CACzB7D,IAAK,MACLc,MAAO,SAAa2D,GAClB,IAAIC,EAAepE,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,CACrF8C,QAAS,EACTC,YAAY,EACZsB,OAAQ,EACRC,cAAe,MAEbC,EAAavE,UAAU,GAE3B,GAAqB,qBAAVmE,EAET,OADAF,QAAQ5B,MAAM,qBACPX,KAGT,IAAI8C,EAAa,IAAI,GAAW1E,GAAS,GAAIqE,EAAOC,IAChDK,EAAKD,EAAWC,GAEpB,OAAI/C,KAAKiC,OAAOe,KAAK,SAAUC,GAC7B,OAAOA,EAAEF,KAAOA,IAET/C,KAAKiC,QAGdjC,KAAKiC,OAAOiB,KAAKJ,GACjB9C,KAAKmD,aAAaL,EAAYD,GACvB7C,KAAKiC,UAOb,CACDjE,IAAK,SACLc,MAAO,SAAgBiE,EAAIK,GACzB,IAAIN,EAAa9C,KAAKqD,cAAcN,GACpC,GAAKD,GAAeA,EAAWQ,SAA/B,CACAR,EAAWS,OAAOH,GAClB,IAAIhC,EAAUgC,EAAahC,QACvBC,EAAa+B,EAAa/B,WAC1BsB,EAASS,EAAaT,OACtBpE,EAAS6E,EAAa7E,OACtB+C,EAAS8B,EAAa9B,OACtBkC,EAASJ,EAAaI,OACtBC,EAAYL,EAAaK,UACzBC,EAAeN,EAAaM,aAET,qBAAZtC,GACTpB,KAAKgC,OAAO2B,WAAWb,EAAY1B,GAGX,qBAAfC,GACTrB,KAAKgC,OAAO4B,cAAcd,EAAYzB,GAGlB,qBAAXsB,GACT3C,KAAKgC,OAAO6B,UAAUf,EAAYH,GAG/B,IAAQpE,IACXyB,KAAKgC,OAAO8B,UAAUhB,GAGnB,IAAQxB,IACXtB,KAAKgC,OAAO+B,UAAUjB,GAGnB,IAAQU,IACXxD,KAAKgC,OAAOgC,UAAUlB,GAGnB,IAAQW,IACXzD,KAAKgC,OAAOiC,aAAanB,GAGtB,IAAQY,IACX1D,KAAKgC,OAAOkC,gBAAgBpB,MAQ/B,CACD9E,IAAK,SACLc,MAAO,SAAgBiE,GACrB,IAAId,EAASjC,KAAKiC,OAAOkC,MAAM,GAC/BnE,KAAKoE,cAAcrB,GACnB,IAAID,EAAa9C,KAAKqD,cAAcN,GAEhCD,GACF9C,KAAKgC,OAAOqC,OAAOvB,GAGrB9C,KAAKiC,OAASA,EAAOqC,OAAO,SAAUrB,GACpC,OAAOA,EAAEF,KAAOA,MAGnB,CACD/E,IAAK,YACLc,MAAO,WACL,OAAOkB,KAAKiC,SAEb,CACDjE,IAAK,gBACLc,MAAO,SAAuBiE,GAC5B,OAAO/C,KAAKiC,OAAOe,KAAK,SAAUC,GAChC,OAAOA,EAAEF,KAAOA,MASnB,CACD/E,IAAK,aACLc,MAAO,SAAoBiE,EAAI3B,GAC7B,IAAI0B,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO2B,WAAWb,EAAY1B,KAQpC,CACDpD,IAAK,gBACLc,MAAO,SAAuBiE,EAAI1B,GAChC,IAAIyB,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO4B,cAAcd,EAAYzB,KAQvC,CACDrD,IAAK,YACLc,MAAO,SAAmBiE,EAAIJ,GAC5B,IAAIG,EAAa9C,KAAKqD,cAAcN,GACpC/C,KAAKgC,OAAO6B,UAAUf,EAAYH,KAEnC,CACD3E,IAAK,eACLc,MAAO,SAAsBgE,EAAYD,GACvC,IAAIjC,EAAQZ,KAERuE,EAAOzB,EAAWyB,KAClBC,EAAW1B,EAAW0B,SACtBC,EAASzE,KAAKgC,OAAO0C,eAAeH,GAExC,OAAKE,GAMLzE,KAAKoE,cAActB,EAAWC,IAG9B/C,KAAKkC,SAASY,EAAWC,IAAM0B,EAAOjG,KAAKwB,KAAM8C,GAAYtC,KAAK,SAAUiC,GAC3D7B,EAAMsB,SAASY,EAAWC,IAAI5C,YAG3C2C,EAAWpB,IAAI,WAAYe,GAE3B7B,EAAMoB,OAAO2C,IAAI7B,EAAYlC,EAAMqB,QAEnCrB,EAAMoB,OAAO6B,UAAUf,EAAYA,EAAWH,QAE9C/B,EAAMoB,OAAO2B,WAAWb,EAAYA,EAAW1B,SAE/CR,EAAMoB,OAAO4B,cAAcd,EAAYA,EAAWzB,YAElDT,EAAMoB,OAAO+B,UAAUjB,GAEvBD,EAAWC,MAGR9C,OA3BLA,KAAKkC,SAASY,EAAWC,IAAMjD,GAAkBJ,OAAO,IAAIkF,MAAMJ,EAAW,qCACtE,KA4BV,CACDxG,IAAK,gBACLc,MAAO,SAAuB+F,GAExB7E,KAAKkC,SAAS2C,IAAiB7E,KAAKkC,SAAS2C,GAAc/D,QAC7Dd,KAAKkC,SAAS2C,GAAc/D,WAG/B,CACD9C,IAAK,UACLc,MAAO,WACLkB,KAAK8B,IAAM,KACX9B,KAAKgC,OAAO8C,cA3NC,GAAnB,IAiOI4M,GAAU,CACZ,eAAgB,oBAGdC,GAAQ,SAAgBC,GAC1B,IAAIzP,EAAU7D,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAClF,OAAO,EAAAoL,EAAMmI,IAAID,EAAKxT,GAAS,CAC7BsT,QAASA,IACRvP,KAUDgE,GAAe,SAAsBC,GACvC,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7E+H,EAAMD,EAQV,OAPAtI,OAAOqB,KAAKqE,GAAQ7B,QAAQ,SAAU3D,GACT,kBAAhBwF,EAAOxF,IAA4C,mBAAhBwF,EAAOxF,KACnDqI,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,MAAQvI,EAAM,MAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,MAASvI,EAAM,MAAQ,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,MAAQvI,EAAM,MAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAQvI,EAAM,KAAO,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,KAGtWqI,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMwF,EAAOxF,IAAMsI,QAAQ,IAAIC,OAAO,IAAMvI,EAAM,IAAK,KAAMwF,EAAOxF,MAE/GqI,GAUL,GAAgB,SAAuBD,GACzC,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7E+H,EAAMD,EACNK,OAAM,EAsBV,OArBA3I,OAAOqB,KAAKqE,GAAQ7B,QAAQ,SAAU3D,GAiBAyI,GAhBpCA,EAAM,GAAK,IAAQ3I,OAAOqB,KAAKqE,EAAOxF,IAAM8D,IAAI,SAAUF,GACxD,IAAI9C,EAAQ0E,EAAOxF,GAAK4D,GAExB,OAAI8E,MAAMC,QAAQ7H,IAAYA,EAAMrB,OAI3BmE,EAAI,QAHO9C,EAAMgD,IAAI,SAAU8E,GACpC,MAAoB,kBAANA,EAAiB,IAAOA,EAAI,IAAOA,IAElBC,KAAK,MAAQ,KAG3CH,MAAMC,QAAQ7H,IAAUA,EACH,kBAAVA,EAAqB8C,EAAI,OAAU9C,EAAQ,IAAO8C,EAAI,MAAQ9C,EAGvE,QACL+H,KAAK,WACE7I,EAAI8I,WAAW,SAAgB,SAAWL,EAAaA,GAAOzI,EAAI8I,WAAW,OAAc,OAASL,EAAe,GAE9HJ,GADAA,EAAMA,EAAIC,QAAQ,IAAIC,OAAO,KAAOvI,EAAM,KAAM,KAAMyI,IAC5CH,QAAQ,IAAIC,OAAO,IAAMvI,EAAM,IAAK,KAAMyI,KAE/CJ,GAULC,GAAU,SAAiBF,GAC7B,IAAI5C,EAASlF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAC7EmF,EAAYnF,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GAChF+H,EAAMD,EAOV,MALmB,kBAARC,IACTA,EAAMF,GAAaE,EAAK7C,GACxB6C,EAAM,GAAcA,EAAK5C,IAGpB4C,GAGL,GAAsB,SAA6BvD,GACrD,IAAIvE,EAASuE,EAAWvE,OACpBiF,EAASV,EAAWU,OACpBC,EAAYX,EAAWW,UACvBb,EAAgBE,EAAWF,cAE3B4B,IADgC,IAAjBjG,EAAOkJ,MAAkBlJ,EAASmJ,KAAKD,MAAMnB,GAAQoB,KAAKC,UAAUpJ,GAASiF,EAAQC,KAC5Ee,SACxBsN,EAAWpK,KAAKC,UAAU,CAC5BoK,QAAS,QACTC,SAAU,MACV/P,OAAQuC,EAASrC,QAAQF,OAAOH,IAAI,SAAUmB,GAC5C,OAAML,GAAiBA,EAAcnF,OAC5BW,GAAS,GAAI6E,EAAG,CACrBd,QAAS/D,GAAS,GAAI6E,EAAEd,QAAS,CAC/BS,cAAeA,MAKdK,MAIPgP,EAAY7T,GAAS,CACvB4T,SAAU,MACV9G,OAAQgH,mBAAmBJ,IAC1BtN,EAASrC,QAAQgQ,SAAW,CAC7BA,QAAS3N,EAASrC,QAAQgQ,UAGxBC,EAAkBtU,OAAOqB,KAAK8S,GAAWnQ,IAAI,SAAUF,GACzD,OAAOA,EAAI,IAAMqQ,EAAUrQ,KAC1BiF,KAAK,KACJ+K,EAAM,WAAapN,EAASrC,QAAQkQ,QAAU,yBAA2BD,EACzEE,EAAexP,EAAWwP,aAE1BA,GACFA,EAAaxR,OAAO,mCAGtB,IAAIyR,EAAqB,cAAYhU,SAYrC,OAXAuE,EAAWpB,IAAI,eAAgB6Q,GACTZ,GAAMC,EAAK,CAC/BY,YAAaD,EAAmBE,QAC/BjS,KAAK,SAAUkS,GAChB,OAAIA,EAAIC,OAAS,KACfpQ,QAAQ5B,MAAM+R,IACP,GAGFA,EAAI9J,QAYXgK,GAAuB,SAA8BC,EAAc/P,GACrE,IAAIC,EAAKD,EAAWC,GAChBS,EAASV,EAAWU,OACpBC,EAAYX,EAAWW,UAE3B,GAAIoP,GAAgBA,EAAapV,OAAQ,CACvC,IAAIqV,EAAqBpL,KAAKD,MAAMnB,GAAQoB,KAAKC,UAAUkL,GAAerP,EAAQC,IAClF,OAAOqP,GAAsBA,EAAmBhR,IAAI,SAAUiR,EAAavV,GACzE,IAKIwV,EAAqBD,EAAYE,MACjCA,OAA+BlS,IAAvBiS,EAAmC,GAAKA,EAGhDE,GAToB,CACtBC,OAAQ,CAAC,OAAQ,QACjBC,OAAQ,CAAC,SAAU,kBAMqBL,EAAYxO,OAAS,CAACwO,EAAYxO,OACjC6G,OAAO,SAAUlM,EAAKmU,GAC/D,IAAIC,EAAkBL,EAAMI,EAAO,YAEnC,OAAOjV,GAAS,GAAIc,EAAK,GAAe,GAAImU,EAAO,iBADZtS,IAApBuS,GAAqD,OAApBA,EAA2BA,EAAkB,GACnBxQ,EAAW1B,QAAU,OAClG,IAGCmS,EAA0BR,EAAYE,OAASnV,OAAO0V,QAAQT,EAAYE,OAAO7H,OAAO,SAAUlM,EAAK8H,GACzG,IAAIyM,EAAQ,GAAczM,EAAM,GAC5BhJ,EAAMyV,EAAM,GACZ3U,EAAQ2U,EAAM,GAElB,OAAOrV,GAAS,GAAIc,IAAOJ,GAAS,GAAe,GAAId,EAAKc,KAC3D,IACH,OAAOV,GAAS,CAGd2E,GAAIA,EAAK,IAAMgQ,EAAYxO,KAAO,IAAM/G,GACvCuV,EAAa,CACdxU,OAAQwE,GACPgQ,EAAYE,OAAS,CACtBA,MAAO7U,GAAS,GAAImV,EAAyBL,OAKnD,OAAO,GAKT,SAASQ,GAAgB1M,GACvB,IAAIlF,EAAMkF,EAAKlF,IACX6R,EAAK3M,EAAK2M,GACVC,EAAO5M,EAAK4M,KAEhB,GAAI9R,EAAI+R,OACN,OAAO/R,EAAI+R,OAGb,IAAIC,EAAeF,GAAQA,EAAKrW,MAAMwW,cAClCC,EAAY,CACdC,iBAAiB,EACjBF,cAAe,WACbjS,EAAIoS,iBAEAJ,GAGFA,KAIJK,WAAY,CACVC,WAAW,EACXC,WAAW,EACXC,UAAW,CAACX,EAAGY,UAAWZ,EAAGa,oBAAqBb,EAAGc,IAAKd,EAAGa,qBAC7DE,cAAef,EAAGgB,UAEpBC,SAAU,CACRC,YAAY,EACZC,aAAc,IAAIC,MAiCtB,OA7BInB,GACFA,EAAKoB,SAAShB,GACdJ,EAAKrW,MAAMqX,SAASC,YAAa,IAGjC/W,OAAOO,OAAO2V,EAAW,CACvBL,GAAIA,EACJrF,OAAO,EACPE,QAAQ,EACRyG,UAAWC,GAAapT,KAE1B8R,EAAO,IAAI,IAAKI,GAIhBlS,EAAIqT,GAAG,OAAQ,WACb,OAqKN,SAAmBvB,EAAM9R,GACvB8R,EAAKoB,SAAS,CACZC,UAAWC,GAAapT,KAvKfsT,CAAUxB,EAAM9R,KAEzBA,EAAIqT,GAAG,SAAU,WACfvB,EAAKyB,WACLvT,EAAI+R,OAAS,QAIjBD,EAAKrW,MAAMqX,SAASU,cA8DtB,SAA0BxT,GAExB,IAAIyT,EAAQ,EACRC,EAAQ,EAEZ,GAAI1T,EAAIiQ,QAAS,CACf,IAAI0D,EAAwB3T,EAAIiQ,QAAQ2D,MAAM,KAAKvR,MAAM,EAAG,GAAGrC,IAAI6T,QAE/DC,EAAyB,GAAcH,EAAuB,GAElEF,EAAQK,EAAuB,GAC/BJ,EAAQI,EAAuB,GAGjC,MAAO,CACLL,MAAOA,EACPC,MAAOA,GA9E2BK,CAAiB/T,GACrDA,EAAI+R,OAASD,EACb9R,EAAIqT,GAAG,SAAU,WACf,OAkGJ,SAAqBvB,EAAM9R,GACzB,IAAIgU,EAAuBlC,EAAKrW,MAAMqX,SAClCE,EAAegB,EAAqBhB,aAGxC,GAFiBgB,EAAqBjB,WAEtB,CAEd,IAAIkB,EAAiBrP,MAAM8K,KAAKsD,EAAc,SAAUrS,GACtD,OAAOA,EAAMM,KAEXd,EAAS,GAAU2R,EAAM,SAAUoC,GACrC,IAAIC,GAA4B,EAC5BC,GAAoB,EACpBC,OAAiBpV,EAErB,IACE,IAAK,IAAmDqV,EAA/CC,EAAYN,EAAerF,OAAOC,cAAsBsF,GAA6BG,EAAQC,EAAUnF,QAAQC,MAAO8E,GAA4B,EAAM,CAG/J,GAAIK,GAFKF,EAAMtX,MAESkX,GACtB,OAAO,GAGX,MAAO5E,GACP8E,GAAoB,EACpBC,EAAiB/E,EACjB,QACA,KACO6E,GAA6BI,EAAUE,QAC1CF,EAAUE,SAEZ,QACA,GAAIL,EACF,MAAMC,GAKZ,OAAO,IAGLlU,EAAOxE,OAAS,IAClB8E,QAAQiU,IAAI,eAEZ5C,EAAK6C,YAAY,iBAAkB,CACjCC,UAAW,CAACC,GAAY/C,EAAM9R,GAAK,IACnCG,OAAQA,EACR2U,aAAa,KAMnBhD,EAAKrW,MAAMqX,SAASiC,gBAAkB,KAvJ7BC,CAAYlD,EAAM9R,KAEpB8R,EA2CT,SAASsB,GAAapT,GACpB,IAAIiV,EAAiBjV,EAAIqM,YAIzB,MAAO,CACLE,UAJQ0I,EAAelK,IAKvBuB,SAJQ2I,EAAenK,IAKvBD,KAAM7K,EAAIoM,UACVJ,QAAShM,EAAIiM,aACbC,MAAOlM,EAAImM,YAwBf,SAAS0I,GAAY/C,EAAM9R,GACzB,IAAIkV,IAAsB1Y,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,KAAmBA,UAAU,GACrFgX,EAAgB1B,EAAKrW,MAAMqX,SAASU,cACxC,OAAO,IAAI,IAAoBxX,OAAOO,OAAO,CAC3C4Y,EAAG,EACH5W,EAAG,EACHiO,MAAOsF,EAAKtF,MACZE,OAAQoF,EAAKpF,QACZ0G,GAAapT,GAAMkV,EAAsB,CAI1CE,gBAAyC,IAAxB5B,EAAcC,OAAeD,EAAcE,OAAS,GAAKF,EAAcC,OAAS,EAAI,IAAO,GAAK3B,EAAKpF,QAAU,IAC9H,CAEF0I,gBAAiB,MAqErB,SAAS,GAAUtD,EAAMuD,GAEvB,OADavD,EAAKzO,aAAa/C,YACjBkC,OAAO6S,GAGvB,SAASb,GAAgBvT,EAAIN,GAG3B,IAFA,IAAI2U,EAAgB3U,EAEb2U,GAAe,CACpB,GAAIA,EAAcrU,KAAOA,EACvB,OAAO,EAGTqU,EAAgBA,EAAcC,OAGhC,OAAO,EAGT,SAASC,GAAa1D,GACpB,IAAIA,EAAKrW,MAAMqX,SAASC,WAAxB,CAIA,IAAI5S,EAAS,GACb2R,EAAKrW,MAAMqX,SAASE,aAAanT,QAAQ,SAAUqU,GACjD,IACIvT,EAAQ,IAAI8U,EADAvB,EAAUzY,MAAMgH,MACNyR,EAAUzY,OACpC0E,EAAOiB,KAAKT,KAEdmR,EAAKoB,SAAS,CACZ/S,OAAQA,KAIZ,IAAIuV,GAAc,WAEhB,SAASA,EAAYja,GAGnB,GAFA,GAAeyC,KAAMwX,IAEhBja,EAAMwF,GACT,MAAM,IAAI6B,MAAM,gCAGlB5E,KAAK+C,GAAKxF,EAAMwF,GAChB/C,KAAKuE,KAAO,SACZvE,KAAKyX,cAAgBla,EAAMka,eAAiB,KAC5CzX,KAAK8B,IAAM,KACX9B,KAAK4T,KAAO,KACZ5T,KAAKzC,MAAQA,EAuCf,OAlCA,GAAYia,EAAa,CAAC,CACxBxZ,IAAK,QACLc,MAAO,SAAegD,EAAK6R,GAtN/B,IAAkBC,EAAMnR,EAuNlBzC,KAAK8B,IAAMA,EACX9B,KAAK4T,KAAOF,GAAgB,CAC1B5R,IAAKA,EACL6R,GAAIA,EACJC,KAAM5T,KAAKzC,MAAMqW,OA3NPA,EA6NH5T,KAAK4T,KA7NInR,EA6NEzC,KA5NxB4T,EAAKrW,MAAMqX,SAASE,aAAanQ,IAAIlC,GACrC6U,GAAa1D,KA6NV,CACD5V,IAAK,WACLc,MAAO,WA5NX,IAAqB8U,EAAMnR,EAANmR,EA6NH5T,KAAK4T,KA7NInR,EA6NEzC,KA5N3B4T,EAAKrW,MAAMqX,SAASE,aAAa4C,OAAOjV,GACxC6U,GAAa1D,KA6NV,CACD5V,IAAK,WACLc,MAAO,SAAkBvB,GAEvBO,OAAOO,OAAO2B,KAAKzC,MAAOA,EAAO,CAC/BwF,GAAI/C,KAAK+C,KAGP/C,KAAK4T,MAjOb0D,GAkOkBtX,KAAK4T,QAGpB,CACD5V,IAAK,SACLc,MAAO,YApOX,SAAmB8U,EAAM9R,EAAKW,GAC5B,IAAIoU,EAAkBjD,EAAKrW,MAAMqX,SAASiC,gBAErCA,IAGHA,EAAkBF,GAAY/C,EAAM9R,GAAK,GACzC8R,EAAKrW,MAAMqX,SAASiC,gBAAkBA,GAGxCjD,EAAK6C,YAAY,iBAAkB,CACjCC,UAAW,CAACG,GAEZ5U,OAAQ,GAAU2R,EAAM,SAAUoC,GAChC,OAAOM,GAAgB7T,EAAMM,GAAIiT,KAEnCY,aAAa,IAqNXe,CAAU3X,KAAK4T,KAAM5T,KAAK8B,IAAK9B,UAG5BwX,EArDS,GAyDlB,SAASI,GAAYX,EAAG5W,EAAGwX,GACzB,IAAIhL,EAAMoK,EAAI9M,KAAK2N,IAAI,EAAGD,GAAK,IAAM,IACjCvX,EAAI6J,KAAK4N,GAAK,EAAI5N,KAAK4N,GAAK1X,EAAI8J,KAAK2N,IAAI,EAAGD,GAEhD,MAAO,CAAChL,EADE,IAAM1C,KAAK4N,GAAK5N,KAAK6N,KAAK,IAAO7N,KAAK8N,IAAI3X,GAAK6J,KAAK8N,KAAK3X,MAkBrE,IAAI4X,GAAO,WACT,SAASA,EAAKlR,GACZ,IAAImR,EAAcnR,EAAKmR,YACnBlB,EAAIjQ,EAAKiQ,EACT5W,EAAI2G,EAAK3G,EACTwX,EAAI7Q,EAAK6Q,EACTO,EAAapR,EAAKoR,WAClBC,EAAcrR,EAAKqR,YACvB,GAAerY,KAAMkY,GACrBlY,KAAKiX,EAAIA,EACTjX,KAAKK,EAAIA,EACTL,KAAK6X,EAAIA,EACT7X,KAAKuN,KA1BT,SAA0B0J,EAAG5W,EAAGwX,GAC9B,IAAIS,EAAeV,GAAYX,EAAG5W,EAAGwX,GACjCU,EAAgB,GAAcD,EAAc,GAC5CE,EAAOD,EAAc,GACrBE,EAAQF,EAAc,GAEtBG,EAAgBd,GAAYX,EAAI,EAAG5W,EAAI,EAAGwX,GAC1Cc,EAAgB,GAAcD,EAAe,GAC7CE,EAAOD,EAAc,GAGzB,MAAO,CAACH,EAFIG,EAAc,GAELC,EAAMH,GAebI,CAAiB7Y,KAAKiX,EAAGjX,KAAKK,EAAGL,KAAK6X,GAClD7X,KAAK8Y,WAAY,EACjB9Y,KAAKmY,YAAcA,EACnBnY,KAAK+Y,MAAQ,KACb/Y,KAAKgZ,WAAY,EACjBhZ,KAAKiZ,QAAUjZ,KAAKkZ,YACpBlZ,KAAKoY,WAAaA,EAClBpY,KAAKqY,YAAcA,EAuDrB,OApDA,GAAYH,EAAM,CAAC,CACjBla,IAAK,YACLc,MAAO,WACL,IAAI8B,EAAQZ,KAERiX,EAAIjX,KAAKiX,EACT5W,EAAIL,KAAKK,EACTwX,EAAI7X,KAAK6X,EACTtK,EAAOvN,KAAKuN,KAEhB,OAAKvN,KAAKmY,YAIHjY,QAAQT,QAAQO,KAAKmY,YAAY,CACtClB,EAAGA,EACH5W,EAAGA,EACHwX,EAAGA,EACHtK,KAAMA,KACJ/M,KAAK,SAAU2Y,GAMjB,OALAvY,EAAMmY,MAAQI,EACdvY,EAAMoY,WAAY,EAElBpY,EAAMwX,WAAWxX,GAEVuY,IACNlY,MAAM,SAAUmQ,GACjBxQ,EAAMoY,WAAY,EAElBpY,EAAMyX,YAAYjH,KAlBX,OAqBV,CACDpT,IAAK,eACLc,MAAO,SAAsBsa,GAC3B,IAAInC,EAAIjX,KAAKiX,EACT5W,EAAIL,KAAKK,EACTwX,EAAI7X,KAAK6X,EACTwB,EAAIlP,KAAK2N,IAAI,EAAGsB,EAAKvB,EAAIA,GAC7B,OAAO1N,KAAKC,MAAMgP,EAAKnC,EAAIoC,KAAOpC,GAAK9M,KAAKC,MAAMgP,EAAK/Y,EAAIgZ,KAAOhZ,IAEnE,CACDrC,IAAK,OACL6T,IAAK,WACH,OAAO7R,KAAK+Y,OAAS/Y,KAAKiZ,UAE3B,CACDjb,IAAK,WACL6T,IAAK,WACH,OAAO7R,KAAKgZ,cAGTd,EA1EE,GA6EPoB,GAAY,IAehB,SAASC,GAAkB7P,GACzB,OAAOA,EAAI4P,GAOb,SAASE,GAAqBxS,EAAMyS,GAClC,IAAIxC,EAAIjQ,EAAKiQ,EACT5W,EAAI2G,EAAK3G,EACTwX,EAAI7Q,EAAK6Q,EACTwB,EAAIlP,KAAK2N,IAAI,EAAGD,EAAI4B,GACxB,MAAO,CACLxC,EAAG9M,KAAKC,MAAM6M,EAAIoC,GAClBhZ,EAAG8J,KAAKC,MAAM/J,EAAIgZ,GAClBxB,EAAG4B,GAmEP,IAAIC,GAAY,WAKd,SAASA,EAAU1S,GACjB,IAAImR,EAAcnR,EAAKmR,YACnBwB,EAAU3S,EAAK2S,QACfC,EAAU5S,EAAK4S,QACfC,EAAU7S,EAAK6S,QACfzB,EAAapR,EAAKoR,WAClBC,EAAcrR,EAAKqR,YACvB,GAAerY,KAAM0Z,GAErB1Z,KAAK8Z,aAAe3B,EACpBnY,KAAK+Z,SAAWJ,EAChB3Z,KAAKqY,YAAcA,EACnBrY,KAAKoY,WAAaA,EAElBpY,KAAKga,OAAS,IAAIlN,IAClB9M,KAAKia,OAAS,GAEVtE,OAAOuE,SAASN,KAClB5Z,KAAKma,SAAWhQ,KAAKC,MAAMwP,IAGzBjE,OAAOuE,SAASL,KAClB7Z,KAAKoa,SAAWjQ,KAAKkQ,KAAKR,IA8J9B,OA1JA,GAAYH,EAAW,CAAC,CACtB1b,IAAK,WAKLc,MAAO,WACLkB,KAAKga,OAAOM,UAQb,CACDtc,IAAK,SACLc,MAAO,SAAgBmO,GACrB,IAAI+M,EAASha,KAAKga,OACdF,EAAe9Z,KAAK8Z,aACpBC,EAAW/Z,KAAK+Z,SAChBI,EAAWna,KAAKma,SAChBC,EAAWpa,KAAKoa,SAEpBpa,KAAKua,gBAEL,IAAIC,EAlHV,SAAwBvN,EAAU2M,EAASC,GACzC,IAAIhC,EAAI1N,KAAKC,MAAM6C,EAASN,MAAQ,EAEpC,GAAIkN,GAAWhC,EAAIgC,EACjB,MAAO,GAOT,IAAItM,EAlDN,SAAwBN,GACtB,IAAIwN,EAAU,CAACxN,EAASyN,UAAU,CAAC,EAAG,IAAKzN,EAASyN,UAAU,CAACzN,EAASqB,MAAO,IAAKrB,EAASyN,UAAU,CAAC,EAAGzN,EAASuB,SAAUvB,EAASyN,UAAU,CAACzN,EAASqB,MAAOrB,EAASuB,UAC3K,MAAO,CAACiM,EAAQrP,OAAO,SAAUuP,EAAQ9Z,GACvC,OAAO8Z,EAAS9Z,EAAE,GAAK8Z,EAAS9Z,EAAE,IACjC,KAAM4Z,EAAQrP,OAAO,SAAUwP,EAAQ/Z,GACxC,OAAO+Z,EAAS/Z,EAAE,GAAK+Z,EAAS/Z,EAAE,IACjC,IAAK4Z,EAAQrP,OAAO,SAAUyP,EAAQha,GACvC,OAAOga,EAASha,EAAE,GAAKga,EAASha,EAAE,KAChC,KAAM4Z,EAAQrP,OAAO,SAAU0P,EAAQja,GACzC,OAAOia,EAASja,EAAE,GAAKia,EAASja,EAAE,KAChC,KAwCOka,CAHX9N,EAAW,IAAIA,EAASpO,YAAYT,GAAS,GAAI6O,EAAU,CACzDN,KAAMkL,EAAI,MAIRmD,EAAqB,YAAc,CAACzN,EAAK,GAAIA,EAAK,IAAKN,EAASgO,OAAOnZ,IAAIyX,IAC3E2B,EAAsB,GAAcF,EAAoB,GACxDG,EAAOD,EAAoB,GAC3BE,EAAOF,EAAoB,GAE3BG,EAAsB,YAAc,CAAC9N,EAAK,GAAIA,EAAK,IAAKN,EAASgO,OAAOnZ,IAAIyX,IAC5E+B,EAAsB,GAAcD,EAAqB,GACzDE,EAAOD,EAAoB,GAC3BE,EAAOF,EAAoB,GAE/BH,EAAOhR,KAAKC,MAAM+Q,GAClBI,EAAOpR,KAAKkQ,KAAKkB,GACjBH,EAAOjR,KAAKC,MAAMgR,GAClBI,EAAOrR,KAAKkQ,KAAKmB,GAGjB,IAFA,IAAIC,EAAU,GAELxE,EAAIkE,EAAMlE,EAAIsE,EAAMtE,IAC3B,IAAK,IAAI5W,EAAI+a,EAAM/a,EAAImb,EAAMnb,IACvBuZ,GAAW/B,EAAI+B,EACjB6B,EAAQvY,KAAKsW,GAAqB,CAChCvC,EAAGA,EACH5W,EAAGA,EACHwX,EAAGA,GACF+B,IAEH6B,EAAQvY,KAAK,CACX+T,EAAGA,EACH5W,EAAGA,EACHwX,EAAGA,IAMX,OAAO4D,EAmEeC,CAAezO,EAAUkN,EAAUC,GAErD,GAAKI,GAAsC,IAAvBA,EAAY/c,OAAhC,CAIAuc,EAAOrY,QAAQ,SAAUga,GACnBnB,EAAYoB,KAAK,SAAUxC,GAC7B,OAAOuC,EAAWE,aAAazC,OAE/BuC,EAAW7C,WAAY,KAM3B,IAFA,IAAIgD,GAAU,EAELte,EAAI,EAAGA,EAAIgd,EAAY/c,OAAQD,IAAK,CAC3C,IAAIue,EAAYvB,EAAYhd,GACxByZ,EAAI8E,EAAU9E,EACd5W,EAAI0b,EAAU1b,EACdwX,EAAIkE,EAAUlE,EAEduB,EAAOpZ,KAAKgc,SAAS/E,EAAG5W,EAAGwX,GAE1BuB,KACHA,EAAO,IAAIlB,GAAK,CACdC,YAAa2B,EACb7C,EAAGA,EACH5W,EAAGA,EACHwX,EAAGA,EACHO,WAAYpY,KAAKoY,WACjBC,YAAarY,KAAKqY,eAEfS,WAAY,EACjBgD,GAAU,GAGZ,IAAIG,EAASjc,KAAKkc,WAAWjF,EAAG5W,EAAGwX,GAEnCmC,EAAOtY,IAAIua,EAAQ7C,GAGrB,GAAI0C,EAAS,CAIX9b,KAAKmc,aAAapC,GAFI,EAE0BS,EAAY/c,QAE5DuC,KAAKia,OAASvT,MAAM8K,KAAKxR,KAAKga,OAAOoC,UACpCC,KAAK,SAAUC,EAAIC,GAClB,OAAOD,EAAGzE,EAAI0E,EAAG1E,QAQtB,CACD7Z,IAAK,eACLc,MAAO,SAAsB6a,GAC3B,IAAIK,EAASha,KAAKga,OAElB,GAAIA,EAAOwC,KAAO7C,EAAS,CACzB,IAAIhJ,EAAWqJ,EAAOtJ,OAAOC,YAGzBsF,GAA4B,EAC5BC,GAAoB,EACpBC,OAAiBpV,EAErB,IACE,IAAK,IAA6CqV,EAAzCC,EAAY1F,EAASD,OAAOC,cAAsBsF,GAA6BG,EAAQC,EAAUnF,QAAQC,MAAO8E,GAA4B,EAAM,CACzJ,IAAI0F,EAAavF,EAAMtX,MAEvB,GAAIkb,EAAOwC,MAAQ7C,EACjB,MAGF,IAAIsC,EAASN,EAAW,GACbA,EAAW,GAEZ7C,WACRkB,EAAOtC,OAAOuE,IAGlB,MAAO7K,GACP8E,GAAoB,EACpBC,EAAiB/E,EACjB,QACA,KACO6E,GAA6BI,EAAUE,QAC1CF,EAAUE,SAEZ,QACA,GAAIL,EACF,MAAMC,OAMf,CACDnY,IAAK,gBACLc,MAAO,WACLkB,KAAKga,OAAOrY,QAAQ,SAAUga,GAE5BA,EAAW7C,WAAY,MAG1B,CACD9a,IAAK,WACLc,MAAO,SAAkBmY,EAAG5W,EAAGwX,GAC7B,IAAIoE,EAASjc,KAAKkc,WAAWjF,EAAG5W,EAAGwX,GAEnC,OAAO7X,KAAKga,OAAOnI,IAAIoK,KAExB,CACDje,IAAK,aACLc,MAAO,SAAoBmY,EAAG5W,EAAGwX,GAC/B,OAAOA,EAAI,IAAMZ,EAAI,IAAM5W,IAE5B,CACDrC,IAAK,QACL6T,IAAK,WACH,OAAO7R,KAAKia,WAGTP,EAzLO,GA8LZxT,GAAe,CACjBuW,gBAAiB,CACflY,KAAM,WACNzF,MAAO,WACL,OAAO,OAGXqZ,YAAa,CACX5T,KAAM,WACNzF,MAAO,WACL,OAAOoB,QAAQT,QAAQ,QAI3Bid,iBAAkB,CAChBnY,KAAM,WACNoY,UAAU,EACV7d,MAAO,MAGTuZ,YAAa,CACX9T,KAAM,WACNzF,MAAO,SAAesS,GACpB,OAAO7O,QAAQ5B,MAAMyQ,KAGzBwI,QAAS,KACTC,QAAS,EACT+C,aAAc,MAGZC,GAAY,SAAUC,GAGxB,SAASD,IAEP,OADA,GAAe7c,KAAM6c,GACd,GAA0B7c,MAAO6c,EAAU7d,WAAalB,OAAOoH,eAAe2X,IAAYxV,MAAMrH,KAAM1B,YA8K/G,OAlLA,GAASue,EAAWC,GAOpB,GAAYD,EAAW,CAAC,CACtB7e,IAAK,kBACLc,MAAO,WACLkB,KAAKgN,MAAQ,CACX+P,MAAO,GACPC,UAAU,KAGb,CACDhf,IAAK,oBACLc,MAAO,SAA2BkI,GAEhC,OADkBA,EAAKiW,YACJC,mBAEpB,CACDlf,IAAK,cACLc,MAAO,SAAqB2U,GAC1B,IAAIlW,EAAQkW,EAAMlW,MACd4f,EAAU1J,EAAM0J,QAChBF,EAAcxJ,EAAMwJ,YACpBG,EAAYpd,KAAKgN,MAAMoQ,UAE3B,IAAKA,GAAaH,EAAYI,wBAA0BJ,EAAYI,sBAAsB9c,KAAO0c,EAAYI,sBAAsBlF,aAAc,CAC/I,IAAIA,EAAc5a,EAAM4a,YACpByB,EAAUrc,EAAMqc,QAChBC,EAAUtc,EAAMsc,QAChB+C,EAAerf,EAAMqf,aAErBQ,GACFA,EAAU/H,WAGZ+H,EAAY,IAAI1D,GAAU,CACxBvB,YAAaA,EACbwB,QAASiD,EACThD,QAASA,EACTC,QAASA,EACTzB,WAAYpY,KAAKsd,YAAYjb,KAAKrC,MAClCqY,YAAarY,KAAKud,aAAalb,KAAKrC,QAEtCA,KAAKsN,SAAS,CACZ8P,UAAWA,SAEJH,EAAYI,uBAErBrd,KAAKgN,MAAMoQ,UAAUL,MAAMpb,QAAQ,SAAUyX,GAC3CA,EAAK3W,MAAQ,OAIjB,IAAIwK,EAAWkQ,EAAQlQ,SAEvB,GAAIgQ,EAAYO,iBAAmC,6BAAhBvQ,EAASlK,GAAmC,CAC7E,IAAI8U,EAAI7X,KAAKyd,oBACbL,EAAU7Z,OAAO0J,GAEjB,IAAIyQ,EAAYN,EAAUL,MAAMzY,OAAO,SAAU8U,GAC/C,OAAOA,EAAKvB,IAAMA,IAEpB7X,KAAKsN,SAAS,CACZ0P,UAAU,EACVD,MAAOW,IAGT1d,KAAKsd,iBAGR,CACDtf,IAAK,cACLc,MAAO,WACL,IAAI4d,EAAmB1c,KAAKzC,MAAMmf,iBAC9BgB,EAAY1d,KAAKgN,MAAM+P,MACvBY,EAAqBD,EAAUE,MAAM,SAAUxE,GACjD,OAAOA,EAAK4D,WAGVhd,KAAKgN,MAAMgQ,WAAaW,IAC1B3d,KAAKsN,SAAS,CACZ0P,SAAUW,IAGRA,GAAsBjB,GACxBA,EAAiBgB,EAAUpZ,OAAO,SAAU8U,GAC1C,OAAOA,EAAKL,QACXjX,IAAI,SAAUsX,GACf,OAAOA,EAAKL,YAKnB,CACD/a,IAAK,eACLc,MAAO,SAAsB6B,GAC3BX,KAAKzC,MAAM8a,YAAY1X,GAEvBX,KAAKsd,gBAEN,CACDtf,IAAK,iBACLc,MAAO,SAAwB+e,GAC7B,IAAIC,EAAOD,EAAMC,KACbC,EAAcF,EAAME,YAGxB,OAFAD,EAAKC,YAAcA,EACnBD,EAAK1E,KAAO2E,EAAYxgB,MAAM6b,KACvB0E,IAER,CACD9f,IAAK,oBACLc,MAAO,WACL,IAAI+Y,EAAI1N,KAAKC,MAAMpK,KAAKmd,QAAQlQ,SAASN,MAAQ,EAC7CnE,EAASxI,KAAKzC,MACdqc,EAAUpR,EAAOoR,QACjBC,EAAUrR,EAAOqR,QAErB,OAAIlE,OAAOuE,SAASN,IAAY/B,EAAI+B,EAC3BzP,KAAKC,MAAMwP,GAGhBjE,OAAOuE,SAASL,IAAYhC,EAAIgC,EAC3B1P,KAAKkQ,KAAKR,GAGZhC,IAER,CACD7Z,IAAK,eACLc,MAAO,WACL,IAAIsG,EAASpF,KAETge,EAAUhe,KAAKzC,MACf0gB,EAAUD,EAAQC,QAClB7c,EAAU4c,EAAQ5c,QAClBsC,EAAesa,EAAQta,aACvB+Y,EAAkBuB,EAAQvB,gBAC1B5E,EAAI7X,KAAKyd,oBACb,OAAOzd,KAAKgN,MAAM+P,MAAMjb,IAAI,SAAUsX,GAKpC,IAAIN,EAAYmF,GAAW7E,EAAKN,aAAe1T,EAAO4H,MAAMgQ,UAAY5D,EAAKvB,IAAMA,GA2BnF,OAzBKuB,EAAK3W,MAWC2W,EAAK3W,MAAMlF,MAAM0gB,UAAYnF,EACtCM,EAAK3W,MAAQ2W,EAAK3W,MAAMyb,MAAM,CAC5BD,QAASnF,IAEFM,EAAK3W,MAAMlF,MAAM6D,UAAYA,EACtCgY,EAAK3W,MAAQ2W,EAAK3W,MAAMyb,MAAM,CAC5B9c,QAASA,IAEFgY,EAAK3W,MAAMlF,MAAMmG,eAC1B0V,EAAK3W,MAAQ2W,EAAK3W,MAAMyb,MAAM,CAC5Bxa,aAAcA,KAlBhB0V,EAAK3W,MAAQga,EAAgBre,GAAS,GAAIgH,EAAO7H,MAAO,CACtDwF,GAAIqC,EAAOrC,GAAK,IAAMqW,EAAKnC,EAAI,IAAMmC,EAAK/Y,EAAI,IAAM+Y,EAAKvB,EACzDjP,KAAMwQ,EAAKxQ,KACXqV,QAASnF,EACT1X,QAASA,EACTgY,KAAMA,EACNzM,KAAMkL,KAgBHuB,EAAK3W,YAIXoa,EAnLO,CAoLd,KAEFA,GAAUsB,UAAY,YACtBtB,GAAU3W,aAAeA,GACzB,IAGIkY,GAEAC,GAAc,KAAKA,YACnBC,IAA0D,GAA5BF,GAAwB,GAA0C,KAAGG,mBAAoB,KAAGC,SAAU,GAAeJ,GAAuB,KAAGK,mBAAoB,KAAGD,SAAU,GAAeJ,GAAuB,KAAGM,eAAgB,KAAGC,eAAgB,GAAeP,GAAuB,KAAGQ,eAAgB,KAAGD,eAAgBP,IAkCtW,GAAc,SAAUS,GAG1B,SAASC,IAEP,OADA,GAAe9e,KAAM8e,GACd,GAA0B9e,MAAO8e,EAAY9f,WAAalB,OAAOoH,eAAe4Z,IAAczX,MAAMrH,KAAM1B,YAmOnH,OAvOA,GAASwgB,EAAaD,GAOtB,GAAYC,EAAa,CAAC,CACxB9gB,IAAK,aACLc,MAAO,WAKL,MAAO,CACLigB,GAxDO,sWAyDPC,GAxDO,u1BAmDS1Y,QAAQ,iBAAkBxI,OAAOqB,KAAKa,KAAKzC,MAAMmG,cAAc5B,IAAI,SAAUjB,GAC7F,MAAO,iBAAmBA,EAAI,MAC7BgG,KAAK,MAAMP,QAAQ,mBAAoBtG,KAAKzC,MAAM0hB,gBAAkB,IAIrEC,QAAS,CAPS,YAOO,cAG5B,CACDlhB,IAAK,kBACLc,MAAO,WACkBkB,KAAKmf,sBACXxa,IAAI,CACnBya,UAAW,CACT5C,KAAM,EACNjZ,OAAQvD,KAAKqf,mBACbvgB,MAAO,IAAIwgB,aAAa,KAE1BC,iBAAkB,CAChB/C,KAAM,EACNjZ,OAAQvD,KAAKwf,0BACb1gB,MAAO,IAAIwgB,aAAa,OAG5Btf,KAAKsN,SAAS,CACZmS,aAAc,MAGjB,CACDzhB,IAAK,cACLc,MAAO,SAAqBkI,GAC1B,IAAIzJ,EAAQyJ,EAAKzJ,MACbmiB,EAAW1Y,EAAK0Y,SAEpB,GAAIniB,EAAMoiB,OAASD,EAASC,KAAM,CAChC,IAAIhM,EAAK3T,KAAKmd,QAAQxJ,GAElB3T,KAAKgN,MAAM4S,OACb5f,KAAKgN,MAAM4S,MAAMlI,SAGnB1X,KAAKsN,SAAS,CACZsS,MAAO5f,KAAK6f,UAAUlM,KAExB3T,KAAKmf,sBAAsBW,gBAGzBviB,EAAMwiB,QAAUL,EAASK,OAC3B/f,KAAKggB,YAAYziB,EAAMwiB,OAGzB,IAAIE,EAAmBjgB,KAAKmf,sBAExB5hB,EAAM8P,SAAWqS,EAASrS,SAC5BrN,KAAKsN,SAAS,CACZ8R,UAAWpf,KAAKkgB,wBAAwB3iB,EAAM8P,UAEhD4S,EAAiBE,WAAW,aAC5BF,EAAiBE,WAAW,uBAG/B,CACDniB,IAAK,gBACLc,MAAO,YAhrDD,SAAS+S,EAAIuO,EAAQ9d,EAAU+d,GACxB,OAAXD,IAAiBA,EAASE,SAASniB,WACvC,IAAIoiB,EAAOziB,OAAO0iB,yBAAyBJ,EAAQ9d,GAEnD,QAAavB,IAATwf,EAAoB,CACtB,IAAIlJ,EAASvZ,OAAOoH,eAAekb,GAEnC,OAAe,OAAX/I,OACF,EAEOxF,EAAIwF,EAAQ/U,EAAU+d,GAE1B,GAAI,UAAWE,EACpB,OAAOA,EAAKzhB,MAEZ,IAAI2hB,EAASF,EAAK1O,IAElB,YAAe9Q,IAAX0f,EAIGA,EAAOjiB,KAAK6hB,QAJnB,GAgqDExO,CAAIiN,EAAY3gB,UAAUa,WAAalB,OAAOoH,eAAe4Z,EAAY3gB,WAAY,gBAAiB6B,MAAMxB,KAAKwB,MAE7GA,KAAKgN,MAAM0T,eACb1gB,KAAKgN,MAAM0T,cAAchJ,WAG5B,CACD1Z,IAAK,0BACLc,MAAO,SAAiCuO,GACtC,IAAI+R,EAAY,IAAI1Y,MAAM,IAE1B,GAAIiP,OAAOuE,SAAS7M,EAAO,IAQzB+R,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK,EACfA,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK,EACfA,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,GAAK,EACfA,EAAU,GAAK/R,EAAO,GACtB+R,EAAU,IAAM/R,EAAO,GACvB+R,EAAU,IAAM,OAGhB,IAAK,IAAI5hB,EAAI,EAAGA,EAAI6P,EAAO5P,OAAQD,IACjC4hB,EAAc,EAAJ5hB,EAAQ,GAAK6P,EAAO7P,GAAG,GACjC4hB,EAAc,EAAJ5hB,EAAQ,GAAK6P,EAAO7P,GAAG,GACjC4hB,EAAc,EAAJ5hB,EAAQ,GAAK6P,EAAO7P,GAAG,IAAM,EAI3C,OAAO4hB,IAER,CACDphB,IAAK,YACLc,MAAO,SAAmB6U,GACxB,OAAKA,EAUE,IAAI,KAAMA,EAAI7V,OAAOO,OAAO,GAAI2B,KAAK2gB,aAAc,CACxD5d,GAAI/C,KAAKzC,MAAMwF,GACf6d,YAAa5gB,KAAKmd,QAAQyD,YAC1BC,SAAU,IAAI,KAAS,CACrBC,SAAU,KAAGC,aACbC,YAAa,EACbC,WAAY,CACVC,UAAW,IAAI5B,aAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,OAGtD6B,aAAa,KAnBN,OAsBV,CACDnjB,IAAK,OACLc,MAAO,SAAc2U,GACnB,IAAI2N,EAAW3N,EAAM2N,SACjBC,EAASrhB,KAAKgN,MACd0T,EAAgBW,EAAOX,cACvBd,EAAQyB,EAAOzB,MACfpX,EAASxI,KAAKzC,MACd+jB,EAAa9Y,EAAO8Y,WACpBC,EAAmB/Y,EAAO+Y,iBAC1BC,EAAYhZ,EAAOgZ,UACnB7U,EAAOnE,EAAOmE,KACdjJ,EAAe8E,EAAO9E,aACtBtC,EAAUoH,EAAOpH,QAGjBsf,GAAiBd,GACnBA,EAAM6B,YAAY3jB,OAAOO,OAAO,GAAI+iB,EAAUhjB,GAAS,CACrDsiB,cAAeA,EACfY,WAAYA,EACZC,iBAAkBA,EAClBC,UAAWA,EACX7U,KAAMA,GACLjJ,EAAc,CACftC,QAASA,MACNsgB,SAGR,CACD1jB,IAAK,cACLc,MAAO,SAAqBihB,GAC1B,IAAI3a,EAASpF,KAMb,GAJqB,kBAAV+f,IACTA,EAAQ,aAAUA,IAGhBA,aAAiB7f,QACnB6f,EAAMvf,KAAK,SAAUoI,GACnB,OAAOxD,EAAO4a,YAAYpX,SAF9B,CAOA,IAAI+K,EAAK3T,KAAKmd,QAAQxJ,GAElB3T,KAAKgN,MAAM0T,eACb1gB,KAAKgN,MAAM0T,cAAchJ,SAGvBqI,aAAiB,KACnB/f,KAAKsN,SAAS,CACZoT,cAAeX,KAGnBA,aAAiB4B,OAAS5B,aAAiB6B,oBACzC5hB,KAAKsN,SAAS,CACZoT,cAAe,IAAI,KAAU/M,EAAI,CAC/B/K,KAAMmX,EACN5L,WAAYmK,GACZuD,SAAS,SAKhB,CACD7jB,IAAK,qBACLc,MAAO,SAA4B+e,GACjC,IAAI/e,EAAQ+e,EAAM/e,MACdsgB,EAAYpf,KAAKgN,MAAMoS,UAC3BtgB,EAAM4C,IAAI0d,KAEX,CACDphB,IAAK,4BACLc,MAAO,SAAmCgjB,GACxC,IAAIC,EAAS/hB,KAAKgiB,qBAClBF,EAAUG,UAAYF,EAEjBA,GAKOD,EAAUhjB,MAChB4C,IAAI1B,KAAKgN,MAAMoS,UAAUtd,IAAIuc,KALjCyD,EAAUhjB,MAAQ,IAAIwgB,aAAa,OAQlCR,EAxOS,CAyOhB,KAEF,GAAYX,UAAY,cACxB,GAAYjY,aA7QS,CACnB6Z,MAAO,KACP1S,OAAQ,CACN9I,KAAM,QACNzF,MAAO,CAAC,EAAG,EAAG,EAAG,GACjBojB,SAAS,GAEXvC,MAAM,EACN2B,WAAY,CACV/c,KAAM,SACN4d,IAAK,EACLC,IAAK,EACLtjB,MAAO,GAKTyiB,iBAAkB,CAChBhd,KAAM,QACNzF,MAAO,CAAC,EAAG,EAAG,EAAG,IAEnB0iB,UAAW,CACTjd,KAAM,QACNzF,MAAO,CAAC,IAAK,IAAK,OAwPtB,IAsBIujB,GAAc,SAAqBvf,GACrC,IAAIwf,EAAqBxf,EAAWvE,OAChCA,OAAgCwC,IAAvBuhB,EAAmC,GAAKA,EACjDC,EAAqBzf,EAAWxB,OAChCA,OAAgCP,IAAvBwhB,EAAmC,GAAKA,EACjD7e,EAAeZ,EAAWY,aAC1BX,EAAKD,EAAWC,GAChB3B,EAAU0B,EAAW1B,QACrB6d,EAAiBnc,EAAWmc,eAC5BuD,EAAyB,CAC3Bzf,GAAIA,EAAK,UACTwB,KAAM,SACNhG,OAAQwE,GAENyB,EAAWjG,EAAOiG,SAClBie,EAAiBnhB,EAAOW,OACxBA,OAA4BlB,IAAnB0hB,EAA+B,CAACD,GAA0BC,EACnEhgB,EAAQ,GAiEZ,OA9DEA,EADEwc,EACM,CACNlc,GAAIA,EACJwB,KAAM,SACNtC,OAAQ,CAAC,CACPc,GAAIA,EAAK,oBACTwB,KAAM,aACN0O,MAAO,CACL,mBAAoB,iBAErB3L,OAAOgK,GAAkB/S,EAAOwe,MAAMjb,IAAI,SAAU+G,GACrD,OAAO,IAAI2O,GAAY,CACrBzU,GAAIA,EAAK,iBACTwB,KAAMsY,GACN1E,YAAa,SAAqBtY,GAChC,OAxDO,SAAsBmH,EAAM4K,GAC7C,IAAIqF,EAAIjQ,EAAKiQ,EACT5W,EAAI2G,EAAK3G,EACTwX,EAAI7Q,EAAK6Q,EACT6K,EAAY9Q,EAAItL,QAAQ,MAAOuR,GAAGvR,QAAQ,MAAO2Q,GAAG3Q,QAAQ,MAAOjG,GACvE,OAAOsiB,MAAMD,GAAWliB,KAAK,SAAUoiB,GACrC,OAAOA,EAASC,SACfriB,KAAK,SAAUoiB,GAChB,IACIre,GADQqe,GAAY,IACPre,KAEjB,GAAa,oBAATA,GAAuC,aAATA,GAAgC,cAATA,EAAsB,CAC7E,IAAIue,EAAMC,IAAIC,gBAAgBJ,GAC1B7C,EAAQ,IAAI4B,MAEhB,OADA5B,EAAM+C,IAAMA,EACL/C,EAGT,OAAO,IAsCQjG,CAAaja,EAAGgJ,IAEzB4T,gBAAiB,SAAyBoB,GACxC,IAAIoF,EAAapF,EAAM9a,GACnB6F,EAAOiV,EAAMjV,KACbwQ,EAAOyE,EAAMzE,KACb6E,EAAUJ,EAAMI,QAChBtR,EAAOkR,EAAMlR,KACbuW,EAAkBrF,EAAMna,aACxByf,EAAoBtF,EAAMoB,eAE9B,OAAIrW,GAAQA,EAAKka,IACR,IAAI,GAAY,CACrB/f,GAAIkgB,EACJlD,MAAOnX,EAAKka,IACZzV,OAAQ+L,EAAK7L,KACb0Q,QAASA,EACTtR,KAAMA,EACNjJ,aAAcwf,EACdjE,eAAgBkE,EAChB/hB,QAASA,IAIN,MAETyY,QAAStb,EAAO6kB,QAChBxJ,QAASrb,EAAO8kB,QAChBjiB,QAAS0B,EAAW1B,QACpBsC,aAAcA,EACdub,eAAgBA,SAKd,CACNlc,GAAIA,EACJwB,KAAM,SACNhG,OAAQH,GAAS,CACfmG,KAAM,SACN+e,SAAU,KACT/kB,GACH0D,OAAQ2Q,GAAqB3Q,EAAOH,IAAI,SAAUmB,GAChD,OAAO7E,GAAS,GAAIokB,EAAwBvf,KAC1CH,KAIJ0B,GAA+B,YAAlBA,EAASD,MAAwC,UAAlBC,EAASD,KAiBlD,IAAIzE,GAAkB,SAAUL,EAASC,GAC1C+C,EACFhD,EAAQgD,GAER/C,EAAO,IAAIkF,MAAM,4BApBZ,IAAI9E,GAAkB,SAAUL,EAASC,GAC9C,GAAoBoD,GAAYtC,KAAK,SAAUoiB,GAC7C,IAAIW,EAAUX,EAASY,QAAQC,UAAUC,MAAM9R,IAAItL,QAAQ,MAAO,KAAO,IAAM9B,EAASrC,QAAQkQ,QAAU,eAAiBuQ,EAASe,aAAe,mBACnJ,OAAOlkB,EAAQrB,GAAS,GAAIqE,EAAO,CACjClE,OAAQ,CACNgG,KAAM,SACN+e,SAAU,IACVvG,MAAO,CAACwG,SAGXtiB,MAAM,SAAUmQ,GACjB,OAAO1R,EAAO0R,QAclBwS,GAAc,SAAqB9gB,GACrC,IAAIwf,EAAqBxf,EAAWvE,OAChCA,OAAgCwC,IAAvBuhB,EAAmC,GAAKA,EACjDC,EAAqBzf,EAAWxB,OAChCA,OAAgCP,IAAvBwhB,EAAmC,GAAKA,EACjDxf,EAAKD,EAAWC,GAChByB,EAAWjG,EAAOiG,SAClBvC,EAASX,EAAOW,OAEhBQ,EAAQrE,GAAS,CACnB2E,GAAIA,EACJxE,OAAQH,GAAS,CACfmG,KAAM,UACLhG,IACF+C,EAAQ,CACTW,OAAQ2Q,GAAqB3Q,EAAQa,KAGvC,OAAI0B,GAA+B,YAAlBA,EAASD,MAAwC,UAAlBC,EAASD,KAgBlD,IAAIzE,GAAkB,SAAUL,EAASC,GAC1C+C,EACFhD,EAAQgD,GAER/C,EAAO,IAAIkF,MAAM,4BAnBZ,IAAI9E,GAAkB,SAAUL,EAASC,GAC9C,GAAoBoD,GAAYtC,KAAK,SAAUoiB,GAC7C,IAAIW,EAAUX,EAASY,QAAQC,UAAUC,MAAM9R,IAAItL,QAAQ,MAAO,KAAO,IAAM9B,EAASrC,QAAQkQ,QAAU,eAAiBuQ,EAASe,aAAe,mBACnJ,OAAOlkB,EAAQrB,GAAS,GAAIqE,EAAO,CACjClE,OAAQ,CACNgG,KAAM,SACNwY,MAAO,CAACwG,SAGXtiB,MAAM,SAAUmQ,GACjB,OAAO1R,EAAO0R,QA2ClByS,GAAe,SAAsB/gB,GACvC,IAAIwf,EAAqBxf,EAAWvE,OAChCA,OAAgCwC,IAAvBuhB,EAAmC,GAAKA,EACjDC,EAAqBzf,EAAWxB,OAChCA,OAAgCP,IAAvBwhB,EAAmC,GAAKA,EACjDxf,EAAKD,EAAWC,GAChBd,EAASX,EAAOW,OAEhBQ,EAAQrE,GAAS,CACnB2E,GAAIA,EACJxE,OAAQH,GAAS,CACfmG,KAAM,WACLhG,IACF+C,EAAQ,CACTW,OAAQ2Q,GAAqB3Q,EAAQa,KAGvC,OAAIvE,EAAOkJ,OAAiC,oBAAjBlJ,EAAOkJ,MACzB,IAAI3H,GAAkB,SAAUL,EAASC,IA/C7B,SAA0BoD,GAC/C,IAAIvE,EAASuE,EAAWvE,OACpBiF,EAASV,EAAWU,OACpBC,EAAYX,EAAWW,UACvB6O,EAAexP,EAAWwP,aAI1B1J,KAHgC,IAAjBrK,EAAOkJ,OAA2C,oBAAjBlJ,EAAOkJ,MAAuBlJ,EAASmJ,KAAKD,MAAMnB,GAAQoB,KAAKC,UAAUpJ,GAASiF,EAAQC,MAEnH,IACXmF,KAEZ0J,GACFA,EAAaxR,OAAO,mCAGtB,IAAIyR,EAAqB,cAAYhU,SAYrC,OAXAuE,EAAWpB,IAAI,eAAgB6Q,GACTZ,GAAM/I,EAAM,CAChC4J,YAAaD,EAAmBE,QAC/BjS,KAAK,SAAUkS,GAChB,OAAIA,EAAIC,OAAS,KACfpQ,QAAQ5B,MAAM+R,IACP,GAGFA,EAAI9J,QAwBT,CAAiB9F,GAAYtC,KAAK,SAAUoiB,GAC1C,IAAIha,EAAOrK,EAAOkJ,MAAMmb,GAEpBkB,EAAgB1lB,GAAS,GAAIqE,EAAO,CACtClE,OAAQH,GAAS,CACfmG,KAAM,WACLhG,EAAQ,CACTqK,KAAMA,MAIVnJ,EAAQqkB,KACP7iB,MAAM,SAAUmQ,GACjB,OAAO1R,EAAO0R,OAKb,IAAItR,GAAkB,SAAUL,EAASC,GAC1C+C,EACFhD,EAAQgD,GAER/C,EAAO,IAAIkF,MAAM,oDAKnBmf,GAAa,SAAoBjhB,GACnC,IAAIwf,EAAqBxf,EAAWvE,OAChCA,OAAgCwC,IAAvBuhB,EAAmC,GAAKA,EACjDC,EAAqBzf,EAAWxB,OAChCA,OAAgCP,IAAvBwhB,EAAmC,GAAKA,EACjD/e,EAASV,EAAWU,OACpBC,EAAYX,EAAWW,UACvBV,EAAKD,EAAWC,GAChByE,GAAgC,IAAjBjJ,EAAOkJ,MAAkBlJ,EAASmJ,KAAKD,MAAMnB,GAAQoB,KAAKC,UAAUpJ,GAASiF,EAAQC,IACpGmE,GAAgC,IAAjBtG,EAAOmG,MAAkBlJ,EAASmJ,KAAKD,MAAMnB,GAAQoB,KAAKC,UAAUrG,GAASkC,EAAQC,IAEpGhB,EAAQrE,GAAS,CACnB2E,GAAIA,EACJwB,KAAM,SACNhG,OAAQH,GAAS,GAAIoJ,EAAc,CACjCjD,KAAM,cAENwY,MAAO,CAAC,2FACRiH,OAAQ,MACRV,SAAU,IACVF,QAAS,EACTC,QAAS,EACTY,aAAc,MAGfrc,EAAc,CACf3F,OAAQ,CAAC,CACPc,GAAIA,EAAK,UACTwB,KAAM,SACNhG,OAAQwE,MAIZ,OAAO,IAAIjD,GAAkB,SAAUL,EAASC,GAC1C+C,EACFhD,EAAQgD,GAER/C,EAAO,IAAIkF,MAAM,6BAOnB,GAAiB,WACnB,SAASsf,EAAepiB,EAAKK,GAC3B,IAAIvB,EAAQZ,KAEZ,GAAeA,KAAMkkB,GACrBlkB,KAAKuE,KAAO,CACV4f,OAAQ9B,GACR+B,OAAQR,GACRS,QAASR,GACTS,MAAOP,IAET/jB,KAAK8B,IAAMA,EACX9B,KAAKmC,QAAUA,EAEfnC,KAAK8B,IAAIqT,GAAG,aAAc,WACXvU,EAAMwB,YAEZT,QAAQ,SAAUc,GACvB,OAAO7B,EAAM+D,IAAIlC,OAgXvB,OA3WA,GAAYyhB,EAAgB,CAAC,CAC3BlmB,IAAK,MAMLc,MAAO,SAAagE,GAClB,IAAIsC,EAASpF,KAETsD,EAAWR,EAAWQ,SACtBihB,EAAYvkB,KAAKoC,YAEjBpC,KAAK8B,KAAOwB,GAAYA,EAAS/E,QAAU+E,EAASP,KAAO/C,KAAK8B,IAAIsH,UAAU9F,EAASP,KACzF/C,KAAK8B,IAAI0iB,UAAUlhB,EAASP,GAAIO,EAAS/E,QAIvC+E,GAAYA,EAASrB,QACvBqB,EAASrB,OAAON,QAAQ,SAAUsB,GAChC,IAAIwhB,EAAcxhB,EAAEyhB,SAEhBC,EAAoC,cADT5jB,IAAhB0jB,EAA4B,GAAKA,GACrBG,SAAqB,KAAOxf,EAAOyf,eAAe/hB,GAExEsC,EAAOtD,IAAIgjB,SAAS7hB,EAAEF,KACzBqC,EAAOtD,IAAIijB,SAAS9hB,EAAG0hB,GAGzBJ,EAAU5iB,QAAQ,WAChByD,EAAOvB,kBAUd,CACD7F,IAAK,SACLc,MAAO,WACL,IAAIkmB,EAAShlB,KAET8C,EAAaxE,UAAUb,OAAS,QAAsBsD,IAAjBzC,UAAU,GAAmBA,UAAU,GAAK,GACjFgF,EAAWR,EAAWQ,SAEtBA,GAAYA,EAASrB,QAAUjC,KAAK8B,KAAO9B,KAAK8B,IAAImjB,OACtD3hB,EAASrB,OAAON,QAAQ,SAAUsB,GAC5B+hB,EAAOljB,IAAIgjB,SAAS7hB,EAAEF,KACxBiiB,EAAOljB,IAAIojB,YAAYjiB,EAAEF,MAK3BO,GAActD,KAAK8B,KAAO9B,KAAK8B,IAAIsH,UAAU9F,EAASP,KACxD/C,KAAK8B,IAAIqjB,aAAa7hB,EAASP,MAQlC,CACD/E,IAAK,iBACLc,MAAO,SAAwByF,GAC7B,OAAOvE,KAAKuE,KAAKA,KAMlB,CACDvG,IAAK,iBACLc,MAAO,WACL,OAAOkB,KAAK8B,IAAIsjB,WAAWnjB,SAE5B,CACDjE,IAAK,WACLc,MAAO,SAAkBgE,GACvB,IAAIQ,EAAWR,EAAWQ,SAE1B,OAAItD,KAAK8B,IACA9B,KAAK8B,IAAIsH,UAAU9F,EAASP,IAG9B,OAMR,CACD/E,IAAK,YACLc,MAAO,WACL,IAAIsD,EAAYpC,KAAKmC,QAAQC,UACzBH,EAASG,IACb,OAAO,KAAOH,EAAQ,SAAUgB,GAC9B,OAAOA,EAAEgc,mBAQZ,CACDjhB,IAAK,iBACLc,MAAO,SAAwBgE,GAC7B,IAAIH,EAASG,EAAWH,OACpB4hB,EAAYvkB,KAAKoC,YACjBijB,EAAcrlB,KAAKslB,iBAEnBC,EAAcF,GAAeA,EAAY5nB,QAAU4nB,EAAYriB,KAAK,SAAUC,GAChF,OAAOA,EAAEF,GAAGyiB,SAAS,kBAAoBviB,EAAEF,GAAGyiB,SAAS,UAAYviB,EAAEF,GAAGyiB,SAAS,UAAYviB,EAAEF,GAAGyiB,SAAS,SAOzGC,EAJe,KAAOlB,EAAW,SAAUthB,GAC7C,OAAOA,EAAEN,SAGkBK,KAAK,SAAUC,GAC1C,OAAOA,EAAEN,OAASA,KAAYM,EAAEK,WAAaL,EAAEK,SAASrB,SAAWgB,EAAEK,SAASrB,OAAO,KAAOgB,EAAEK,SAASrB,OAAO,GAAGyiB,WAAazhB,EAAEK,SAASrB,OAAO,GAAGyiB,SAASE,YAG9J,IAAKa,GAAeA,IAAcA,EAAUniB,SAC1C,OAAOiiB,EAAYxiB,GAIrB,IAGIA,EAHqB0iB,EAAUniB,SAASrB,OACD,GAEhBc,GAM3B,QAJyBsiB,EAAYriB,KAAK,SAAUC,GAClD,OAAOF,IAAOE,EAAEF,KAGQA,EAAKwiB,EAAYxiB,KAO5C,CACD/E,IAAK,YACLc,MAAO,WACL,IAAI4mB,EAAS1lB,KAETukB,EAAYvkB,KAAKoC,YACjBijB,EAAcrlB,KAAKslB,iBAEvBD,EAAY1jB,QAAQ,SAAUsB,GAC5B,IAAIF,EAAKE,EAAEF,GACP4iB,EAAe1iB,EAAEyhB,SACjBA,OAA4B3jB,IAAjB4kB,EAA6B,GAAKA,EAC7C7iB,EAAayhB,EAAUvhB,KAAK,SAAU4iB,GACxC,OAAO7iB,EAAGyiB,SAASI,EAAG7iB,MAGxB,GAAID,EAAY,CACd,IAAI6hB,EAAoC,QAAtBD,EAASE,SAAqB,KAAOc,EAAOb,eAAe/hB,GAE7E4iB,EAAO5jB,IAAI+jB,UAAU9iB,EAAI4hB,MAI7B,IAAImB,EAAevB,EAAUjgB,OAAO,SAAUrB,GAC5C,QAASA,EAAEgc,iBAwBb,OArBI6G,GAAgB9lB,KAAK8B,KACvBgkB,EAAankB,QAAQ,SAAUmB,GAC7B,IAAIQ,EAAWR,EAAWQ,SAE1B,GAAIA,EAAU,CACZ,IAAIrB,EAASqB,EAASrB,OAClB8jB,EAAc9jB,EAAO,GACrB+jB,EAAa/jB,EAAO,GACpBgkB,EAAmBZ,EAAYriB,KAAK,SAAU4iB,GAChD,OAAOA,EAAG7iB,KAAOgjB,EAAYhjB,KAG3BmjB,EAAkBR,EAAO5jB,IAAIgjB,SAASkB,EAAWjjB,IAEjDkjB,GAAoBC,GACtBR,EAAO5jB,IAAI+jB,UAAUG,EAAWjjB,GAAIgjB,EAAYhjB,QAMjD,IAQR,CACD/E,IAAK,aACLc,MAAO,SAAoBgE,EAAY1B,GACrC,IAAI+kB,EAASnmB,KAETomB,EAAoB,CACtBjT,OAAQ,CAAC,OAAQ,QACjBC,OAAQ,CAAC,SAAU,kBAEjB9R,EAASwB,EAAWxB,OACpBgC,EAAWR,EAAWQ,SACtB2b,EAAiBnc,EAAWmc,eAC5BwD,EAAiBnhB,EAAOW,OACxBA,OAA4BlB,IAAnB0hB,EAA+B,GAAKA,EAuBjD,GArBInf,EAASrB,SAAWgd,GACtB3b,EAASrB,OAAON,QAAQ,SAAUsB,GAEhC,IAAIojB,EAAkBD,EAAkBnjB,EAAEsB,OAAS,CAACtB,EAAEsB,MAKlD+hB,GAHOrkB,EAAOe,KAAK,SAAU4D,EAAGpJ,GAClC,OAAQoJ,EAAE7D,IAAME,EAAE1E,OAAS,IAAMqI,EAAErC,KAAO,IAAM/G,KAAOyF,EAAEF,MACrD,IACgBkQ,MAClBA,OAAuBlS,IAAfulB,EAA2B,GAAKA,EAG5CD,EAAgB1kB,QAAQ,SAAU0R,GAChC,IAAIC,EAAkBL,EAAMI,EAAO,YAC/BkT,OAAmCxlB,IAApBuS,EAAgCA,EAAkB,EAErE6S,EAAOrkB,IAAI0kB,iBAAiBvjB,EAAEF,GAAIsQ,EAAO,WAAYkT,EAAenlB,EAAU,SAKhF6d,EAAgB,CAClB,IAAIxc,EAAQa,EAASrB,OAAO,GAExBQ,GAAmC,oBAAnBA,EAAMuS,UACxBvS,EAAMuS,SAAS,CACb5T,QAASA,OAWhB,CACDpD,IAAK,gBACLc,MAAO,SAAuBgE,EAAYzB,GACxC,IAAIolB,EAASzmB,KAETsD,EAAWR,EAAWQ,SAEtBA,GAAYA,EAASrB,QAAUjC,KAAK8B,KAAO9B,KAAK8B,IAAImjB,OACtD3hB,EAASrB,OAAON,QAAQ,SAAUsB,GAChCwjB,EAAO3kB,IAAI4kB,kBAAkBzjB,EAAEF,GAAI,aAAc1B,EAAa,UAAY,YAI/E,CACDrD,IAAK,YACLc,MAAO,SAAmBgE,GACxB,IAAIC,EAAKD,EAAWC,GAChBxE,EAASuE,EAAWvE,OACpBgG,EAAOhG,EAAOgG,KACdqE,EAAOrK,EAAOqK,KAEd5I,KAAK8B,KAAgB,YAATyC,GAAsC,kBAATqE,GACjC5I,KAAK8B,IAAIsH,UAAUrG,GACzB4jB,QAAQ/d,GAGd,OAAO5I,OAER,CACDhC,IAAK,YACLc,MAAO,SAAmBgE,GACxB,IAAI8jB,EAAS5mB,KAETsD,EAAWR,EAAWQ,SAEtBujB,EADS/jB,EAAWxB,OACKW,OACzB6kB,OAAmC/lB,IAApB8lB,EAAgC,GAAKA,EAExD,IAAKvjB,IAAawjB,EAAarpB,OAC7B,OAAOuC,KAGT,IACEsD,EAASrB,OAAON,QAAQ,SAAUc,EAAOjF,GACvC,IAAIuF,EAAKN,EAAMM,GACXgkB,EAAKD,EAAatpB,IAAMspB,EAAa,IAAM,GAE3CE,EAAYD,EAAG9T,MACfA,OAAsBlS,IAAdimB,EAA0B,GAAKA,EACvCC,EAAaF,EAAGG,OAChBA,OAAwBnmB,IAAfkmB,EAA2B,GAAKA,EACzCE,EAAaJ,EAAGziB,OAChBA,OAAwBvD,IAAfomB,EAA2B,KAAOA,EAE/CP,EAAO9kB,IAAIslB,UAAUrkB,EAAIuB,GAEzBxG,OAAOqB,KAAK8T,GAAOtR,QAAQ,SAAUd,GAEnC+lB,EAAO9kB,IAAI0kB,iBAAiBzjB,EAAIlC,EAAGoS,EAAMpS,MAE3C/C,OAAOqB,KAAK+nB,GAAQvlB,QAAQ,SAAUsB,GACpC2jB,EAAO9kB,IAAI4kB,kBAAkB3jB,EAAIE,EAAGikB,EAAOjkB,QAG/C,MAAOtC,GACP4B,QAAQ5B,MAAMA,GAGhB,OAAOX,OAER,CACDhC,IAAK,YACLc,MAAO,WACL,OAAOkB,OAER,CACDhC,IAAK,eACLc,MAAO,WACL,OAAOkB,OAER,CACDhC,IAAK,kBACLc,MAAO,SAAyBgE,GAC9B,IAAIQ,EAAWR,EAAWQ,SACtBI,EAAeZ,EAAWY,aAE9B,IAAKJ,EACH,OAAOtD,KAGT,IAAIyC,EAAQa,EAASrB,OAAO,GAU5B,OARIQ,GAAmC,oBAAnBA,EAAMuS,SACxBvS,EAAMuS,SAAS,CACbtR,aAAcA,IAGhBnB,QAAQ5B,MAAM,+FAGTX,OAER,CACDhC,IAAK,UACLc,MAAO,WACLkB,KAAK8B,IAAM,SAGRoiB,EAlYY,G,SCvrEN,IAEb,CACEnhB,GAAI,OACJsQ,KAAM,kBACNnI,OAAQ,CACN3G,KAAM,SACNhG,OAAQ,CACNgG,KAAM,SACNwY,MAAO,CAAC,gFACRqG,QAAS,EACTC,QAAS,KAGbgE,aAAc,CACZ9iB,KAAM,QACN+iB,MAAO,CAAC,CAAEjU,KAAM,kBAAmBkU,MAAO,cAK9C,CACExkB,GAAI,OACJsQ,KAAM,kBACNnI,OAAQ,CACN3G,KAAM,SACNhG,OAAQ,CACNgG,KAAM,SACNwY,MAAO,CACL,kGAEFqG,QAAS,EACTC,QAAS,KAGbgE,aAAc,CACZG,SAAS,GAEXC,aAAc,CACZ,CACEnc,QAAS,aACTtN,IAAK,YACL0pB,UAAU,GAEZ,CACEpc,QAAS,aACTtN,IAAK,UACL0pB,UAAU,IAGdC,eAAgB,CACdC,KAAM,EACNC,MAAO,IACPC,SAAU,QACVC,WAAY,OACZvc,YAAa,aACbjB,QAAS,aACTD,QAAS,aACT0d,SAAS,EACTC,UAAW,CACTC,WAAY,QAEdC,WAAY,CACV,CACED,WAAY,WAEd,CACEA,WAAY,aAIlBjJ,eAAe,uoCAiCjB,CACElc,GAAI,kBACJsQ,KAAM,kBACNnI,OAAQ,CACN3G,KAAM,SACNhG,OAAQ,CACNgG,KAAM,SACNC,SAAU,CACRD,KAAM,QACNpC,QAAS,CACPkQ,QAAS,SACTpQ,OAAQ,CACN,CACEE,QAAS,CACPimB,SACE,yEACFC,iBAAkB,QAClB5hB,IAAK,sCAEPlC,KAAM,cAMhBjD,OAAQ,CACNW,OAAQ,CACN,CACEsC,KAAM,OACN,eAAgB,SAChB0O,MAAO,CACL,aAAc,UACd,eAAgB,IAGpB,CACE1O,KAAM,OACN,eAAgB,SAChB0O,MAAO,CACL,aAAc,UACd,eAAgB,QAM1BqV,aAAc,GACdjB,aAAc,CACZ9iB,KAAM,QACN+iB,MAAO,CAAC,CAAEjU,KAAM,kBAAmBkU,MAAO,e,8jBCmGjCgB,OA5Nf,WAAgB,IAAD,EACeC,mBAASC,IADxB,mBACNxmB,EADM,KACEymB,EADF,OAEuBF,mBAAS9gB,KAAKC,UAAU8gB,GAAgB,KAAM,IAFrE,mBAENE,EAFM,KAEMC,EAFN,OAG+BJ,mBAAS,IAHxC,mBAGNK,EAHM,KAGUC,EAHV,KAKPC,EAAc9mB,EAAOH,IAAI,SAAAmB,GAAM,IAC3BF,EAA8DE,EAA9DF,GAAIulB,EAA0DrlB,EAA1DqlB,aAAcU,EAA4C/lB,EAA5C+lB,UAAWvB,EAAiCxkB,EAAjCwkB,aAAcE,EAAmB1kB,EAAnB0kB,eAC7CsB,EAAYJ,EAAe9lB,IAAO,GAElCS,IAAW8kB,GAAgBrd,EAAUqd,EAAcW,EAAUzlB,QAC7DC,IAAculB,GAAa/d,EAAU+d,EAAWC,EAAUxlB,WAC1DC,IACF+jB,GAAgBxc,EAAUwc,EAAD,MAAoBE,EAApB,GAAuCsB,EAAUvlB,eACxEwlB,IAAmBvB,GAAF,MAClBA,EADkB,GAElB1c,EAAUqd,EAAcW,EAAUzlB,QAFhB,GAGlByH,EAAUwc,EAAcwB,EAAUvlB,eAGvC,OAAO,IACLX,KACAomB,KAAMpmB,EACNqmB,QAASrmB,EACTd,OAAQ,CAAC,IAELonB,QAAQ,GACLpmB,EAHC,GAIDgmB,EAJC,CAKJzlB,SACAC,YACAC,eACAwlB,qBAGDD,KAmBDK,EAAqB,SAACrmB,EAAG5B,GAC7BynB,EAAkB,MACbD,EADY,eAEd5lB,EAAEF,GAFY,MAGV8lB,EAAe5lB,EAAEF,IAHP,CAIb1B,mBAKAkoB,EAAkB,SAACtmB,EAAG7B,GAC1B0nB,EAAkB,MACbD,EADY,eAEd5lB,EAAEF,GAFY,MAGV8lB,EAAe5lB,EAAEF,IAHP,CAIb3B,gBAKAooB,EAAoB,SAACC,EAAOhnB,GAAW,IACnCM,EAAqBN,EAArBM,GAAI0kB,EAAiBhlB,EAAjBglB,aAEZqB,EAAkB,MACbD,EADY,eAEd9lB,EAFc,MAGV8lB,EAAe9lB,GAHL,GAIT0kB,GAAgB,CAClB/jB,aAAc,CACZ8F,UAAWigB,EAAM,GACjBhgB,QAASggB,EAAM,GACfje,YAAaie,EAAM,KARV,IAWRhC,GAAgB,CACnBjkB,OAAQ,CACNgG,UAAWigB,EAAM,GACjBhgB,QAASggB,EAAM,UAOzB,OACE,yBAAK5Z,UAAU,SACb,kBAAC,SAAD,MAEA,yBAAKA,UAAU,UACb,kBAAC,EAAD,KACE,kBAAC,IAAD,CACE6Z,KAAK,OACLC,MAAM,SACN7qB,MAAO6pB,EACPiB,SArEW,SAAAC,GACnBjB,EAAciB,GAEd,IACE,IAAMC,EAAYpiB,KAAKD,MAAMoiB,GAC7BnB,EAAUoB,GACV,MAAOjqB,MAgEDkqB,QAAS,EACTzb,MAAM,OACNE,OAAO,OACPwb,aAAW,EACXC,iBAAiB,EACjBC,YAAa,CAAEC,iBAAiB,GAChCC,qBAAsB,OAI1B,yBAAKva,UAAU,mBACb,kBAAC,EAAD,CACEwa,qBAAsBC,oGACtBC,SAAS,0DACT1Q,QAAS,GAER,SAAA/X,GAAG,OACF,kBAAC,eAAD,CAAcA,IAAKA,EAAKE,OAAQwoB,IAC7BvoB,EAAOH,IAAI,SAAAW,GAAU,IAElBM,EAMEN,EANFM,GACAulB,EAKE7lB,EALF6lB,aACAU,EAIEvmB,EAJFumB,UACAvB,EAGEhlB,EAHFglB,aACAE,EAEEllB,EAFFklB,eACA1I,EACExc,EADFwc,eAEIgK,EAAYJ,EAAe9lB,IAAO,GAElCE,EAAC,MACFR,EADE,GAEFA,EAAMyI,OAFJ,GAGF+d,EAHE,KAICX,GAAgB,CACpB9kB,OAAQyH,EAAUqd,EAAD,MAAoBW,EAAUzlB,UAL5C,KAQCwlB,GAAa,CACjBvlB,UAAWwH,EAAU+d,EAAD,MAAiBC,EAAUxlB,aAT5C,KAYCgkB,GAAgB,CACpB/jB,aAAcuH,EAAUwc,EAAD,MAClBE,EADkB,GAElBsB,EAAUvlB,eAEfub,mBAIJ,OAAO,kBAAC,QAAD,eAAOjhB,IAAKyE,EAAMM,IAAQE,SAMzC,yBAAK4M,UAAU,YACb,kBAAC,UAAD,CACE4a,UAAW,OACXC,aAAa,EACbC,UAAU,EACVC,cAxHU,SAAAC,GACpBtoB,QAAQiU,IAAI,gBAAiBqU,KAyHlB9B,EAAYjnB,IAAI,SAACgpB,EAAYttB,GAC5B,OACE,kBAAC,kBAAD,CACEutB,MAAOvtB,EACPQ,IAAK8sB,EAAW3B,KAChB2B,WAAYA,EACZE,QACE,kBAAC,qBAAD,KACE,kBAAC,2BAAD,CACE7C,WAAY,CACVD,WAAY,WAEd+C,YAAa,CACX/C,WAAY,aAGhB,kBAAC,8BAAD,OAGJoB,mBAAoBA,EACpBC,gBAAiBA,GAEjB,kBAAC,mBAAD,MAEA,kBAAC,sBAAD,CACE2B,cAAe,CACbD,YAAa,CACXE,gBAAiB,QACjBC,aAAc,MACdC,UAAW,kCACXC,OAAQ,MACR3oB,OAAQ,GAEVslB,UAAW,CAAEkD,gBAAiB,WAC9BI,SAAU,CAAElqB,WAAY,SAAUiqB,OAAQ,QAE5CE,aAAchC,aCnOhBiC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2D,OCXNC,IAASxqB,OAAO,kBAAC,GAAD,MAASyqB,SAASC,eAAe,SD0H3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAM3rB,KAAK,SAAA4rB,GACjCA,EAAaC,iB","file":"static/js/main.064b8f2c.chunk.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash/isEqual'), require('lodash/isEmpty'), require('react'), require('prop-types'), require('lodash/compact')) : typeof define === 'function' && define.amd ? define(['lodash/isEqual', 'lodash/isEmpty', 'react', 'prop-types', 'lodash/compact'], factory) : global.LayerManager = factory(global.isEqual, global.isEmpty, global.React, global.PropTypes, global.compact);\n})(this, function (isEqual, isEmpty, react, PropTypes, compact) {\n  'use strict';\n\n  isEqual = isEqual && isEqual.hasOwnProperty('default') ? isEqual['default'] : isEqual;\n  isEmpty = isEmpty && isEmpty.hasOwnProperty('default') ? isEmpty['default'] : isEmpty;\n  PropTypes = PropTypes && PropTypes.hasOwnProperty('default') ? PropTypes['default'] : PropTypes;\n  compact = compact && compact.hasOwnProperty('default') ? compact['default'] : compact;\n\n  var classCallCheck = function classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  var inherits = function inherits(subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  var objectWithoutProperties = function objectWithoutProperties(obj, keys) {\n    var target = {};\n\n    for (var i in obj) {\n      if (keys.indexOf(i) >= 0) continue;\n      if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n      target[i] = obj[i];\n    }\n\n    return target;\n  };\n\n  var possibleConstructorReturn = function possibleConstructorReturn(self, call) {\n    if (!self) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n  };\n\n  var handleCallback = function handleCallback(resolve, reject, callback, r) {\n    try {\n      resolve(callback(r));\n    } catch (e) {\n      reject(e);\n    }\n  };\n\n  var CancelablePromise = function () {\n    createClass(CancelablePromise, null, [{\n      key: \"all\",\n      value: function all(iterable) {\n        return new CancelablePromise(function (y, n) {\n          Promise.all(iterable).then(y, n);\n        });\n      }\n    }, {\n      key: \"race\",\n      value: function race(iterable) {\n        return new CancelablePromise(function (y, n) {\n          Promise.race(iterable).then(y, n);\n        });\n      }\n    }, {\n      key: \"reject\",\n      value: function reject(value) {\n        return new CancelablePromise(function (y, n) {\n          Promise.reject(value).then(y, n);\n        });\n      }\n    }, {\n      key: \"resolve\",\n      value: function resolve(value) {\n        return new CancelablePromise(function (y, n) {\n          Promise.resolve(value).then(y, n);\n        });\n      }\n    }]);\n\n    function CancelablePromise(executor) {\n      classCallCheck(this, CancelablePromise);\n      this._promise = new Promise(executor);\n      this._canceled = false;\n    }\n\n    createClass(CancelablePromise, [{\n      key: \"then\",\n      value: function then(success, error) {\n        var _this = this;\n\n        var p = new CancelablePromise(function (resolve, reject) {\n          _this._promise.then(function (r) {\n            if (_this._canceled) {\n              p.cancel();\n            }\n\n            if (success && !_this._canceled) {\n              handleCallback(resolve, reject, success, r);\n            } else {\n              resolve(r);\n            }\n          }, function (r) {\n            if (_this._canceled) {\n              p.cancel();\n            }\n\n            if (error && !_this._canceled) {\n              handleCallback(resolve, reject, error, r);\n            } else {\n              reject(r);\n            }\n          });\n        });\n        return p;\n      }\n    }, {\n      key: \"catch\",\n      value: function _catch(error) {\n        return this.then(undefined, error);\n      }\n    }, {\n      key: \"cancel\",\n      value: function cancel(errorCallback) {\n        this._canceled = true;\n\n        if (errorCallback) {\n          this._promise.catch(errorCallback);\n        }\n\n        return this;\n      }\n    }]);\n    return CancelablePromise;\n  }();\n\n  var LayerModel = function () {\n    function LayerModel() {\n      var layerSpec = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      classCallCheck(this, LayerModel);\n      this.opacity = 1;\n      this.visibility = true;\n      this.source = {};\n      this.render = {};\n      Object.assign(this, layerSpec, {\n        changedAttributes: {}\n      });\n    }\n\n    createClass(LayerModel, [{\n      key: 'get',\n      value: function get$$1(key) {\n        return this[key];\n      }\n    }, {\n      key: 'set',\n      value: function set$$1(key, value) {\n        this[key] = value;\n        return this;\n      }\n    }, {\n      key: 'update',\n      value: function update(layerSpec) {\n        var _this = this;\n\n        var prevData = _extends({}, this);\n\n        var nextData = _extends({}, layerSpec); // reseting changedAttributes for every update\n\n\n        this.set('changedAttributes', {});\n        Object.keys(nextData).forEach(function (k) {\n          if (!isEqual(prevData[k], nextData[k])) {\n            _this.changedAttributes[k] = nextData[k];\n\n            _this.set(k, nextData[k]);\n          }\n        });\n      }\n    }]);\n    return LayerModel;\n  }();\n\n  function checkPluginProperties(plugin) {\n    if (plugin) {\n      var requiredProperties = ['add', 'remove', 'setVisibility', 'setOpacity', 'setZIndex', 'setSource', 'setRender', 'setParams', 'setSQLParams', 'setDecodeParams', 'getLayerByType'];\n      requiredProperties.forEach(function (property) {\n        if (!plugin[property]) {\n          console.error('The ' + property + ' function is required for layer manager plugins');\n        }\n      });\n      var deprecatedProperties = ['getLayerByProvider'];\n      deprecatedProperties.forEach(function (property) {\n        if (plugin[property]) {\n          console.warn('The ' + property + ' function is deprecated for layer manager plugins');\n        }\n      });\n    }\n  }\n\n  var LayerManager = function () {\n    function LayerManager(map, Plugin) {\n      classCallCheck(this, LayerManager);\n      this.map = map;\n      this.layers = [];\n      this.promises = {};\n      this.options = {\n        getLayers: this.getLayers.bind(this)\n      };\n      this.plugin = new Plugin(this.map, this.options);\n      checkPluginProperties(this.plugin);\n    }\n    /**\n     * Add layers\n     * @param {Array} layers\n     * @param {Object} layerOptions\n     */\n\n\n    createClass(LayerManager, [{\n      key: 'add',\n      value: function add(layer) {\n        var layerOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n          opacity: 1,\n          visibility: true,\n          zIndex: 0,\n          interactivity: null\n        };\n        var onAfterAdd = arguments[2];\n\n        if (typeof layer === 'undefined') {\n          console.error('layer is required');\n          return this;\n        }\n\n        var layerModel = new LayerModel(_extends({}, layer, layerOptions));\n        var id = layerModel.id;\n\n        if (this.layers.find(function (l) {\n          return l.id === id;\n        })) {\n          return this.layers;\n        }\n\n        this.layers.push(layerModel);\n        this.requestLayer(layerModel, onAfterAdd);\n        return this.layers;\n      }\n      /**\n       * Updating a specific layer\n       * @param  {Object} layerModel\n       */\n\n    }, {\n      key: 'update',\n      value: function update(id, changedProps) {\n        var layerModel = this.getLayerModel(id);\n        if (!layerModel || !layerModel.mapLayer) return;\n        layerModel.update(changedProps);\n        var opacity = changedProps.opacity,\n            visibility = changedProps.visibility,\n            zIndex = changedProps.zIndex,\n            source = changedProps.source,\n            render = changedProps.render,\n            params = changedProps.params,\n            sqlParams = changedProps.sqlParams,\n            decodeParams = changedProps.decodeParams;\n\n        if (typeof opacity !== 'undefined') {\n          this.plugin.setOpacity(layerModel, opacity);\n        }\n\n        if (typeof visibility !== 'undefined') {\n          this.plugin.setVisibility(layerModel, visibility);\n        }\n\n        if (typeof zIndex !== 'undefined') {\n          this.plugin.setZIndex(layerModel, zIndex);\n        }\n\n        if (!isEmpty(source)) {\n          this.plugin.setSource(layerModel);\n        }\n\n        if (!isEmpty(render)) {\n          this.plugin.setRender(layerModel);\n        }\n\n        if (!isEmpty(params)) {\n          this.plugin.setParams(layerModel);\n        }\n\n        if (!isEmpty(sqlParams)) {\n          this.plugin.setSqlParams(layerModel);\n        }\n\n        if (!isEmpty(decodeParams)) {\n          this.plugin.setDecodeParams(layerModel);\n        }\n      }\n      /**\n       * Remove a layer giving a Layer ID\n       * @param {String} id\n       */\n\n    }, {\n      key: 'remove',\n      value: function remove(id) {\n        var layers = this.layers.slice(0);\n        this.requestCancel(id);\n        var layerModel = this.getLayerModel(id);\n\n        if (layerModel) {\n          this.plugin.remove(layerModel);\n        }\n\n        this.layers = layers.filter(function (l) {\n          return l.id !== id;\n        });\n      }\n    }, {\n      key: 'getLayers',\n      value: function getLayers() {\n        return this.layers;\n      }\n    }, {\n      key: 'getLayerModel',\n      value: function getLayerModel(id) {\n        return this.layers.find(function (l) {\n          return l.id === id;\n        });\n      }\n      /**\n       * A namespace to set opacity on selected layer\n       * @param {String} id\n       * @param {Number} opacity\n       */\n\n    }, {\n      key: 'setOpacity',\n      value: function setOpacity(id, opacity) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setOpacity(layerModel, opacity);\n      }\n      /**\n       * A namespace to hide or show a selected layer\n       * @param {String} id\n       * @param {Boolean} visibility\n       */\n\n    }, {\n      key: 'setVisibility',\n      value: function setVisibility(id, visibility) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setVisibility(layerModel, visibility);\n      }\n      /**\n       * A namespace to set z-index on selected layer\n       * @param {String} id\n       * @param {Number} zIndex\n       */\n\n    }, {\n      key: 'setZIndex',\n      value: function setZIndex(id, zIndex) {\n        var layerModel = this.getLayerModel(id);\n        this.plugin.setZIndex(layerModel, zIndex);\n      }\n    }, {\n      key: 'requestLayer',\n      value: function requestLayer(layerModel, onAfterAdd) {\n        var _this = this;\n\n        var type = layerModel.type,\n            provider = layerModel.provider;\n        var method = this.plugin.getLayerByType(type);\n\n        if (!method) {\n          this.promises[layerModel.id] = CancelablePromise.reject(new Error(provider + ' provider is not yet supported.'));\n          return false;\n        } // Cancel previous/existing request\n\n\n        this.requestCancel(layerModel.id); // every request method returns a promise that we store in the array\n        // to control when all layers are fetched.\n\n        this.promises[layerModel.id] = method.call(this, layerModel).then(function (layer) {\n          var canceled = _this.promises[layerModel.id]._canceled;\n\n          if (!canceled) {\n            layerModel.set('mapLayer', layer);\n\n            _this.plugin.add(layerModel, _this.layers);\n\n            _this.plugin.setZIndex(layerModel, layerModel.zIndex);\n\n            _this.plugin.setOpacity(layerModel, layerModel.opacity);\n\n            _this.plugin.setVisibility(layerModel, layerModel.visibility);\n\n            _this.plugin.setRender(layerModel);\n\n            onAfterAdd(layerModel);\n          }\n        });\n        return this;\n      }\n    }, {\n      key: 'requestCancel',\n      value: function requestCancel(layerModelId) {\n        // Cancel previous/existing request\n        if (this.promises[layerModelId] && this.promises[layerModelId].cancel) {\n          this.promises[layerModelId].cancel();\n        }\n      }\n    }, {\n      key: 'unmount',\n      value: function unmount() {\n        this.map = null;\n        this.plugin.unmount();\n      }\n    }]);\n    return LayerManager;\n  }();\n\n  var LayerManager$1 = function (_PureComponent) {\n    inherits(LayerManager$$1, _PureComponent);\n\n    function LayerManager$$1(props) {\n      classCallCheck(this, LayerManager$$1);\n\n      var _this = possibleConstructorReturn(this, (LayerManager$$1.__proto__ || Object.getPrototypeOf(LayerManager$$1)).call(this, props));\n\n      var map = props.map,\n          plugin = props.plugin;\n      _this.layerManager = new LayerManager(map, plugin);\n      return _this;\n    }\n\n    createClass(LayerManager$$1, [{\n      key: 'componentWillUnmount',\n      value: function componentWillUnmount() {\n        this.layerManager.unmount();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        var _this2 = this;\n\n        var children = this.props.children;\n\n        if (children && react.Children.count(children)) {\n          return react.Children.map(children, function (child, i) {\n            return child && react.cloneElement(child, {\n              layerManager: _this2.layerManager,\n              zIndex: child.props.zIndex || 1000 - i\n            });\n          });\n        }\n\n        return null;\n      }\n    }]);\n    return LayerManager$$1;\n  }(react.PureComponent);\n\n  LayerManager$1.propTypes = {\n    map: PropTypes.shape({}).isRequired,\n    plugin: PropTypes.func.isRequired,\n    children: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.node), PropTypes.node])\n  };\n  LayerManager$1.defaultProps = {\n    children: []\n  };\n  /**\n   * Params should have this format => { key:'xxx', key2:'xxx' }\n   * Keys to search should be in this format {{key}}\n   * @param {String} originalStr\n   * @param {Object} params\n   */\n\n  var substitution = function substitution(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var str = originalStr;\n    Object.keys(params).forEach(function (key) {\n      if (typeof params[key] === 'number' || typeof params[key] === 'boolean') {\n        str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), params[key]).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), params[key]).replace(new RegExp('`{{' + key + '}}`', 'g'), params[key]).replace(new RegExp('\"{' + key + '}\"', 'g'), params[key]).replace(new RegExp('\\'{' + key + '}\\'', 'g'), params[key]).replace(new RegExp('`{' + key + '}`', 'g'), params[key]);\n      }\n\n      str = str.replace(new RegExp('{{' + key + '}}', 'g'), params[key]).replace(new RegExp('{' + key + '}', 'g'), params[key]);\n    });\n    return str;\n  };\n  /**\n   * Params should have this format => { where1: { { key:'xxx', key2:'xxx' } }},\n   * Keys to search should be in this format {{key}}\n   * @param {String} originalStr\n   * @param {Object} params\n   */\n\n\n  var concatenation = function concatenation(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var str = originalStr;\n    var sql = void 0;\n    Object.keys(params).forEach(function (key) {\n      sql = '' + compact(Object.keys(params[key]).map(function (k) {\n        var value = params[key][k];\n\n        if (Array.isArray(value) && !!value.length) {\n          var mappedValue = value.map(function (v) {\n            return typeof v !== 'number' ? '\\'' + v + '\\'' : v;\n          });\n          return k + ' IN (' + mappedValue.join(', ') + ')';\n        }\n\n        if (!Array.isArray(value) && value) {\n          return typeof value !== 'number' ? k + ' = \\'' + value + '\\'' : k + ' = ' + value;\n        }\n\n        return null;\n      })).join(' AND ');\n      if (sql && key.startsWith('where')) sql = 'WHERE ' + sql;else if (sql && key.startsWith('and')) sql = 'AND ' + sql;else sql = '';\n      str = str.replace(new RegExp('{{' + key + '}}', 'g'), sql);\n      str = str.replace(new RegExp('{' + key + '}', 'g'), sql);\n    });\n    return str;\n  };\n  /**\n   * Replace function\n   * @param {String} string\n   * @param {Object} params\n   * @param {Object} sqlParams\n   */\n\n\n  var replace = function replace(originalStr) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var sqlParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var str = originalStr;\n\n    if (typeof str === 'string') {\n      str = substitution(str, params);\n      str = concatenation(str, sqlParams);\n    }\n\n    return str;\n  };\n\n  var Layer = function (_PureComponent) {\n    inherits(Layer, _PureComponent);\n\n    function Layer() {\n      var _ref;\n\n      var _temp, _this, _ret;\n\n      classCallCheck(this, Layer);\n\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return _ret = (_temp = (_this = possibleConstructorReturn(this, (_ref = Layer.__proto__ || Object.getPrototypeOf(Layer)).call.apply(_ref, [this].concat(args))), _this), _this.add = function () {\n        var _this$props = _this.props,\n            layerManager = _this$props.layerManager,\n            onAfterAdd = _this$props.onAfterAdd,\n            props = objectWithoutProperties(_this$props, ['layerManager', 'onAfterAdd']);\n        var source = props.source,\n            render = props.render,\n            params = props.params,\n            sqlParams = props.sqlParams;\n        var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams));\n        var renderParsed = render.parse === false ? render : JSON.parse(replace(JSON.stringify(render), params, sqlParams));\n        layerManager.add(_extends({}, props, {\n          source: sourceParsed,\n          render: renderParsed\n        }), {}, onAfterAdd);\n      }, _this.update = function (changedProps) {\n        var _this$props2 = _this.props,\n            layerManager = _this$props2.layerManager,\n            id = _this$props2.id;\n        layerManager.update(id, changedProps);\n      }, _this.remove = function () {\n        var _this$props3 = _this.props,\n            layerManager = _this$props3.layerManager,\n            id = _this$props3.id;\n        layerManager.remove(id);\n      }, _temp), possibleConstructorReturn(_this, _ret);\n    }\n\n    createClass(Layer, [{\n      key: 'componentDidMount',\n      value: function componentDidMount() {\n        this.add();\n      }\n    }, {\n      key: 'componentDidUpdate',\n      value: function componentDidUpdate(prevProps) {\n        var prevSource = prevProps.source,\n            prevRender = prevProps.render,\n            prevParams = prevProps.params,\n            prevSqlParams = prevProps.sqlParams,\n            prevDecodeParams = prevProps.decodeParams,\n            prevOpacity = prevProps.opacity,\n            prevVisibility = prevProps.visibility,\n            prevZIndex = prevProps.zIndex;\n        var _props = this.props,\n            type = _props.type,\n            source = _props.source,\n            render = _props.render,\n            params = _props.params,\n            sqlParams = _props.sqlParams,\n            decodeParams = _props.decodeParams,\n            opacity = _props.opacity,\n            visibility = _props.visibility,\n            zIndex = _props.zIndex; // Check that source has changed\n\n        var prevSourceParsed = prevSource.parse === false ? prevSource : JSON.parse(replace(JSON.stringify(prevSource), prevParams, prevSqlParams));\n        var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams)); // Check that render has changed\n\n        var prevRenderParsed = prevRender.parse === false ? prevRender : JSON.parse(replace(JSON.stringify(prevRender), prevParams, prevSqlParams));\n        var renderParsed = render.parse === false ? render : JSON.parse(replace(JSON.stringify(render), params, sqlParams)); // TODO: don't add and remove if provider is geojson\n\n        if (sourceParsed && !isEqual(sourceParsed, prevSourceParsed)) {\n          var sourceType = sourceParsed.type,\n              data = sourceParsed.data;\n          var t = sourceType || type;\n\n          if (t === 'raster' || t === 'vector' || t === 'geojson' && typeof data === 'string') {\n            this.remove();\n            this.add(); // prevent updating layer\n\n            return;\n          }\n        }\n\n        if (renderParsed && !isEqual(renderParsed, prevRenderParsed)) {\n          var _renderParsed$layers = renderParsed.layers,\n              layers = _renderParsed$layers === undefined ? [] : _renderParsed$layers;\n          var _prevRenderParsed$lay = prevRenderParsed.layers,\n              prevLayers = _prevRenderParsed$lay === undefined ? [] : _prevRenderParsed$lay;\n\n          if (layers.length !== prevLayers.length) {\n            this.remove();\n            this.add(); // prevent updating layer\n\n            return;\n          }\n        }\n\n        var changedProps = _extends({}, opacity !== prevOpacity && {\n          opacity: opacity\n        }, visibility !== prevVisibility && {\n          visibility: visibility\n        }, zIndex !== prevZIndex && {\n          zIndex: zIndex\n        }, !isEqual(sourceParsed, prevRenderParsed) && {\n          source: sourceParsed\n        }, !isEqual(renderParsed, prevRenderParsed) && {\n          render: renderParsed\n        }, !isEqual(decodeParams, prevDecodeParams) && {\n          decodeParams: decodeParams\n        });\n\n        if (!isEmpty(changedProps)) {\n          this.update(changedProps);\n        }\n      }\n    }, {\n      key: 'componentWillUnmount',\n      value: function componentWillUnmount() {\n        this.remove();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        return null;\n      }\n    }]);\n    return Layer;\n  }(react.PureComponent);\n\n  Layer.propTypes = {\n    id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n    source: PropTypes.shape({\n      parse: PropTypes.oneOfType([PropTypes.bool, PropTypes.func])\n    }),\n    render: PropTypes.shape({\n      parse: PropTypes.oneOfType([PropTypes.bool, PropTypes.func])\n    }),\n    params: PropTypes.shape({}),\n    sqlParams: PropTypes.shape({}),\n    decodeParams: PropTypes.shape({}),\n    opacity: PropTypes.number,\n    visibility: PropTypes.bool,\n    zIndex: PropTypes.number,\n    onAfterAdd: PropTypes.func,\n    layerManager: PropTypes.shape({\n      add: PropTypes.func.isRequired,\n      update: PropTypes.func.isRequired,\n      remove: PropTypes.func.isRequired,\n      map: PropTypes.shape({\n        getSource: PropTypes.func\n      })\n    })\n  };\n  Layer.defaultProps = {\n    params: undefined,\n    sqlParams: undefined,\n    decodeParams: undefined,\n    opacity: 1,\n    visibility: true,\n    zIndex: undefined,\n    source: {\n      parse: true\n    },\n    render: {},\n    layerManager: null,\n    onAfterAdd: function onAfterAdd() {}\n  }; // This file exists as an entry point for bundling our umd builds.\n\n  var Components = {};\n  Components.LayerManager = LayerManager$1;\n  Components.Layer = Layer;\n  return Components;\n});","import moment from 'moment';\n\nconst MS_PER_DAY = 1000 * 60 * 60 * 24;\n\n// a and b are javascript Date objects\nexport const dateDiffInDays = (startDate, endDate) => {\n  const a = new Date(endDate);\n  const b = new Date(startDate);\n  // Discard the time and time-zone information.\n  const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());\n  const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());\n\n  return Math.floor((utc2 - utc1) / MS_PER_DAY);\n};\n\nexport const getDayRange = (params = {}) => {\n  const { startDate, endDate, minDate, maxDate } = params || {};\n\n  if (!startDate || !endDate || !minDate || !maxDate) return null;\n\n  const minDateTime = new Date(minDate);\n  const maxDateTime = new Date(maxDate);\n  const numberOfDays = dateDiffInDays(maxDateTime, minDateTime);\n\n  // timeline or hover effect active range\n  const startDateTime = new Date(startDate);\n  const endDateTime = new Date(endDate);\n  const activeStartDay = numberOfDays - dateDiffInDays(maxDateTime, startDateTime);\n  const activeEndDay = numberOfDays - dateDiffInDays(maxDateTime, endDateTime);\n\n  // get start and end day\n  const startDayIndex = activeStartDay || 0;\n  const endDayIndex = activeEndDay || numberOfDays;\n\n  return {\n    startDayIndex,\n    endDayIndex,\n    numberOfDays\n  };\n};\n\nexport const getParams = (config = [], params = {}) => {\n  const defaultParams = config.reduce((acc, v) => {\n    const key = v.key;\n    const value = v.default;\n\n    return {\n      ...acc,\n      [key]: value\n    };\n  }, {});\n\n  const newParams = {\n    ...defaultParams,\n    ...params\n  };\n\n  const { startDate, endDate, trimEndDate, maxAbsoluteDate } = newParams;\n\n  const start = startDate;\n  const end = endDate > maxAbsoluteDate ? maxAbsoluteDate : endDate;\n  const trim = trimEndDate > maxAbsoluteDate ? maxAbsoluteDate : trimEndDate;\n\n  return {\n    ...newParams,\n    ...(!!start && {\n      startYear: moment(start).year(),\n      startMonth: moment(start).month(),\n      startDay: moment(start).dayOfYear()\n    }),\n    ...(!!endDate && {\n      endYear: moment(end).year(),\n      endMonth: moment(end).month(),\n      endDay: moment(end).dayOfYear()\n    }),\n    ...(!!trimEndDate && {\n      trimEndYear: moment(trim).year(),\n      trimEndMonth: moment(trim).month(),\n      trimEndDay: moment(trim).dayOfYear()\n    }),\n    ...getDayRange(newParams)\n  };\n};\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\n\nimport isEqual from 'lodash/isEqual';\nimport isEmpty from 'lodash/isEmpty';\n\nimport ReactMapGL, { FlyToInterpolator, TRANSITION_EVENTS } from 'react-map-gl';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport { easeCubic } from 'd3-ease';\n\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport './styles.scss';\n\nconst DEFAULT_VIEWPORT = {\n  zoom: 2,\n  lat: 0,\n  lng: 0\n}\n\nclass Map extends Component {\n  events = {}\n\n  static propTypes = {\n    /** A function that returns the map instance */\n    children: PropTypes.func,\n\n    /** Custom css class for styling */\n    customClass: PropTypes.string,\n\n    /** An object that defines the viewport\n     * @see https://uber.github.io/react-map-gl/#/Documentation/api-reference/interactive-map?section=initialization\n    */\n    viewport: PropTypes.shape({\n\n    }),\n\n    /** An object that defines the bounds */\n    bounds: PropTypes.shape({\n      bbox: PropTypes.array,\n      options: PropTypes.shape({})\n    }),\n\n    /** A boolean that allows panning */\n    dragPan: PropTypes.bool,\n\n    /** A boolean that allows rotating */\n    dragRotate: PropTypes.bool,\n\n    /** A boolean that allows zooming */\n    scrollZoom: PropTypes.bool,\n\n    /** A boolean that allows zooming */\n    touchZoom: PropTypes.bool,\n\n    /** A boolean that allows touch rotating */\n    touchRotate: PropTypes.bool,\n\n    /** A boolean that allows double click zooming */\n    doubleClickZoom: PropTypes.bool,\n\n    /** A function that exposes when the map is loaded. It returns and object with the `this.map` and `this.mapContainer` reference. */\n    onLoad: PropTypes.func,\n\n    /** A function that exposes the viewport */\n    onViewportChange: PropTypes.func,\n\n    /** A function that exposes the viewport */\n    getCursor: PropTypes.func\n  }\n\n  static defaultProps = {\n    children: null,\n    customClass: null,\n    viewport: DEFAULT_VIEWPORT,\n    bounds: {},\n    dragPan: true,\n    dragRotate: true,\n\n    onViewportChange: () => {},\n    onLoad: () => {},\n    getCursor: ({ isHovering, isDragging }) => {\n      if (isHovering) return 'pointer';\n      if (isDragging) return 'grabbing';\n      return 'grab';\n    }\n  }\n\n  state = {\n    viewport: {\n      ...DEFAULT_VIEWPORT,\n      ...this.props.viewport // eslint-disable-line\n    },\n    flying: false,\n    loaded: false\n  }\n\n  componentDidUpdate(prevProps) {\n    const { viewport: prevViewport, bounds: prevBounds } = prevProps;\n    const { viewport, bounds } = this.props;\n    const { viewport: stateViewport } = this.state;\n\n    if (!isEqual(viewport, prevViewport)) {\n      this.setState({ // eslint-disable-line\n        viewport: {\n          ...stateViewport,\n          ...viewport\n        }\n      });\n    }\n\n    if (!isEmpty(bounds) && !isEqual(bounds, prevBounds)) {\n      this.fitBounds();\n    }\n  }\n\n  onLoad = () => {\n    const { bounds, onLoad } = this.props;\n    this.setState({ loaded: true });\n\n    if (!isEmpty(bounds) && !!bounds.bbox) {\n      this.fitBounds();\n    }\n\n    onLoad({\n      map: this.map,\n      mapContainer: this.mapContainer\n    })\n  }\n\n  onViewportChange = (v, i) => {\n    const { onViewportChange } = this.props;\n\n    this.setState({ viewport: v });\n    onViewportChange(v);\n  }\n\n  onResize = (v) => {\n    const { onViewportChange } = this.props;\n    const { viewport } = this.state;\n    const newViewport = {\n      ...viewport,\n      ...v\n    };\n\n    this.setState({ viewport: newViewport });\n    onViewportChange(newViewport);\n  }\n\n  onMoveEnd = () => {\n    const { onViewportChange } = this.props;\n    const { viewport } = this.state;\n\n    if (this.map) {\n      const bearing = this.map.getBearing();\n      const pitch = this.map.getPitch();\n      const zoom = this.map.getZoom();\n      const { lng, lat } = this.map.getCenter();\n\n      const newViewport = {\n        ...viewport,\n        bearing,\n        pitch,\n        zoom,\n        latitude: lat,\n        longitude: lng\n      };\n\n      // Publish new viewport and save it into the state\n      this.setState({ viewport: newViewport });\n      onViewportChange(newViewport);\n    }\n  }\n\n  fitBounds = () => {\n    const { viewport } = this.state;\n    const { bounds, onViewportChange } = this.props;\n    const { bbox, options } = bounds;\n\n    const v = {\n      width: this.mapContainer.offsetWidth,\n      height: this.mapContainer.offsetHeight,\n      ...viewport\n    }\n\n    const { longitude, latitude, zoom } = new WebMercatorViewport(v).fitBounds(\n      [[bbox[0], bbox[1]], [bbox[2], bbox[3]]],\n      options\n    );\n\n    const newViewport = {\n      ...this.state.viewport,\n      longitude,\n      latitude,\n      zoom,\n      transitionDuration: 2500,\n      transitionInterruption: TRANSITION_EVENTS.UPDATE\n    }\n\n    this.setState({\n      flying: true,\n      viewport: newViewport\n    });\n    onViewportChange(newViewport);\n\n    setTimeout(() => {\n      this.setState({ flying: false });\n    }, 2500);\n  };\n\n  render() {\n    const { customClass, children, getCursor, dragPan, dragRotate, scrollZoom, touchZoom, touchRotate, doubleClickZoom, ...mapboxProps } = this.props;\n    const { viewport, loaded, flying } = this.state;\n\n    return (\n      <div\n        ref={r => { this.mapContainer = r}}\n        className={classnames({\n          \"c-map\": true,\n          [customClass]: !!customClass\n        })}\n      >\n        <ReactMapGL\n          ref={map => { this.map = map && map.getMap(); }}\n\n          // CUSTOM PROPS FROM REACT MAPBOX API\n          {...mapboxProps}\n\n          // VIEWPORT\n          {...viewport}\n          width=\"100%\"\n          height=\"100%\"\n\n          // INTERACTIVE\n          dragPan={!flying && dragPan}\n          dragRotate={!flying && dragRotate}\n          scrollZoom={!flying && scrollZoom}\n          touchZoom={!flying && touchZoom}\n          touchRotate={!flying && touchRotate}\n          doubleClickZoom={!flying && doubleClickZoom}\n\n          // DEFAULT FUNC IMPLEMENTATIONS\n          onViewportChange={this.onViewportChange}\n          onResize={this.onResize}\n          onLoad={this.onLoad}\n          // getCursor={getCursor}\n\n          transitionInterpolator={new FlyToInterpolator()}\n          transitionEasing={easeCubic}\n        >\n          {loaded && !!this.map && typeof children === 'function' && children(this.map)}\n        </ReactMapGL>\n      </div>\n    );\n  }\n}\n\nexport default Map;","import SidebarComponent from './component';\n\nexport default SidebarComponent;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './styles.scss';\n\nclass SidebarComponent extends React.Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired\n  };\n\n  render() {\n    const { children } = this.props;\n\n    return (\n      <div className=\"c-sidebar\">\n        <div className=\"sidebar--scroll\">{children}</div>\n      </div>\n    );\n  }\n}\n\nexport default SidebarComponent;\n","import isEqual from 'lodash/isEqual';\nimport isEmpty from 'lodash/isEmpty';\nimport axios, { CancelToken } from 'axios';\nimport compact from 'lodash/compact';\nimport { Deck, WebMercatorViewport, Layer } from '@deck.gl/core';\nimport { lngLatToWorld } from 'viewport-mercator-project';\nimport { CompositeLayer } from 'deck.gl';\nimport GL from '@luma.gl/constants';\nimport { Model, Geometry, Texture2D, fp64 } from 'luma.gl';\nimport { loadImage } from '@loaders.gl/images';\nimport sortBy from 'lodash/sortBy';\n\nvar classCallCheck = function classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar defineProperty = function defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar possibleConstructorReturn = function possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar toConsumableArray = function toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n};\n\nvar handleCallback = function handleCallback(resolve, reject, callback, r) {\n  try {\n    resolve(callback(r));\n  } catch (e) {\n    reject(e);\n  }\n};\n\nvar CancelablePromise = function () {\n  createClass(CancelablePromise, null, [{\n    key: \"all\",\n    value: function all(iterable) {\n      return new CancelablePromise(function (y, n) {\n        Promise.all(iterable).then(y, n);\n      });\n    }\n  }, {\n    key: \"race\",\n    value: function race(iterable) {\n      return new CancelablePromise(function (y, n) {\n        Promise.race(iterable).then(y, n);\n      });\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(value) {\n      return new CancelablePromise(function (y, n) {\n        Promise.reject(value).then(y, n);\n      });\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(value) {\n      return new CancelablePromise(function (y, n) {\n        Promise.resolve(value).then(y, n);\n      });\n    }\n  }]);\n\n  function CancelablePromise(executor) {\n    classCallCheck(this, CancelablePromise);\n    this._promise = new Promise(executor);\n    this._canceled = false;\n  }\n\n  createClass(CancelablePromise, [{\n    key: \"then\",\n    value: function then(success, error) {\n      var _this = this;\n\n      var p = new CancelablePromise(function (resolve, reject) {\n        _this._promise.then(function (r) {\n          if (_this._canceled) {\n            p.cancel();\n          }\n\n          if (success && !_this._canceled) {\n            handleCallback(resolve, reject, success, r);\n          } else {\n            resolve(r);\n          }\n        }, function (r) {\n          if (_this._canceled) {\n            p.cancel();\n          }\n\n          if (error && !_this._canceled) {\n            handleCallback(resolve, reject, error, r);\n          } else {\n            reject(r);\n          }\n        });\n      });\n      return p;\n    }\n  }, {\n    key: \"catch\",\n    value: function _catch(error) {\n      return this.then(undefined, error);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(errorCallback) {\n      this._canceled = true;\n\n      if (errorCallback) {\n        this._promise.catch(errorCallback);\n      }\n\n      return this;\n    }\n  }]);\n  return CancelablePromise;\n}();\n\nvar LayerModel = function () {\n  function LayerModel() {\n    var layerSpec = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    classCallCheck(this, LayerModel);\n    this.opacity = 1;\n    this.visibility = true;\n    this.source = {};\n    this.render = {};\n    Object.assign(this, layerSpec, {\n      changedAttributes: {}\n    });\n  }\n\n  createClass(LayerModel, [{\n    key: 'get',\n    value: function get$$1(key) {\n      return this[key];\n    }\n  }, {\n    key: 'set',\n    value: function set$$1(key, value) {\n      this[key] = value;\n      return this;\n    }\n  }, {\n    key: 'update',\n    value: function update(layerSpec) {\n      var _this = this;\n\n      var prevData = _extends({}, this);\n\n      var nextData = _extends({}, layerSpec); // reseting changedAttributes for every update\n\n\n      this.set('changedAttributes', {});\n      Object.keys(nextData).forEach(function (k) {\n        if (!isEqual(prevData[k], nextData[k])) {\n          _this.changedAttributes[k] = nextData[k];\n\n          _this.set(k, nextData[k]);\n        }\n      });\n    }\n  }]);\n  return LayerModel;\n}();\n\nfunction checkPluginProperties(plugin) {\n  if (plugin) {\n    var requiredProperties = ['add', 'remove', 'setVisibility', 'setOpacity', 'setZIndex', 'setSource', 'setRender', 'setParams', 'setSQLParams', 'setDecodeParams', 'getLayerByType'];\n    requiredProperties.forEach(function (property) {\n      if (!plugin[property]) {\n        console.error('The ' + property + ' function is required for layer manager plugins');\n      }\n    });\n    var deprecatedProperties = ['getLayerByProvider'];\n    deprecatedProperties.forEach(function (property) {\n      if (plugin[property]) {\n        console.warn('The ' + property + ' function is deprecated for layer manager plugins');\n      }\n    });\n  }\n}\n\nvar LayerManager = function () {\n  function LayerManager(map, Plugin) {\n    classCallCheck(this, LayerManager);\n    this.map = map;\n    this.layers = [];\n    this.promises = {};\n    this.options = {\n      getLayers: this.getLayers.bind(this)\n    };\n    this.plugin = new Plugin(this.map, this.options);\n    checkPluginProperties(this.plugin);\n  }\n  /**\n   * Add layers\n   * @param {Array} layers\n   * @param {Object} layerOptions\n   */\n\n\n  createClass(LayerManager, [{\n    key: 'add',\n    value: function add(layer) {\n      var layerOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        opacity: 1,\n        visibility: true,\n        zIndex: 0,\n        interactivity: null\n      };\n      var onAfterAdd = arguments[2];\n\n      if (typeof layer === 'undefined') {\n        console.error('layer is required');\n        return this;\n      }\n\n      var layerModel = new LayerModel(_extends({}, layer, layerOptions));\n      var id = layerModel.id;\n\n      if (this.layers.find(function (l) {\n        return l.id === id;\n      })) {\n        return this.layers;\n      }\n\n      this.layers.push(layerModel);\n      this.requestLayer(layerModel, onAfterAdd);\n      return this.layers;\n    }\n    /**\n     * Updating a specific layer\n     * @param  {Object} layerModel\n     */\n\n  }, {\n    key: 'update',\n    value: function update(id, changedProps) {\n      var layerModel = this.getLayerModel(id);\n      if (!layerModel || !layerModel.mapLayer) return;\n      layerModel.update(changedProps);\n      var opacity = changedProps.opacity,\n          visibility = changedProps.visibility,\n          zIndex = changedProps.zIndex,\n          source = changedProps.source,\n          render = changedProps.render,\n          params = changedProps.params,\n          sqlParams = changedProps.sqlParams,\n          decodeParams = changedProps.decodeParams;\n\n      if (typeof opacity !== 'undefined') {\n        this.plugin.setOpacity(layerModel, opacity);\n      }\n\n      if (typeof visibility !== 'undefined') {\n        this.plugin.setVisibility(layerModel, visibility);\n      }\n\n      if (typeof zIndex !== 'undefined') {\n        this.plugin.setZIndex(layerModel, zIndex);\n      }\n\n      if (!isEmpty(source)) {\n        this.plugin.setSource(layerModel);\n      }\n\n      if (!isEmpty(render)) {\n        this.plugin.setRender(layerModel);\n      }\n\n      if (!isEmpty(params)) {\n        this.plugin.setParams(layerModel);\n      }\n\n      if (!isEmpty(sqlParams)) {\n        this.plugin.setSqlParams(layerModel);\n      }\n\n      if (!isEmpty(decodeParams)) {\n        this.plugin.setDecodeParams(layerModel);\n      }\n    }\n    /**\n     * Remove a layer giving a Layer ID\n     * @param {String} id\n     */\n\n  }, {\n    key: 'remove',\n    value: function remove(id) {\n      var layers = this.layers.slice(0);\n      this.requestCancel(id);\n      var layerModel = this.getLayerModel(id);\n\n      if (layerModel) {\n        this.plugin.remove(layerModel);\n      }\n\n      this.layers = layers.filter(function (l) {\n        return l.id !== id;\n      });\n    }\n  }, {\n    key: 'getLayers',\n    value: function getLayers() {\n      return this.layers;\n    }\n  }, {\n    key: 'getLayerModel',\n    value: function getLayerModel(id) {\n      return this.layers.find(function (l) {\n        return l.id === id;\n      });\n    }\n    /**\n     * A namespace to set opacity on selected layer\n     * @param {String} id\n     * @param {Number} opacity\n     */\n\n  }, {\n    key: 'setOpacity',\n    value: function setOpacity(id, opacity) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setOpacity(layerModel, opacity);\n    }\n    /**\n     * A namespace to hide or show a selected layer\n     * @param {String} id\n     * @param {Boolean} visibility\n     */\n\n  }, {\n    key: 'setVisibility',\n    value: function setVisibility(id, visibility) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setVisibility(layerModel, visibility);\n    }\n    /**\n     * A namespace to set z-index on selected layer\n     * @param {String} id\n     * @param {Number} zIndex\n     */\n\n  }, {\n    key: 'setZIndex',\n    value: function setZIndex(id, zIndex) {\n      var layerModel = this.getLayerModel(id);\n      this.plugin.setZIndex(layerModel, zIndex);\n    }\n  }, {\n    key: 'requestLayer',\n    value: function requestLayer(layerModel, onAfterAdd) {\n      var _this = this;\n\n      var type = layerModel.type,\n          provider = layerModel.provider;\n      var method = this.plugin.getLayerByType(type);\n\n      if (!method) {\n        this.promises[layerModel.id] = CancelablePromise.reject(new Error(provider + ' provider is not yet supported.'));\n        return false;\n      } // Cancel previous/existing request\n\n\n      this.requestCancel(layerModel.id); // every request method returns a promise that we store in the array\n      // to control when all layers are fetched.\n\n      this.promises[layerModel.id] = method.call(this, layerModel).then(function (layer) {\n        var canceled = _this.promises[layerModel.id]._canceled;\n\n        if (!canceled) {\n          layerModel.set('mapLayer', layer);\n\n          _this.plugin.add(layerModel, _this.layers);\n\n          _this.plugin.setZIndex(layerModel, layerModel.zIndex);\n\n          _this.plugin.setOpacity(layerModel, layerModel.opacity);\n\n          _this.plugin.setVisibility(layerModel, layerModel.visibility);\n\n          _this.plugin.setRender(layerModel);\n\n          onAfterAdd(layerModel);\n        }\n      });\n      return this;\n    }\n  }, {\n    key: 'requestCancel',\n    value: function requestCancel(layerModelId) {\n      // Cancel previous/existing request\n      if (this.promises[layerModelId] && this.promises[layerModelId].cancel) {\n        this.promises[layerModelId].cancel();\n      }\n    }\n  }, {\n    key: 'unmount',\n    value: function unmount() {\n      this.map = null;\n      this.plugin.unmount();\n    }\n  }]);\n  return LayerManager;\n}();\n\nvar headers = {\n  'Content-Type': 'application/json'\n};\n\nvar get$1 = function get$$1(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return axios.get(url, _extends({\n    headers: headers\n  }, options));\n};\n/**\n * Params should have this format => { key:'xxx', key2:'xxx' }\n * Keys to search should be in this format {{key}}\n * @param {String} originalStr\n * @param {Object} params\n */\n\n\nvar substitution = function substitution(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var str = originalStr;\n  Object.keys(params).forEach(function (key) {\n    if (typeof params[key] === 'number' || typeof params[key] === 'boolean') {\n      str = str.replace(new RegExp('\"{{' + key + '}}\"', 'g'), params[key]).replace(new RegExp('\\'{{' + key + '}}\\'', 'g'), params[key]).replace(new RegExp('`{{' + key + '}}`', 'g'), params[key]).replace(new RegExp('\"{' + key + '}\"', 'g'), params[key]).replace(new RegExp('\\'{' + key + '}\\'', 'g'), params[key]).replace(new RegExp('`{' + key + '}`', 'g'), params[key]);\n    }\n\n    str = str.replace(new RegExp('{{' + key + '}}', 'g'), params[key]).replace(new RegExp('{' + key + '}', 'g'), params[key]);\n  });\n  return str;\n};\n/**\n * Params should have this format => { where1: { { key:'xxx', key2:'xxx' } }},\n * Keys to search should be in this format {{key}}\n * @param {String} originalStr\n * @param {Object} params\n */\n\n\nvar concatenation = function concatenation(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var str = originalStr;\n  var sql = void 0;\n  Object.keys(params).forEach(function (key) {\n    sql = '' + compact(Object.keys(params[key]).map(function (k) {\n      var value = params[key][k];\n\n      if (Array.isArray(value) && !!value.length) {\n        var mappedValue = value.map(function (v) {\n          return typeof v !== 'number' ? '\\'' + v + '\\'' : v;\n        });\n        return k + ' IN (' + mappedValue.join(', ') + ')';\n      }\n\n      if (!Array.isArray(value) && value) {\n        return typeof value !== 'number' ? k + ' = \\'' + value + '\\'' : k + ' = ' + value;\n      }\n\n      return null;\n    })).join(' AND ');\n    if (sql && key.startsWith('where')) sql = 'WHERE ' + sql;else if (sql && key.startsWith('and')) sql = 'AND ' + sql;else sql = '';\n    str = str.replace(new RegExp('{{' + key + '}}', 'g'), sql);\n    str = str.replace(new RegExp('{' + key + '}', 'g'), sql);\n  });\n  return str;\n};\n/**\n * Replace function\n * @param {String} string\n * @param {Object} params\n * @param {Object} sqlParams\n */\n\n\nvar replace = function replace(originalStr) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var sqlParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var str = originalStr;\n\n  if (typeof str === 'string') {\n    str = substitution(str, params);\n    str = concatenation(str, sqlParams);\n  }\n\n  return str;\n};\n\nvar fetchCartoAnonymous = function fetchCartoAnonymous(layerModel) {\n  var source = layerModel.source,\n      params = layerModel.params,\n      sqlParams = layerModel.sqlParams,\n      interactivity = layerModel.interactivity;\n  var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams));\n  var provider = sourceParsed.provider;\n  var layerTpl = JSON.stringify({\n    version: '1.3.0',\n    stat_tag: 'API',\n    layers: provider.options.layers.map(function (l) {\n      if (!!interactivity && interactivity.length) {\n        return _extends({}, l, {\n          options: _extends({}, l.options, {\n            interactivity: interactivity\n          })\n        });\n      }\n\n      return l;\n    })\n  }); // https://carto.com/developers/auth-api/guides/how-to-send-API-Keys/\n\n  var apiParams = _extends({\n    stat_tag: 'API',\n    config: encodeURIComponent(layerTpl)\n  }, provider.options.api_key && {\n    api_key: provider.options.api_key\n  });\n\n  var apiParamsString = Object.keys(apiParams).map(function (k) {\n    return k + '=' + apiParams[k];\n  }).join('&');\n  var url = 'https://' + provider.options.account + '.carto.com/api/v1/map?' + apiParamsString;\n  var layerRequest = layerModel.layerRequest;\n\n  if (layerRequest) {\n    layerRequest.cancel('Operation canceled by the user.');\n  }\n\n  var layerRequestSource = CancelToken.source();\n  layerModel.set('layerRequest', layerRequestSource);\n  var newLayerRequest = get$1(url, {\n    cancelToken: layerRequestSource.token\n  }).then(function (res) {\n    if (res.status > 400) {\n      console.error(res);\n      return false;\n    }\n\n    return res.data;\n  });\n  return newLayerRequest;\n};\n/**\n * Parsed vector style layers that follow the mapbox style layer spec\n * and returns mountable layers with ids and opacity applied\n * @param {Array} vectorLayers\n * @param {Object} layerModel\n */\n\n\nvar getVectorStyleLayers = function getVectorStyleLayers(vectorLayers, layerModel) {\n  var id = layerModel.id,\n      params = layerModel.params,\n      sqlParams = layerModel.sqlParams;\n\n  if (vectorLayers && vectorLayers.length) {\n    var vectorLayersParsed = JSON.parse(replace(JSON.stringify(vectorLayers), params, sqlParams));\n    return vectorLayersParsed && vectorLayersParsed.map(function (vectorLayer, i) {\n      var PAINT_STYLE_NAMES = {\n        symbol: ['icon', 'text'],\n        circle: ['circle', 'circle-stroke']\n      }; // Select the paint property from the original layer\n\n      var _vectorLayer$paint = vectorLayer.paint,\n          paint = _vectorLayer$paint === undefined ? {} : _vectorLayer$paint; // Select the style to change depending on the type of layer\n\n      var opacityPaintNames = PAINT_STYLE_NAMES[vectorLayer.type] || [vectorLayer.type];\n      var opacityPaintStyles = opacityPaintNames.reduce(function (obj, name) {\n        var currentProperty = paint[name + '-opacity'];\n        var paintOpacity = currentProperty !== undefined && currentProperty !== null ? currentProperty : 1;\n        return _extends({}, obj, defineProperty({}, name + '-opacity', paintOpacity * layerModel.opacity * 0.99));\n      }, {}); // if paint properties are null are passed it breaks interaction\n      // on mapbox. We need to remove these\n\n      var filteredPaintProperties = vectorLayer.paint && Object.entries(vectorLayer.paint).reduce(function (obj, _ref) {\n        var _ref2 = slicedToArray(_ref, 2),\n            key = _ref2[0],\n            value = _ref2[1];\n\n        return _extends({}, obj, !!value && defineProperty({}, key, value));\n      }, {});\n      return _extends({\n        // id: This will avoid having issues with any layer, but you should specify an id when you create it.\n        // If you don't set an id in the definition, and you set a fill-opacity, it won't work\n        id: id + '-' + vectorLayer.type + '-' + i\n      }, vectorLayer, {\n        source: id\n      }, vectorLayer.paint && {\n        paint: _extends({}, filteredPaintProperties, opacityPaintStyles)\n      });\n    });\n  }\n\n  return false;\n};\n/* eslint-disable */\n\n\nfunction getDeckInstance(_ref) {\n  var map = _ref.map,\n      gl = _ref.gl,\n      deck = _ref.deck; // Only create one deck instance per context\n\n  if (map.__deck) {\n    return map.__deck;\n  }\n\n  var customRender = deck && deck.props._customRender;\n  var deckProps = {\n    useDevicePixels: true,\n    _customRender: function _customRender() {\n      map.triggerRepaint();\n\n      if (customRender) {\n        // customRender may be subscribed by DeckGL React component to update child props\n        // make sure it is still called\n        customRender();\n      }\n    },\n    // TODO: import these defaults from a single source of truth\n    parameters: {\n      depthMask: true,\n      depthTest: true,\n      blendFunc: [gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA],\n      blendEquation: gl.FUNC_ADD\n    },\n    userData: {\n      isExternal: false,\n      mapboxLayers: new Set()\n    }\n  };\n\n  if (deck) {\n    deck.setProps(deckProps);\n    deck.props.userData.isExternal = true;\n  } else {\n    // Using external gl context - do not set css size\n    Object.assign(deckProps, {\n      gl: gl,\n      width: false,\n      height: false,\n      viewState: getViewState(map)\n    });\n    deck = new Deck(deckProps); // If deck is externally provided (React use case), we use deck's viewState to\n    // drive the map.\n    // Otherwise (pure JS use case), we use the map's viewState to drive deck.\n\n    map.on('move', function () {\n      return onMapMove(deck, map);\n    });\n    map.on('remove', function () {\n      deck.finalize();\n      map.__deck = null;\n    });\n  }\n\n  deck.props.userData.mapboxVersion = getMapboxVersion(map);\n  map.__deck = deck;\n  map.on('render', function () {\n    return afterRender(deck, map);\n  });\n  return deck;\n}\n\nfunction addLayer(deck, layer) {\n  deck.props.userData.mapboxLayers.add(layer);\n  updateLayers(deck);\n}\n\nfunction removeLayer(deck, layer) {\n  deck.props.userData.mapboxLayers.delete(layer);\n  updateLayers(deck);\n}\n\nfunction updateLayer(deck, layer) {\n  updateLayers(deck);\n}\n\nfunction drawLayer(deck, map, layer) {\n  var currentViewport = deck.props.userData.currentViewport;\n\n  if (!currentViewport) {\n    // This is the first layer drawn in this render cycle.\n    // Generate viewport from the current map state.\n    currentViewport = getViewport(deck, map, true);\n    deck.props.userData.currentViewport = currentViewport;\n  }\n\n  deck._drawLayers('mapbox-repaint', {\n    viewports: [currentViewport],\n    // TODO - accept layerFilter in drawLayers' renderOptions\n    layers: getLayers(deck, function (deckLayer) {\n      return shouldDrawLayer(layer.id, deckLayer);\n    }),\n    clearCanvas: false\n  }); // if (ANIMATION) cancelAnimationFrame(ANIMATION);\n  // ANIMATION = requestAnimationFrame(() => {\n  //   deck._drawLayers('mapbox-repaint', {\n  //     clearCanvas: false\n  //   });\n  // });\n\n}\n\nfunction getViewState(map) {\n  var _map$getCenter = map.getCenter(),\n      lng = _map$getCenter.lng,\n      lat = _map$getCenter.lat;\n\n  return {\n    longitude: lng,\n    latitude: lat,\n    zoom: map.getZoom(),\n    bearing: map.getBearing(),\n    pitch: map.getPitch()\n  };\n}\n\nfunction getMapboxVersion(map) {\n  // parse mapbox version string\n  var major = 0;\n  var minor = 0;\n\n  if (map.version) {\n    var _map$version$split$sl = map.version.split('.').slice(0, 2).map(Number);\n\n    var _map$version$split$sl2 = slicedToArray(_map$version$split$sl, 2);\n\n    major = _map$version$split$sl2[0];\n    minor = _map$version$split$sl2[1];\n  }\n\n  return {\n    major: major,\n    minor: minor\n  };\n}\n\nfunction getViewport(deck, map) {\n  var useMapboxProjection = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var mapboxVersion = deck.props.userData.mapboxVersion;\n  return new WebMercatorViewport(Object.assign({\n    x: 0,\n    y: 0,\n    width: deck.width,\n    height: deck.height\n  }, getViewState(map), useMapboxProjection ? {\n    // match mapbox's projection matrix\n    // A change of near plane was made in 1.3.0\n    // https://github.com/mapbox/mapbox-gl-js/pull/8502\n    nearZMultiplier: mapboxVersion.major === 1 && mapboxVersion.minor >= 3 || mapboxVersion.major >= 2 ? 0.02 : 1 / (deck.height || 1)\n  } : {\n    // use deck.gl's own default\n    nearZMultiplier: 0.1\n  }));\n}\n\nfunction afterRender(deck, map) {\n  var _deck$props$userData = deck.props.userData,\n      mapboxLayers = _deck$props$userData.mapboxLayers,\n      isExternal = _deck$props$userData.isExternal;\n\n  if (isExternal) {\n    // Draw non-Mapbox layers\n    var mapboxLayerIds = Array.from(mapboxLayers, function (layer) {\n      return layer.id;\n    });\n    var layers = getLayers(deck, function (deckLayer) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = mapboxLayerIds[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var id = _step.value;\n\n          if (shouldDrawLayer(id, deckLayer)) {\n            return false;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return true;\n    });\n\n    if (layers.length > 0) {\n      console.log('afterRender');\n\n      deck._drawLayers('mapbox-repaint', {\n        viewports: [getViewport(deck, map, false)],\n        layers: layers,\n        clearCanvas: false\n      });\n    }\n  } // End of render cycle, clear generated viewport\n\n\n  deck.props.userData.currentViewport = null;\n}\n\nfunction onMapMove(deck, map) {\n  deck.setProps({\n    viewState: getViewState(map)\n  }); // Camera changed, will trigger a map repaint right after this\n  // Clear any change flag triggered by setting viewState so that deck does not request\n  // a second repaint\n  // deck.needsRedraw({clearRedrawFlags: true});\n}\n\nfunction getLayers(deck, layerFilter) {\n  var layers = deck.layerManager.getLayers();\n  return layers.filter(layerFilter);\n}\n\nfunction shouldDrawLayer(id, layer) {\n  var layerInstance = layer;\n\n  while (layerInstance) {\n    if (layerInstance.id === id) {\n      return true;\n    }\n\n    layerInstance = layerInstance.parent;\n  }\n\n  return false;\n}\n\nfunction updateLayers(deck) {\n  if (deck.props.userData.isExternal) {\n    return;\n  }\n\n  var layers = [];\n  deck.props.userData.mapboxLayers.forEach(function (deckLayer) {\n    var LayerType = deckLayer.props.type;\n    var layer = new LayerType(deckLayer.props);\n    layers.push(layer);\n  });\n  deck.setProps({\n    layers: layers\n  });\n}\n\nvar MapboxLayer = function () {\n  /* eslint-disable no-this-before-super */\n  function MapboxLayer(props) {\n    classCallCheck(this, MapboxLayer);\n\n    if (!props.id) {\n      throw new Error('Layer must have an unique id');\n    }\n\n    this.id = props.id;\n    this.type = 'custom';\n    this.renderingMode = props.renderingMode || '3d';\n    this.map = null;\n    this.deck = null;\n    this.props = props;\n  }\n  /* Mapbox custom layer methods */\n\n\n  createClass(MapboxLayer, [{\n    key: 'onAdd',\n    value: function onAdd(map, gl) {\n      this.map = map;\n      this.deck = getDeckInstance({\n        map: map,\n        gl: gl,\n        deck: this.props.deck\n      });\n      addLayer(this.deck, this);\n    }\n  }, {\n    key: 'onRemove',\n    value: function onRemove() {\n      removeLayer(this.deck, this);\n    }\n  }, {\n    key: 'setProps',\n    value: function setProps(props) {\n      // id cannot be changed\n      Object.assign(this.props, props, {\n        id: this.id\n      }); // safe guard in case setProps is called before onAdd\n\n      if (this.deck) {\n        updateLayer(this.deck, this);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      drawLayer(this.deck, this.map, this);\n    }\n  }]);\n  return MapboxLayer;\n}(); // https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Lon..2Flat._to_tile_numbers_2\n\n\nfunction tile2latLng(x, y, z) {\n  var lng = x / Math.pow(2, z) * 360 - 180;\n  var n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\n  var lat = 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  return [lng, lat];\n}\n\nfunction tile2boundingBox(x, y, z) {\n  var _tile2latLng = tile2latLng(x, y, z),\n      _tile2latLng2 = slicedToArray(_tile2latLng, 2),\n      west = _tile2latLng2[0],\n      north = _tile2latLng2[1];\n\n  var _tile2latLng3 = tile2latLng(x + 1, y + 1, z),\n      _tile2latLng4 = slicedToArray(_tile2latLng3, 2),\n      east = _tile2latLng4[0],\n      south = _tile2latLng4[1];\n\n  return [west, south, east, north];\n}\n\nvar Tile = function () {\n  function Tile(_ref) {\n    var getTileData = _ref.getTileData,\n        x = _ref.x,\n        y = _ref.y,\n        z = _ref.z,\n        onTileLoad = _ref.onTileLoad,\n        onTileError = _ref.onTileError;\n    classCallCheck(this, Tile);\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.bbox = tile2boundingBox(this.x, this.y, this.z);\n    this.isVisible = true;\n    this.getTileData = getTileData;\n    this._data = null;\n    this._isLoaded = false;\n    this._loader = this._loadData();\n    this.onTileLoad = onTileLoad;\n    this.onTileError = onTileError;\n  }\n\n  createClass(Tile, [{\n    key: \"_loadData\",\n    value: function _loadData() {\n      var _this = this;\n\n      var x = this.x,\n          y = this.y,\n          z = this.z,\n          bbox = this.bbox;\n\n      if (!this.getTileData) {\n        return null;\n      }\n\n      return Promise.resolve(this.getTileData({\n        x: x,\n        y: y,\n        z: z,\n        bbox: bbox\n      })).then(function (buffers) {\n        _this._data = buffers;\n        _this._isLoaded = true;\n\n        _this.onTileLoad(_this);\n\n        return buffers;\n      }).catch(function (err) {\n        _this._isLoaded = true;\n\n        _this.onTileError(err);\n      });\n    }\n  }, {\n    key: \"isOverlapped\",\n    value: function isOverlapped(tile) {\n      var x = this.x,\n          y = this.y,\n          z = this.z;\n      var m = Math.pow(2, tile.z - z);\n      return Math.floor(tile.x / m) === x && Math.floor(tile.y / m) === y;\n    }\n  }, {\n    key: \"data\",\n    get: function get$$1() {\n      return this._data || this._loader;\n    }\n  }, {\n    key: \"isLoaded\",\n    get: function get$$1() {\n      return this._isLoaded;\n    }\n  }]);\n  return Tile;\n}();\n\nvar TILE_SIZE = 256;\n\nfunction getBoundingBox(viewport) {\n  var corners = [viewport.unproject([0, 0]), viewport.unproject([viewport.width, 0]), viewport.unproject([0, viewport.height]), viewport.unproject([viewport.width, viewport.height])];\n  return [corners.reduce(function (minLng, p) {\n    return minLng < p[0] ? minLng : p[0];\n  }, 180), corners.reduce(function (minLat, p) {\n    return minLat < p[1] ? minLat : p[1];\n  }, 90), corners.reduce(function (maxLng, p) {\n    return maxLng > p[0] ? maxLng : p[0];\n  }, -180), corners.reduce(function (maxLat, p) {\n    return maxLat > p[1] ? maxLat : p[1];\n  }, -90)];\n}\n\nfunction pixelsToTileIndex(a) {\n  return a / TILE_SIZE;\n}\n/**\n * Calculates and returns a new tile index {x, y, z}, with z being the given adjustedZ.\n */\n\n\nfunction getAdjustedTileIndex(_ref, adjustedZ) {\n  var x = _ref.x,\n      y = _ref.y,\n      z = _ref.z;\n  var m = Math.pow(2, z - adjustedZ);\n  return {\n    x: Math.floor(x / m),\n    y: Math.floor(y / m),\n    z: adjustedZ\n  };\n}\n/**\n * Returns all tile indices in the current viewport. If the current zoom level is smaller\n * than minZoom, return an empty array. If the current zoom level is greater than maxZoom,\n * return tiles that are on maxZoom.\n */\n\n\nfunction getTileIndices(viewport, maxZoom, minZoom) {\n  var z = Math.floor(viewport.zoom) + 1;\n\n  if (minZoom && z < minZoom) {\n    return [];\n  } // eslint-disable-next-line no-param-reassign\n\n\n  viewport = new viewport.constructor(_extends({}, viewport, {\n    zoom: z - 1\n  }));\n  var bbox = getBoundingBox(viewport);\n\n  var _lngLatToWorld$map = lngLatToWorld([bbox[0], bbox[3]], viewport.scale).map(pixelsToTileIndex),\n      _lngLatToWorld$map2 = slicedToArray(_lngLatToWorld$map, 2),\n      minX = _lngLatToWorld$map2[0],\n      minY = _lngLatToWorld$map2[1];\n\n  var _lngLatToWorld$map3 = lngLatToWorld([bbox[2], bbox[1]], viewport.scale).map(pixelsToTileIndex),\n      _lngLatToWorld$map4 = slicedToArray(_lngLatToWorld$map3, 2),\n      maxX = _lngLatToWorld$map4[0],\n      maxY = _lngLatToWorld$map4[1];\n\n  minX = Math.floor(minX);\n  maxX = Math.ceil(maxX);\n  minY = Math.floor(minY);\n  maxY = Math.ceil(maxY);\n  var indices = [];\n\n  for (var x = minX; x < maxX; x++) {\n    for (var y = minY; y < maxY; y++) {\n      if (maxZoom && z > maxZoom) {\n        indices.push(getAdjustedTileIndex({\n          x: x,\n          y: y,\n          z: z\n        }, maxZoom));\n      } else {\n        indices.push({\n          x: x,\n          y: y,\n          z: z\n        });\n      }\n    }\n  }\n\n  return indices;\n}\n/* eslint-disable class-methods-use-this */\n\n/**\n * Manages loading and purging of tiles data. This class caches recently visited tiles\n * and only create new tiles if they are present.\n */\n\n\nvar TileCache = function () {\n  /**\n   * Takes in a function that returns tile data, a cache size, and a max and a min zoom level.\n   * Cache size defaults to 5 * number of tiles in the current viewport\n   */\n  function TileCache(_ref) {\n    var getTileData = _ref.getTileData,\n        maxSize = _ref.maxSize,\n        maxZoom = _ref.maxZoom,\n        minZoom = _ref.minZoom,\n        onTileLoad = _ref.onTileLoad,\n        onTileError = _ref.onTileError;\n    classCallCheck(this, TileCache); // TODO: Instead of hardcode size, we should calculate how much memory left\n\n    this._getTileData = getTileData;\n    this._maxSize = maxSize;\n    this.onTileError = onTileError;\n    this.onTileLoad = onTileLoad; // Maps tile id in string {z}-{x}-{y} to a Tile object\n\n    this._cache = new Map();\n    this._tiles = [];\n\n    if (Number.isFinite(maxZoom)) {\n      this._maxZoom = Math.floor(maxZoom);\n    }\n\n    if (Number.isFinite(minZoom)) {\n      this._minZoom = Math.ceil(minZoom);\n    }\n  }\n\n  createClass(TileCache, [{\n    key: 'finalize',\n\n    /**\n     * Clear the current cache\n     */\n    value: function finalize() {\n      this._cache.clear();\n    }\n    /**\n     * Update the cache with the given viewport and triggers callback onUpdate.\n     * @param {*} viewport\n     * @param {*} onUpdate\n     */\n\n  }, {\n    key: 'update',\n    value: function update(viewport) {\n      var _cache = this._cache,\n          _getTileData = this._getTileData,\n          _maxSize = this._maxSize,\n          _maxZoom = this._maxZoom,\n          _minZoom = this._minZoom;\n\n      this._markOldTiles();\n\n      var tileIndices = getTileIndices(viewport, _maxZoom, _minZoom);\n\n      if (!tileIndices || tileIndices.length === 0) {\n        return;\n      }\n\n      _cache.forEach(function (cachedTile) {\n        if (tileIndices.some(function (tile) {\n          return cachedTile.isOverlapped(tile);\n        })) {\n          cachedTile.isVisible = true; // eslint-disable-line\n        }\n      });\n\n      var changed = false;\n\n      for (var i = 0; i < tileIndices.length; i++) {\n        var tileIndex = tileIndices[i];\n        var x = tileIndex.x,\n            y = tileIndex.y,\n            z = tileIndex.z;\n\n        var tile = this._getTile(x, y, z);\n\n        if (!tile) {\n          tile = new Tile({\n            getTileData: _getTileData,\n            x: x,\n            y: y,\n            z: z,\n            onTileLoad: this.onTileLoad,\n            onTileError: this.onTileError\n          });\n          tile.isVisible = true;\n          changed = true;\n        }\n\n        var tileId = this._getTileId(x, y, z);\n\n        _cache.set(tileId, tile);\n      }\n\n      if (changed) {\n        // cache size is either the user defined maxSize or 5 * number of current tiles in the viewport.\n        var commonZoomRange = 5;\n\n        this._resizeCache(_maxSize || commonZoomRange * tileIndices.length);\n\n        this._tiles = Array.from(this._cache.values()) // sort by zoom level so parents tiles don't show up when children tiles are rendered\n        .sort(function (t1, t2) {\n          return t1.z - t2.z;\n        });\n      }\n    }\n    /**\n     * Clear tiles that are not visible when the cache is full\n     */\n\n  }, {\n    key: '_resizeCache',\n    value: function _resizeCache(maxSize) {\n      var _cache = this._cache;\n\n      if (_cache.size > maxSize) {\n        var iterator = _cache[Symbol.iterator](); // eslint-disable-next-line no-restricted-syntax\n\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = iterator[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var cachedTile = _step.value;\n\n            if (_cache.size <= maxSize) {\n              break;\n            }\n\n            var tileId = cachedTile[0];\n            var tile = cachedTile[1];\n\n            if (!tile.isVisible) {\n              _cache.delete(tileId);\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: '_markOldTiles',\n    value: function _markOldTiles() {\n      this._cache.forEach(function (cachedTile) {\n        // eslint-disable-next-line no-param-reassign\n        cachedTile.isVisible = false;\n      });\n    }\n  }, {\n    key: '_getTile',\n    value: function _getTile(x, y, z) {\n      var tileId = this._getTileId(x, y, z);\n\n      return this._cache.get(tileId);\n    }\n  }, {\n    key: '_getTileId',\n    value: function _getTileId(x, y, z) {\n      return z + '-' + x + '-' + y;\n    }\n  }, {\n    key: 'tiles',\n    get: function get$$1() {\n      return this._tiles;\n    }\n  }]);\n  return TileCache;\n}();\n/* eslint-disable no-param-reassign,no-restricted-properties,class-methods-use-this,no-underscore-dangle */\n\n\nvar defaultProps = {\n  renderSubLayers: {\n    type: 'function',\n    value: function value() {\n      return null;\n    }\n  },\n  getTileData: {\n    type: 'function',\n    value: function value() {\n      return Promise.resolve(null);\n    }\n  },\n  // TODO - change to onViewportLoad to align with Tile3DLayer\n  onViewportLoaded: {\n    type: 'function',\n    optional: true,\n    value: null\n  },\n  // eslint-disable-next-line\n  onTileError: {\n    type: 'function',\n    value: function value(err) {\n      return console.error(err);\n    }\n  },\n  maxZoom: null,\n  minZoom: 0,\n  maxCacheSize: null\n};\n\nvar TileLayer = function (_CompositeLayer) {\n  inherits(TileLayer, _CompositeLayer);\n\n  function TileLayer() {\n    classCallCheck(this, TileLayer);\n    return possibleConstructorReturn(this, (TileLayer.__proto__ || Object.getPrototypeOf(TileLayer)).apply(this, arguments));\n  }\n\n  createClass(TileLayer, [{\n    key: 'initializeState',\n    value: function initializeState() {\n      this.state = {\n        tiles: [],\n        isLoaded: false\n      };\n    }\n  }, {\n    key: 'shouldUpdateState',\n    value: function shouldUpdateState(_ref) {\n      var changeFlags = _ref.changeFlags;\n      return changeFlags.somethingChanged;\n    }\n  }, {\n    key: 'updateState',\n    value: function updateState(_ref2) {\n      var props = _ref2.props,\n          context = _ref2.context,\n          changeFlags = _ref2.changeFlags;\n      var tileCache = this.state.tileCache;\n\n      if (!tileCache || changeFlags.updateTriggersChanged && (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getTileData)) {\n        var getTileData = props.getTileData,\n            maxZoom = props.maxZoom,\n            minZoom = props.minZoom,\n            maxCacheSize = props.maxCacheSize;\n\n        if (tileCache) {\n          tileCache.finalize();\n        }\n\n        tileCache = new TileCache({\n          getTileData: getTileData,\n          maxSize: maxCacheSize,\n          maxZoom: maxZoom,\n          minZoom: minZoom,\n          onTileLoad: this._onTileLoad.bind(this),\n          onTileError: this._onTileError.bind(this)\n        });\n        this.setState({\n          tileCache: tileCache\n        });\n      } else if (changeFlags.updateTriggersChanged) {\n        // if any updateTriggersChanged (other than getTileData), delete the layer\n        this.state.tileCache.tiles.forEach(function (tile) {\n          tile.layer = null;\n        });\n      }\n\n      var viewport = context.viewport;\n\n      if (changeFlags.viewportChanged && viewport.id !== 'DEFAULT-INITIAL-VIEWPORT') {\n        var z = this.getLayerZoomLevel();\n        tileCache.update(viewport); // The tiles that should be displayed at this zoom level\n\n        var currTiles = tileCache.tiles.filter(function (tile) {\n          return tile.z === z;\n        });\n        this.setState({\n          isLoaded: false,\n          tiles: currTiles\n        });\n\n        this._onTileLoad();\n      }\n    }\n  }, {\n    key: '_onTileLoad',\n    value: function _onTileLoad() {\n      var onViewportLoaded = this.props.onViewportLoaded;\n      var currTiles = this.state.tiles;\n      var allCurrTilesLoaded = currTiles.every(function (tile) {\n        return tile.isLoaded;\n      });\n\n      if (this.state.isLoaded !== allCurrTilesLoaded) {\n        this.setState({\n          isLoaded: allCurrTilesLoaded\n        });\n\n        if (allCurrTilesLoaded && onViewportLoaded) {\n          onViewportLoaded(currTiles.filter(function (tile) {\n            return tile._data;\n          }).map(function (tile) {\n            return tile._data;\n          }));\n        }\n      }\n    }\n  }, {\n    key: '_onTileError',\n    value: function _onTileError(error) {\n      this.props.onTileError(error); // errorred tiles should not block rendering, are considered \"loaded\" with empty data\n\n      this._onTileLoad();\n    }\n  }, {\n    key: 'getPickingInfo',\n    value: function getPickingInfo(_ref3) {\n      var info = _ref3.info,\n          sourceLayer = _ref3.sourceLayer;\n      info.sourceLayer = sourceLayer;\n      info.tile = sourceLayer.props.tile;\n      return info;\n    }\n  }, {\n    key: 'getLayerZoomLevel',\n    value: function getLayerZoomLevel() {\n      var z = Math.floor(this.context.viewport.zoom) + 1;\n      var _props = this.props,\n          maxZoom = _props.maxZoom,\n          minZoom = _props.minZoom;\n\n      if (Number.isFinite(maxZoom) && z > maxZoom) {\n        return Math.floor(maxZoom);\n      }\n\n      if (Number.isFinite(minZoom) && z < minZoom) {\n        return Math.ceil(minZoom);\n      }\n\n      return z;\n    }\n  }, {\n    key: 'renderLayers',\n    value: function renderLayers() {\n      var _this2 = this;\n\n      var _props2 = this.props,\n          visible = _props2.visible,\n          opacity = _props2.opacity,\n          decodeParams = _props2.decodeParams,\n          renderSubLayers = _props2.renderSubLayers;\n      var z = this.getLayerZoomLevel();\n      return this.state.tiles.map(function (tile) {\n        // For a tile to be visible:\n        // - parent layer must be visible\n        // - tile must be visible in the current viewport\n        // - if all tiles are loaded, only display the tiles from the current z level\n        var isVisible = visible && tile.isVisible && (!_this2.state.isLoaded || tile.z === z); // cache the rendered layer in the tile\n\n        if (!tile.layer) {\n          // I have an error when I try this condition. I think is related to return the same tile.layer\n          // https://github.com/uber/deck.gl/blob/c616dbfbcbdc9d8533b88ba8a142c5527764bbd8/modules/core/src/lib/layer-manager.js#L67-L70\n          tile.layer = renderSubLayers(_extends({}, _this2.props, {\n            id: _this2.id + '-' + tile.x + '-' + tile.y + '-' + tile.z,\n            data: tile.data,\n            visible: isVisible,\n            opacity: opacity,\n            tile: tile,\n            zoom: z\n          }));\n        } else if (tile.layer.props.visible !== isVisible) {\n          tile.layer = tile.layer.clone({\n            visible: isVisible\n          });\n        } else if (tile.layer.props.opacity !== opacity) {\n          tile.layer = tile.layer.clone({\n            opacity: opacity\n          });\n        } else if (tile.layer.props.decodeParams) {\n          tile.layer = tile.layer.clone({\n            decodeParams: decodeParams\n          });\n        }\n\n        return tile.layer;\n      });\n    }\n  }]);\n  return TileLayer;\n}(CompositeLayer);\n\nTileLayer.layerName = 'TileLayer';\nTileLayer.defaultProps = defaultProps;\nvar decodeVX = \"\\n#define SHADER_NAME bitmap-layer-vertex-shader\\n\\nattribute vec2 texCoords;\\nattribute vec3 positions;\\nattribute vec2 positions64xyLow;\\n\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\\n\\n  vTexCoord = texCoords;\\n\\n  picking_setPickingColor(vec3(0., 0., 1.));\\n}\\n\";\nvar decodeFR = \"\\n#define SHADER_NAME bitmap-layer-fragment-shader\\n\\n#ifdef GL_ES\\nprecision highp float;\\n#endif\\n\\nuniform sampler2D bitmapTexture;\\n\\nvarying vec2 vTexCoord;\\n\\n{decodeParams}\\n\\nuniform float opacity;\\nuniform float zoom;\\n\\n\\nvec4 decodeFunction(vec3 color, float alpha) {\\n  {decodeFunction}\\n  return vec4(color, alpha * opacity);\\n}\\n\\nvoid main(void) {\\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\\n\\n  // clear mask\\n  if (bitmapColor == vec4(0., 0., 0., 1.)) {\\n    discard;\\n  }\\n\\n  // custom decode\\n  gl_FragColor = decodeFunction(bitmapColor.rgb, bitmapColor.a);\\n\\n  // use highlight color if this fragment belongs to the selected object.\\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\\n\\n  // use picking color if rendering to picking FBO.\\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\\n}\\n\";\n\nvar _DEFAULT_TEXTURE_PARA;\n\nvar fp64LowPart = fp64.fp64LowPart;\nvar DEFAULT_TEXTURE_PARAMETERS = (_DEFAULT_TEXTURE_PARA = {}, defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_MIN_FILTER, GL.NEAREST), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_MAG_FILTER, GL.NEAREST), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_WRAP_S, GL.CLAMP_TO_EDGE), defineProperty(_DEFAULT_TEXTURE_PARA, GL.TEXTURE_WRAP_T, GL.CLAMP_TO_EDGE), _DEFAULT_TEXTURE_PARA);\nvar defaultProps$1 = {\n  image: null,\n  bounds: {\n    type: 'array',\n    value: [1, 0, 0, 1],\n    compare: true\n  },\n  fp64: false,\n  desaturate: {\n    type: 'number',\n    min: 0,\n    max: 1,\n    value: 0\n  },\n  // More context: because of the blending mode we're using for ground imagery,\n  // alpha is not effective when blending the bitmap layers with the base map.\n  // Instead we need to manually dim/blend rgb values with a background color.\n  transparentColor: {\n    type: 'color',\n    value: [0, 0, 0, 0]\n  },\n  tintColor: {\n    type: 'color',\n    value: [255, 255, 255]\n  }\n};\n/*\n * @class\n * @param {object} props\n * @param {number} props.transparentColor - color to interpret transparency to\n * @param {number} props.tintColor - color bias\n */\n\nvar DecodeLayer = function (_Layer) {\n  inherits(DecodeLayer, _Layer);\n\n  function DecodeLayer() {\n    classCallCheck(this, DecodeLayer);\n    return possibleConstructorReturn(this, (DecodeLayer.__proto__ || Object.getPrototypeOf(DecodeLayer)).apply(this, arguments));\n  }\n\n  createClass(DecodeLayer, [{\n    key: 'getShaders',\n    value: function getShaders() {\n      var projectModule = 'project32';\n      var fs = decodeFR.replace('{decodeParams}', Object.keys(this.props.decodeParams).map(function (p) {\n        return 'uniform float ' + p + ';';\n      }).join(' ')).replace('{decodeFunction}', this.props.decodeFunction || '');\n      return {\n        vs: decodeVX,\n        fs: fs,\n        modules: [projectModule, 'picking']\n      };\n    }\n  }, {\n    key: 'initializeState',\n    value: function initializeState() {\n      var attributeManager = this.getAttributeManager();\n      attributeManager.add({\n        positions: {\n          size: 3,\n          update: this.calculatePositions,\n          value: new Float32Array(12)\n        },\n        positions64xyLow: {\n          size: 3,\n          update: this.calculatePositions64xyLow,\n          value: new Float32Array(12)\n        }\n      });\n      this.setState({\n        numInstances: 4\n      }); // 4 corners\n    }\n  }, {\n    key: 'updateState',\n    value: function updateState(_ref) {\n      var props = _ref.props,\n          oldProps = _ref.oldProps; // setup model first\n\n      if (props.fp64 !== oldProps.fp64) {\n        var gl = this.context.gl;\n\n        if (this.state.model) {\n          this.state.model.delete();\n        }\n\n        this.setState({\n          model: this._getModel(gl)\n        });\n        this.getAttributeManager().invalidateAll();\n      }\n\n      if (props.image !== oldProps.image) {\n        this.loadTexture(props.image);\n      }\n\n      var attributeManager = this.getAttributeManager();\n\n      if (props.bounds !== oldProps.bounds) {\n        this.setState({\n          positions: this._getPositionsFromBounds(props.bounds)\n        });\n        attributeManager.invalidate('positions');\n        attributeManager.invalidate('positions64xyLow');\n      }\n    }\n  }, {\n    key: 'finalizeState',\n    value: function finalizeState() {\n      get(DecodeLayer.prototype.__proto__ || Object.getPrototypeOf(DecodeLayer.prototype), 'finalizeState', this).call(this);\n\n      if (this.state.bitmapTexture) {\n        this.state.bitmapTexture.delete();\n      }\n    }\n  }, {\n    key: '_getPositionsFromBounds',\n    value: function _getPositionsFromBounds(bounds) {\n      var positions = new Array(12); // bounds as [minX, minY, maxX, maxY]\n\n      if (Number.isFinite(bounds[0])) {\n        /*\n          (minX0, maxY3) ---- (maxX2, maxY3)\n                 |                  |\n                 |                  |\n                 |                  |\n          (minX0, minY1) ---- (maxX2, minY1)\n        */\n        positions[0] = bounds[0];\n        positions[1] = bounds[1];\n        positions[2] = 0;\n        positions[3] = bounds[0];\n        positions[4] = bounds[3];\n        positions[5] = 0;\n        positions[6] = bounds[2];\n        positions[7] = bounds[3];\n        positions[8] = 0;\n        positions[9] = bounds[2];\n        positions[10] = bounds[1];\n        positions[11] = 0;\n      } else {\n        // [[minX, minY], [minX, maxY], [maxX, maxY], [maxX, minY]]\n        for (var i = 0; i < bounds.length; i++) {\n          positions[i * 3 + 0] = bounds[i][0];\n          positions[i * 3 + 1] = bounds[i][1];\n          positions[i * 3 + 2] = bounds[i][2] || 0;\n        }\n      }\n\n      return positions;\n    }\n  }, {\n    key: '_getModel',\n    value: function _getModel(gl) {\n      if (!gl) {\n        return null;\n      }\n      /*\n        0,1 --- 1,1\n         |       |\n        0,0 --- 1,0\n      */\n\n\n      return new Model(gl, Object.assign({}, this.getShaders(), {\n        id: this.props.id,\n        shaderCache: this.context.shaderCache,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLE_FAN,\n          vertexCount: 4,\n          attributes: {\n            texCoords: new Float32Array([0, 0, 0, 1, 1, 1, 1, 0])\n          }\n        }),\n        isInstanced: false\n      }));\n    }\n  }, {\n    key: 'draw',\n    value: function draw(_ref2) {\n      var uniforms = _ref2.uniforms;\n      var _state = this.state,\n          bitmapTexture = _state.bitmapTexture,\n          model = _state.model;\n      var _props = this.props,\n          desaturate = _props.desaturate,\n          transparentColor = _props.transparentColor,\n          tintColor = _props.tintColor,\n          zoom = _props.zoom,\n          decodeParams = _props.decodeParams,\n          opacity = _props.opacity; // // TODO fix zFighting\n      // Render the image\n\n      if (bitmapTexture && model) {\n        model.setUniforms(Object.assign({}, uniforms, _extends({\n          bitmapTexture: bitmapTexture,\n          desaturate: desaturate,\n          transparentColor: transparentColor,\n          tintColor: tintColor,\n          zoom: zoom\n        }, decodeParams, {\n          opacity: opacity\n        }))).draw();\n      }\n    }\n  }, {\n    key: 'loadTexture',\n    value: function loadTexture(image) {\n      var _this2 = this;\n\n      if (typeof image === 'string') {\n        image = loadImage(image);\n      }\n\n      if (image instanceof Promise) {\n        image.then(function (data) {\n          return _this2.loadTexture(data);\n        });\n        return;\n      }\n\n      var gl = this.context.gl;\n\n      if (this.state.bitmapTexture) {\n        this.state.bitmapTexture.delete();\n      }\n\n      if (image instanceof Texture2D) {\n        this.setState({\n          bitmapTexture: image\n        });\n      } else if ( // browser object\n      image instanceof Image || image instanceof HTMLCanvasElement) {\n        this.setState({\n          bitmapTexture: new Texture2D(gl, {\n            data: image,\n            parameters: DEFAULT_TEXTURE_PARAMETERS,\n            mipmaps: false\n          })\n        });\n      }\n    }\n  }, {\n    key: 'calculatePositions',\n    value: function calculatePositions(_ref3) {\n      var value = _ref3.value;\n      var positions = this.state.positions;\n      value.set(positions);\n    }\n  }, {\n    key: 'calculatePositions64xyLow',\n    value: function calculatePositions64xyLow(attribute) {\n      var isFP64 = this.use64bitPositions();\n      attribute.constant = !isFP64;\n\n      if (!isFP64) {\n        attribute.value = new Float32Array(4);\n        return;\n      }\n\n      var value = attribute.value;\n      value.set(this.state.positions.map(fp64LowPart));\n    }\n  }]);\n  return DecodeLayer;\n}(Layer);\n\nDecodeLayer.layerName = 'DecodeLayer';\nDecodeLayer.defaultProps = defaultProps$1;\n\nvar _getTileData = function _getTileData(_ref, url) {\n  var x = _ref.x,\n      y = _ref.y,\n      z = _ref.z;\n  var mapSource = url.replace('{z}', z).replace('{x}', x).replace('{y}', y);\n  return fetch(mapSource).then(function (response) {\n    return response.blob();\n  }).then(function (response) {\n    var _ref2 = response || {},\n        type = _ref2.type;\n\n    if (type !== 'application/xml' && type !== 'text/xml' && type !== 'text/html') {\n      var src = URL.createObjectURL(response);\n      var image = new Image();\n      image.src = src;\n      return image;\n    }\n\n    return false;\n  });\n};\n\nvar RasterLayer = function RasterLayer(layerModel) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      decodeParams = layerModel.decodeParams,\n      id = layerModel.id,\n      opacity = layerModel.opacity,\n      decodeFunction = layerModel.decodeFunction;\n  var DEFAULT_RASTER_OPTIONS = {\n    id: id + '-raster',\n    type: 'raster',\n    source: id\n  };\n  var provider = source.provider;\n  var _render$layers = render.layers,\n      layers = _render$layers === undefined ? [DEFAULT_RASTER_OPTIONS] : _render$layers;\n  var layer = {}; // if decoded layer use custom deck layer\n\n  if (decodeFunction) {\n    layer = {\n      id: id,\n      type: 'custom',\n      layers: [{\n        id: id + '-raster-decode-bg',\n        type: 'background',\n        paint: {\n          'background-color': 'transparent'\n        }\n      }].concat(toConsumableArray(source.tiles.map(function (t) {\n        return new MapboxLayer({\n          id: id + '-raster-decode',\n          type: TileLayer,\n          getTileData: function getTileData(e) {\n            return _getTileData(e, t);\n          },\n          renderSubLayers: function renderSubLayers(_ref3) {\n            var subLayerId = _ref3.id,\n                data = _ref3.data,\n                tile = _ref3.tile,\n                visible = _ref3.visible,\n                zoom = _ref3.zoom,\n                decodeParamsSub = _ref3.decodeParams,\n                decodeFunctionSub = _ref3.decodeFunction;\n\n            if (data && data.src) {\n              return new DecodeLayer({\n                id: subLayerId,\n                image: data.src,\n                bounds: tile.bbox,\n                visible: visible,\n                zoom: zoom,\n                decodeParams: decodeParamsSub,\n                decodeFunction: decodeFunctionSub,\n                opacity: opacity\n              });\n            }\n\n            return null;\n          },\n          minZoom: source.minzoom,\n          maxZoom: source.maxzoom,\n          opacity: layerModel.opacity,\n          decodeParams: decodeParams,\n          decodeFunction: decodeFunction\n        });\n      })))\n    };\n  } else {\n    layer = {\n      id: id,\n      type: 'raster',\n      source: _extends({\n        type: 'raster',\n        tileSize: 256\n      }, source),\n      layers: getVectorStyleLayers(layers.map(function (l) {\n        return _extends({}, DEFAULT_RASTER_OPTIONS, l);\n      }), layerModel)\n    };\n  }\n\n  if (provider && (provider.type === 'cartodb' || provider.type === 'carto')) {\n    return new CancelablePromise(function (resolve, reject) {\n      fetchCartoAnonymous(layerModel).then(function (response) {\n        var tileUrl = response.cdn_url.templates.https.url.replace('{s}', 'a') + '/' + provider.options.account + '/api/v1/map/' + response.layergroupid + '/{z}/{x}/{y}.png';\n        return resolve(_extends({}, layer, {\n          source: {\n            type: 'raster',\n            tileSize: 256,\n            tiles: [tileUrl]\n          }\n        }));\n      }).catch(function (err) {\n        return reject(err);\n      });\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n\nvar VectorLayer = function VectorLayer(layerModel) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      id = layerModel.id;\n  var provider = source.provider;\n  var layers = render.layers;\n\n  var layer = _extends({\n    id: id,\n    source: _extends({\n      type: 'vector'\n    }, source)\n  }, render, {\n    layers: getVectorStyleLayers(layers, layerModel)\n  });\n\n  if (provider && (provider.type === 'cartodb' || provider.type === 'carto')) {\n    return new CancelablePromise(function (resolve, reject) {\n      fetchCartoAnonymous(layerModel).then(function (response) {\n        var tileUrl = response.cdn_url.templates.https.url.replace('{s}', 'a') + '/' + provider.options.account + '/api/v1/map/' + response.layergroupid + '/{z}/{x}/{y}.mvt';\n        return resolve(_extends({}, layer, {\n          source: {\n            type: 'vector',\n            tiles: [tileUrl]\n          }\n        }));\n      }).catch(function (err) {\n        return reject(err);\n      });\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n\nvar fetchGeojsonData = function fetchGeojsonData(layerModel) {\n  var source = layerModel.source,\n      params = layerModel.params,\n      sqlParams = layerModel.sqlParams,\n      layerRequest = layerModel.layerRequest;\n  var sourceParsed = source.parse === false || typeof source.parse === 'function' ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams));\n\n  var _ref = sourceParsed || {},\n      data = _ref.data;\n\n  if (layerRequest) {\n    layerRequest.cancel('Operation canceled by the user.');\n  }\n\n  var layerRequestSource = CancelToken.source();\n  layerModel.set('layerRequest', layerRequestSource);\n  var newLayerRequest = get$1(data, {\n    cancelToken: layerRequestSource.token\n  }).then(function (res) {\n    if (res.status > 400) {\n      console.error(res);\n      return false;\n    }\n\n    return res.data;\n  });\n  return newLayerRequest;\n};\n\nvar GeoJsonLayer = function GeoJsonLayer(layerModel) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      id = layerModel.id;\n  var layers = render.layers;\n\n  var layer = _extends({\n    id: id,\n    source: _extends({\n      type: 'geojson'\n    }, source)\n  }, render, {\n    layers: getVectorStyleLayers(layers, layerModel)\n  });\n\n  if (source.parse && typeof source.parse === 'function') {\n    return new CancelablePromise(function (resolve, reject) {\n      fetchGeojsonData(layerModel).then(function (response) {\n        var data = source.parse(response);\n\n        var layerWithData = _extends({}, layer, {\n          source: _extends({\n            type: 'geojson'\n          }, source, {\n            data: data\n          })\n        });\n\n        resolve(layerWithData);\n      }).catch(function (err) {\n        return reject(err);\n      });\n    });\n  }\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('\"type\" specified in layer spec doesn`t exist'));\n    }\n  });\n};\n\nvar VideoLayer = function VideoLayer(layerModel) {\n  var _layerModel$source = layerModel.source,\n      source = _layerModel$source === undefined ? {} : _layerModel$source,\n      _layerModel$render = layerModel.render,\n      render = _layerModel$render === undefined ? {} : _layerModel$render,\n      params = layerModel.params,\n      sqlParams = layerModel.sqlParams,\n      id = layerModel.id;\n  var sourceParsed = source.parse === false ? source : JSON.parse(replace(JSON.stringify(source), params, sqlParams));\n  var renderParsed = render.parse === false ? source : JSON.parse(replace(JSON.stringify(render), params, sqlParams));\n\n  var layer = _extends({\n    id: id,\n    type: 'raster',\n    source: _extends({}, sourceParsed, {\n      type: 'video-tiled',\n      // tiles: [ \"https://storage.googleapis.com/skydipper_materials/movie-tiles/MODIS/{z}/{x}/{y}.mp4\" ],\n      tiles: ['https://storage.googleapis.com/skydipper_materials/movie-tiles/EVI_TEST/{z}/{x}/{y}.mp4'],\n      scheme: 'xyz',\n      tileSize: 256,\n      minzoom: 1,\n      maxzoom: 4,\n      playbackRate: 0.1 // geometryFilter: 'https://storage.googleapis.com/deltares-video-map/mapbox-test/test1/geometry-filter.geojson'\n\n    })\n  }, renderParsed, {\n    layers: [{\n      id: id + '-raster',\n      type: 'raster',\n      source: id\n    }]\n  });\n\n  return new CancelablePromise(function (resolve, reject) {\n    if (layer) {\n      resolve(layer);\n    } else {\n      reject(new Error('error in layer config'));\n    }\n  });\n};\n/* eslint-disable no-underscore-dangle */\n\n\nvar PluginMapboxGL = function () {\n  function PluginMapboxGL(map, options) {\n    var _this = this;\n\n    classCallCheck(this, PluginMapboxGL);\n    this.type = {\n      raster: RasterLayer,\n      vector: VectorLayer,\n      geojson: GeoJsonLayer,\n      video: VideoLayer\n    };\n    this.map = map;\n    this.options = options; // You can change mapStyles and all the layers will be repositioned\n\n    this.map.on('style.load', function () {\n      var layers = _this.getLayers();\n\n      layers.forEach(function (layer) {\n        return _this.add(layer);\n      });\n    });\n  }\n\n  createClass(PluginMapboxGL, [{\n    key: 'add',\n\n    /**\n     * Add a layer\n     * @param {Object} layerModel\n     */\n    value: function add(layerModel) {\n      var _this2 = this;\n\n      var mapLayer = layerModel.mapLayer;\n      var allLayers = this.getLayers(); // add source if it has one\n\n      if (this.map && mapLayer && mapLayer.source && mapLayer.id && !this.map.getSource(mapLayer.id)) {\n        this.map.addSource(mapLayer.id, mapLayer.source);\n      } // add layers\n\n\n      if (mapLayer && mapLayer.layers) {\n        mapLayer.layers.forEach(function (l) {\n          var _l$metadata = l.metadata,\n              metadata = _l$metadata === undefined ? {} : _l$metadata;\n          var nextLayerId = metadata.position === 'top' ? null : _this2.getNextLayerId(layerModel);\n\n          if (!_this2.map.getLayer(l.id)) {\n            _this2.map.addLayer(l, nextLayerId);\n          }\n\n          allLayers.forEach(function () {\n            _this2.setZIndex();\n          });\n        });\n      }\n    }\n    /**\n     * Remove a layer\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'remove',\n    value: function remove() {\n      var _this3 = this;\n\n      var layerModel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var mapLayer = layerModel.mapLayer;\n\n      if (mapLayer && mapLayer.layers && this.map && this.map.style) {\n        mapLayer.layers.forEach(function (l) {\n          if (_this3.map.getLayer(l.id)) {\n            _this3.map.removeLayer(l.id);\n          }\n        });\n      }\n\n      if (mapLayer && !!this.map && this.map.getSource(mapLayer.id)) {\n        this.map.removeSource(mapLayer.id);\n      }\n    }\n    /**\n     * Get method by type\n     * @param {String} type\n     */\n\n  }, {\n    key: 'getLayerByType',\n    value: function getLayerByType(type) {\n      return this.type[type];\n    }\n    /**\n     * Get all mapbox layers\n     */\n\n  }, {\n    key: 'getLayersOnMap',\n    value: function getLayersOnMap() {\n      return this.map.getStyle().layers;\n    }\n  }, {\n    key: 'getLayer',\n    value: function getLayer(layerModel) {\n      var mapLayer = layerModel.mapLayer;\n\n      if (this.map) {\n        return this.map.getSource(mapLayer.id);\n      }\n\n      return null;\n    }\n    /**\n     * Get all layers passed to layer manager\n     */\n\n  }, {\n    key: 'getLayers',\n    value: function getLayers() {\n      var getLayers = this.options.getLayers;\n      var layers = getLayers();\n      return sortBy(layers, function (l) {\n        return l.decodeFunction;\n      });\n    }\n    /**\n     * Get the layer above the given z-index\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'getNextLayerId',\n    value: function getNextLayerId(layerModel) {\n      var zIndex = layerModel.zIndex;\n      var allLayers = this.getLayers();\n      var layersOnMap = this.getLayersOnMap(); // find the top layer for placing data layers below\n\n      var customLayer = layersOnMap && layersOnMap.length && layersOnMap.find(function (l) {\n        return l.id.includes('custom-layers') || l.id.includes('label') || l.id.includes('place') || l.id.includes('poi');\n      }); // make sure layers are sorted by zIndex\n\n      var sortedLayers = sortBy(allLayers, function (l) {\n        return l.zIndex;\n      }); // get the layer with zIndex greater than current layer from all layers\n\n      var nextLayer = sortedLayers.find(function (l) {\n        return l.zIndex > zIndex && (!l.mapLayer || !l.mapLayer.layers || !l.mapLayer.layers[0] || !l.mapLayer.layers[0].metadata || !l.mapLayer.layers[0].metadata.position);\n      }); // if no layer above it then use the custom layer\n\n      if (!nextLayer || !!nextLayer && !nextLayer.mapLayer) {\n        return customLayer.id;\n      } // get the first layer of the next layer's array\n\n\n      var nextLayerMapLayers = nextLayer.mapLayer.layers;\n      var nextLayerMapLayer = nextLayerMapLayers[0]; // Filter layers with custom metadata position\n\n      var id = nextLayerMapLayer.id; // if it has a layer above it, check if that layer has been added to the map and get its id\n\n      var isNextLayerOnMap = !!layersOnMap.find(function (l) {\n        return id === l.id;\n      }); // if next layer is on map return the id, else return the custom layer to add below\n\n      return isNextLayerOnMap ? id : customLayer.id;\n    }\n    /**\n     * A namespace to set z-index\n     * @param {Object} layerModel\n     */\n\n  }, {\n    key: 'setZIndex',\n    value: function setZIndex() {\n      var _this4 = this;\n\n      var allLayers = this.getLayers();\n      var layersOnMap = this.getLayersOnMap(); // set zIndex for all layers currently on map\n\n      layersOnMap.forEach(function (l) {\n        var id = l.id,\n            _l$metadata2 = l.metadata,\n            metadata = _l$metadata2 === undefined ? {} : _l$metadata2;\n        var layerModel = allLayers.find(function (ly) {\n          return id.includes(ly.id);\n        });\n\n        if (layerModel) {\n          var nextLayerId = metadata.position === 'top' ? null : _this4.getNextLayerId(layerModel);\n\n          _this4.map.moveLayer(id, nextLayerId);\n        }\n      }); // set for all decode layers that don't exist inside mapStyle()\n\n      var decodeLayers = allLayers.filter(function (l) {\n        return !!l.decodeFunction;\n      });\n\n      if (decodeLayers && this.map) {\n        decodeLayers.forEach(function (layerModel) {\n          var mapLayer = layerModel.mapLayer;\n\n          if (mapLayer) {\n            var layers = mapLayer.layers;\n            var parentLayer = layers[0];\n            var childLayer = layers[1];\n            var parentLayerOnMap = layersOnMap.find(function (ly) {\n              return ly.id === parentLayer.id;\n            });\n\n            var childLayerOnMap = _this4.map.getLayer(childLayer.id);\n\n            if (parentLayerOnMap && childLayerOnMap) {\n              _this4.map.moveLayer(childLayer.id, parentLayer.id);\n            }\n          }\n        });\n      }\n\n      return true;\n    }\n    /**\n     * A namespace to set opacity\n     * @param {Object} layerModel\n     * @param {Number} opacity\n     */\n\n  }, {\n    key: 'setOpacity',\n    value: function setOpacity(layerModel, opacity) {\n      var _this5 = this;\n\n      var PAINT_STYLE_NAMES = {\n        symbol: ['icon', 'text'],\n        circle: ['circle', 'circle-stroke']\n      };\n      var render = layerModel.render,\n          mapLayer = layerModel.mapLayer,\n          decodeFunction = layerModel.decodeFunction;\n      var _render$layers = render.layers,\n          layers = _render$layers === undefined ? [] : _render$layers;\n\n      if (mapLayer.layers && !decodeFunction) {\n        mapLayer.layers.forEach(function (l) {\n          // Select the style to change depending on the type of layer\n          var paintStyleNames = PAINT_STYLE_NAMES[l.type] || [l.type]; // Select the paint property from the original layer\n\n          var _ref = layers.find(function (v, i) {\n            return (v.id || l.source + '-' + v.type + '-' + i) === l.id;\n          }) || {},\n              _ref$paint = _ref.paint,\n              paint = _ref$paint === undefined ? {} : _ref$paint; // Loop each style name and check if there is an opacity in the original layer\n\n\n          paintStyleNames.forEach(function (name) {\n            var currentProperty = paint[name + '-opacity'];\n            var paintOpacity = currentProperty !== undefined ? currentProperty : 1;\n\n            _this5.map.setPaintProperty(l.id, name + '-opacity', paintOpacity * opacity * 0.99);\n          });\n        });\n      }\n\n      if (decodeFunction) {\n        var layer = mapLayer.layers[1];\n\n        if (layer && typeof layer.setProps === 'function') {\n          layer.setProps({\n            opacity: opacity\n          });\n        }\n      }\n    }\n    /**\n     * A namespace to hide or show a selected layer\n     * @param {Object} layerModel\n     * @param {Boolean} visibility\n     */\n\n  }, {\n    key: 'setVisibility',\n    value: function setVisibility(layerModel, visibility) {\n      var _this6 = this;\n\n      var mapLayer = layerModel.mapLayer;\n\n      if (mapLayer && mapLayer.layers && this.map && this.map.style) {\n        mapLayer.layers.forEach(function (l) {\n          _this6.map.setLayoutProperty(l.id, 'visibility', visibility ? 'visible' : 'none');\n        });\n      }\n    }\n  }, {\n    key: 'setSource',\n    value: function setSource(layerModel) {\n      var id = layerModel.id,\n          source = layerModel.source;\n      var type = source.type,\n          data = source.data;\n\n      if (this.map && type === 'geojson' && typeof data !== 'string') {\n        var src = this.map.getSource(id);\n        src.setData(data);\n      }\n\n      return this;\n    }\n  }, {\n    key: 'setRender',\n    value: function setRender(layerModel) {\n      var _this7 = this;\n\n      var mapLayer = layerModel.mapLayer,\n          render = layerModel.render;\n      var _render$layers2 = render.layers,\n          renderLayers = _render$layers2 === undefined ? [] : _render$layers2;\n\n      if (!mapLayer || !renderLayers.length) {\n        return this;\n      }\n\n      try {\n        mapLayer.layers.forEach(function (layer, i) {\n          var id = layer.id;\n          var rl = renderLayers[i] || renderLayers[0] || {}; // take the style for each layer or use the first one for all of them\n\n          var _rl$paint = rl.paint,\n              paint = _rl$paint === undefined ? {} : _rl$paint,\n              _rl$layout = rl.layout,\n              layout = _rl$layout === undefined ? {} : _rl$layout,\n              _rl$filter = rl.filter,\n              filter = _rl$filter === undefined ? null : _rl$filter;\n\n          _this7.map.setFilter(id, filter);\n\n          Object.keys(paint).forEach(function (p) {\n            // console.log(id, p, paint[p]);\n            _this7.map.setPaintProperty(id, p, paint[p]);\n          });\n          Object.keys(layout).forEach(function (l) {\n            _this7.map.setLayoutProperty(id, l, layout[l]);\n          });\n        });\n      } catch (error) {\n        console.error(error);\n      }\n\n      return this;\n    }\n  }, {\n    key: 'setParams',\n    value: function setParams() {\n      return this;\n    }\n  }, {\n    key: 'setSQLParams',\n    value: function setSQLParams() {\n      return this;\n    }\n  }, {\n    key: 'setDecodeParams',\n    value: function setDecodeParams(layerModel) {\n      var mapLayer = layerModel.mapLayer,\n          decodeParams = layerModel.decodeParams;\n\n      if (!mapLayer) {\n        return this;\n      }\n\n      var layer = mapLayer.layers[1];\n\n      if (layer && typeof layer.setProps === 'function') {\n        layer.setProps({\n          decodeParams: decodeParams\n        });\n      } else {\n        console.error(\"Layer is not present. You defined decodeParams but maybe you didn't define a decodeFunction\");\n      }\n\n      return this;\n    }\n  }, {\n    key: 'unmount',\n    value: function unmount() {\n      this.map = null;\n    }\n  }]);\n  return PluginMapboxGL;\n}();\n\nexport default LayerManager;\nexport { PluginMapboxGL as PluginMapboxGl, replace, substitution, concatenation };","export default [\n  // RASTER LAYER\n  {\n    id: 'gain',\n    name: 'Tree cover gain',\n    config: {\n      type: 'raster',\n      source: {\n        type: 'raster',\n        tiles: ['https://earthengine.google.org/static/hansen_2013/gain_alpha/{z}/{x}/{y}.png'],\n        minzoom: 3,\n        maxzoom: 12\n      }\n    },\n    legendConfig: {\n      type: 'basic',\n      items: [{ name: 'Tree cover gain', color: '#6D6DE5' }]\n    }\n  },\n\n  // DECODED RASTER LAYER\n  {\n    id: 'loss',\n    name: 'Tree cover loss',\n    config: {\n      type: 'raster',\n      source: {\n        type: 'raster',\n        tiles: [\n          'https://storage.googleapis.com/wri-public/Hansen_16/tiles/hansen_world/v1/tc30/{z}/{x}/{y}.png'\n        ],\n        minzoom: 3,\n        maxzoom: 12\n      }\n    },\n    legendConfig: {\n      enabled: true\n    },\n    decodeConfig: [\n      {\n        default: '2001-01-01',\n        key: 'startDate',\n        required: true\n      },\n      {\n        default: '2018-12-31',\n        key: 'endDate',\n        required: true\n      }\n    ],\n    timelineConfig: {\n      step: 1,\n      speed: 250,\n      interval: 'years',\n      dateFormat: 'YYYY',\n      trimEndDate: '2018-12-31',\n      maxDate: '2018-12-31',\n      minDate: '2001-01-01',\n      canPlay: true,\n      railStyle: {\n        background: '#DDD'\n      },\n      trackStyle: [\n        {\n          background: '#dc6c9a'\n        },\n        {\n          background: '#982d5f'\n        }\n      ]\n    },\n    decodeFunction: `\n      // values for creating power scale, domain (input), and range (output)\n      float domainMin = 0.;\n      float domainMax = 255.;\n      float rangeMin = 0.;\n      float rangeMax = 255.;\n\n      float exponent = zoom < 13. ? 0.3 + (zoom - 3.) / 20. : 1.;\n      float intensity = color.r * 255.;\n\n      // get the min, max, and current values on the power scale\n      float minPow = pow(domainMin, exponent - domainMin);\n      float maxPow = pow(domainMax, exponent);\n      float currentPow = pow(intensity, exponent);\n\n      // get intensity value mapped to range\n      float scaleIntensity = ((currentPow - minPow) / (maxPow - minPow) * (rangeMax - rangeMin)) + rangeMin;\n      // a value between 0 and 255\n      alpha = zoom < 13. ? scaleIntensity / 255. : color.g;\n\n      float year = 2000.0 + (color.b * 255.);\n      // map to years\n      if (year >= startYear && year <= endYear && year >= 2001.) {\n        color.r = 220. / 255.;\n        color.g = (72. - zoom + 102. - 3. * scaleIntensity / zoom) / 255.;\n        color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n      } else {\n        alpha = 0.;\n      }\n    `\n  },\n\n  // VECTOR - PROVIDER CARTO\n  {\n    id: 'protected-areas',\n    name: 'Protected areas',\n    config: {\n      type: 'vector',\n      source: {\n        type: 'vector',\n        provider: {\n          type: 'carto',\n          options: {\n            account: 'wri-01',\n            layers: [\n              {\n                options: {\n                  cartocss:\n                    '#wdpa_protected_areas {  polygon-opacity: 1.0; polygon-fill: #704489 }',\n                  cartocss_version: '2.3.0',\n                  sql: 'SELECT * FROM wdpa_protected_areas'\n                },\n                type: 'mapnik'\n              }\n            ]\n          }\n        }\n      },\n      render: {\n        layers: [\n          {\n            type: 'fill',\n            'source-layer': 'layer0',\n            paint: {\n              'fill-color': '#5ca2d1',\n              'fill-opacity': 1\n            }\n          },\n          {\n            type: 'line',\n            'source-layer': 'layer0',\n            paint: {\n              'line-color': '#000000',\n              'line-opacity': 0.1\n            }\n          }\n        ]\n      }\n    },\n    paramsConfig: [],\n    legendConfig: {\n      type: 'basic',\n      items: [{ name: 'Protected areas', color: '#5ca2d1' }]\n    }\n  }\n];\n","import React, { useState } from 'react';\n\nimport { getParams } from './utils';\n\n// Components\nimport Map from 'components/map';\nimport Sidebar from 'components/sidebar';\nimport AceEditor from 'react-ace';\nimport 'ace-builds/src-noconflict/mode-json';\nimport 'ace-builds/src-noconflict/theme-github';\n\n// Layer manager\nimport { LayerManager, Layer } from 'layer-manager/dist/components';\nimport { PluginMapboxGl } from 'layer-manager';\n\n// Legend\nimport {\n  Icons,\n  Legend,\n  LegendListItem,\n  LegendItemTypes,\n  LegendItemTimeStep,\n  LegendItemToolbar,\n  LegendItemButtonOpacity,\n  LegendItemButtonVisibility\n} from 'vizzuality-components';\n\n// DATA\nimport DEFAULT_LAYERS from './layers';\n\nimport './App.scss';\n\nfunction App() {\n  const [layers, setLayers] = useState(DEFAULT_LAYERS);\n  const [layersJson, setLayersJson] = useState(JSON.stringify(DEFAULT_LAYERS, null, 2));\n  const [layersSettings, setLayersSettings] = useState({});\n\n  const layerGroups = layers.map(l => {\n    const { id, paramsConfig, sqlConfig, decodeConfig, timelineConfig } = l;\n    const lSettings = layersSettings[id] || {};\n\n    const params = !!paramsConfig && getParams(paramsConfig, lSettings.params);\n    const sqlParams = !!sqlConfig && getParams(sqlConfig, lSettings.sqlParams);\n    const decodeParams =\n      !!decodeConfig && getParams(decodeConfig, { ...timelineConfig, ...lSettings.decodeParams });\n    const timelineParams = !!timelineConfig && {\n      ...timelineConfig,\n      ...getParams(paramsConfig, lSettings.params),\n      ...getParams(decodeConfig, lSettings.decodeParams)\n    };\n\n    return {\n      id,\n      slug: id,\n      dataset: id,\n      layers: [\n        {\n          active: true,\n          ...l,\n          ...lSettings,\n          params,\n          sqlParams,\n          decodeParams,\n          timelineParams\n        }\n      ],\n      ...lSettings\n    };\n  });\n\n  const onChangeJson = json => {\n    setLayersJson(json);\n\n    try {\n      const newLayers = JSON.parse(json);\n      setLayers(newLayers);\n    } catch (e) {\n      // do nothing\n    }\n  };\n\n  const onChangeOrder = ids => {\n    console.log('onChangeOrder', ids);\n  };\n\n  const onChangeVisibility = (l, visibility) => {\n    setLayersSettings({\n      ...layersSettings,\n      [l.id]: {\n        ...layersSettings[l.id],\n        visibility\n      }\n    });\n  };\n\n  const onChangeOpacity = (l, opacity) => {\n    setLayersSettings({\n      ...layersSettings,\n      [l.id]: {\n        ...layersSettings[l.id],\n        opacity\n      }\n    });\n  };\n\n  const onChangeLayerDate = (dates, layer) => {\n    const { id, decodeConfig } = layer;\n\n    setLayersSettings({\n      ...layersSettings,\n      [id]: {\n        ...layersSettings[id],\n        ...(decodeConfig && {\n          decodeParams: {\n            startDate: dates[0],\n            endDate: dates[1],\n            trimEndDate: dates[2]\n          }\n        }),\n        ...(!decodeConfig && {\n          params: {\n            startDate: dates[0],\n            endDate: dates[1]\n          }\n        })\n      }\n    });\n  };\n\n  return (\n    <div className=\"c-app\">\n      <Icons />\n\n      <div className=\"c-main\">\n        <Sidebar>\n          <AceEditor\n            mode=\"json\"\n            theme=\"github\"\n            value={layersJson}\n            onChange={onChangeJson}\n            tabSize={2}\n            width=\"100%\"\n            height=\"100%\"\n            wrapEnabled\n            showPrintMargin={false}\n            editorProps={{ $blockScrolling: true }}\n            debounceChangePeriod={500}\n          />\n        </Sidebar>\n\n        <div className=\"c-map-container\">\n          <Map\n            mapboxApiAccessToken={process.env.REACT_APP_MAPBOX_TOKEN}\n            mapStyle=\"mapbox://styles/layer-manager/ck07vfinn01xm1co324q5vcdl\"\n            minZoom={2}\n          >\n            {map => (\n              <LayerManager map={map} plugin={PluginMapboxGl}>\n                {layers.map(layer => {\n                  const {\n                    id,\n                    paramsConfig,\n                    sqlConfig,\n                    decodeConfig,\n                    timelineConfig,\n                    decodeFunction\n                  } = layer;\n                  const lSettings = layersSettings[id] || {};\n\n                  const l = {\n                    ...layer,\n                    ...layer.config,\n                    ...lSettings,\n                    ...(!!paramsConfig && {\n                      params: getParams(paramsConfig, { ...lSettings.params })\n                    }),\n\n                    ...(!!sqlConfig && {\n                      sqlParams: getParams(sqlConfig, { ...lSettings.sqlParams })\n                    }),\n\n                    ...(!!decodeConfig && {\n                      decodeParams: getParams(decodeConfig, {\n                        ...timelineConfig,\n                        ...lSettings.decodeParams\n                      }),\n                      decodeFunction\n                    })\n                  };\n\n                  return <Layer key={layer.id} {...l} />;\n                })}\n              </LayerManager>\n            )}\n          </Map>\n\n          <div className=\"c-legend\">\n            <Legend\n              maxHeight={'65vh'}\n              collapsable={false}\n              sortable={false}\n              onChangeOrder={onChangeOrder}\n            >\n              {layerGroups.map((layerGroup, i) => {\n                return (\n                  <LegendListItem\n                    index={i}\n                    key={layerGroup.slug}\n                    layerGroup={layerGroup}\n                    toolbar={\n                      <LegendItemToolbar>\n                        <LegendItemButtonOpacity\n                          trackStyle={{\n                            background: '#FFCC00'\n                          }}\n                          handleStyle={{\n                            background: '#FFCC00'\n                          }}\n                        />\n                        <LegendItemButtonVisibility />\n                      </LegendItemToolbar>\n                    }\n                    onChangeVisibility={onChangeVisibility}\n                    onChangeOpacity={onChangeOpacity}\n                  >\n                    <LegendItemTypes />\n\n                    <LegendItemTimeStep\n                      defaultStyles={{\n                        handleStyle: {\n                          backgroundColor: 'white',\n                          borderRadius: '50%',\n                          boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.29)',\n                          border: '0px',\n                          zIndex: 2\n                        },\n                        railStyle: { backgroundColor: '#d6d6d9' },\n                        dotStyle: { visibility: 'hidden', border: '0px' }\n                      }}\n                      handleChange={onChangeLayerDate}\n                    />\n                  </LegendListItem>\n                );\n              })}\n            </Legend>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport './styles/index.scss';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}